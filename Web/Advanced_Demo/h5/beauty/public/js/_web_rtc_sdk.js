/*
* Copyright (c) 2020 The VolcEngineRTC project authors. All Rights Reserved.
* @brief VolcEngine Advance API
* version: 4.54.0
*/
!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?module.exports=t():"function"==typeof define&&define.amd?define(t):(e="undefined"!=typeof globalThis?globalThis:e||self).VERTC=t()}(this,(function(){"use strict";function e(e,t){return t.forEach((function(t){t&&"string"!=typeof t&&!Array.isArray(t)&&Object.keys(t).forEach((function(r){if("default"!==r&&!(r in e)){var n=Object.getOwnPropertyDescriptor(t,r);Object.defineProperty(e,r,n.get?n:{enumerable:!0,get:function(){return t[r]}})}}))})),Object.freeze(Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}))}var t="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:{},r=function(e){return e&&e.Math==Math&&e},n=r("object"==typeof globalThis&&globalThis)||r("object"==typeof window&&window)||r("object"==typeof self&&self)||r("object"==typeof t&&t)||function(){return this}()||Function("return this")(),i=function(e){try{return!!e()}catch(t){return!0}},o=!i((function(){var e=function(){}.bind();return"function"!=typeof e||e.hasOwnProperty("prototype")})),a=o,s=Function.prototype,c=s.apply,u=s.call,d="object"==typeof Reflect&&Reflect.apply||(a?u.bind(c):function(){return u.apply(c,arguments)}),l=o,h=Function.prototype,p=h.call,_=l&&h.bind.bind(p,p),v=l?_:function(e){return function(){return p.apply(e,arguments)}},f=v,m=f({}.toString),g=f("".slice),y=function(e){return g(m(e),8,-1)},S=y,b=v,E=function(e){if("Function"===S(e))return b(e)},T="object"==typeof document&&document.all,k={all:T,IS_HTMLDDA:void 0===T&&void 0!==T},I=k.all,R=k.IS_HTMLDDA?function(e){return"function"==typeof e||e===I}:function(e){return"function"==typeof e},A={},C=!i((function(){return 7!=Object.defineProperty({},1,{get:function(){return 7}})[1]})),w=o,x=Function.prototype.call,O=w?x.bind(x):function(){return x.apply(x,arguments)},P={},D={}.propertyIsEnumerable,M=Object.getOwnPropertyDescriptor,N=M&&!D.call({1:2},1);P.f=N?function(e){var t=M(this,e);return!!t&&t.enumerable}:D;var L,U,V=function(e,t){return{enumerable:!(1&e),configurable:!(2&e),writable:!(4&e),value:t}},F=i,B=y,j=Object,G=E("".split),H=F((function(){return!j("z").propertyIsEnumerable(0)}))?function(e){return"String"==B(e)?G(e,""):j(e)}:j,z=function(e){return null==e},K=z,X=TypeError,W=function(e){if(K(e))throw X("Can't call method on "+e);return e},q=H,Y=W,J=function(e){return q(Y(e))},Q=R,Z=k.all,$=k.IS_HTMLDDA?function(e){return"object"==typeof e?null!==e:Q(e)||e===Z}:function(e){return"object"==typeof e?null!==e:Q(e)},ee={},te=ee,re=n,ne=R,ie=function(e){return ne(e)?e:void 0},oe=function(e,t){return arguments.length<2?ie(te[e])||ie(re[e]):te[e]&&te[e][t]||re[e]&&re[e][t]},ae=E({}.isPrototypeOf),se=oe("navigator","userAgent")||"",ce=n,ue=se,de=ce.process,le=ce.Deno,he=de&&de.versions||le&&le.version,pe=he&&he.v8;pe&&(U=(L=pe.split("."))[0]>0&&L[0]<4?1:+(L[0]+L[1])),!U&&ue&&(!(L=ue.match(/Edge\/(\d+)/))||L[1]>=74)&&(L=ue.match(/Chrome\/(\d+)/))&&(U=+L[1]);var _e=U,ve=_e,fe=i,me=!!Object.getOwnPropertySymbols&&!fe((function(){var e=Symbol();return!String(e)||!(Object(e)instanceof Symbol)||!Symbol.sham&&ve&&ve<41})),ge=me&&!Symbol.sham&&"symbol"==typeof Symbol.iterator,ye=oe,Se=R,be=ae,Ee=Object,Te=ge?function(e){return"symbol"==typeof e}:function(e){var t=ye("Symbol");return Se(t)&&be(t.prototype,Ee(e))},ke=String,Ie=function(e){try{return ke(e)}catch(t){return"Object"}},Re=R,Ae=Ie,Ce=TypeError,we=function(e){if(Re(e))return e;throw Ce(Ae(e)+" is not a function")},xe=we,Oe=z,Pe=function(e,t){var r=e[t];return Oe(r)?void 0:xe(r)},De=O,Me=R,Ne=$,Le=TypeError,Ue={exports:{}},Ve=n,Fe=Object.defineProperty,Be=function(e,t){try{Fe(Ve,e,{value:t,configurable:!0,writable:!0})}catch(r){Ve[e]=t}return t},je="__core-js_shared__",Ge=n[je]||Be(je,{}),He=Ge;(Ue.exports=function(e,t){return He[e]||(He[e]=void 0!==t?t:{})})("versions",[]).push({version:"3.26.0",mode:"pure",copyright:"Â© 2014-2022 Denis Pushkarev (zloirock.ru)",license:"https://github.com/zloirock/core-js/blob/v3.26.0/LICENSE",source:"https://github.com/zloirock/core-js"});var ze=W,Ke=Object,Xe=function(e){return Ke(ze(e))},We=Xe,qe=E({}.hasOwnProperty),Ye=Object.hasOwn||function(e,t){return qe(We(e),t)},Je=E,Qe=0,Ze=Math.random(),$e=Je(1..toString),et=function(e){return"Symbol("+(void 0===e?"":e)+")_"+$e(++Qe+Ze,36)},tt=n,rt=Ue.exports,nt=Ye,it=et,ot=me,at=ge,st=rt("wks"),ct=tt.Symbol,ut=ct&&ct.for,dt=at?ct:ct&&ct.withoutSetter||it,lt=function(e){if(!nt(st,e)||!ot&&"string"!=typeof st[e]){var t="Symbol."+e;ot&&nt(ct,e)?st[e]=ct[e]:st[e]=at&&ut?ut(t):dt(t)}return st[e]},ht=O,pt=$,_t=Te,vt=Pe,ft=function(e,t){var r,n;if("string"===t&&Me(r=e.toString)&&!Ne(n=De(r,e)))return n;if(Me(r=e.valueOf)&&!Ne(n=De(r,e)))return n;if("string"!==t&&Me(r=e.toString)&&!Ne(n=De(r,e)))return n;throw Le("Can't convert object to primitive value")},mt=TypeError,gt=lt("toPrimitive"),yt=function(e,t){if(!pt(e)||_t(e))return e;var r,n=vt(e,gt);if(n){if(void 0===t&&(t="default"),r=ht(n,e,t),!pt(r)||_t(r))return r;throw mt("Can't convert object to primitive value")}return void 0===t&&(t="number"),ft(e,t)},St=Te,bt=function(e){var t=yt(e,"string");return St(t)?t:t+""},Et=$,Tt=n.document,kt=Et(Tt)&&Et(Tt.createElement),It=function(e){return kt?Tt.createElement(e):{}},Rt=It,At=!C&&!i((function(){return 7!=Object.defineProperty(Rt("div"),"a",{get:function(){return 7}}).a})),Ct=C,wt=O,xt=P,Ot=V,Pt=J,Dt=bt,Mt=Ye,Nt=At,Lt=Object.getOwnPropertyDescriptor;A.f=Ct?Lt:function(e,t){if(e=Pt(e),t=Dt(t),Nt)try{return Lt(e,t)}catch(r){}if(Mt(e,t))return Ot(!wt(xt.f,e,t),e[t])};var Ut=i,Vt=R,Ft=/#|\.prototype\./,Bt=function(e,t){var r=Gt[jt(e)];return r==zt||r!=Ht&&(Vt(t)?Ut(t):!!t)},jt=Bt.normalize=function(e){return String(e).replace(Ft,".").toLowerCase()},Gt=Bt.data={},Ht=Bt.NATIVE="N",zt=Bt.POLYFILL="P",Kt=Bt,Xt=we,Wt=o,qt=E(E.bind),Yt=function(e,t){return Xt(e),void 0===t?e:Wt?qt(e,t):function(){return e.apply(t,arguments)}},Jt={},Qt=C&&i((function(){return 42!=Object.defineProperty((function(){}),"prototype",{value:42,writable:!1}).prototype})),Zt=$,$t=String,er=TypeError,tr=function(e){if(Zt(e))return e;throw er($t(e)+" is not an object")},rr=C,nr=At,ir=Qt,or=tr,ar=bt,sr=TypeError,cr=Object.defineProperty,ur=Object.getOwnPropertyDescriptor,dr="enumerable",lr="configurable",hr="writable";Jt.f=rr?ir?function(e,t,r){if(or(e),t=ar(t),or(r),"function"==typeof e&&"prototype"===t&&"value"in r&&hr in r&&!r.writable){var n=ur(e,t);n&&n.writable&&(e[t]=r.value,r={configurable:lr in r?r.configurable:n.configurable,enumerable:dr in r?r.enumerable:n.enumerable,writable:!1})}return cr(e,t,r)}:cr:function(e,t,r){if(or(e),t=ar(t),or(r),nr)try{return cr(e,t,r)}catch(n){}if("get"in r||"set"in r)throw sr("Accessors not supported");return"value"in r&&(e[t]=r.value),e};var pr=Jt,_r=V,vr=C?function(e,t,r){return pr.f(e,t,_r(1,r))}:function(e,t,r){return e[t]=r,e},fr=n,mr=d,gr=E,yr=R,Sr=A.f,br=Kt,Er=ee,Tr=Yt,kr=vr,Ir=Ye,Rr=function(e){var t=function(r,n,i){if(this instanceof t){switch(arguments.length){case 0:return new e;case 1:return new e(r);case 2:return new e(r,n)}return new e(r,n,i)}return mr(e,this,arguments)};return t.prototype=e.prototype,t},Ar=function(e,t){var r,n,i,o,a,s,c,u,d=e.target,l=e.global,h=e.stat,p=e.proto,_=l?fr:h?fr[d]:(fr[d]||{}).prototype,v=l?Er:Er[d]||kr(Er,d,{})[d],f=v.prototype;for(i in t)r=!br(l?i:d+(h?".":"#")+i,e.forced)&&_&&Ir(_,i),a=v[i],r&&(s=e.dontCallGetSet?(u=Sr(_,i))&&u.value:_[i]),o=r&&s?s:t[i],r&&typeof a==typeof o||(c=e.bind&&r?Tr(o,fr):e.wrap&&r?Rr(o):p&&yr(o)?gr(o):o,(e.sham||o&&o.sham||a&&a.sham)&&kr(c,"sham",!0),kr(v,i,c),p&&(Ir(Er,n=d+"Prototype")||kr(Er,n,{}),kr(Er[n],i,o),e.real&&f&&!f[i]&&kr(f,i,o)))},Cr=Math.ceil,wr=Math.floor,xr=Math.trunc||function(e){var t=+e;return(t>0?wr:Cr)(t)},Or=function(e){var t=+e;return t!=t||0===t?0:xr(t)},Pr=Or,Dr=Math.max,Mr=Math.min,Nr=function(e,t){var r=Pr(e);return r<0?Dr(r+t,0):Mr(r,t)},Lr=Or,Ur=Math.min,Vr=function(e){return e>0?Ur(Lr(e),9007199254740991):0},Fr=Vr,Br=function(e){return Fr(e.length)},jr=J,Gr=Nr,Hr=Br,zr=function(e){return function(t,r,n){var i,o=jr(t),a=Hr(o),s=Gr(n,a);if(e&&r!=r){for(;a>s;)if((i=o[s++])!=i)return!0}else for(;a>s;s++)if((e||s in o)&&o[s]===r)return e||s||0;return!e&&-1}},Kr={includes:zr(!0),indexOf:zr(!1)},Xr={},Wr=Ye,qr=J,Yr=Kr.indexOf,Jr=Xr,Qr=E([].push),Zr=function(e,t){var r,n=qr(e),i=0,o=[];for(r in n)!Wr(Jr,r)&&Wr(n,r)&&Qr(o,r);for(;t.length>i;)Wr(n,r=t[i++])&&(~Yr(o,r)||Qr(o,r));return o},$r=["constructor","hasOwnProperty","isPrototypeOf","propertyIsEnumerable","toLocaleString","toString","valueOf"],en=Zr,tn=$r,rn=Object.keys||function(e){return en(e,tn)},nn=Xe,on=rn;Ar({target:"Object",stat:!0,forced:i((function(){on(1)}))},{keys:function(e){return on(nn(e))}});var an=ee.Object.keys,sn={};sn[lt("toStringTag")]="z";var cn="[object z]"===String(sn),un=cn,dn=R,ln=y,hn=lt("toStringTag"),pn=Object,_n="Arguments"==ln(function(){return arguments}()),vn=un?ln:function(e){var t,r,n;return void 0===e?"Undefined":null===e?"Null":"string"==typeof(r=function(e,t){try{return e[t]}catch(r){}}(t=pn(e),hn))?r:_n?ln(t):"Object"==(n=ln(t))&&dn(t.callee)?"Arguments":n},fn=vn,mn=String,gn=function(e){if("Symbol"===fn(e))throw TypeError("Cannot convert a Symbol value to a string");return mn(e)},yn={},Sn=C,bn=Qt,En=Jt,Tn=tr,kn=J,In=rn;yn.f=Sn&&!bn?Object.defineProperties:function(e,t){Tn(e);for(var r,n=kn(t),i=In(t),o=i.length,a=0;o>a;)En.f(e,r=i[a++],n[r]);return e};var Rn,An=oe("document","documentElement"),Cn=Ue.exports,wn=et,xn=Cn("keys"),On=function(e){return xn[e]||(xn[e]=wn(e))},Pn=tr,Dn=yn,Mn=$r,Nn=Xr,Ln=An,Un=It,Vn=On("IE_PROTO"),Fn=function(){},Bn=function(e){return"<script>"+e+"</"+"script>"},jn=function(e){e.write(Bn("")),e.close();var t=e.parentWindow.Object;return e=null,t},Gn=function(){try{Rn=new ActiveXObject("htmlfile")}catch(n){}var e,t;Gn="undefined"!=typeof document?document.domain&&Rn?jn(Rn):((t=Un("iframe")).style.display="none",Ln.appendChild(t),t.src=String("javascript:"),(e=t.contentWindow.document).open(),e.write(Bn("document.F=Object")),e.close(),e.F):jn(Rn);for(var r=Mn.length;r--;)delete Gn.prototype[Mn[r]];return Gn()};Nn[Vn]=!0;var Hn=Object.create||function(e,t){var r;return null!==e?(Fn.prototype=Pn(e),r=new Fn,Fn.prototype=null,r[Vn]=e):r=Gn(),void 0===t?r:Dn.f(r,t)},zn={},Kn=Zr,Xn=$r.concat("length","prototype");zn.f=Object.getOwnPropertyNames||function(e){return Kn(e,Xn)};var Wn={},qn=bt,Yn=Jt,Jn=V,Qn=function(e,t,r){var n=qn(t);n in e?Yn.f(e,n,Jn(0,r)):e[n]=r},Zn=Nr,$n=Br,ei=Qn,ti=Array,ri=Math.max,ni=function(e,t,r){for(var n=$n(e),i=Zn(t,n),o=Zn(void 0===r?n:r,n),a=ti(ri(o-i,0)),s=0;i<o;i++,s++)ei(a,s,e[i]);return a.length=s,a},ii=y,oi=J,ai=zn.f,si=ni,ci="object"==typeof window&&window&&Object.getOwnPropertyNames?Object.getOwnPropertyNames(window):[];Wn.f=function(e){return ci&&"Window"==ii(e)?function(e){try{return ai(e)}catch(t){return si(ci)}}(e):ai(oi(e))};var ui={};ui.f=Object.getOwnPropertySymbols;var di=vr,li=function(e,t,r,n){return n&&n.enumerable?e[t]=r:di(e,t,r),e},hi={},pi=lt;hi.f=pi;var _i,vi,fi,mi=ee,gi=Ye,yi=hi,Si=Jt.f,bi=function(e){var t=mi.Symbol||(mi.Symbol={});gi(t,e)||Si(t,e,{value:yi.f(e)})},Ei=O,Ti=oe,ki=lt,Ii=li,Ri=function(){var e=Ti("Symbol"),t=e&&e.prototype,r=t&&t.valueOf,n=ki("toPrimitive");t&&!t[n]&&Ii(t,n,(function(e){return Ei(r,this)}),{arity:1})},Ai=vn,Ci=cn?{}.toString:function(){return"[object "+Ai(this)+"]"},wi=cn,xi=Jt.f,Oi=vr,Pi=Ye,Di=Ci,Mi=lt("toStringTag"),Ni=function(e,t,r,n){if(e){var i=r?e:e.prototype;Pi(i,Mi)||xi(i,Mi,{configurable:!0,value:t}),n&&!wi&&Oi(i,"toString",Di)}},Li=R,Ui=n.WeakMap,Vi=Li(Ui)&&/native code/.test(String(Ui)),Fi=Vi,Bi=n,ji=$,Gi=vr,Hi=Ye,zi=Ge,Ki=On,Xi=Xr,Wi="Object already initialized",qi=Bi.TypeError,Yi=Bi.WeakMap;if(Fi||zi.state){var Ji=zi.state||(zi.state=new Yi);Ji.get=Ji.get,Ji.has=Ji.has,Ji.set=Ji.set,_i=function(e,t){if(Ji.has(e))throw qi(Wi);return t.facade=e,Ji.set(e,t),t},vi=function(e){return Ji.get(e)||{}},fi=function(e){return Ji.has(e)}}else{var Qi=Ki("state");Xi[Qi]=!0,_i=function(e,t){if(Hi(e,Qi))throw qi(Wi);return t.facade=e,Gi(e,Qi,t),t},vi=function(e){return Hi(e,Qi)?e[Qi]:{}},fi=function(e){return Hi(e,Qi)}}var Zi={set:_i,get:vi,has:fi,enforce:function(e){return fi(e)?vi(e):_i(e,{})},getterFor:function(e){return function(t){var r;if(!ji(t)||(r=vi(t)).type!==e)throw qi("Incompatible receiver, "+e+" required");return r}}},$i=y,eo=Array.isArray||function(e){return"Array"==$i(e)},to=R,ro=Ge,no=E(Function.toString);to(ro.inspectSource)||(ro.inspectSource=function(e){return no(e)});var io=ro.inspectSource,oo=E,ao=i,so=R,co=vn,uo=io,lo=function(){},ho=[],po=oe("Reflect","construct"),_o=/^\s*(?:class|function)\b/,vo=oo(_o.exec),fo=!_o.exec(lo),mo=function(e){if(!so(e))return!1;try{return po(lo,ho,e),!0}catch(t){return!1}},go=function(e){if(!so(e))return!1;switch(co(e)){case"AsyncFunction":case"GeneratorFunction":case"AsyncGeneratorFunction":return!1}try{return fo||!!vo(_o,uo(e))}catch(t){return!0}};go.sham=!0;var yo=!po||ao((function(){var e;return mo(mo.call)||!mo(Object)||!mo((function(){e=!0}))||e}))?go:mo,So=eo,bo=yo,Eo=$,To=lt("species"),ko=Array,Io=function(e){var t;return So(e)&&(t=e.constructor,(bo(t)&&(t===ko||So(t.prototype))||Eo(t)&&null===(t=t[To]))&&(t=void 0)),void 0===t?ko:t},Ro=function(e,t){return new(Io(e))(0===t?0:t)},Ao=Yt,Co=H,wo=Xe,xo=Br,Oo=Ro,Po=E([].push),Do=function(e){var t=1==e,r=2==e,n=3==e,i=4==e,o=6==e,a=7==e,s=5==e||o;return function(c,u,d,l){for(var h,p,_=wo(c),v=Co(_),f=Ao(u,d),m=xo(v),g=0,y=l||Oo,S=t?y(c,m):r||a?y(c,0):void 0;m>g;g++)if((s||g in v)&&(p=f(h=v[g],g,_),e))if(t)S[g]=p;else if(p)switch(e){case 3:return!0;case 5:return h;case 6:return g;case 2:Po(S,h)}else switch(e){case 4:return!1;case 7:Po(S,h)}return o?-1:n||i?i:S}},Mo={forEach:Do(0),map:Do(1),filter:Do(2),some:Do(3),every:Do(4),find:Do(5),findIndex:Do(6),filterReject:Do(7)},No=Ar,Lo=n,Uo=O,Vo=E,Fo=C,Bo=me,jo=i,Go=Ye,Ho=ae,zo=tr,Ko=J,Xo=bt,Wo=gn,qo=V,Yo=Hn,Jo=rn,Qo=zn,Zo=Wn,$o=ui,ea=A,ta=Jt,ra=yn,na=P,ia=li,oa=Ue.exports,aa=Xr,sa=et,ca=lt,ua=hi,da=bi,la=Ri,ha=Ni,pa=Zi,_a=Mo.forEach,va=On("hidden"),fa="Symbol",ma=pa.set,ga=pa.getterFor(fa),ya=Object.prototype,Sa=Lo.Symbol,ba=Sa&&Sa.prototype,Ea=Lo.TypeError,Ta=Lo.QObject,ka=ea.f,Ia=ta.f,Ra=Zo.f,Aa=na.f,Ca=Vo([].push),wa=oa("symbols"),xa=oa("op-symbols"),Oa=oa("wks"),Pa=!Ta||!Ta.prototype||!Ta.prototype.findChild,Da=Fo&&jo((function(){return 7!=Yo(Ia({},"a",{get:function(){return Ia(this,"a",{value:7}).a}})).a}))?function(e,t,r){var n=ka(ya,t);n&&delete ya[t],Ia(e,t,r),n&&e!==ya&&Ia(ya,t,n)}:Ia,Ma=function(e,t){var r=wa[e]=Yo(ba);return ma(r,{type:fa,tag:e,description:t}),Fo||(r.description=t),r},Na=function(e,t,r){e===ya&&Na(xa,t,r),zo(e);var n=Xo(t);return zo(r),Go(wa,n)?(r.enumerable?(Go(e,va)&&e[va][n]&&(e[va][n]=!1),r=Yo(r,{enumerable:qo(0,!1)})):(Go(e,va)||Ia(e,va,qo(1,{})),e[va][n]=!0),Da(e,n,r)):Ia(e,n,r)},La=function(e,t){zo(e);var r=Ko(t),n=Jo(r).concat(Ba(r));return _a(n,(function(t){Fo&&!Uo(Ua,r,t)||Na(e,t,r[t])})),e},Ua=function(e){var t=Xo(e),r=Uo(Aa,this,t);return!(this===ya&&Go(wa,t)&&!Go(xa,t))&&(!(r||!Go(this,t)||!Go(wa,t)||Go(this,va)&&this[va][t])||r)},Va=function(e,t){var r=Ko(e),n=Xo(t);if(r!==ya||!Go(wa,n)||Go(xa,n)){var i=ka(r,n);return!i||!Go(wa,n)||Go(r,va)&&r[va][n]||(i.enumerable=!0),i}},Fa=function(e){var t=Ra(Ko(e)),r=[];return _a(t,(function(e){Go(wa,e)||Go(aa,e)||Ca(r,e)})),r},Ba=function(e){var t=e===ya,r=Ra(t?xa:Ko(e)),n=[];return _a(r,(function(e){!Go(wa,e)||t&&!Go(ya,e)||Ca(n,wa[e])})),n};Bo||(Sa=function(){if(Ho(ba,this))throw Ea("Symbol is not a constructor");var e=arguments.length&&void 0!==arguments[0]?Wo(arguments[0]):void 0,t=sa(e),r=function(e){this===ya&&Uo(r,xa,e),Go(this,va)&&Go(this[va],t)&&(this[va][t]=!1),Da(this,t,qo(1,e))};return Fo&&Pa&&Da(ya,t,{configurable:!0,set:r}),Ma(t,e)},ia(ba=Sa.prototype,"toString",(function(){return ga(this).tag})),ia(Sa,"withoutSetter",(function(e){return Ma(sa(e),e)})),na.f=Ua,ta.f=Na,ra.f=La,ea.f=Va,Qo.f=Zo.f=Fa,$o.f=Ba,ua.f=function(e){return Ma(ca(e),e)},Fo&&Ia(ba,"description",{configurable:!0,get:function(){return ga(this).description}})),No({global:!0,constructor:!0,wrap:!0,forced:!Bo,sham:!Bo},{Symbol:Sa}),_a(Jo(Oa),(function(e){da(e)})),No({target:fa,stat:!0,forced:!Bo},{useSetter:function(){Pa=!0},useSimple:function(){Pa=!1}}),No({target:"Object",stat:!0,forced:!Bo,sham:!Fo},{create:function(e,t){return void 0===t?Yo(e):La(Yo(e),t)},defineProperty:Na,defineProperties:La,getOwnPropertyDescriptor:Va}),No({target:"Object",stat:!0,forced:!Bo},{getOwnPropertyNames:Fa}),la(),ha(Sa,fa),aa[va]=!0;var ja=me&&!!Symbol.for&&!!Symbol.keyFor,Ga=Ar,Ha=oe,za=Ye,Ka=gn,Xa=Ue.exports,Wa=ja,qa=Xa("string-to-symbol-registry"),Ya=Xa("symbol-to-string-registry");Ga({target:"Symbol",stat:!0,forced:!Wa},{for:function(e){var t=Ka(e);if(za(qa,t))return qa[t];var r=Ha("Symbol")(t);return qa[t]=r,Ya[r]=t,r}});var Ja=Ar,Qa=Ye,Za=Te,$a=Ie,es=ja,ts=(0,Ue.exports)("symbol-to-string-registry");Ja({target:"Symbol",stat:!0,forced:!es},{keyFor:function(e){if(!Za(e))throw TypeError($a(e)+" is not a symbol");if(Qa(ts,e))return ts[e]}});var rs=E([].slice),ns=Ar,is=oe,os=d,as=O,ss=E,cs=i,us=eo,ds=R,ls=$,hs=Te,ps=rs,_s=me,vs=is("JSON","stringify"),fs=ss(/./.exec),ms=ss("".charAt),gs=ss("".charCodeAt),ys=ss("".replace),Ss=ss(1..toString),bs=/[\uD800-\uDFFF]/g,Es=/^[\uD800-\uDBFF]$/,Ts=/^[\uDC00-\uDFFF]$/,ks=!_s||cs((function(){var e=is("Symbol")();return"[null]"!=vs([e])||"{}"!=vs({a:e})||"{}"!=vs(Object(e))})),Is=cs((function(){return'"\\udf06\\ud834"'!==vs("\udf06\ud834")||'"\\udead"'!==vs("\udead")})),Rs=function(e,t){var r=ps(arguments),n=t;if((ls(t)||void 0!==e)&&!hs(e))return us(t)||(t=function(e,t){if(ds(n)&&(t=as(n,this,e,t)),!hs(t))return t}),r[1]=t,os(vs,null,r)},As=function(e,t,r){var n=ms(r,t-1),i=ms(r,t+1);return fs(Es,e)&&!fs(Ts,i)||fs(Ts,e)&&!fs(Es,n)?"\\u"+Ss(gs(e,0),16):e};vs&&ns({target:"JSON",stat:!0,arity:3,forced:ks||Is},{stringify:function(e,t,r){var n=ps(arguments),i=os(ks?Rs:vs,null,n);return Is&&"string"==typeof i?ys(i,bs,As):i}});var Cs=ui,ws=Xe;Ar({target:"Object",stat:!0,forced:!me||i((function(){Cs.f(1)}))},{getOwnPropertySymbols:function(e){var t=Cs.f;return t?t(ws(e)):[]}});var xs=ee.Object.getOwnPropertySymbols,Os=i,Ps=_e,Ds=lt("species"),Ms=function(e){return Ps>=51||!Os((function(){var t=[];return(t.constructor={})[Ds]=function(){return{foo:1}},1!==t[e](Boolean).foo}))},Ns=Mo.filter;Ar({target:"Array",proto:!0,forced:!Ms("filter")},{filter:function(e){return Ns(this,e,arguments.length>1?arguments[1]:void 0)}});var Ls=ee,Us=function(e){return Ls[e+"Prototype"]},Vs=Us("Array").filter,Fs=ae,Bs=Vs,js=Array.prototype,Gs=function(e){var t=e.filter;return e===js||Fs(js,e)&&t===js.filter?Bs:t},Hs={exports:{}},zs=Ar,Ks=i,Xs=J,Ws=A.f,qs=C,Ys=Ks((function(){Ws(1)}));zs({target:"Object",stat:!0,forced:!qs||Ys,sham:!qs},{getOwnPropertyDescriptor:function(e,t){return Ws(Xs(e),t)}});var Js=ee.Object,Qs=Hs.exports=function(e,t){return Js.getOwnPropertyDescriptor(e,t)};Js.getOwnPropertyDescriptor.sham&&(Qs.sham=!0);var Zs,$s,ec,tc=Hs.exports,rc={},nc=C,ic=Ye,oc=Function.prototype,ac=nc&&Object.getOwnPropertyDescriptor,sc=ic(oc,"name"),cc={EXISTS:sc,PROPER:sc&&"something"===function(){}.name,CONFIGURABLE:sc&&(!nc||nc&&ac(oc,"name").configurable)},uc=!i((function(){function e(){}return e.prototype.constructor=null,Object.getPrototypeOf(new e)!==e.prototype})),dc=Ye,lc=R,hc=Xe,pc=uc,_c=On("IE_PROTO"),vc=Object,fc=vc.prototype,mc=pc?vc.getPrototypeOf:function(e){var t=hc(e);if(dc(t,_c))return t[_c];var r=t.constructor;return lc(r)&&t instanceof r?r.prototype:t instanceof vc?fc:null},gc=i,yc=R,Sc=$,bc=Hn,Ec=mc,Tc=li,kc=lt("iterator"),Ic=!1;[].keys&&("next"in(ec=[].keys())?($s=Ec(Ec(ec)))!==Object.prototype&&(Zs=$s):Ic=!0);var Rc=!Sc(Zs)||gc((function(){var e={};return Zs[kc].call(e)!==e}));yc((Zs=Rc?{}:bc(Zs))[kc])||Tc(Zs,kc,(function(){return this}));var Ac={IteratorPrototype:Zs,BUGGY_SAFARI_ITERATORS:Ic},Cc=Ac.IteratorPrototype,wc=Hn,xc=V,Oc=Ni,Pc=rc,Dc=function(){return this},Mc=function(e,t,r,n){var i=t+" Iterator";return e.prototype=wc(Cc,{next:xc(+!n,r)}),Oc(e,i,!1,!0),Pc[i]=Dc,e},Nc=R,Lc=String,Uc=TypeError,Vc=E,Fc=tr,Bc=function(e){if("object"==typeof e||Nc(e))return e;throw Uc("Can't set "+Lc(e)+" as a prototype")},jc=Object.setPrototypeOf||("__proto__"in{}?function(){var e,t=!1,r={};try{(e=Vc(Object.getOwnPropertyDescriptor(Object.prototype,"__proto__").set))(r,[]),t=r instanceof Array}catch(n){}return function(r,n){return Fc(r),Bc(n),t?e(r,n):r.__proto__=n,r}}():void 0),Gc=Ar,Hc=O,zc=cc,Kc=Mc,Xc=mc,Wc=Ni,qc=li,Yc=rc,Jc=Ac,Qc=zc.PROPER,Zc=Jc.BUGGY_SAFARI_ITERATORS,$c=lt("iterator"),eu="keys",tu="values",ru="entries",nu=function(){return this},iu=function(e,t,r,n,i,o,a){Kc(r,t,n);var s,c,u,d=function(e){if(e===i&&v)return v;if(!Zc&&e in p)return p[e];switch(e){case eu:case tu:case ru:return function(){return new r(this,e)}}return function(){return new r(this)}},l=t+" Iterator",h=!1,p=e.prototype,_=p[$c]||p["@@iterator"]||i&&p[i],v=!Zc&&_||d(i),f="Array"==t&&p.entries||_;if(f&&(s=Xc(f.call(new e)))!==Object.prototype&&s.next&&(Wc(s,l,!0,!0),Yc[l]=nu),Qc&&i==tu&&_&&_.name!==tu&&(h=!0,v=function(){return Hc(_,this)}),i)if(c={values:d(tu),keys:o?v:d(eu),entries:d(ru)},a)for(u in c)(Zc||h||!(u in p))&&qc(p,u,c[u]);else Gc({target:t,proto:!0,forced:Zc||h},c);return a&&p[$c]!==v&&qc(p,$c,v,{name:i}),Yc[t]=v,c},ou=function(e,t){return{value:e,done:t}},au=J,su=function(){},cu=rc,uu=Zi,du=(Jt.f,iu),lu=ou,hu="Array Iterator",pu=uu.set,_u=uu.getterFor(hu);du(Array,"Array",(function(e,t){pu(this,{type:hu,target:au(e),index:0,kind:t})}),(function(){var e=_u(this),t=e.target,r=e.kind,n=e.index++;return!t||n>=t.length?(e.target=void 0,lu(void 0,!0)):lu("keys"==r?n:"values"==r?t[n]:[n,t[n]],!1)}),"values");cu.Arguments=cu.Array;su(),su(),su();var vu={CSSRuleList:0,CSSStyleDeclaration:0,CSSValueList:0,ClientRectList:0,DOMRectList:0,DOMStringList:0,DOMTokenList:1,DataTransferItemList:0,FileList:0,HTMLAllCollection:0,HTMLCollection:0,HTMLFormElement:0,HTMLSelectElement:0,MediaList:0,MimeTypeArray:0,NamedNodeMap:0,NodeList:1,PaintRequestList:0,Plugin:0,PluginArray:0,SVGLengthList:0,SVGNumberList:0,SVGPathSegList:0,SVGPointList:0,SVGStringList:0,SVGTransformList:0,SourceBufferList:0,StyleSheetList:0,TextTrackCueList:0,TextTrackList:0,TouchList:0},fu=n,mu=vn,gu=vr,yu=rc,Su=lt("toStringTag");for(var bu in vu){var Eu=fu[bu],Tu=Eu&&Eu.prototype;Tu&&mu(Tu)!==Su&&gu(Tu,Su,bu),yu[bu]=yu.Array}var ku=i,Iu=function(e,t){var r=[][e];return!!r&&ku((function(){r.call(null,t||function(){return 1},1)}))},Ru=Mo.forEach,Au=Iu("forEach")?[].forEach:function(e){return Ru(this,e,arguments.length>1?arguments[1]:void 0)};Ar({target:"Array",proto:!0,forced:[].forEach!=Au},{forEach:Au});var Cu=Us("Array").forEach,wu=vn,xu=Ye,Ou=ae,Pu=Cu,Du=Array.prototype,Mu={DOMTokenList:!0,NodeList:!0},Nu=function(e){var t=e.forEach;return e===Du||Ou(Du,e)&&t===Du.forEach||xu(Mu,wu(e))?Pu:t},Lu=oe,Uu=zn,Vu=ui,Fu=tr,Bu=E([].concat),ju=Lu("Reflect","ownKeys")||function(e){var t=Uu.f(Fu(e)),r=Vu.f;return r?Bu(t,r(e)):t},Gu=ju,Hu=J,zu=A,Ku=Qn;Ar({target:"Object",stat:!0,sham:!C},{getOwnPropertyDescriptors:function(e){for(var t,r,n=Hu(e),i=zu.f,o=Gu(n),a={},s=0;o.length>s;)void 0!==(r=i(n,t=o[s++]))&&Ku(a,t,r);return a}});var Xu=ee.Object.getOwnPropertyDescriptors,Wu={exports:{}},qu=Ar,Yu=C,Ju=yn.f;qu({target:"Object",stat:!0,forced:Object.defineProperties!==Ju,sham:!Yu},{defineProperties:Ju});var Qu=ee.Object,Zu=Wu.exports=function(e,t){return Qu.defineProperties(e,t)};Qu.defineProperties.sham&&(Zu.sham=!0);var $u=Wu.exports,ed={exports:{}},td=Ar,rd=C,nd=Jt.f;td({target:"Object",stat:!0,forced:Object.defineProperty!==nd,sham:!rd},{defineProperty:nd});var id=ee.Object,od=ed.exports=function(e,t,r){return id.defineProperty(e,t,r)};id.defineProperty.sham&&(od.sham=!0);var ad=ed.exports;function sd(e,t,r){return t in e?ad(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function cd(e,t){var r=an(e);if(xs){var n=xs(e);t&&(n=Gs(n).call(n,(function(t){return tc(e,t).enumerable}))),r.push.apply(r,n)}return r}function ud(e){for(var t=1;t<arguments.length;t++){var r,n,i=null!=arguments[t]?arguments[t]:{};t%2?Nu(r=cd(Object(i),!0)).call(r,(function(t){sd(e,t,i[t])})):Xu?$u(e,Xu(i)):Nu(n=cd(Object(i))).call(n,(function(t){ad(e,t,tc(i,t))}))}return e}var dd=function(e){return e[e.VIDEO_SOURCE_TYPE_EXTERNAL=0]="VIDEO_SOURCE_TYPE_EXTERNAL",e[e.VIDEO_SOURCE_TYPE_INTERNAL=1]="VIDEO_SOURCE_TYPE_INTERNAL",e}(dd||{}),ld=function(e){return e[e.AUDIO_SOURCE_TYPE_EXTERNAL=0]="AUDIO_SOURCE_TYPE_EXTERNAL",e[e.AUDIO_SOURCE_TYPE_INTERNAL=1]="AUDIO_SOURCE_TYPE_INTERNAL",e}(ld||{}),hd=function(e){return e[e.QUIT=0]="QUIT",e[e.DROPPED=1]="DROPPED",e[e.SWITCH_TO_INVISIBLE=2]="SWITCH_TO_INVISIBLE",e[e.KICKED_BY_ADMIN=3]="KICKED_BY_ADMIN",e}(hd||{}),pd=function(e){return e[e.CHANNEL_PROFILE_COMMUNICATION=0]="CHANNEL_PROFILE_COMMUNICATION",e[e.CHANNEL_PROFILE_LIVE_BROADCASTING=1]="CHANNEL_PROFILE_LIVE_BROADCASTING",e}(pd||{}),_d=function(e){return e[e.AUTO_SUBSCRIBE_MODE=0]="AUTO_SUBSCRIBE_MODE",e[e.MANUAL_SUBSCRIBE_MODE=1]="MANUAL_SUBSCRIBE_MODE",e}(_d||{}),vd=function(e){return e[e.SUBSCRIBE_SUCC=0]="SUBSCRIBE_SUCC",e[e.SUBSCRIBE_FAIL=1]="SUBSCRIBE_FAIL",e}(vd||{}),fd=function(e){return e[e.PUBLISH_SUCC=0]="PUBLISH_SUCC",e[e.PUBLISH_FAIL=1]="PUBLISH_FAIL",e}(fd||{}),md=function(e){return e[e.MIRROR_MODE_OFF=0]="MIRROR_MODE_OFF",e[e.MIRROR_MODE_ON=1]="MIRROR_MODE_ON",e}(md||{}),gd=function(e){return e[e.RENDER_MODE_HIDDEN=0]="RENDER_MODE_HIDDEN",e[e.RENDER_MODE_FIT=1]="RENDER_MODE_FIT",e[e.RENDER_MODE_FILL=2]="RENDER_MODE_FILL",e}(gd||{}),yd=function(e){return e[e.STREAM_INDEX_MAIN=0]="STREAM_INDEX_MAIN",e[e.STREAM_INDEX_SCREEN=1]="STREAM_INDEX_SCREEN",e}(yd||{}),Sd=function(e){return e[e.AUDIO=1]="AUDIO",e[e.VIDEO=2]="VIDEO",e[e.AUDIO_AND_VIDEO=3]="AUDIO_AND_VIDEO",e}(Sd||{}),bd=function(e){return e[e.STREAM_REMOVE_REASON_UNPUBLISH=0]="STREAM_REMOVE_REASON_UNPUBLISH",e[e.STREAM_REMOVE_REASON_PUBLISH_FAILED=1]="STREAM_REMOVE_REASON_PUBLISH_FAILED",e[e.STREAM_REMOVE_REASON_KEEP_LIVE_FAILED=2]="STREAM_REMOVE_REASON_KEEP_LIVE_FAILED",e[e.STREAM_REMOVE_REASON_CLIENT_DISCONNECTED=3]="STREAM_REMOVE_REASON_CLIENT_DISCONNECTED",e[e.STREAM_REMOVE_REASON_REPUBLISH=4]="STREAM_REMOVE_REASON_REPUBLISH",e[e.STREAM_REMOVE_REASON_OTHER=5]="STREAM_REMOVE_REASON_OTHER",e}(bd||{}),Ed=function(e){return e[e.CONNECTION_START=0]="CONNECTION_START",e[e.CONNECTION_STATE_DISCONNECTED=1]="CONNECTION_STATE_DISCONNECTED",e[e.CONNECTION_STATE_CONNECTING=2]="CONNECTION_STATE_CONNECTING",e[e.CONNECTION_STATE_CONNECTED=3]="CONNECTION_STATE_CONNECTED",e[e.CONNECTION_STATE_RECONNECTING=4]="CONNECTION_STATE_RECONNECTING",e[e.CONNECTION_STATE_RECONNECTED=5]="CONNECTION_STATE_RECONNECTED",e[e.CONNECTION_STATE_LOST=6]="CONNECTION_STATE_LOST",e}(Ed||{}),Td=function(e){return e[e.MIRROR_TYPE_NONE=0]="MIRROR_TYPE_NONE",e[e.MIRROR_TYPE_RENDER=1]="MIRROR_TYPE_RENDER",e}(Td||{}),kd=function(e){return e[e.domestic=0]="domestic",e[e.overseas=1]="overseas",e}(kd||{}),Id=function(e){return e[e.OFFLINE=0]="OFFLINE",e[e.ONLINE=1]="ONLINE",e[e.UNREACHABLE=2]="UNREACHABLE",e}(Id||{}),Rd=function(e){return e[e.AUDIO_AND_VIDEO=0]="AUDIO_AND_VIDEO",e[e.AUDIO_ONLY=1]="AUDIO_ONLY",e[e.VIDEO_ONLY=2]="VIDEO_ONLY",e}(Rd||{}),Ad=function(e){return e[e.PREV_FRAME=0]="PREV_FRAME",e[e.OTHER_FRAME=1]="OTHER_FRAME",e}(Ad||{}),Cd=function(e){return e[e.DISABLE=0]="DISABLE",e[e.VIDEO_STREAM_LOW=1]="VIDEO_STREAM_LOW",e[e.AUDIO_ONLY=2]="AUDIO_ONLY",e}(Cd||{}),wd=function(e){return e[e.LOW=0]="LOW",e[e.MEDIUM=100]="MEDIUM",e[e.HIGH=200]="HIGH",e}(wd||{}),xd=function(e){return e[e.UNKNOWN=0]="UNKNOWN",e[e.EXCELLENT=1]="EXCELLENT",e[e.GOOD=2]="GOOD",e[e.POOR=3]="POOR",e[e.BAD=4]="BAD",e[e.VBAD=5]="VBAD",e}(xd||{}),Od=function(e){return e[e.Unknown=-1]="Unknown",e[e.SubscribeFallbackByBandwidth=0]="SubscribeFallbackByBandwidth",e[e.SubscribeRecoverByBandwidth=2]="SubscribeRecoverByBandwidth",e}(Od||{}),Pd=function(e){return e[e.communication=0]="communication",e[e.chat=5]="chat",e[e.chatRoom=6]="chatRoom",e[e.coHost=9]="coHost",e[e.meeting=16]="meeting",e[e.classRoom=18]="classRoom",e}(Pd||{}),Dd=function(e){return e[e.default=0]="default",e[e.fluent=1]="fluent",e[e.standard=2]="standard",e[e.hd=3]="hd",e[e.standardStereo=4]="standardStereo",e[e.hdMono=5]="hdMono",e}(Dd||{}),Md=function(e){return e[e.AUTO_PLAY=0]="AUTO_PLAY",e[e.VIDEO_ONLY=1]="VIDEO_ONLY",e[e.PLAY_MANUALLY=2]="PLAY_MANUALLY",e}(Md||{}),Nd=function(e){return e.LC="LC",e.HEv1="HEv1",e.HEv2="HEv2",e}(Nd||{}),Ld=function(e){return e.H264="H264",e.H265="H265",e}(Ld||{}),Ud=function(e){return e[e.ASR_ONLY=0]="ASR_ONLY",e[e.ASR_AND_TRANSLATION=1]="ASR_AND_TRANSLATION",e}(Ud||{}),Vd=function(e){return e[e.STARTED=0]="STARTED",e[e.STOPPED=1]="STOPPED",e[e.ERROR=2]="ERROR",e}(Vd||{}),Fd=function(e){return e[e.FORWARD_STREAM_STATE_SUCCESS=0]="FORWARD_STREAM_STATE_SUCCESS",e[e.FORWARD_STREAM_STATE_FAILURE=1]="FORWARD_STREAM_STATE_FAILURE",e}(Fd||{}),Bd=function(e){return e[e.FORWARD_STREAM_ERROR_OK=0]="FORWARD_STREAM_ERROR_OK",e[e.FORWARD_STREAM_ERROR_INVALID_TOKEN=1202]="FORWARD_STREAM_ERROR_INVALID_TOKEN",e[e.FORWARD_STREAM_ERROR_RESPONSE=1203]="FORWARD_STREAM_ERROR_RESPONSE",e[e.FORWARD_STREAM_ERROR_REMOTE_KICKED=1204]="FORWARD_STREAM_ERROR_REMOTE_KICKED",e[e.FORWARD_STREAM_ERROR_NOT_SUPPORT=1205]="FORWARD_STREAM_ERROR_NOT_SUPPORT",e}(Bd||{}),jd=Object.freeze(Object.defineProperty({__proto__:null,VideoSourceType:dd,AudioSourceType:ld,UserOfflineReason:hd,ChannelProfile:pd,SubscribeMode:_d,SubscribeState:vd,PublishState:fd,MirrorMode:md,VideoRenderMode:gd,StreamIndex:yd,MediaType:Sd,StreamRemoveReason:bd,ConnectionState:Ed,MirrorType:Td,LogChannel:kd,USER_ONLINE_STATUS:Id,PublicStreamType:Rd,PublicInterpolationMode:Ad,SubscribeFallbackOption:Cd,RemoteUserPriority:wd,NetworkQuality:xd,FallbackOrRecoverReason:Od,RoomProfileType:Pd,AudioProfileType:Dd,RTCAutoPlayPolicy:Md,AAC_PROFILE:Nd,TRANSCODING_VIDEO_CODEC:Ld,SUBTITLE_MODE:Ud,SubtitleEventType:Vd,ForwardStreamState:Fd,ForwardStreamError:Bd},Symbol.toStringTag,{value:"Module"})),Gd=function(e){return e[e.AUTO=0]="AUTO",e[e.MODE_L=1]="MODE_L",e[e.MODE_R=2]="MODE_R",e[e.MODE_MIX=3]="MODE_MIX",e}(Gd||{}),Hd=function(e){return e[e.PLAYOUT=0]="PLAYOUT",e[e.PUBLISH=1]="PUBLISH",e[e.PLAYOUT_AND_PUBLISH=2]="PLAYOUT_AND_PUBLISH",e}(Hd||{}),zd=function(e){return e[e.AUDIO_MIXING_STATE_PRELOADED=0]="AUDIO_MIXING_STATE_PRELOADED",e[e.AUDIO_MIXING_STATE_PLAYING=1]="AUDIO_MIXING_STATE_PLAYING",e[e.AUDIO_MIXING_STATE_PAUSED=2]="AUDIO_MIXING_STATE_PAUSED",e[e.AUDIO_MIXING_STATE_STOPPED=3]="AUDIO_MIXING_STATE_STOPPED",e[e.AUDIO_MIXING_STATE_FAILED=4]="AUDIO_MIXING_STATE_FAILED",e[e.AUDIO_MIXING_STATE_FINISHED=5]="AUDIO_MIXING_STATE_FINISHED",e[e.AUDIO_MIXING_STATE_PCM_ENABLED=6]="AUDIO_MIXING_STATE_PCM_ENABLED",e[e.AUDIO_MIXING_STATE_PCM_DISABLED=7]="AUDIO_MIXING_STATE_PCM_DISABLED",e}(zd||{}),Kd=Object.freeze(Object.defineProperty({__proto__:null,AudioMixingDualMonoMode:Gd,AudioMixingType:Hd,AudioMixingState:zd},Symbol.toStringTag,{value:"Module"})),Xd=function(e){return e.onTrackEnded="onTrackEnded",e.onTrackMute="onTrackMute",e.onTrackUnmute="onTrackUnmute",e.onPlayerEvent="onPlayerEvent",e.onAutoplayFailed="onAutoplayFailed",e.onUserJoined="onUserJoined",e.onUserLeave="onUserLeave",e.onConnectionStateChanged="onConnectionStateChanged",e.onUserPublishStream="onUserPublishStream",e.onUserUnpublishStream="onUserUnpublishStream",e.onUserPublishScreen="onUserPublishScreen",e.onUserUnpublishScreen="onUserUnpublishScreen",e.onRoomMessageReceived="onRoomMessageReceived",e.onRoomBinaryMessageReceived="onRoomBinaryMessageReceived",e.onUserMessageReceived="onUserMessageReceived",e.onUserBinaryMessageReceived="onUserBinaryMessageReceived",e.onVideoFirstFrameRendered="onVideoFirstFrameRendered",e.onVideoFirstFrameDecoded="onVideoFirstFrameDecoded",e.onRemoteVideoFirstFrame="onRemoteVideoFirstFrame",e.onAudioFirstFrameDecoded="onAudioFirstFrameDecoded",e.onRemoteAudioFirstFrame="onRemoteAudioFirstFrame",e.onFirstPublicStreamVideoFrameRendered="onFirstPublicStreamVideoFrameRendered",e.onFirstPublicStreamVideoFrameDecoded="onFirstPublicStreamVideoFrameDecoded",e.onFirstPublicStreamAudioFrameDecoded="onFirstPublicStreamAudioFrameDecoded",e.onVideoDeviceStateChanged="onVideoDeviceStateChanged",e.onAudioDeviceStateChanged="onAudioDeviceStateChanged",e.onRemoteStreamStats="onRemoteStreamStats",e.onPublicStreamStats="onPublicStreamStats",e.onLocalStreamStats="onLocalStreamStats",e.onAudioVolumeIndication="onAudioVolumeIndication",e.onLocalAudioPropertiesReport="onLocalAudioPropertiesReport",e.onRemoteAudioPropertiesReport="onRemoteAudioPropertiesReport",e.onActiveSpeaker="onActiveSpeaker",e.onAudioPlaybackDeviceChanged="onAudioPlaybackDeviceChanged",e.onUserStartVideoCapture="onUserStartVideoCapture",e.onUserStopVideoCapture="onUserStopVideoCapture",e.onUserStartAudioCapture="onUserStartAudioCapture",e.onUserStopAudioCapture="onUserStopAudioCapture",e.onAutoPublishResult="onAutoPublishResult",e.onAutoSubscribeResult="onAutoSubscribeResult",e.onLiveTranscodingResult="onLiveTranscodingResult",e.onStreamMixingEvent="onStreamMixingEvent",e.onAudioPlaybackDeviceTestVolume="onAudioPlaybackDeviceTestVolume",e.onSEIMessageReceived="onSEIMessageReceived",e.onError="onError",e.onAudioMixingStateChanged="onAudioMixingStateChanged",e.onUserMessageReceivedOutsideRoom="onUserMessageReceivedOutsideRoom",e.onUserBinaryMessageReceivedOutsideRoom="onUserBinaryMessageReceivedOutsideRoom",e.onTokenWillExpire="onTokenWillExpire",e.onCloudProxyConnected="onCloudProxyConnected",e.onPushPublicStreamResult="onPushPublicStreamResult",e.onPublicStreamSEIMessageReceived="onPublicStreamSEIMessageReceived",e.onNetworkQuality="onNetworkQuality",e.onSimulcastSubscribeFallback="onSimulcastSubscribeFallback",e.onRemoteVideoSizeChanged="onRemoteVideoSizeChanged",e.onVideoStreamBanned="onVideoStreamBanned",e.onAudioStreamBanned="onAudioStreamBanned",e.onLocalVideoSizeChanged="onLocalVideoSizeChanged",e.onSubtitleStateChanged="onSubtitleStateChanged",e.onSubtitleMessageReceived="onSubtitleMessageReceived",e.onServerParamsSetResult="onServerParamsSetResult",e.onLocalStreamTrackChangedByExtension="onLocalStreamTrackChangedByExtension",e.onVendorConnectionStateChanged="onVendorConnectionStateChanged",e.onForwardStreamError="onForwardStreamError",e.onRejoinWithTcp="onRejoinWithTcp",e.onIceConnectWithTcp="onIceConnectWithTcp",e}(Xd||{});function Wd(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),ad(e,n.key,n)}}function qd(e,t,r){return t&&Wd(e.prototype,t),r&&Wd(e,r),ad(e,"prototype",{writable:!1}),e}function Yd(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}var Jd=TypeError,Qd=function(e){if(e>9007199254740991)throw Jd("Maximum allowed index exceeded");return e},Zd=Ar,$d=i,el=eo,tl=$,rl=Xe,nl=Br,il=Qd,ol=Qn,al=Ro,sl=Ms,cl=_e,ul=lt("isConcatSpreadable"),dl=cl>=51||!$d((function(){var e=[];return e[ul]=!1,e.concat()[0]!==e})),ll=sl("concat"),hl=function(e){if(!tl(e))return!1;var t=e[ul];return void 0!==t?!!t:el(e)};Zd({target:"Array",proto:!0,arity:1,forced:!dl||!ll},{concat:function(e){var t,r,n,i,o,a=rl(this),s=al(a,0),c=0;for(t=-1,n=arguments.length;t<n;t++)if(hl(o=-1===t?a:arguments[t]))for(i=nl(o),il(c+i),r=0;r<i;r++,c++)r in o&&ol(s,c,o[r]);else il(c+1),ol(s,c++,o);return s.length=c,s}}),bi("asyncIterator"),bi("hasInstance"),bi("isConcatSpreadable"),bi("iterator"),bi("match"),bi("matchAll"),bi("replace"),bi("search"),bi("species"),bi("split");var pl=Ri;bi("toPrimitive"),pl();var _l=oe,vl=Ni;bi("toStringTag"),vl(_l("Symbol"),"Symbol"),bi("unscopables"),Ni(n.JSON,"JSON",!0);var fl=ee.Symbol;bi("asyncDispose"),bi("dispose"),bi("matcher"),bi("metadataKey"),bi("observable"),bi("metadata"),bi("patternMatch"),bi("replaceAll");var ml=fl,gl=E,yl=Or,Sl=gn,bl=W,El=gl("".charAt),Tl=gl("".charCodeAt),kl=gl("".slice),Il=function(e){return function(t,r){var n,i,o=Sl(bl(t)),a=yl(r),s=o.length;return a<0||a>=s?e?"":void 0:(n=Tl(o,a))<55296||n>56319||a+1===s||(i=Tl(o,a+1))<56320||i>57343?e?El(o,a):n:e?kl(o,a,a+2):i-56320+(n-55296<<10)+65536}},Rl={codeAt:Il(!1),charAt:Il(!0)},Al=Rl.charAt,Cl=gn,wl=Zi,xl=iu,Ol=ou,Pl="String Iterator",Dl=wl.set,Ml=wl.getterFor(Pl);xl(String,"String",(function(e){Dl(this,{type:Pl,string:Cl(e),index:0})}),(function(){var e,t=Ml(this),r=t.string,n=t.index;return n>=r.length?Ol(void 0,!0):(e=Al(r,n),t.index+=e.length,Ol(e,!1))}));var Nl=hi.f("iterator");function Ll(e){return(Ll="function"==typeof ml&&"symbol"==typeof Nl?function(e){return typeof e}:function(e){return e&&"function"==typeof ml&&e.constructor===ml&&e!==ml.prototype?"symbol":typeof e})(e)}Ar({target:"Object",stat:!0,sham:!C},{create:Hn});var Ul=ee.Object,Vl=function(e,t){return Ul.create(e,t)},Fl=Xe,Bl=mc,jl=uc;Ar({target:"Object",stat:!0,forced:i((function(){Bl(1)})),sham:!jl},{getPrototypeOf:function(e){return Bl(Fl(e))}});var Gl=ee.Object.getPrototypeOf;Ar({target:"Object",stat:!0},{setPrototypeOf:jc});var Hl=ee.Object.setPrototypeOf,zl=Ye,Kl=ju,Xl=A,Wl=Jt,ql=Error,Yl=E("".replace),Jl=String(ql("zxcasd").stack),Ql=/\n\s*at [^:]*:[^\n]*/,Zl=Ql.test(Jl),$l=$,eh=vr,th=rc,rh=lt("iterator"),nh=Array.prototype,ih=function(e){return void 0!==e&&(th.Array===e||nh[rh]===e)},oh=vn,ah=Pe,sh=z,ch=rc,uh=lt("iterator"),dh=function(e){if(!sh(e))return ah(e,uh)||ah(e,"@@iterator")||ch[oh(e)]},lh=O,hh=we,ph=tr,_h=Ie,vh=dh,fh=TypeError,mh=function(e,t){var r=arguments.length<2?vh(e):t;if(hh(r))return ph(lh(r,e));throw fh(_h(e)+" is not iterable")},gh=O,yh=tr,Sh=Pe,bh=function(e,t,r){var n,i;yh(e);try{if(!(n=Sh(e,"return"))){if("throw"===t)throw r;return r}n=gh(n,e)}catch(o){i=!0,n=o}if("throw"===t)throw r;if(i)throw n;return yh(n),r},Eh=Yt,Th=O,kh=tr,Ih=Ie,Rh=ih,Ah=Br,Ch=ae,wh=mh,xh=dh,Oh=bh,Ph=TypeError,Dh=function(e,t){this.stopped=e,this.result=t},Mh=Dh.prototype,Nh=function(e,t,r){var n,i,o,a,s,c,u,d=r&&r.that,l=!(!r||!r.AS_ENTRIES),h=!(!r||!r.IS_RECORD),p=!(!r||!r.IS_ITERATOR),_=!(!r||!r.INTERRUPTED),v=Eh(t,d),f=function(e){return n&&Oh(n,"normal",e),new Dh(!0,e)},m=function(e){return l?(kh(e),_?v(e[0],e[1],f):v(e[0],e[1])):_?v(e,f):v(e)};if(h)n=e.iterator;else if(p)n=e;else{if(!(i=xh(e)))throw Ph(Ih(e)+" is not iterable");if(Rh(i)){for(o=0,a=Ah(e);a>o;o++)if((s=m(e[o]))&&Ch(Mh,s))return s;return new Dh(!1)}n=wh(e,i)}for(c=h?e.next:n.next;!(u=Th(c,n)).done;){try{s=m(u.value)}catch(g){Oh(n,"throw",g)}if("object"==typeof s&&s&&Ch(Mh,s))return s}return new Dh(!1)},Lh=gn,Uh=V,Vh=!i((function(){var e=Error("a");return!("stack"in e)||(Object.defineProperty(e,"stack",Uh(1,7)),7!==e.stack)})),Fh=Ar,Bh=ae,jh=mc,Gh=jc,Hh=function(e,t,r){for(var n=Kl(t),i=Wl.f,o=Xl.f,a=0;a<n.length;a++){var s=n[a];zl(e,s)||r&&zl(r,s)||i(e,s,o(t,s))}},zh=Hn,Kh=vr,Xh=V,Wh=function(e,t){if(Zl&&"string"==typeof e&&!ql.prepareStackTrace)for(;t--;)e=Yl(e,Ql,"");return e},qh=function(e,t){$l(t)&&"cause"in t&&eh(e,"cause",t.cause)},Yh=Nh,Jh=function(e,t){return void 0===e?arguments.length<2?"":t:Lh(e)},Qh=Vh,Zh=lt("toStringTag"),$h=Error,ep=[].push,tp=function(e,t){var r,n=arguments.length>2?arguments[2]:void 0,i=Bh(rp,this);Gh?r=Gh($h(),i?jh(this):rp):(r=i?this:zh(rp),Kh(r,Zh,"Error")),void 0!==t&&Kh(r,"message",Jh(t)),Qh&&Kh(r,"stack",Wh(r.stack,1)),qh(r,n);var o=[];return Yh(e,ep,{that:o}),Kh(r,"errors",o),r};Gh?Gh(tp,$h):Hh(tp,$h,{name:!0});var rp=tp.prototype=zh($h.prototype,{constructor:Xh(1,tp),message:Xh(1,""),name:Xh(1,"AggregateError")});Fh({global:!0,constructor:!0,arity:2},{AggregateError:tp});var np,ip,op,ap,sp="process"==y(n.process),cp=oe,up=Jt,dp=C,lp=lt("species"),hp=function(e){var t=cp(e),r=up.f;dp&&t&&!t[lp]&&r(t,lp,{configurable:!0,get:function(){return this}})},pp=ae,_p=TypeError,vp=function(e,t){if(pp(t,e))return e;throw _p("Incorrect invocation")},fp=yo,mp=Ie,gp=TypeError,yp=function(e){if(fp(e))return e;throw gp(mp(e)+" is not a constructor")},Sp=tr,bp=yp,Ep=z,Tp=lt("species"),kp=function(e,t){var r,n=Sp(e).constructor;return void 0===n||Ep(r=Sp(n)[Tp])?t:bp(r)},Ip=TypeError,Rp=function(e,t){if(e<t)throw Ip("Not enough arguments");return e},Ap=/(?:ipad|iphone|ipod).*applewebkit/i.test(se),Cp=n,wp=d,xp=Yt,Op=R,Pp=Ye,Dp=i,Mp=An,Np=rs,Lp=It,Up=Rp,Vp=Ap,Fp=sp,Bp=Cp.setImmediate,jp=Cp.clearImmediate,Gp=Cp.process,Hp=Cp.Dispatch,zp=Cp.Function,Kp=Cp.MessageChannel,Xp=Cp.String,Wp=0,qp={},Yp="onreadystatechange";try{np=Cp.location}catch(HX){}var Jp=function(e){if(Pp(qp,e)){var t=qp[e];delete qp[e],t()}},Qp=function(e){return function(){Jp(e)}},Zp=function(e){Jp(e.data)},$p=function(e){Cp.postMessage(Xp(e),np.protocol+"//"+np.host)};Bp&&jp||(Bp=function(e){Up(arguments.length,1);var t=Op(e)?e:zp(e),r=Np(arguments,1);return qp[++Wp]=function(){wp(t,void 0,r)},ip(Wp),Wp},jp=function(e){delete qp[e]},Fp?ip=function(e){Gp.nextTick(Qp(e))}:Hp&&Hp.now?ip=function(e){Hp.now(Qp(e))}:Kp&&!Vp?(ap=(op=new Kp).port2,op.port1.onmessage=Zp,ip=xp(ap.postMessage,ap)):Cp.addEventListener&&Op(Cp.postMessage)&&!Cp.importScripts&&np&&"file:"!==np.protocol&&!Dp($p)?(ip=$p,Cp.addEventListener("message",Zp,!1)):ip=Yp in Lp("script")?function(e){Mp.appendChild(Lp("script")).onreadystatechange=function(){Mp.removeChild(this),Jp(e)}}:function(e){setTimeout(Qp(e),0)});var e_,t_,r_,n_,i_,o_,a_,s_,c_={set:Bp,clear:jp},u_=n,d_=/ipad|iphone|ipod/i.test(se)&&void 0!==u_.Pebble,l_=/web0s(?!.*chrome)/i.test(se),h_=n,p_=Yt,__=A.f,v_=c_.set,f_=Ap,m_=d_,g_=l_,y_=sp,S_=h_.MutationObserver||h_.WebKitMutationObserver,b_=h_.document,E_=h_.process,T_=h_.Promise,k_=__(h_,"queueMicrotask"),I_=k_&&k_.value;I_||(e_=function(){var e,t;for(y_&&(e=E_.domain)&&e.exit();t_;){t=t_.fn,t_=t_.next;try{t()}catch(HX){throw t_?n_():r_=void 0,HX}}r_=void 0,e&&e.enter()},f_||y_||g_||!S_||!b_?!m_&&T_&&T_.resolve?((a_=T_.resolve(void 0)).constructor=T_,s_=p_(a_.then,a_),n_=function(){s_(e_)}):y_?n_=function(){E_.nextTick(e_)}:(v_=p_(v_,h_),n_=function(){v_(e_)}):(i_=!0,o_=b_.createTextNode(""),new S_(e_).observe(o_,{characterData:!0}),n_=function(){o_.data=i_=!i_}));var R_=I_||function(e){var t={fn:e,next:void 0};r_&&(r_.next=t),t_||(t_=t,n_()),r_=t},A_=n,C_=function(e){try{return{error:!1,value:e()}}catch(HX){return{error:!0,value:HX}}},w_=function(){this.head=null,this.tail=null};w_.prototype={add:function(e){var t={item:e,next:null};this.head?this.tail.next=t:this.head=t,this.tail=t},get:function(){var e=this.head;if(e)return this.head=e.next,this.tail===e&&(this.tail=null),e.item}};var x_=w_,O_=n.Promise,P_="object"==typeof Deno&&Deno&&"object"==typeof Deno.version,D_=!P_&&!sp&&"object"==typeof window&&"object"==typeof document,M_=n,N_=O_,L_=R,U_=Kt,V_=io,F_=lt,B_=D_,j_=P_,G_=_e,H_=N_&&N_.prototype,z_=F_("species"),K_=!1,X_=L_(M_.PromiseRejectionEvent),W_={CONSTRUCTOR:U_("Promise",(function(){var e=V_(N_),t=e!==String(N_);if(!t&&66===G_)return!0;if(!H_.catch||!H_.finally)return!0;if(!G_||G_<51||!/native code/.test(e)){var r=new N_((function(e){e(1)})),n=function(e){e((function(){}),(function(){}))};if((r.constructor={})[z_]=n,!(K_=r.then((function(){}))instanceof n))return!0}return!t&&(B_||j_)&&!X_})),REJECTION_EVENT:X_,SUBCLASSING:K_},q_={},Y_=we,J_=TypeError,Q_=function(e){var t,r;this.promise=new e((function(e,n){if(void 0!==t||void 0!==r)throw J_("Bad Promise constructor");t=e,r=n})),this.resolve=Y_(t),this.reject=Y_(r)};q_.f=function(e){return new Q_(e)};var Z_,$_,ev=Ar,tv=sp,rv=n,nv=O,iv=li,ov=Ni,av=hp,sv=we,cv=R,uv=$,dv=vp,lv=kp,hv=c_.set,pv=R_,_v=function(e,t){var r=A_.console;r&&r.error&&(1==arguments.length?r.error(e):r.error(e,t))},vv=C_,fv=x_,mv=Zi,gv=O_,yv=W_,Sv=q_,bv="Promise",Ev=yv.CONSTRUCTOR,Tv=yv.REJECTION_EVENT,kv=mv.getterFor(bv),Iv=mv.set,Rv=gv&&gv.prototype,Av=gv,Cv=Rv,wv=rv.TypeError,xv=rv.document,Ov=rv.process,Pv=Sv.f,Dv=Pv,Mv=!!(xv&&xv.createEvent&&rv.dispatchEvent),Nv="unhandledrejection",Lv=function(e){var t;return!(!uv(e)||!cv(t=e.then))&&t},Uv=function(e,t){var r,n,i,o=t.value,a=1==t.state,s=a?e.ok:e.fail,c=e.resolve,u=e.reject,d=e.domain;try{s?(a||(2===t.rejection&&Gv(t),t.rejection=1),!0===s?r=o:(d&&d.enter(),r=s(o),d&&(d.exit(),i=!0)),r===e.promise?u(wv("Promise-chain cycle")):(n=Lv(r))?nv(n,r,c,u):c(r)):u(o)}catch(HX){d&&!i&&d.exit(),u(HX)}},Vv=function(e,t){e.notified||(e.notified=!0,pv((function(){for(var r,n=e.reactions;r=n.get();)Uv(r,e);e.notified=!1,t&&!e.rejection&&Bv(e)})))},Fv=function(e,t,r){var n,i;Mv?((n=xv.createEvent("Event")).promise=t,n.reason=r,n.initEvent(e,!1,!0),rv.dispatchEvent(n)):n={promise:t,reason:r},!Tv&&(i=rv["on"+e])?i(n):e===Nv&&_v("Unhandled promise rejection",r)},Bv=function(e){nv(hv,rv,(function(){var t,r=e.facade,n=e.value;if(jv(e)&&(t=vv((function(){tv?Ov.emit("unhandledRejection",n,r):Fv(Nv,r,n)})),e.rejection=tv||jv(e)?2:1,t.error))throw t.value}))},jv=function(e){return 1!==e.rejection&&!e.parent},Gv=function(e){nv(hv,rv,(function(){var t=e.facade;tv?Ov.emit("rejectionHandled",t):Fv("rejectionhandled",t,e.value)}))},Hv=function(e,t,r){return function(n){e(t,n,r)}},zv=function(e,t,r){e.done||(e.done=!0,r&&(e=r),e.value=t,e.state=2,Vv(e,!0))},Kv=function(e,t,r){if(!e.done){e.done=!0,r&&(e=r);try{if(e.facade===t)throw wv("Promise can't be resolved itself");var n=Lv(t);n?pv((function(){var r={done:!1};try{nv(n,t,Hv(Kv,r,e),Hv(zv,r,e))}catch(HX){zv(r,HX,e)}})):(e.value=t,e.state=1,Vv(e,!1))}catch(HX){zv({done:!1},HX,e)}}};Ev&&(Cv=(Av=function(e){dv(this,Cv),sv(e),nv(Z_,this);var t=kv(this);try{e(Hv(Kv,t),Hv(zv,t))}catch(HX){zv(t,HX)}}).prototype,(Z_=function(e){Iv(this,{type:bv,done:!1,notified:!1,parent:!1,reactions:new fv,rejection:!1,state:0,value:void 0})}).prototype=iv(Cv,"then",(function(e,t){var r=kv(this),n=Pv(lv(this,Av));return r.parent=!0,n.ok=!cv(e)||e,n.fail=cv(t)&&t,n.domain=tv?Ov.domain:void 0,0==r.state?r.reactions.add(n):pv((function(){Uv(n,r)})),n.promise})),$_=function(){var e=new Z_,t=kv(e);this.promise=e,this.resolve=Hv(Kv,t),this.reject=Hv(zv,t)},Sv.f=Pv=function(e){return e===Av||undefined===e?new $_(e):Dv(e)}),ev({global:!0,constructor:!0,wrap:!0,forced:Ev},{Promise:Av}),ov(Av,bv,!1,!0),av(bv);var Xv=lt("iterator"),Wv=!1;try{var qv=0,Yv={next:function(){return{done:!!qv++}},return:function(){Wv=!0}};Yv[Xv]=function(){return this},Array.from(Yv,(function(){throw 2}))}catch(HX){}var Jv=function(e,t){if(!t&&!Wv)return!1;var r=!1;try{var n={};n[Xv]=function(){return{next:function(){return{done:r=!0}}}},e(n)}catch(HX){}return r},Qv=O_,Zv=W_.CONSTRUCTOR||!Jv((function(e){Qv.all(e).then(void 0,(function(){}))})),$v=O,ef=we,tf=q_,rf=C_,nf=Nh;Ar({target:"Promise",stat:!0,forced:Zv},{all:function(e){var t=this,r=tf.f(t),n=r.resolve,i=r.reject,o=rf((function(){var r=ef(t.resolve),o=[],a=0,s=1;nf(e,(function(e){var c=a++,u=!1;s++,$v(r,t,e).then((function(e){u||(u=!0,o[c]=e,--s||n(o))}),i)})),--s||n(o)}));return o.error&&i(o.value),r.promise}});var of=Ar,af=W_.CONSTRUCTOR;O_&&O_.prototype,of({target:"Promise",proto:!0,forced:af,real:!0},{catch:function(e){return this.then(void 0,e)}});var sf=O,cf=we,uf=q_,df=C_,lf=Nh;Ar({target:"Promise",stat:!0,forced:Zv},{race:function(e){var t=this,r=uf.f(t),n=r.reject,i=df((function(){var i=cf(t.resolve);lf(e,(function(e){sf(i,t,e).then(r.resolve,n)}))}));return i.error&&n(i.value),r.promise}});var hf=O,pf=q_;Ar({target:"Promise",stat:!0,forced:W_.CONSTRUCTOR},{reject:function(e){var t=pf.f(this);return hf(t.reject,void 0,e),t.promise}});var _f=tr,vf=$,ff=q_,mf=function(e,t){if(_f(e),vf(t)&&t.constructor===e)return t;var r=ff.f(e);return(0,r.resolve)(t),r.promise},gf=Ar,yf=O_,Sf=W_.CONSTRUCTOR,bf=mf,Ef=oe("Promise"),Tf=!Sf;gf({target:"Promise",stat:!0,forced:true},{resolve:function(e){return bf(Tf&&this===Ef?yf:this,e)}});var kf=O,If=we,Rf=q_,Af=C_,Cf=Nh;Ar({target:"Promise",stat:!0},{allSettled:function(e){var t=this,r=Rf.f(t),n=r.resolve,i=r.reject,o=Af((function(){var r=If(t.resolve),i=[],o=0,a=1;Cf(e,(function(e){var s=o++,c=!1;a++,kf(r,t,e).then((function(e){c||(c=!0,i[s]={status:"fulfilled",value:e},--a||n(i))}),(function(e){c||(c=!0,i[s]={status:"rejected",reason:e},--a||n(i))}))})),--a||n(i)}));return o.error&&i(o.value),r.promise}});var wf=O,xf=we,Of=oe,Pf=q_,Df=C_,Mf=Nh,Nf="No one promise resolved";Ar({target:"Promise",stat:!0},{any:function(e){var t=this,r=Of("AggregateError"),n=Pf.f(t),i=n.resolve,o=n.reject,a=Df((function(){var n=xf(t.resolve),a=[],s=0,c=1,u=!1;Mf(e,(function(e){var d=s++,l=!1;c++,wf(n,t,e).then((function(e){l||u||(u=!0,i(e))}),(function(e){l||u||(l=!0,a[d]=e,--c||o(new r(a,Nf)))}))})),--c||o(new r(a,Nf))}));return a.error&&o(a.value),n.promise}});var Lf=Ar,Uf=O_,Vf=i,Ff=oe,Bf=R,jf=kp,Gf=mf,Hf=Uf&&Uf.prototype;Lf({target:"Promise",proto:!0,real:!0,forced:!!Uf&&Vf((function(){Hf.finally.call({then:function(){}},(function(){}))}))},{finally:function(e){var t=jf(this,Ff("Promise")),r=Bf(e);return this.then(r?function(r){return Gf(t,e()).then((function(){return r}))}:e,r?function(r){return Gf(t,e()).then((function(){throw r}))}:e)}});var zf=ee.Promise,Kf=q_,Xf=C_;Ar({target:"Promise",stat:!0,forced:!0},{try:function(e){var t=Kf.f(this),r=Xf(e);return(r.error?t.reject:t.resolve)(r.value),t.promise}});var Wf=zf,qf=Ar,Yf=eo,Jf=E([].reverse),Qf=[1,2];qf({target:"Array",proto:!0,forced:String(Qf)===String(Qf.reverse())},{reverse:function(){return Yf(this)&&(this.length=this.length),Jf(this)}});var Zf=Us("Array").reverse,$f=ae,em=Zf,tm=Array.prototype,rm=function(e){var t=e.reverse;return e===tm||$f(tm,e)&&t===tm.reverse?em:t},nm=Ar,im=eo,om=yo,am=$,sm=Nr,cm=Br,um=J,dm=Qn,lm=lt,hm=rs,pm=Ms("slice"),_m=lm("species"),vm=Array,fm=Math.max;nm({target:"Array",proto:!0,forced:!pm},{slice:function(e,t){var r,n,i,o=um(this),a=cm(o),s=sm(e,a),c=sm(void 0===t?a:t,a);if(im(o)&&(r=o.constructor,(om(r)&&(r===vm||im(r.prototype))||am(r)&&null===(r=r[_m]))&&(r=void 0),r===vm||void 0===r))return hm(o,s,c);for(n=new(void 0===r?vm:r)(fm(c-s,0)),i=0;s<c;s++,i++)s in o&&dm(n,i,o[s]);return n.length=i,n}});var mm=Us("Array").slice,gm=ae,ym=mm,Sm=Array.prototype,bm=function(e){var t=e.slice;return e===Sm||gm(Sm,e)&&t===Sm.slice?ym:t};function Em(){Em=function(){return e};var e={},t=Object.prototype,r=t.hasOwnProperty,n=ad||function(e,t,r){e[t]=r.value},i="function"==typeof ml?ml:{},o=i.iterator||"@@iterator",a=i.asyncIterator||"@@asyncIterator",s=i.toStringTag||"@@toStringTag";function c(e,t,r){return ad(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}),e[t]}try{c({},"")}catch(A){c=function(e,t,r){return e[t]=r}}function u(e,t,r,i){var o=t&&t.prototype instanceof h?t:h,a=Vl(o.prototype),s=new k(i||[]);return n(a,"_invoke",{value:S(e,r,s)}),a}function d(e,t,r){try{return{type:"normal",arg:e.call(t,r)}}catch(A){return{type:"throw",arg:A}}}e.wrap=u;var l={};function h(){}function p(){}function _(){}var v={};c(v,o,(function(){return this}));var f=Gl&&Gl(Gl(I([])));f&&f!==t&&r.call(f,o)&&(v=f);var m=_.prototype=h.prototype=Vl(v);function g(e){var t;Nu(t=["next","throw","return"]).call(t,(function(t){c(e,t,(function(e){return this._invoke(t,e)}))}))}function y(e,t){function i(n,o,a,s){var c=d(e[n],e,o);if("throw"!==c.type){var u=c.arg,l=u.value;return l&&"object"==Ll(l)&&r.call(l,"__await")?t.resolve(l.__await).then((function(e){i("next",e,a,s)}),(function(e){i("throw",e,a,s)})):t.resolve(l).then((function(e){u.value=e,a(u)}),(function(e){return i("throw",e,a,s)}))}s(c.arg)}var o;n(this,"_invoke",{value:function(e,r){function n(){return new t((function(t,n){i(e,r,t,n)}))}return o=o?o.then(n,n):n()}})}function S(e,t,r){var n="suspendedStart";return function(i,o){if("executing"===n)throw new Error("Generator is already running");if("completed"===n){if("throw"===i)throw o;return{value:void 0,done:!0}}for(r.method=i,r.arg=o;;){var a=r.delegate;if(a){var s=b(a,r);if(s){if(s===l)continue;return s}}if("next"===r.method)r.sent=r._sent=r.arg;else if("throw"===r.method){if("suspendedStart"===n)throw n="completed",r.arg;r.dispatchException(r.arg)}else"return"===r.method&&r.abrupt("return",r.arg);n="executing";var c=d(e,t,r);if("normal"===c.type){if(n=r.done?"completed":"suspendedYield",c.arg===l)continue;return{value:c.arg,done:r.done}}"throw"===c.type&&(n="completed",r.method="throw",r.arg=c.arg)}}}function b(e,t){var r=e.iterator[t.method];if(void 0===r){if(t.delegate=null,"throw"===t.method){if(e.iterator.return&&(t.method="return",t.arg=void 0,b(e,t),"throw"===t.method))return l;t.method="throw",t.arg=new TypeError("The iterator does not provide a 'throw' method")}return l}var n=d(r,e.iterator,t.arg);if("throw"===n.type)return t.method="throw",t.arg=n.arg,t.delegate=null,l;var i=n.arg;return i?i.done?(t[e.resultName]=i.value,t.next=e.nextLoc,"return"!==t.method&&(t.method="next",t.arg=void 0),t.delegate=null,l):i:(t.method="throw",t.arg=new TypeError("iterator result is not an object"),t.delegate=null,l)}function E(e){var t={tryLoc:e[0]};1 in e&&(t.catchLoc=e[1]),2 in e&&(t.finallyLoc=e[2],t.afterLoc=e[3]),this.tryEntries.push(t)}function T(e){var t=e.completion||{};t.type="normal",delete t.arg,e.completion=t}function k(e){this.tryEntries=[{tryLoc:"root"}],Nu(e).call(e,E,this),this.reset(!0)}function I(e){if(e){var t=e[o];if(t)return t.call(e);if("function"==typeof e.next)return e;if(!isNaN(e.length)){var n=-1,i=function t(){for(;++n<e.length;)if(r.call(e,n))return t.value=e[n],t.done=!1,t;return t.value=void 0,t.done=!0,t};return i.next=i}}return{next:R}}function R(){return{value:void 0,done:!0}}return p.prototype=_,n(m,"constructor",{value:_,configurable:!0}),n(_,"constructor",{value:p,configurable:!0}),p.displayName=c(_,s,"GeneratorFunction"),e.isGeneratorFunction=function(e){var t="function"==typeof e&&e.constructor;return!!t&&(t===p||"GeneratorFunction"===(t.displayName||t.name))},e.mark=function(e){return Hl?Hl(e,_):(e.__proto__=_,c(e,s,"GeneratorFunction")),e.prototype=Vl(m),e},e.awrap=function(e){return{__await:e}},g(y.prototype),c(y.prototype,a,(function(){return this})),e.AsyncIterator=y,e.async=function(t,r,n,i,o){void 0===o&&(o=Wf);var a=new y(u(t,r,n,i),o);return e.isGeneratorFunction(r)?a:a.next().then((function(e){return e.done?e.value:a.next()}))},g(m),c(m,s,"Generator"),c(m,o,(function(){return this})),c(m,"toString",(function(){return"[object Generator]"})),e.keys=function(e){var t=Object(e),r=[];for(var n in t)r.push(n);return rm(r).call(r),function e(){for(;r.length;){var n=r.pop();if(n in t)return e.value=n,e.done=!1,e}return e.done=!0,e}},e.values=I,k.prototype={constructor:k,reset:function(e){var t;if(this.prev=0,this.next=0,this.sent=this._sent=void 0,this.done=!1,this.delegate=null,this.method="next",this.arg=void 0,Nu(t=this.tryEntries).call(t,T),!e)for(var n in this)"t"===n.charAt(0)&&r.call(this,n)&&!isNaN(+bm(n).call(n,1))&&(this[n]=void 0)},stop:function(){this.done=!0;var e=this.tryEntries[0].completion;if("throw"===e.type)throw e.arg;return this.rval},dispatchException:function(e){if(this.done)throw e;var t=this;function n(r,n){return a.type="throw",a.arg=e,t.next=r,n&&(t.method="next",t.arg=void 0),!!n}for(var i=this.tryEntries.length-1;i>=0;--i){var o=this.tryEntries[i],a=o.completion;if("root"===o.tryLoc)return n("end");if(o.tryLoc<=this.prev){var s=r.call(o,"catchLoc"),c=r.call(o,"finallyLoc");if(s&&c){if(this.prev<o.catchLoc)return n(o.catchLoc,!0);if(this.prev<o.finallyLoc)return n(o.finallyLoc)}else if(s){if(this.prev<o.catchLoc)return n(o.catchLoc,!0)}else{if(!c)throw new Error("try statement without catch or finally");if(this.prev<o.finallyLoc)return n(o.finallyLoc)}}}},abrupt:function(e,t){for(var n=this.tryEntries.length-1;n>=0;--n){var i=this.tryEntries[n];if(i.tryLoc<=this.prev&&r.call(i,"finallyLoc")&&this.prev<i.finallyLoc){var o=i;break}}o&&("break"===e||"continue"===e)&&o.tryLoc<=t&&t<=o.finallyLoc&&(o=null);var a=o?o.completion:{};return a.type=e,a.arg=t,o?(this.method="next",this.next=o.finallyLoc,l):this.complete(a)},complete:function(e,t){if("throw"===e.type)throw e.arg;return"break"===e.type||"continue"===e.type?this.next=e.arg:"return"===e.type?(this.rval=this.arg=e.arg,this.method="return",this.next="end"):"normal"===e.type&&t&&(this.next=t),l},finish:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var r=this.tryEntries[t];if(r.finallyLoc===e)return this.complete(r.completion,r.afterLoc),T(r),l}},catch:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var r=this.tryEntries[t];if(r.tryLoc===e){var n=r.completion;if("throw"===n.type){var i=n.arg;T(r)}return i}}throw new Error("illegal catch attempt")},delegateYield:function(e,t,r){return this.delegate={iterator:I(e),resultName:t,nextLoc:r},"next"===this.method&&(this.arg=void 0),l}},e}function Tm(e,t,r,n,i,o,a){try{var s=e[o](a),c=s.value}catch(HX){return void r(HX)}s.done?t(c):Wf.resolve(c).then(n,i)}function km(e){return function(){var t=this,r=arguments;return new Wf((function(n,i){var o=e.apply(t,r);function a(e){Tm(o,n,i,a,s,"next",e)}function s(e){Tm(o,n,i,a,s,"throw",e)}a(void 0)}))}}var Im=Us("Array").concat,Rm=ae,Am=Im,Cm=Array.prototype,wm=function(e){var t=e.concat;return e===Cm||Rm(Cm,e)&&t===Cm.concat?Am:t},xm="\t\n\v\f\r Â áââââââââââââ¯âã\u2028\u2029\ufeff",Om=W,Pm=gn,Dm=E("".replace),Mm="[\t\n\v\f\r Â áââââââââââââ¯âã\u2028\u2029\ufeff]",Nm=RegExp("^"+Mm+Mm+"*"),Lm=RegExp(Mm+Mm+"*$"),Um=function(e){return function(t){var r=Pm(Om(t));return 1&e&&(r=Dm(r,Nm,"")),2&e&&(r=Dm(r,Lm,"")),r}},Vm={start:Um(1),end:Um(2),trim:Um(3)},Fm=n,Bm=i,jm=E,Gm=gn,Hm=Vm.trim,zm=xm,Km=Fm.parseInt,Xm=Fm.Symbol,Wm=Xm&&Xm.iterator,qm=/^[+-]?0x/i,Ym=jm(qm.exec),Jm=8!==Km(zm+"08")||22!==Km(zm+"0x16")||Wm&&!Bm((function(){Km(Object(Wm))}))?function(e,t){var r=Hm(Gm(e));return Km(r,t>>>0||(Ym(qm,r)?16:10))}:Km;Ar({global:!0,forced:parseInt!=Jm},{parseInt:Jm});var Qm=ee.parseInt,Zm={exports:{}},$m=i((function(){if("function"==typeof ArrayBuffer){var e=new ArrayBuffer(8);Object.isExtensible(e)&&Object.defineProperty(e,"a",{value:8})}})),eg=i,tg=$,rg=y,ng=$m,ig=Object.isExtensible,og=eg((function(){ig(1)}))||ng?function(e){return!!tg(e)&&((!ng||"ArrayBuffer"!=rg(e))&&(!ig||ig(e)))}:ig,ag=!i((function(){return Object.isExtensible(Object.preventExtensions({}))})),sg=Ar,cg=E,ug=Xr,dg=$,lg=Ye,hg=Jt.f,pg=zn,_g=Wn,vg=og,fg=ag,mg=!1,gg=et("meta"),yg=0,Sg=function(e){hg(e,gg,{value:{objectID:"O"+yg++,weakData:{}}})},bg=Zm.exports={enable:function(){bg.enable=function(){},mg=!0;var e=pg.f,t=cg([].splice),r={};r[gg]=1,e(r).length&&(pg.f=function(r){for(var n=e(r),i=0,o=n.length;i<o;i++)if(n[i]===gg){t(n,i,1);break}return n},sg({target:"Object",stat:!0,forced:!0},{getOwnPropertyNames:_g.f}))},fastKey:function(e,t){if(!dg(e))return"symbol"==typeof e?e:("string"==typeof e?"S":"P")+e;if(!lg(e,gg)){if(!vg(e))return"F";if(!t)return"E";Sg(e)}return e[gg].objectID},getWeakData:function(e,t){if(!lg(e,gg)){if(!vg(e))return!0;if(!t)return!1;Sg(e)}return e[gg].weakData},onFreeze:function(e){return fg&&mg&&vg(e)&&!lg(e,gg)&&Sg(e),e}};ug[gg]=!0;var Eg=Ar,Tg=n,kg=Zm.exports,Ig=i,Rg=vr,Ag=Nh,Cg=vp,wg=R,xg=$,Og=Ni,Pg=Jt.f,Dg=Mo.forEach,Mg=C,Ng=Zi.set,Lg=Zi.getterFor,Ug=function(e,t,r){var n,i=-1!==e.indexOf("Map"),o=-1!==e.indexOf("Weak"),a=i?"set":"add",s=Tg[e],c=s&&s.prototype,u={};if(Mg&&wg(s)&&(o||c.forEach&&!Ig((function(){(new s).entries().next()})))){var d=(n=t((function(t,r){Ng(Cg(t,d),{type:e,collection:new s}),null!=r&&Ag(r,t[a],{that:t,AS_ENTRIES:i})}))).prototype,l=Lg(e);Dg(["add","clear","delete","forEach","get","has","set","keys","values","entries"],(function(e){var t="add"==e||"set"==e;!(e in c)||o&&"clear"==e||Rg(d,e,(function(r,n){var i=l(this).collection;if(!t&&o&&!xg(r))return"get"==e&&void 0;var a=i[e](0===r?0:r,n);return t?this:a}))})),o||Pg(d,"size",{configurable:!0,get:function(){return l(this).collection.size}})}else n=r.getConstructor(t,e,i,a),kg.enable();return Og(n,e,!1,!0),u[e]=n,Eg({global:!0,forced:!0},u),o||r.setStrong(n,e,i),n},Vg=li,Fg=function(e,t,r){for(var n in t)r&&r.unsafe&&e[n]?e[n]=t[n]:Vg(e,n,t[n],r);return e},Bg=Jt.f,jg=Hn,Gg=Fg,Hg=Yt,zg=vp,Kg=z,Xg=Nh,Wg=iu,qg=ou,Yg=hp,Jg=C,Qg=Zm.exports.fastKey,Zg=Zi.set,$g=Zi.getterFor,ey={getConstructor:function(e,t,r,n){var i=e((function(e,i){zg(e,o),Zg(e,{type:t,index:jg(null),first:void 0,last:void 0,size:0}),Jg||(e.size=0),Kg(i)||Xg(i,e[n],{that:e,AS_ENTRIES:r})})),o=i.prototype,a=$g(t),s=function(e,t,r){var n,i,o=a(e),s=c(e,t);return s?s.value=r:(o.last=s={index:i=Qg(t,!0),key:t,value:r,previous:n=o.last,next:void 0,removed:!1},o.first||(o.first=s),n&&(n.next=s),Jg?o.size++:e.size++,"F"!==i&&(o.index[i]=s)),e},c=function(e,t){var r,n=a(e),i=Qg(t);if("F"!==i)return n.index[i];for(r=n.first;r;r=r.next)if(r.key==t)return r};return Gg(o,{clear:function(){for(var e=a(this),t=e.index,r=e.first;r;)r.removed=!0,r.previous&&(r.previous=r.previous.next=void 0),delete t[r.index],r=r.next;e.first=e.last=void 0,Jg?e.size=0:this.size=0},delete:function(e){var t=this,r=a(t),n=c(t,e);if(n){var i=n.next,o=n.previous;delete r.index[n.index],n.removed=!0,o&&(o.next=i),i&&(i.previous=o),r.first==n&&(r.first=i),r.last==n&&(r.last=o),Jg?r.size--:t.size--}return!!n},forEach:function(e){for(var t,r=a(this),n=Hg(e,arguments.length>1?arguments[1]:void 0);t=t?t.next:r.first;)for(n(t.value,t.key,this);t&&t.removed;)t=t.previous},has:function(e){return!!c(this,e)}}),Gg(o,r?{get:function(e){var t=c(this,e);return t&&t.value},set:function(e,t){return s(this,0===e?0:e,t)}}:{add:function(e){return s(this,e=0===e?0:e,e)}}),Jg&&Bg(o,"size",{get:function(){return a(this).size}}),i},setStrong:function(e,t,r){var n=t+" Iterator",i=$g(t),o=$g(n);Wg(e,t,(function(e,t){Zg(this,{type:n,target:e,state:i(e),kind:t,last:void 0})}),(function(){for(var e=o(this),t=e.kind,r=e.last;r&&r.removed;)r=r.previous;return e.target&&(e.last=r=r?r.next:e.state.first)?qg("keys"==t?r.key:"values"==t?r.value:[r.key,r.value],!1):(e.target=void 0,qg(void 0,!0))}),r?"entries":"values",!r,!0),Yg(t)}};Ug("Map",(function(e){return function(){return e(this,arguments.length?arguments[0]:void 0)}}),ey);var ty=ee.Map,ry=Yt,ny=O,iy=we,oy=yp,ay=z,sy=Nh,cy=[].push,uy=function(e){var t,r,n,i,o=arguments.length,a=o>1?arguments[1]:void 0;return oy(this),(t=void 0!==a)&&iy(a),ay(e)?new this:(r=[],t?(n=0,i=ry(a,o>2?arguments[2]:void 0),sy(e,(function(e){ny(cy,r,i(e,n++))}))):sy(e,cy,{that:r}),new this(r))};Ar({target:"Map",stat:!0,forced:!0},{from:uy});var dy=rs,ly=function(){return new this(dy(arguments))};Ar({target:"Map",stat:!0,forced:!0},{of:ly});var hy=O,py=we,_y=tr,vy=function(){for(var e,t=_y(this),r=py(t.delete),n=!0,i=0,o=arguments.length;i<o;i++)e=hy(r,t,arguments[i]),n=n&&e;return!!n};Ar({target:"Map",proto:!0,real:!0,forced:!0},{deleteAll:vy});var fy=O,my=we,gy=tr,yy=function(e,t){var r,n,i=gy(this),o=my(i.get),a=my(i.has),s=my(i.set);return fy(a,i,e)?(r=fy(o,i,e),"update"in t&&(r=t.update(r,e,i),fy(s,i,e,r)),r):(n=t.insert(e,i),fy(s,i,e,n),n)};Ar({target:"Map",proto:!0,real:!0,forced:!0},{emplace:yy});var Sy=mh,by=tr,Ey=Yt,Ty=Sy,ky=Nh;Ar({target:"Map",proto:!0,real:!0,forced:!0},{every:function(e){var t=by(this),r=Ty(t),n=Ey(e,arguments.length>1?arguments[1]:void 0);return!ky(r,(function(e,r,i){if(!n(r,e,t))return i()}),{AS_ENTRIES:!0,IS_ITERATOR:!0,INTERRUPTED:!0}).stopped}});var Iy=oe,Ry=Yt,Ay=O,Cy=we,wy=tr,xy=kp,Oy=Sy,Py=Nh;Ar({target:"Map",proto:!0,real:!0,forced:!0},{filter:function(e){var t=wy(this),r=Oy(t),n=Ry(e,arguments.length>1?arguments[1]:void 0),i=new(xy(t,Iy("Map"))),o=Cy(i.set);return Py(r,(function(e,r){n(r,e,t)&&Ay(o,i,e,r)}),{AS_ENTRIES:!0,IS_ITERATOR:!0}),i}});var Dy=tr,My=Yt,Ny=Sy,Ly=Nh;Ar({target:"Map",proto:!0,real:!0,forced:!0},{find:function(e){var t=Dy(this),r=Ny(t),n=My(e,arguments.length>1?arguments[1]:void 0);return Ly(r,(function(e,r,i){if(n(r,e,t))return i(r)}),{AS_ENTRIES:!0,IS_ITERATOR:!0,INTERRUPTED:!0}).result}});var Uy=tr,Vy=Yt,Fy=Sy,By=Nh;Ar({target:"Map",proto:!0,real:!0,forced:!0},{findKey:function(e){var t=Uy(this),r=Fy(t),n=Vy(e,arguments.length>1?arguments[1]:void 0);return By(r,(function(e,r,i){if(n(r,e,t))return i(e)}),{AS_ENTRIES:!0,IS_ITERATOR:!0,INTERRUPTED:!0}).result}});var jy=Ar,Gy=O,Hy=we,zy=mh,Ky=Nh,Xy=E([].push);jy({target:"Map",stat:!0,forced:!0},{groupBy:function(e,t){Hy(t);var r=zy(e),n=new this,i=Hy(n.has),o=Hy(n.get),a=Hy(n.set);return Ky(r,(function(e){var r=t(e);Gy(i,n,r)?Xy(Gy(o,n,r),e):Gy(a,n,r,[e])}),{IS_ITERATOR:!0}),n}});var Wy=tr,qy=Sy,Yy=function(e,t){return e===t||e!=e&&t!=t},Jy=Nh;Ar({target:"Map",proto:!0,real:!0,forced:!0},{includes:function(e){return Jy(qy(Wy(this)),(function(t,r,n){if(Yy(r,e))return n()}),{AS_ENTRIES:!0,IS_ITERATOR:!0,INTERRUPTED:!0}).stopped}});var Qy=O,Zy=Nh,$y=we;Ar({target:"Map",stat:!0,forced:!0},{keyBy:function(e,t){var r=new this;$y(t);var n=$y(r.set);return Zy(e,(function(e){Qy(n,r,t(e),e)})),r}});var eS=tr,tS=Sy,rS=Nh;Ar({target:"Map",proto:!0,real:!0,forced:!0},{keyOf:function(e){return rS(tS(eS(this)),(function(t,r,n){if(r===e)return n(t)}),{AS_ENTRIES:!0,IS_ITERATOR:!0,INTERRUPTED:!0}).result}});var nS=oe,iS=Yt,oS=O,aS=we,sS=tr,cS=kp,uS=Sy,dS=Nh;Ar({target:"Map",proto:!0,real:!0,forced:!0},{mapKeys:function(e){var t=sS(this),r=uS(t),n=iS(e,arguments.length>1?arguments[1]:void 0),i=new(cS(t,nS("Map"))),o=aS(i.set);return dS(r,(function(e,r){oS(o,i,n(r,e,t),r)}),{AS_ENTRIES:!0,IS_ITERATOR:!0}),i}});var lS=oe,hS=Yt,pS=O,_S=we,vS=tr,fS=kp,mS=Sy,gS=Nh;Ar({target:"Map",proto:!0,real:!0,forced:!0},{mapValues:function(e){var t=vS(this),r=mS(t),n=hS(e,arguments.length>1?arguments[1]:void 0),i=new(fS(t,lS("Map"))),o=_S(i.set);return gS(r,(function(e,r){pS(o,i,e,n(r,e,t))}),{AS_ENTRIES:!0,IS_ITERATOR:!0}),i}});var yS=we,SS=tr,bS=Nh;Ar({target:"Map",proto:!0,real:!0,arity:1,forced:!0},{merge:function(e){for(var t=SS(this),r=yS(t.set),n=arguments.length,i=0;i<n;)bS(arguments[i++],r,{that:t,AS_ENTRIES:!0});return t}});var ES=tr,TS=we,kS=Sy,IS=Nh,RS=TypeError;Ar({target:"Map",proto:!0,real:!0,forced:!0},{reduce:function(e){var t=ES(this),r=kS(t),n=arguments.length<2,i=n?void 0:arguments[1];if(TS(e),IS(r,(function(r,o){n?(n=!1,i=o):i=e(i,o,r,t)}),{AS_ENTRIES:!0,IS_ITERATOR:!0}),n)throw RS("Reduce of empty map with no initial value");return i}});var AS=tr,CS=Yt,wS=Sy,xS=Nh;Ar({target:"Map",proto:!0,real:!0,forced:!0},{some:function(e){var t=AS(this),r=wS(t),n=CS(e,arguments.length>1?arguments[1]:void 0);return xS(r,(function(e,r,i){if(n(r,e,t))return i()}),{AS_ENTRIES:!0,IS_ITERATOR:!0,INTERRUPTED:!0}).stopped}});var OS=O,PS=tr,DS=we,MS=TypeError;Ar({target:"Map",proto:!0,real:!0,forced:!0},{update:function(e,t){var r=PS(this),n=DS(r.get),i=DS(r.has),o=DS(r.set),a=arguments.length;DS(t);var s=OS(i,r,e);if(!s&&a<3)throw MS("Updating absent value");var c=s?OS(n,r,e):DS(a>2?arguments[2]:void 0)(e,r);return OS(o,r,e,t(c,e,r)),r}});var NS=O,LS=we,US=R,VS=tr,FS=TypeError,BS=function(e,t){var r,n=VS(this),i=LS(n.get),o=LS(n.has),a=LS(n.set),s=arguments.length>2?arguments[2]:void 0;if(!US(t)&&!US(s))throw FS("At least one callback required");return NS(o,n,e)?(r=NS(i,n,e),US(t)&&(r=t(r),NS(a,n,e,r))):US(s)&&(r=s(),NS(a,n,e,r)),r};Ar({target:"Map",proto:!0,real:!0,forced:!0},{upsert:BS}),Ar({target:"Map",proto:!0,real:!0,name:"upsert",forced:!0},{updateOrInsert:BS});var jS=ty,GS=we,HS=Xe,zS=H,KS=Br,XS=TypeError,WS=function(e){return function(t,r,n,i){GS(r);var o=HS(t),a=zS(o),s=KS(o),c=e?s-1:0,u=e?-1:1;if(n<2)for(;;){if(c in a){i=a[c],c+=u;break}if(c+=u,e?c<0:s<=c)throw XS("Reduce of empty array with no initial value")}for(;e?c>=0:s>c;c+=u)c in a&&(i=r(i,a[c],c,o));return i}},qS={left:WS(!1),right:WS(!0)}.left,YS=_e,JS=sp;Ar({target:"Array",proto:!0,forced:!Iu("reduce")||!JS&&YS>79&&YS<83},{reduce:function(e){var t=arguments.length;return qS(this,e,t,t>1?arguments[1]:void 0)}});var QS=Us("Array").reduce,ZS=ae,$S=QS,eb=Array.prototype,tb=function(e){var t=e.reduce;return e===eb||ZS(eb,e)&&t===eb.reduce?$S:t},rb=C,nb=E,ib=O,ob=i,ab=rn,sb=ui,cb=P,ub=Xe,db=H,lb=Object.assign,hb=Object.defineProperty,pb=nb([].concat),_b=!lb||ob((function(){if(rb&&1!==lb({b:1},lb(hb({},"a",{enumerable:!0,get:function(){hb(this,"b",{value:3,enumerable:!1})}}),{b:2})).b)return!0;var e={},t={},r=Symbol(),n="abcdefghijklmnopqrst";return e[r]=7,n.split("").forEach((function(e){t[e]=e})),7!=lb({},e)[r]||ab(lb({},t)).join("")!=n}))?function(e,t){for(var r=ub(e),n=arguments.length,i=1,o=sb.f,a=cb.f;n>i;)for(var s,c=db(arguments[i++]),u=o?pb(ab(c),o(c)):ab(c),d=u.length,l=0;d>l;)s=u[l++],rb&&!ib(a,c,s)||(r[s]=c[s]);return r}:lb,vb=_b;Ar({target:"Object",stat:!0,arity:2,forced:Object.assign!==vb},{assign:vb});var fb=ee.Object.assign,mb=$,gb=y,yb=lt("match"),Sb=function(e){var t;return mb(e)&&(void 0!==(t=e[yb])?!!t:"RegExp"==gb(e))},bb=TypeError,Eb=function(e){if(Sb(e))throw bb("The method doesn't accept regular expressions");return e},Tb=lt("match"),kb=function(e){var t=/./;try{"/./"[e](t)}catch(r){try{return t[Tb]=!1,"/./"[e](t)}catch(n){}}return!1},Ib=Ar,Rb=E;A.f;var Ab=Vr,Cb=gn,wb=Eb,xb=W,Ob=kb,Pb=Rb("".endsWith),Db=Rb("".slice),Mb=Math.min;Ib({target:"String",proto:!0,forced:!Ob("endsWith")},{endsWith:function(e){var t=Cb(xb(this));wb(e);var r=arguments.length>1?arguments[1]:void 0,n=t.length,i=void 0===r?n:Mb(Ab(r),n),o=Cb(e);return Pb?Pb(t,o,i):Db(t,i-o.length,i)===o}});var Nb=Us("String").endsWith,Lb=ae,Ub=Nb,Vb=String.prototype,Fb=function(e){var t=e.endsWith;return"string"==typeof e||e===Vb||Lb(Vb,e)&&t===Vb.endsWith?Ub:t},Bb=!0,jb=!0;function Gb(e,t,r){var n=e.match(t);return n&&n.length>=r&&Qm(n[r],10)}function Hb(e,t,r){if(e.RTCPeerConnection){var n=e.RTCPeerConnection.prototype,i=n.addEventListener;n.addEventListener=function(e,n){if(e!==t)return i.apply(this,arguments);var o=function(e){var t=r(e);t&&(n.handleEvent?n.handleEvent(t):n(t))};return this._eventMap=this._eventMap||{},this._eventMap[t]||(this._eventMap[t]=new jS),this._eventMap[t].set(n,o),i.apply(this,[e,o])};var o=n.removeEventListener;n.removeEventListener=function(e,r){if(e!==t||!this._eventMap||!this._eventMap[t])return o.apply(this,arguments);if(!this._eventMap[t].has(r))return o.apply(this,arguments);var n=this._eventMap[t].get(r);return this._eventMap[t].delete(r),0===this._eventMap[t].size&&delete this._eventMap[t],0===an(this._eventMap).length&&delete this._eventMap,o.apply(this,[e,n])},ad(n,"on"+t,{get:function(){return this["_on"+t]},set:function(e){this["_on"+t]&&(this.removeEventListener(t,this["_on"+t]),delete this["_on"+t]),e&&this.addEventListener(t,this["_on"+t]=e)},enumerable:!0,configurable:!0})}}function zb(e){return"boolean"!=typeof e?new Error("Argument type: "+Ll(e)+". Please use a boolean."):(Bb=e,e?"adapter.js logging disabled":"adapter.js logging enabled")}function Kb(e){return"boolean"!=typeof e?new Error("Argument type: "+Ll(e)+". Please use a boolean."):(jb=!e,"adapter.js deprecation warnings "+(e?"disabled":"enabled"))}function Xb(){if("object"===("undefined"==typeof window?"undefined":Ll(window))){if(Bb)return;"undefined"!=typeof console&&"function"==typeof console.log&&console.log.apply(console,arguments)}}function Wb(e,t){jb&&console.warn(e+" is deprecated, please use "+t+" instead.")}function qb(e){var t={browser:null,version:null};if(void 0===e||!e.navigator)return t.browser="Not a browser.",t;var r=e.navigator;if(r.mozGetUserMedia)t.browser="firefox",t.version=Gb(r.userAgent,/Firefox\/(\d+)\./,1);else if(r.webkitGetUserMedia||!1===e.isSecureContext&&e.webkitRTCPeerConnection)t.browser="chrome",t.version=Gb(r.userAgent,/Chrom(e|ium)\/(\d+)\./,2);else{if(!e.RTCPeerConnection||!r.userAgent.match(/AppleWebKit\/(\d+)\./))return t.browser="Not a supported browser.",t;t.browser="safari",t.version=Gb(r.userAgent,/AppleWebKit\/(\d+)\./,1),t.supportsUnifiedPlan=e.RTCRtpTransceiver&&"currentDirection"in e.RTCRtpTransceiver.prototype}return t}function Yb(e){return"[object Object]"===Object.prototype.toString.call(e)}function Jb(e){var t;return Yb(e)?tb(t=an(e)).call(t,(function(t,r){var n=Yb(e[r]),i=n?Jb(e[r]):e[r],o=n&&!an(i).length;return void 0===i||o?t:fb(t,sd({},r,i))}),{}):e}function Qb(e,t,r){t&&!r.has(t.id)&&(r.set(t.id,t),an(t).forEach((function(n){Fb(n).call(n,"Id")?Qb(e,e.get(t[n]),r):Fb(n).call(n,"Ids")&&t[n].forEach((function(t){Qb(e,e.get(t),r)}))})))}function Zb(e,t,r){var n=r?"outbound-rtp":"inbound-rtp",i=new jS;if(null===t)return i;var o=[];return e.forEach((function(e){"track"===e.type&&e.trackIdentifier===t.id&&o.push(e)})),o.forEach((function(t){e.forEach((function(r){r.type===n&&r.trackId===t.id&&Qb(e,r,i)}))})),i}var $b=Ar,eE=Mo.find,tE="find",rE=!0;tE in[]&&Array(1).find((function(){rE=!1})),$b({target:"Array",proto:!0,forced:rE},{find:function(e){return eE(this,e,arguments.length>1?arguments[1]:void 0)}});var nE=Us("Array").find,iE=ae,oE=nE,aE=Array.prototype,sE=function(e){var t=e.find;return e===aE||iE(aE,e)&&t===aE.find?oE:t},cE=Ar,uE=Kr.indexOf,dE=Iu,lE=E([].indexOf),hE=!!lE&&1/lE([1],1,-0)<0,pE=dE("indexOf");cE({target:"Array",proto:!0,forced:hE||!pE},{indexOf:function(e){var t=arguments.length>1?arguments[1]:void 0;return hE?lE(this,e,t)||0:uE(this,e,t)}});var _E=Us("Array").indexOf,vE=ae,fE=_E,mE=Array.prototype,gE=function(e){var t=e.indexOf;return e===mE||vE(mE,e)&&t===mE.indexOf?fE:t},yE=C,SE=eo,bE=TypeError,EE=Object.getOwnPropertyDescriptor,TE=yE&&!function(){if(void 0!==this)return!0;try{Object.defineProperty([],"length",{writable:!1}).length=1}catch(HX){return HX instanceof TypeError}}(),kE=Ie,IE=TypeError,RE=function(e,t){if(!delete e[t])throw IE("Cannot delete property "+kE(t)+" of "+kE(e))},AE=Ar,CE=Xe,wE=Nr,xE=Or,OE=Br,PE=TE?function(e,t){if(SE(e)&&!EE(e,"length").writable)throw bE("Cannot set read only .length");return e.length=t}:function(e,t){return e.length=t},DE=Qd,ME=Ro,NE=Qn,LE=RE,UE=Ms("splice"),VE=Math.max,FE=Math.min;AE({target:"Array",proto:!0,forced:!UE},{splice:function(e,t){var r,n,i,o,a,s,c=CE(this),u=OE(c),d=wE(e,u),l=arguments.length;for(0===l?r=n=0:1===l?(r=0,n=u-d):(r=l-2,n=FE(VE(xE(t),0),u-d)),DE(u+r-n),i=ME(c,n),o=0;o<n;o++)(a=d+o)in c&&NE(i,o,c[a]);if(i.length=n,r<n){for(o=d;o<u-n;o++)s=o+r,(a=o+n)in c?c[s]=c[a]:LE(c,s);for(o=u;o>u-n+r;o--)LE(c,o-1)}else if(r>n)for(o=u-n;o>d;o--)s=o+r-1,(a=o+n-1)in c?c[s]=c[a]:LE(c,s);for(o=0;o<r;o++)c[o+d]=arguments[o+2];return PE(c,u-n+r),i}});var BE=Us("Array").splice,jE=ae,GE=BE,HE=Array.prototype,zE=function(e){var t=e.splice;return e===HE||jE(HE,e)&&t===HE.splice?GE:t},KE=Mo.map;Ar({target:"Array",proto:!0,forced:!Ms("map")},{map:function(e){return KE(this,e,arguments.length>1?arguments[1]:void 0)}});var XE=Us("Array").map,WE=ae,qE=XE,YE=Array.prototype,JE=function(e){var t=e.map;return e===YE||WE(YE,e)&&t===YE.map?qE:t},QE=ee,ZE=d;QE.JSON||(QE.JSON={stringify:JSON.stringify});var $E=function(e,t,r){return ZE(QE.JSON.stringify,null,arguments)},eT=$E,tT=Kr.includes;Ar({target:"Array",proto:!0,forced:i((function(){return!Array(1).includes()}))},{includes:function(e){return tT(this,e,arguments.length>1?arguments[1]:void 0)}});var rT=Us("Array").includes,nT=Ar,iT=Eb,oT=W,aT=gn,sT=kb,cT=E("".indexOf);nT({target:"String",proto:!0,forced:!sT("includes")},{includes:function(e){return!!~cT(aT(oT(this)),aT(iT(e)),arguments.length>1?arguments[1]:void 0)}});var uT=Us("String").includes,dT=ae,lT=rT,hT=uT,pT=Array.prototype,_T=String.prototype,vT=function(e){var t=e.includes;return e===pT||dT(pT,e)&&t===pT.includes?lT:"string"==typeof e||e===_T||dT(_T,e)&&t===_T.includes?hT:t},fT=Xb;function mT(e,t){var r=e&&e.navigator;if(r.mediaDevices){var n=function(e){if("object"!==Ll(e)||e.mandatory||e.optional)return e;var t,r={};(an(e).forEach((function(t){if("require"!==t&&"advanced"!==t&&"mediaSource"!==t){var n="object"===Ll(e[t])?e[t]:{ideal:e[t]};void 0!==n.exact&&"number"==typeof n.exact&&(n.min=n.max=n.exact);var i=function(e,t){return e?e+t.charAt(0).toUpperCase()+bm(t).call(t,1):"deviceId"===t?"sourceId":t};if(void 0!==n.ideal){r.optional=r.optional||[];var o={};"number"==typeof n.ideal?(o[i("min",t)]=n.ideal,r.optional.push(o),(o={})[i("max",t)]=n.ideal,r.optional.push(o)):(o[i("",t)]=n.ideal,r.optional.push(o))}void 0!==n.exact&&"number"!=typeof n.exact?(r.mandatory=r.mandatory||{},r.mandatory[i("",t)]=n.exact):["min","max"].forEach((function(e){void 0!==n[e]&&(r.mandatory=r.mandatory||{},r.mandatory[i(e,t)]=n[e])}))}})),e.advanced)&&(r.optional=wm(t=r.optional||[]).call(t,e.advanced));return r},i=function(e,i){if(t.version>=61)return i(e);if((e=JSON.parse(eT(e)))&&"object"===Ll(e.audio)){var o=function(e,t,r){t in e&&!(r in e)&&(e[r]=e[t],delete e[t])};o((e=JSON.parse(eT(e))).audio,"autoGainControl","googAutoGainControl"),o(e.audio,"noiseSuppression","googNoiseSuppression"),e.audio=n(e.audio)}if(e&&"object"===Ll(e.video)){var a=e.video.facingMode;a=a&&("object"===Ll(a)?a:{ideal:a});var s,c=t.version<66;if(a&&("user"===a.exact||"environment"===a.exact||"user"===a.ideal||"environment"===a.ideal)&&(!r.mediaDevices.getSupportedConstraints||!r.mediaDevices.getSupportedConstraints().facingMode||c))if(delete e.video.facingMode,"environment"===a.exact||"environment"===a.ideal?s=["back","rear"]:"user"!==a.exact&&"user"!==a.ideal||(s=["front"]),s)return r.mediaDevices.enumerateDevices().then((function(t){t=Gs(t).call(t,(function(e){return"videoinput"===e.kind}));var r=sE(t).call(t,(function(e){return s.some((function(t){var r;return vT(r=e.label.toLowerCase()).call(r,t)}))}));return!r&&t.length&&vT(s).call(s,"back")&&(r=t[t.length-1]),r&&(e.video.deviceId=a.exact?{exact:r.deviceId}:{ideal:r.deviceId}),e.video=n(e.video),fT("chrome: "+eT(e)),i(e)}));e.video=n(e.video)}return fT("chrome: "+eT(e)),i(e)},o=function(e){return t.version>=64?e:{name:{PermissionDeniedError:"NotAllowedError",PermissionDismissedError:"NotAllowedError",InvalidStateError:"NotAllowedError",DevicesNotFoundError:"NotFoundError",ConstraintNotSatisfiedError:"OverconstrainedError",TrackStartError:"NotReadableError",MediaDeviceFailedDueToShutdown:"NotAllowedError",MediaDeviceKillSwitchOn:"NotAllowedError",TabCaptureError:"AbortError",ScreenCaptureError:"AbortError",DeviceCaptureError:"AbortError"}[e.name]||e.name,message:e.message,constraint:e.constraint||e.constraintName,toString:function(){return this.name+(this.message&&": ")+this.message}}};if(r.getUserMedia=function(e,t,n){i(e,(function(e){r.webkitGetUserMedia(e,t,(function(e){n&&n(o(e))}))}))}.bind(r),r.mediaDevices.getUserMedia){var a=r.mediaDevices.getUserMedia.bind(r.mediaDevices);r.mediaDevices.getUserMedia=function(e){return i(e,(function(e){return a(e).then((function(t){if(e.audio&&!t.getAudioTracks().length||e.video&&!t.getVideoTracks().length)throw t.getTracks().forEach((function(e){e.stop()})),new DOMException("","NotFoundError");return t}),(function(e){return Wf.reject(o(e))}))}))}}}}function gT(e){e.MediaStream=e.MediaStream||e.webkitMediaStream}function yT(e){if("object"===Ll(e)&&e.RTCPeerConnection&&!("ontrack"in e.RTCPeerConnection.prototype)){ad(e.RTCPeerConnection.prototype,"ontrack",{get:function(){return this._ontrack},set:function(e){this._ontrack&&this.removeEventListener("track",this._ontrack),this.addEventListener("track",this._ontrack=e)},enumerable:!0,configurable:!0});var t=e.RTCPeerConnection.prototype.setRemoteDescription;e.RTCPeerConnection.prototype.setRemoteDescription=function(){var r=this;return this._ontrackpoly||(this._ontrackpoly=function(t){t.stream.addEventListener("addtrack",(function(n){var i,o;e.RTCPeerConnection.prototype.getReceivers?i=sE(o=r.getReceivers()).call(o,(function(e){return e.track&&e.track.id===n.track.id})):i={track:n.track};var a=new Event("track");a.track=n.track,a.receiver=i,a.transceiver={receiver:i},a.streams=[t.stream],r.dispatchEvent(a)})),t.stream.getTracks().forEach((function(n){var i,o;e.RTCPeerConnection.prototype.getReceivers?i=sE(o=r.getReceivers()).call(o,(function(e){return e.track&&e.track.id===n.id})):i={track:n};var a=new Event("track");a.track=n,a.receiver=i,a.transceiver={receiver:i},a.streams=[t.stream],r.dispatchEvent(a)}))},this.addEventListener("addstream",this._ontrackpoly)),t.apply(this,arguments)}}else Hb(e,"track",(function(e){return e.transceiver||ad(e,"transceiver",{value:{receiver:e.receiver}}),e}))}function ST(e){if("object"===Ll(e)&&e.RTCPeerConnection&&!("getSenders"in e.RTCPeerConnection.prototype)&&"createDTMFSender"in e.RTCPeerConnection.prototype){var t=function(e,t){return{track:t,get dtmf(){return void 0===this._dtmf&&("audio"===t.kind?this._dtmf=e.createDTMFSender(t):this._dtmf=null),this._dtmf},_pc:e}};if(!e.RTCPeerConnection.prototype.getSenders){e.RTCPeerConnection.prototype.getSenders=function(){var e;return this._senders=this._senders||[],bm(e=this._senders).call(e)};var r=e.RTCPeerConnection.prototype.addTrack;e.RTCPeerConnection.prototype.addTrack=function(e,n){var i=r.apply(this,arguments);return i||(i=t(this,e),this._senders.push(i)),i};var n=e.RTCPeerConnection.prototype.removeTrack;e.RTCPeerConnection.prototype.removeTrack=function(e){var t;n.apply(this,arguments);var r,i=gE(t=this._senders).call(t,e);-1!==i&&zE(r=this._senders).call(r,i,1)}}var i=e.RTCPeerConnection.prototype.addStream;e.RTCPeerConnection.prototype.addStream=function(e){var r=this;this._senders=this._senders||[],i.apply(this,[e]),e.getTracks().forEach((function(e){r._senders.push(t(r,e))}))};var o=e.RTCPeerConnection.prototype.removeStream;e.RTCPeerConnection.prototype.removeStream=function(e){var t=this;this._senders=this._senders||[],o.apply(this,[e]),e.getTracks().forEach((function(e){var r,n,i,o=sE(r=t._senders).call(r,(function(t){return t.track===e}));o&&zE(n=t._senders).call(n,gE(i=t._senders).call(i,o),1)}))}}else if("object"===Ll(e)&&e.RTCPeerConnection&&"getSenders"in e.RTCPeerConnection.prototype&&"createDTMFSender"in e.RTCPeerConnection.prototype&&e.RTCRtpSender&&!("dtmf"in e.RTCRtpSender.prototype)){var a=e.RTCPeerConnection.prototype.getSenders;e.RTCPeerConnection.prototype.getSenders=function(){var e=this,t=a.apply(this,[]);return t.forEach((function(t){return t._pc=e})),t},ad(e.RTCRtpSender.prototype,"dtmf",{get:function(){return void 0===this._dtmf&&("audio"===this.track.kind?this._dtmf=this._pc.createDTMFSender(this.track):this._dtmf=null),this._dtmf}})}}function bT(e){if(e.RTCPeerConnection){var t=e.RTCPeerConnection.prototype.getStats;e.RTCPeerConnection.prototype.getStats=function(){var e=this,r=bm(Array.prototype).call(arguments),n=r[0],i=r[1],o=r[2];if(arguments.length>0&&"function"==typeof n)return t.apply(this,arguments);if(0===t.length&&(0===arguments.length||"function"!=typeof n))return t.apply(this,[]);var a=function(e){var t={};return e.result().forEach((function(e){var r={id:e.id,timestamp:e.timestamp,type:{localcandidate:"local-candidate",remotecandidate:"remote-candidate"}[e.type]||e.type};e.names().forEach((function(t){r[t]=e.stat(t)})),t[r.id]=r})),t},s=function(e){var t;return new jS(JE(t=an(e)).call(t,(function(t){return[t,e[t]]})))};if(arguments.length>=2){var c=function(e){i(s(a(e)))};return t.apply(this,[c,n])}return new Wf((function(r,n){t.apply(e,[function(e){r(s(a(e)))},n])})).then(i,o)}}}function ET(e){if("object"===Ll(e)&&e.RTCPeerConnection&&e.RTCRtpSender&&e.RTCRtpReceiver){if(!("getStats"in e.RTCRtpSender.prototype)){var t=e.RTCPeerConnection.prototype.getSenders;t&&(e.RTCPeerConnection.prototype.getSenders=function(){var e=this,r=t.apply(this,[]);return r.forEach((function(t){return t._pc=e})),r});var r=e.RTCPeerConnection.prototype.addTrack;r&&(e.RTCPeerConnection.prototype.addTrack=function(){var e=r.apply(this,arguments);return e._pc=this,e}),e.RTCRtpSender.prototype.getStats=function(){var e=this;return this._pc.getStats().then((function(t){return Zb(t,e.track,!0)}))}}if(!("getStats"in e.RTCRtpReceiver.prototype)){var n=e.RTCPeerConnection.prototype.getReceivers;n&&(e.RTCPeerConnection.prototype.getReceivers=function(){var e=this,t=n.apply(this,[]);return t.forEach((function(t){return t._pc=e})),t}),Hb(e,"track",(function(e){return e.receiver._pc=e.srcElement,e})),e.RTCRtpReceiver.prototype.getStats=function(){var e=this;return this._pc.getStats().then((function(t){return Zb(t,e.track,!1)}))}}if("getStats"in e.RTCRtpSender.prototype&&"getStats"in e.RTCRtpReceiver.prototype){var i=e.RTCPeerConnection.prototype.getStats;e.RTCPeerConnection.prototype.getStats=function(){if(arguments.length>0&&arguments[0]instanceof e.MediaStreamTrack){var t,r,n,o=arguments[0];return this.getSenders().forEach((function(e){e.track===o&&(t?n=!0:t=e)})),this.getReceivers().forEach((function(e){return e.track===o&&(r?n=!0:r=e),e.track===o})),n||t&&r?Wf.reject(new DOMException("There are more than one sender or receiver for the track.","InvalidAccessError")):t?t.getStats():r?r.getStats():Wf.reject(new DOMException("There is no sender or receiver for the track.","InvalidAccessError"))}return i.apply(this,arguments)}}}}function TT(e){e.RTCPeerConnection.prototype.getLocalStreams=function(){var e,t=this;return this._shimmedLocalStreams=this._shimmedLocalStreams||{},JE(e=an(this._shimmedLocalStreams)).call(e,(function(e){return t._shimmedLocalStreams[e][0]}))};var t=e.RTCPeerConnection.prototype.addTrack;e.RTCPeerConnection.prototype.addTrack=function(e,r){var n;if(!r)return t.apply(this,arguments);this._shimmedLocalStreams=this._shimmedLocalStreams||{};var i=t.apply(this,arguments);return this._shimmedLocalStreams[r.id]?-1===gE(n=this._shimmedLocalStreams[r.id]).call(n,i)&&this._shimmedLocalStreams[r.id].push(i):this._shimmedLocalStreams[r.id]=[r,i],i};var r=e.RTCPeerConnection.prototype.addStream;e.RTCPeerConnection.prototype.addStream=function(e){var t,n,i=this;this._shimmedLocalStreams=this._shimmedLocalStreams||{},e.getTracks().forEach((function(e){var t;if(sE(t=i.getSenders()).call(t,(function(t){return t.track===e})))throw new DOMException("Track already exists.","InvalidAccessError")}));var o=this.getSenders();r.apply(this,arguments);var a=Gs(t=this.getSenders()).call(t,(function(e){return-1===gE(o).call(o,e)}));this._shimmedLocalStreams[e.id]=wm(n=[e]).call(n,a)};var n=e.RTCPeerConnection.prototype.removeStream;e.RTCPeerConnection.prototype.removeStream=function(e){return this._shimmedLocalStreams=this._shimmedLocalStreams||{},delete this._shimmedLocalStreams[e.id],n.apply(this,arguments)};var i=e.RTCPeerConnection.prototype.removeTrack;e.RTCPeerConnection.prototype.removeTrack=function(e){var t=this;return this._shimmedLocalStreams=this._shimmedLocalStreams||{},e&&an(this._shimmedLocalStreams).forEach((function(r){var n,i,o=gE(n=t._shimmedLocalStreams[r]).call(n,e);-1!==o&&zE(i=t._shimmedLocalStreams[r]).call(i,o,1);1===t._shimmedLocalStreams[r].length&&delete t._shimmedLocalStreams[r]})),i.apply(this,arguments)}}function kT(e,t){if(e.RTCPeerConnection){if(e.RTCPeerConnection.prototype.addTrack&&t.version>=65)return TT(e);var r=e.RTCPeerConnection.prototype.getLocalStreams;e.RTCPeerConnection.prototype.getLocalStreams=function(){var e=this,t=r.apply(this);return this._reverseStreams=this._reverseStreams||{},JE(t).call(t,(function(t){return e._reverseStreams[t.id]}))};var n=e.RTCPeerConnection.prototype.addStream;e.RTCPeerConnection.prototype.addStream=function(t){var r=this;if(this._streams=this._streams||{},this._reverseStreams=this._reverseStreams||{},t.getTracks().forEach((function(e){var t;if(sE(t=r.getSenders()).call(t,(function(t){return t.track===e})))throw new DOMException("Track already exists.","InvalidAccessError")})),!this._reverseStreams[t.id]){var i=new e.MediaStream(t.getTracks());this._streams[t.id]=i,this._reverseStreams[i.id]=t,t=i}n.apply(this,[t])};var i=e.RTCPeerConnection.prototype.removeStream;e.RTCPeerConnection.prototype.removeStream=function(e){this._streams=this._streams||{},this._reverseStreams=this._reverseStreams||{},i.apply(this,[this._streams[e.id]||e]),delete this._reverseStreams[this._streams[e.id]?this._streams[e.id].id:e.id],delete this._streams[e.id]},e.RTCPeerConnection.prototype.addTrack=function(t,r){var n,i,o,a=this;if("closed"===this.signalingState)throw new DOMException("The RTCPeerConnection's signalingState is 'closed'.","InvalidStateError");var s=bm([]).call(arguments,1);if(1!==s.length||!sE(n=s[0].getTracks()).call(n,(function(e){return e===t})))throw new DOMException("The adapter.js addTrack polyfill only supports a single  stream which is associated with the specified track.","NotSupportedError");var c=sE(i=this.getSenders()).call(i,(function(e){return e.track===t}));if(c)throw new DOMException("Track already exists.","InvalidAccessError");this._streams=this._streams||{},this._reverseStreams=this._reverseStreams||{};var u=this._streams[r.id];if(u)u.addTrack(t),Wf.resolve().then((function(){a.dispatchEvent(new Event("negotiationneeded"))}));else{var d=new e.MediaStream([t]);this._streams[r.id]=d,this._reverseStreams[d.id]=r,this.addStream(d)}return sE(o=this.getSenders()).call(o,(function(e){return e.track===t}))},["createOffer","createAnswer"].forEach((function(t){var r=e.RTCPeerConnection.prototype[t],n=sd({},t,(function(){var e=this,t=arguments,n=arguments.length&&"function"==typeof arguments[0];return n?r.apply(this,[function(r){var n=s(e,r);t[0].apply(null,[n])},function(e){t[1]&&t[1].apply(null,e)},arguments[2]]):r.apply(this,arguments).then((function(t){return s(e,t)}))}));e.RTCPeerConnection.prototype[t]=n[t]}));var o=e.RTCPeerConnection.prototype.setLocalDescription;e.RTCPeerConnection.prototype.setLocalDescription=function(){return arguments.length&&arguments[0].type?(arguments[0]=c(this,arguments[0]),o.apply(this,arguments)):o.apply(this,arguments)};var a=tc(e.RTCPeerConnection.prototype,"localDescription");ad(e.RTCPeerConnection.prototype,"localDescription",{get:function(){var e=a.get.apply(this);return""===e.type?e:s(this,e)}}),e.RTCPeerConnection.prototype.removeTrack=function(e){var t,r=this;if("closed"===this.signalingState)throw new DOMException("The RTCPeerConnection's signalingState is 'closed'.","InvalidStateError");if(!e._pc)throw new DOMException("Argument 1 of RTCPeerConnection.removeTrack does not implement interface RTCRtpSender.","TypeError");if(!(e._pc===this))throw new DOMException("Sender was not created by this connection.","InvalidAccessError");this._streams=this._streams||{},an(this._streams).forEach((function(n){var i;sE(i=r._streams[n].getTracks()).call(i,(function(t){return e.track===t}))&&(t=r._streams[n])})),t&&(1===t.getTracks().length?this.removeStream(this._reverseStreams[t.id]):t.removeTrack(e.track),this.dispatchEvent(new Event("negotiationneeded")))}}function s(e,t){var r=t.sdp;return an(e._reverseStreams||[]).forEach((function(t){var n=e._reverseStreams[t],i=e._streams[n.id];r=r.replace(new RegExp(i.id,"g"),n.id)})),new RTCSessionDescription({type:t.type,sdp:r})}function c(e,t){var r=t.sdp;return an(e._reverseStreams||[]).forEach((function(t){var n=e._reverseStreams[t],i=e._streams[n.id];r=r.replace(new RegExp(n.id,"g"),i.id)})),new RTCSessionDescription({type:t.type,sdp:r})}}function IT(e,t){!e.RTCPeerConnection&&e.webkitRTCPeerConnection&&(e.RTCPeerConnection=e.webkitRTCPeerConnection),e.RTCPeerConnection&&t.version<53&&["setLocalDescription","setRemoteDescription","addIceCandidate"].forEach((function(t){var r=e.RTCPeerConnection.prototype[t],n=sd({},t,(function(){return arguments[0]=new("addIceCandidate"===t?e.RTCIceCandidate:e.RTCSessionDescription)(arguments[0]),r.apply(this,arguments)}));e.RTCPeerConnection.prototype[t]=n[t]}))}function RT(e,t){Hb(e,"negotiationneeded",(function(e){var r=e.target;if(!(t.version<72||r.getConfiguration&&"plan-b"===r.getConfiguration().sdpSemantics)||"stable"===r.signalingState)return e}))}var AT=Object.freeze(Object.defineProperty({__proto__:null,shimMediaStream:gT,shimOnTrack:yT,shimGetSendersWithDtmf:ST,shimGetStats:bT,shimSenderReceiverGetStats:ET,shimAddTrackRemoveTrackWithNative:TT,shimAddTrackRemoveTrack:kT,shimPeerConnection:IT,fixNegotiationNeeded:RT,shimGetUserMedia:mT,shimGetDisplayMedia:function(e,t){e.navigator.mediaDevices&&"getDisplayMedia"in e.navigator.mediaDevices||e.navigator.mediaDevices&&("function"==typeof t?e.navigator.mediaDevices.getDisplayMedia=function(r){return t(r).then((function(t){var n=r.video&&r.video.width,i=r.video&&r.video.height,o=r.video&&r.video.frameRate;return r.video={mandatory:{chromeMediaSource:"desktop",chromeMediaSourceId:t,maxFrameRate:o||3}},n&&(r.video.mandatory.maxWidth=n),i&&(r.video.mandatory.maxHeight=i),e.navigator.mediaDevices.getUserMedia(r)}))}:console.error("shimGetDisplayMedia: getSourceId argument is not a function"))}},Symbol.toStringTag,{value:"Module"}));Ar({target:"Array",stat:!0},{isArray:eo});var CT=ee.Array.isArray;function wT(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,n=new Array(t);r<t;r++)n[r]=e[r];return n}var xT=dh,OT=tr,PT=bh,DT=Yt,MT=O,NT=Xe,LT=function(e,t,r,n){try{return n?t(OT(r)[0],r[1]):t(r)}catch(HX){PT(e,"throw",HX)}},UT=ih,VT=yo,FT=Br,BT=Qn,jT=mh,GT=dh,HT=Array,zT=function(e){var t=NT(e),r=VT(this),n=arguments.length,i=n>1?arguments[1]:void 0,o=void 0!==i;o&&(i=DT(i,n>2?arguments[2]:void 0));var a,s,c,u,d,l,h=GT(t),p=0;if(!h||this===HT&&UT(h))for(a=FT(t),s=r?new this(a):HT(a);a>p;p++)l=o?i(t[p],p):t[p],BT(s,p,l);else for(d=(u=jT(t,h)).next,s=r?new this:[];!(c=MT(d,u)).done;p++)l=o?LT(u,i,[c.value,p],!0):c.value,BT(s,p,l);return s.length=p,s},KT=zT;Ar({target:"Array",stat:!0,forced:!Jv((function(e){Array.from(e)}))},{from:KT});var XT=ee.Array.from;function WT(e,t){var r;if(e){if("string"==typeof e)return wT(e,t);var n=bm(r=Object.prototype.toString.call(e)).call(r,8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?XT(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?wT(e,t):void 0}}function qT(e){return function(e){if(CT(e))return wT(e)}(e)||function(e){if(void 0!==ml&&null!=xT(e)||null!=e["@@iterator"])return XT(e)}(e)||WT(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}var YT=n,JT=i,QT=gn,ZT=Vm.trim,$T=E("".charAt),ek=YT.parseFloat,tk=YT.Symbol,rk=tk&&tk.iterator,nk=1/ek("\t\n\v\f\r Â áââââââââââââ¯âã\u2028\u2029\ufeff-0")!=-1/0||rk&&!JT((function(){ek(Object(rk))}))?function(e){var t=ZT(QT(e)),r=ek(t);return 0===r&&"-"==$T(t,0)?-0:r}:ek;Ar({global:!0,forced:parseFloat!=nk},{parseFloat:nk});var ik=ee.parseFloat;function ok(e,t){var r=e&&e.navigator,n=e&&e.MediaStreamTrack;if(r.getUserMedia=function(e,t,n){Wb("navigator.getUserMedia","navigator.mediaDevices.getUserMedia"),r.mediaDevices.getUserMedia(e).then(t,n)},!(t.version>55&&"autoGainControl"in r.mediaDevices.getSupportedConstraints())){var i=function(e,t,r){t in e&&!(r in e)&&(e[r]=e[t],delete e[t])},o=r.mediaDevices.getUserMedia.bind(r.mediaDevices);if(r.mediaDevices.getUserMedia=function(e){return"object"===Ll(e)&&"object"===Ll(e.audio)&&(e=JSON.parse(eT(e)),i(e.audio,"autoGainControl","mozAutoGainControl"),i(e.audio,"noiseSuppression","mozNoiseSuppression")),o(e)},n&&n.prototype.getSettings){var a=n.prototype.getSettings;n.prototype.getSettings=function(){var e=a.apply(this,arguments);return i(e,"mozAutoGainControl","autoGainControl"),i(e,"mozNoiseSuppression","noiseSuppression"),e}}if(n&&n.prototype.applyConstraints){var s=n.prototype.applyConstraints;n.prototype.applyConstraints=function(e){return"audio"===this.kind&&"object"===Ll(e)&&(e=JSON.parse(eT(e)),i(e,"autoGainControl","mozAutoGainControl"),i(e,"noiseSuppression","mozNoiseSuppression")),s.apply(this,[e])}}}}function ak(e){"object"===Ll(e)&&e.RTCTrackEvent&&"receiver"in e.RTCTrackEvent.prototype&&!("transceiver"in e.RTCTrackEvent.prototype)&&ad(e.RTCTrackEvent.prototype,"transceiver",{get:function(){return{receiver:this.receiver}}})}function sk(e,t){if("object"===Ll(e)&&(e.RTCPeerConnection||e.mozRTCPeerConnection)){!e.RTCPeerConnection&&e.mozRTCPeerConnection&&(e.RTCPeerConnection=e.mozRTCPeerConnection),t.version<53&&["setLocalDescription","setRemoteDescription","addIceCandidate"].forEach((function(t){var r=e.RTCPeerConnection.prototype[t],n=sd({},t,(function(){return arguments[0]=new("addIceCandidate"===t?e.RTCIceCandidate:e.RTCSessionDescription)(arguments[0]),r.apply(this,arguments)}));e.RTCPeerConnection.prototype[t]=n[t]}));var r={inboundrtp:"inbound-rtp",outboundrtp:"outbound-rtp",candidatepair:"candidate-pair",localcandidate:"local-candidate",remotecandidate:"remote-candidate"},n=e.RTCPeerConnection.prototype.getStats;e.RTCPeerConnection.prototype.getStats=function(){var e=bm(Array.prototype).call(arguments),i=e[0],o=e[1],a=e[2];return n.apply(this,[i||null]).then((function(e){if(t.version<53&&!o)try{e.forEach((function(e){e.type=r[e.type]||e.type}))}catch(n){if("TypeError"!==n.name)throw n;e.forEach((function(t,n){e.set(n,fb({},t,{type:r[t.type]||t.type}))}))}return e})).then(o,a)}}}function ck(e){if("object"===Ll(e)&&e.RTCPeerConnection&&e.RTCRtpSender&&(!e.RTCRtpSender||!("getStats"in e.RTCRtpSender.prototype))){var t=e.RTCPeerConnection.prototype.getSenders;t&&(e.RTCPeerConnection.prototype.getSenders=function(){var e=this,r=t.apply(this,[]);return r.forEach((function(t){return t._pc=e})),r});var r=e.RTCPeerConnection.prototype.addTrack;r&&(e.RTCPeerConnection.prototype.addTrack=function(){var e=r.apply(this,arguments);return e._pc=this,e}),e.RTCRtpSender.prototype.getStats=function(){return this.track?this._pc.getStats(this.track):Wf.resolve(new jS)}}}function uk(e){if("object"===Ll(e)&&e.RTCPeerConnection&&e.RTCRtpSender&&(!e.RTCRtpSender||!("getStats"in e.RTCRtpReceiver.prototype))){var t=e.RTCPeerConnection.prototype.getReceivers;t&&(e.RTCPeerConnection.prototype.getReceivers=function(){var e=this,r=t.apply(this,[]);return r.forEach((function(t){return t._pc=e})),r}),Hb(e,"track",(function(e){return e.receiver._pc=e.srcElement,e})),e.RTCRtpReceiver.prototype.getStats=function(){return this._pc.getStats(this.track)}}}function dk(e){e.RTCPeerConnection&&!("removeStream"in e.RTCPeerConnection.prototype)&&(e.RTCPeerConnection.prototype.removeStream=function(e){var t=this;Wb("removeStream","removeTrack"),this.getSenders().forEach((function(r){var n;r.track&&vT(n=e.getTracks()).call(n,r.track)&&t.removeTrack(r)}))})}function lk(e){e.DataChannel&&!e.RTCDataChannel&&(e.RTCDataChannel=e.DataChannel)}function hk(e){if("object"===Ll(e)&&e.RTCPeerConnection){var t=e.RTCPeerConnection.prototype.addTransceiver;t&&(e.RTCPeerConnection.prototype.addTransceiver=function(){this.setParametersPromises=[];var e=arguments[1]&&arguments[1].sendEncodings;void 0===e&&(e=[]);var r=(e=qT(e)).length>0;r&&e.forEach((function(e){if("rid"in e){if(!/^[a-z0-9]{0,16}$/i.test(e.rid))throw new TypeError("Invalid RID value provided.")}if("scaleResolutionDownBy"in e&&!(ik(e.scaleResolutionDownBy)>=1))throw new RangeError("scale_resolution_down_by must be >= 1.0");if("maxFramerate"in e&&!(ik(e.maxFramerate)>=0))throw new RangeError("max_framerate must be >= 0.0")}));var n=t.apply(this,arguments);if(r){var i=n.sender,o=i.getParameters();(!("encodings"in o)||1===o.encodings.length&&0===an(o.encodings[0]).length)&&(o.encodings=e,i.sendEncodings=e,this.setParametersPromises.push(i.setParameters(o).then((function(){delete i.sendEncodings})).catch((function(){delete i.sendEncodings}))))}return n})}}function pk(e){if("object"===Ll(e)&&e.RTCRtpSender){var t=e.RTCRtpSender.prototype.getParameters;t&&(e.RTCRtpSender.prototype.getParameters=function(){var e,r=t.apply(this,arguments);"encodings"in r||(r.encodings=wm(e=[]).call(e,this.sendEncodings||[{}]));return r})}}function _k(e){if("object"===Ll(e)&&e.RTCPeerConnection){var t=e.RTCPeerConnection.prototype.createOffer;e.RTCPeerConnection.prototype.createOffer=function(){var e=arguments,r=this;return this.setParametersPromises&&this.setParametersPromises.length?Wf.all(this.setParametersPromises).then((function(){return t.apply(r,e)})).finally((function(){r.setParametersPromises=[]})):t.apply(this,arguments)}}}function vk(e){if("object"===Ll(e)&&e.RTCPeerConnection){var t=e.RTCPeerConnection.prototype.createAnswer;e.RTCPeerConnection.prototype.createAnswer=function(){var e=arguments,r=this;return this.setParametersPromises&&this.setParametersPromises.length?Wf.all(this.setParametersPromises).then((function(){return t.apply(r,e)})).finally((function(){r.setParametersPromises=[]})):t.apply(this,arguments)}}}var fk=Object.freeze(Object.defineProperty({__proto__:null,shimOnTrack:ak,shimPeerConnection:sk,shimSenderGetStats:ck,shimReceiverGetStats:uk,shimRemoveStream:dk,shimRTCDataChannel:lk,shimAddTransceiver:hk,shimGetParameters:pk,shimCreateOffer:_k,shimCreateAnswer:vk,shimGetUserMedia:ok,shimGetDisplayMedia:function(e,t){e.navigator.mediaDevices&&"getDisplayMedia"in e.navigator.mediaDevices||e.navigator.mediaDevices&&(e.navigator.mediaDevices.getDisplayMedia=function(r){if(!r||!r.video){var n=new DOMException("getDisplayMedia without video constraints is undefined");return n.name="NotFoundError",n.code=8,Wf.reject(n)}return!0===r.video?r.video={mediaSource:t}:r.video.mediaSource=t,e.navigator.mediaDevices.getUserMedia(r)})}},Symbol.toStringTag,{value:"Module"}));function mk(e){if("object"===Ll(e)&&e.RTCPeerConnection){if("getLocalStreams"in e.RTCPeerConnection.prototype||(e.RTCPeerConnection.prototype.getLocalStreams=function(){return this._localStreams||(this._localStreams=[]),this._localStreams}),!("addStream"in e.RTCPeerConnection.prototype)){var t=e.RTCPeerConnection.prototype.addTrack;e.RTCPeerConnection.prototype.addStream=function(e){var r,n=this;this._localStreams||(this._localStreams=[]),vT(r=this._localStreams).call(r,e)||this._localStreams.push(e),e.getAudioTracks().forEach((function(r){return t.call(n,r,e)})),e.getVideoTracks().forEach((function(r){return t.call(n,r,e)}))},e.RTCPeerConnection.prototype.addTrack=function(e){for(var r=this,n=arguments.length,i=new Array(n>1?n-1:0),o=1;o<n;o++)i[o-1]=arguments[o];return i&&i.forEach((function(e){var t;r._localStreams?vT(t=r._localStreams).call(t,e)||r._localStreams.push(e):r._localStreams=[e]})),t.apply(this,arguments)}}"removeStream"in e.RTCPeerConnection.prototype||(e.RTCPeerConnection.prototype.removeStream=function(e){var t,r,n=this;this._localStreams||(this._localStreams=[]);var i=gE(t=this._localStreams).call(t,e);if(-1!==i){zE(r=this._localStreams).call(r,i,1);var o=e.getTracks();this.getSenders().forEach((function(e){vT(o).call(o,e.track)&&n.removeTrack(e)}))}})}}function gk(e){if("object"===Ll(e)&&e.RTCPeerConnection&&("getRemoteStreams"in e.RTCPeerConnection.prototype||(e.RTCPeerConnection.prototype.getRemoteStreams=function(){return this._remoteStreams?this._remoteStreams:[]}),!("onaddstream"in e.RTCPeerConnection.prototype))){ad(e.RTCPeerConnection.prototype,"onaddstream",{get:function(){return this._onaddstream},set:function(e){var t=this;this._onaddstream&&(this.removeEventListener("addstream",this._onaddstream),this.removeEventListener("track",this._onaddstreampoly)),this.addEventListener("addstream",this._onaddstream=e),this.addEventListener("track",this._onaddstreampoly=function(e){e.streams.forEach((function(e){var r;if(t._remoteStreams||(t._remoteStreams=[]),!vT(r=t._remoteStreams).call(r,e)){t._remoteStreams.push(e);var n=new Event("addstream");n.stream=e,t.dispatchEvent(n)}}))})}});var t=e.RTCPeerConnection.prototype.setRemoteDescription;e.RTCPeerConnection.prototype.setRemoteDescription=function(){var e=this;return this._onaddstreampoly||this.addEventListener("track",this._onaddstreampoly=function(t){t.streams.forEach((function(t){var r;if(e._remoteStreams||(e._remoteStreams=[]),!(gE(r=e._remoteStreams).call(r,t)>=0)){e._remoteStreams.push(t);var n=new Event("addstream");n.stream=t,e.dispatchEvent(n)}}))}),t.apply(e,arguments)}}}function yk(e){if("object"===Ll(e)&&e.RTCPeerConnection){var t=e.RTCPeerConnection.prototype,r=t.createOffer,n=t.createAnswer,i=t.setLocalDescription,o=t.setRemoteDescription,a=t.addIceCandidate;t.createOffer=function(e,t){var n=arguments.length>=2?arguments[2]:arguments[0],i=r.apply(this,[n]);return t?(i.then(e,t),Wf.resolve()):i},t.createAnswer=function(e,t){var r=arguments.length>=2?arguments[2]:arguments[0],i=n.apply(this,[r]);return t?(i.then(e,t),Wf.resolve()):i};var s=function(e,t,r){var n=i.apply(this,[e]);return r?(n.then(t,r),Wf.resolve()):n};t.setLocalDescription=s,s=function(e,t,r){var n=o.apply(this,[e]);return r?(n.then(t,r),Wf.resolve()):n},t.setRemoteDescription=s,s=function(e,t,r){var n=a.apply(this,[e]);return r?(n.then(t,r),Wf.resolve()):n},t.addIceCandidate=s}}function Sk(e){var t=e&&e.navigator;if(t.mediaDevices&&t.mediaDevices.getUserMedia){var r=t.mediaDevices,n=r.getUserMedia.bind(r);t.mediaDevices.getUserMedia=function(e){return n(bk(e))}}!t.getUserMedia&&t.mediaDevices&&t.mediaDevices.getUserMedia&&(t.getUserMedia=function(e,r,n){t.mediaDevices.getUserMedia(e).then(r,n)}.bind(t))}function bk(e){return e&&void 0!==e.video?fb({},e,{video:Jb(e.video)}):e}function Ek(e){if(e.RTCPeerConnection){var t=e.RTCPeerConnection;e.RTCPeerConnection=function(e,r){if(e&&e.iceServers){for(var n=[],i=0;i<e.iceServers.length;i++){var o=e.iceServers[i];!o.hasOwnProperty("urls")&&o.hasOwnProperty("url")?(Wb("RTCIceServer.url","RTCIceServer.urls"),(o=JSON.parse(eT(o))).urls=o.url,delete o.url,n.push(o)):n.push(e.iceServers[i])}e.iceServers=n}return new t(e,r)},e.RTCPeerConnection.prototype=t.prototype,"generateCertificate"in t&&ad(e.RTCPeerConnection,"generateCertificate",{get:function(){return t.generateCertificate}})}}function Tk(e){"object"===Ll(e)&&e.RTCTrackEvent&&"receiver"in e.RTCTrackEvent.prototype&&!("transceiver"in e.RTCTrackEvent.prototype)&&ad(e.RTCTrackEvent.prototype,"transceiver",{get:function(){return{receiver:this.receiver}}})}function kk(e){var t=e.RTCPeerConnection.prototype.createOffer;e.RTCPeerConnection.prototype.createOffer=function(e){if(e){var r,n;void 0!==e.offerToReceiveAudio&&(e.offerToReceiveAudio=!!e.offerToReceiveAudio);var i=sE(r=this.getTransceivers()).call(r,(function(e){return"audio"===e.receiver.track.kind}));!1===e.offerToReceiveAudio&&i?"sendrecv"===i.direction?i.setDirection?i.setDirection("sendonly"):i.direction="sendonly":"recvonly"===i.direction&&(i.setDirection?i.setDirection("inactive"):i.direction="inactive"):!0!==e.offerToReceiveAudio||i||this.addTransceiver("audio",{direction:"recvonly"}),void 0!==e.offerToReceiveVideo&&(e.offerToReceiveVideo=!!e.offerToReceiveVideo);var o=sE(n=this.getTransceivers()).call(n,(function(e){return"video"===e.receiver.track.kind}));!1===e.offerToReceiveVideo&&o?"sendrecv"===o.direction?o.setDirection?o.setDirection("sendonly"):o.direction="sendonly":"recvonly"===o.direction&&(o.setDirection?o.setDirection("inactive"):o.direction="inactive"):!0!==e.offerToReceiveVideo||o||this.addTransceiver("video",{direction:"recvonly"})}return t.apply(this,arguments)}}function Ik(e){"object"!==Ll(e)||e.AudioContext||(e.AudioContext=e.webkitAudioContext)}var Rk=Object.freeze(Object.defineProperty({__proto__:null,shimLocalStreamsAPI:mk,shimRemoteStreamsAPI:gk,shimCallbacksAPI:yk,shimGetUserMedia:Sk,shimConstraints:bk,shimRTCIceServerUrls:Ek,shimTrackEventTransceiver:Tk,shimCreateOfferLegacy:kk,shimAudioContext:Ik},Symbol.toStringTag,{value:"Module"})),Ak=cc.PROPER,Ck=i,wk=xm,xk=Vm.trim;Ar({target:"String",proto:!0,forced:function(e){return Ck((function(){return!!wk[e]()||"âÂá "!=="âÂá "[e]()||Ak&&wk[e].name!==e}))}("trim")},{trim:function(){return xk(this)}});var Ok,Pk,Dk=Us("String").trim,Mk=ae,Nk=Dk,Lk=String.prototype,Uk=function(e){var t=e.trim;return"string"==typeof e||e===Lk||Mk(Lk,e)&&t===Lk.trim?Nk:t},Vk={exports:{}};Ok=Vk,(Pk={generateIdentifier:function(){return Math.random().toString(36).substr(2,10)}}).localCName=Pk.generateIdentifier(),Pk.splitLines=function(e){var t;return JE(t=Uk(e).call(e).split("\n")).call(t,(function(e){return Uk(e).call(e)}))},Pk.splitSections=function(e){var t=e.split("\nm=");return JE(t).call(t,(function(e,t){var r;return Uk(r=t>0?"m="+e:e).call(r)+"\r\n"}))},Pk.getDescription=function(e){var t=Pk.splitSections(e);return t&&t[0]},Pk.getMediaSections=function(e){var t=Pk.splitSections(e);return t.shift(),t},Pk.matchPrefix=function(e,t){var r;return Gs(r=Pk.splitLines(e)).call(r,(function(e){return 0===gE(e).call(e,t)}))},Pk.parseCandidate=function(e){for(var t,r={foundation:(t=0===gE(e).call(e,"a=candidate:")?e.substring(12).split(" "):e.substring(10).split(" "))[0],component:{1:"rtp",2:"rtcp"}[t[1]]||t[1],protocol:t[2].toLowerCase(),priority:Qm(t[3],10),ip:t[4],address:t[4],port:Qm(t[5],10),type:t[7]},n=8;n<t.length;n+=2)switch(t[n]){case"raddr":r.relatedAddress=t[n+1];break;case"rport":r.relatedPort=Qm(t[n+1],10);break;case"tcptype":r.tcpType=t[n+1];break;case"ufrag":r.ufrag=t[n+1],r.usernameFragment=t[n+1];break;default:void 0===r[t[n]]&&(r[t[n]]=t[n+1])}return r},Pk.writeCandidate=function(e){var t=[];t.push(e.foundation);var r=e.component;"rtp"===r?t.push(1):"rtcp"===r?t.push(2):t.push(r),t.push(e.protocol.toUpperCase()),t.push(e.priority),t.push(e.address||e.ip),t.push(e.port);var n=e.type;return t.push("typ"),t.push(n),"host"!==n&&e.relatedAddress&&e.relatedPort&&(t.push("raddr"),t.push(e.relatedAddress),t.push("rport"),t.push(e.relatedPort)),e.tcpType&&"tcp"===e.protocol.toLowerCase()&&(t.push("tcptype"),t.push(e.tcpType)),(e.usernameFragment||e.ufrag)&&(t.push("ufrag"),t.push(e.usernameFragment||e.ufrag)),"candidate:"+t.join(" ")},Pk.parseIceOptions=function(e){return e.substr(14).split(" ")},Pk.parseRtpMap=function(e){var t=e.substr(9).split(" "),r={payloadType:Qm(t.shift(),10)};return t=t[0].split("/"),r.name=t[0],r.clockRate=Qm(t[1],10),r.channels=3===t.length?Qm(t[2],10):1,r.numChannels=r.channels,r},Pk.writeRtpMap=function(e){var t=e.payloadType;void 0!==e.preferredPayloadType&&(t=e.preferredPayloadType);var r=e.channels||e.numChannels||1;return"a=rtpmap:"+t+" "+e.name+"/"+e.clockRate+(1!==r?"/"+r:"")+"\r\n"},Pk.parseExtmap=function(e){var t,r=e.substr(9).split(" ");return{id:Qm(r[0],10),direction:gE(t=r[0]).call(t,"/")>0?r[0].split("/")[1]:"sendrecv",uri:r[1]}},Pk.writeExtmap=function(e){return"a=extmap:"+(e.id||e.preferredId)+(e.direction&&"sendrecv"!==e.direction?"/"+e.direction:"")+" "+e.uri+"\r\n"},Pk.parseFmtp=function(e){for(var t,r={},n=e.substr(gE(e).call(e," ")+1).split(";"),i=0;i<n.length;i++){var o,a;t=Uk(o=n[i]).call(o).split("="),r[Uk(a=t[0]).call(a)]=t[1]}return r},Pk.writeFmtp=function(e){var t="",r=e.payloadType;if(void 0!==e.preferredPayloadType&&(r=e.preferredPayloadType),e.parameters&&an(e.parameters).length){var n=[];an(e.parameters).forEach((function(t){void 0!==e.parameters[t]?n.push(t+"="+e.parameters[t]):n.push(t)})),t+="a=fmtp:"+r+" "+n.join(";")+"\r\n"}return t},Pk.parseRtcpFb=function(e){var t=e.substr(gE(e).call(e," ")+1).split(" ");return{type:t.shift(),parameter:t.join(" ")}},Pk.writeRtcpFb=function(e){var t="",r=e.payloadType;return void 0!==e.preferredPayloadType&&(r=e.preferredPayloadType),e.rtcpFeedback&&e.rtcpFeedback.length&&e.rtcpFeedback.forEach((function(e){t+="a=rtcp-fb:"+r+" "+e.type+(e.parameter&&e.parameter.length?" "+e.parameter:"")+"\r\n"})),t},Pk.parseSsrcMedia=function(e){var t=gE(e).call(e," "),r={ssrc:Qm(e.substr(7,t-7),10)},n=gE(e).call(e,":",t);return n>-1?(r.attribute=e.substr(t+1,n-t-1),r.value=e.substr(n+1)):r.attribute=e.substr(t+1),r},Pk.parseSsrcGroup=function(e){var t=e.substr(13).split(" ");return{semantics:t.shift(),ssrcs:JE(t).call(t,(function(e){return Qm(e,10)}))}},Pk.getMid=function(e){var t=Pk.matchPrefix(e,"a=mid:")[0];if(t)return t.substr(6)},Pk.parseFingerprint=function(e){var t=e.substr(14).split(" ");return{algorithm:t[0].toLowerCase(),value:t[1].toUpperCase()}},Pk.getDtlsParameters=function(e,t){var r=Pk.matchPrefix(e+t,"a=fingerprint:");return{role:"auto",fingerprints:JE(r).call(r,Pk.parseFingerprint)}},Pk.writeDtlsParameters=function(e,t){var r="a=setup:"+t+"\r\n";return e.fingerprints.forEach((function(e){r+="a=fingerprint:"+e.algorithm+" "+e.value+"\r\n"})),r},Pk.parseCryptoLine=function(e){var t=e.substr(9).split(" ");return{tag:Qm(t[0],10),cryptoSuite:t[1],keyParams:t[2],sessionParams:bm(t).call(t,3)}},Pk.writeCryptoLine=function(e){return"a=crypto:"+e.tag+" "+e.cryptoSuite+" "+("object"===Ll(e.keyParams)?Pk.writeCryptoKeyParams(e.keyParams):e.keyParams)+(e.sessionParams?" "+e.sessionParams.join(" "):"")+"\r\n"},Pk.parseCryptoKeyParams=function(e){if(0!==gE(e).call(e,"inline:"))return null;var t=e.substr(7).split("|");return{keyMethod:"inline",keySalt:t[0],lifeTime:t[1],mkiValue:t[2]?t[2].split(":")[0]:void 0,mkiLength:t[2]?t[2].split(":")[1]:void 0}},Pk.writeCryptoKeyParams=function(e){return e.keyMethod+":"+e.keySalt+(e.lifeTime?"|"+e.lifeTime:"")+(e.mkiValue&&e.mkiLength?"|"+e.mkiValue+":"+e.mkiLength:"")},Pk.getCryptoParameters=function(e,t){var r=Pk.matchPrefix(e+t,"a=crypto:");return JE(r).call(r,Pk.parseCryptoLine)},Pk.getIceParameters=function(e,t){var r=Pk.matchPrefix(e+t,"a=ice-ufrag:")[0],n=Pk.matchPrefix(e+t,"a=ice-pwd:")[0];return r&&n?{usernameFragment:r.substr(12),password:n.substr(10)}:null},Pk.writeIceParameters=function(e){var t="a=ice-ufrag:"+e.usernameFragment+"\r\na=ice-pwd:"+e.password+"\r\n";return e.iceLite&&(t+="a=ice-lite\r\n"),t},Pk.parseRtpParameters=function(e){for(var t={codecs:[],headerExtensions:[],fecMechanisms:[],rtcp:[]},r=Pk.splitLines(e)[0].split(" "),n=3;n<r.length;n++){var i=r[n],o=Pk.matchPrefix(e,"a=rtpmap:"+i+" ")[0];if(o){var a,s=Pk.parseRtpMap(o),c=Pk.matchPrefix(e,"a=fmtp:"+i+" ");switch(s.parameters=c.length?Pk.parseFmtp(c[0]):{},s.rtcpFeedback=JE(a=Pk.matchPrefix(e,"a=rtcp-fb:"+i+" ")).call(a,Pk.parseRtcpFb),t.codecs.push(s),s.name.toUpperCase()){case"RED":case"ULPFEC":t.fecMechanisms.push(s.name.toUpperCase())}}}return Pk.matchPrefix(e,"a=extmap:").forEach((function(e){t.headerExtensions.push(Pk.parseExtmap(e))})),t},Pk.writeRtpDescription=function(e,t){var r,n="";n+="m="+e+" ",n+=t.codecs.length>0?"9":"0",n+=" UDP/TLS/RTP/SAVPF ",n+=JE(r=t.codecs).call(r,(function(e){return void 0!==e.preferredPayloadType?e.preferredPayloadType:e.payloadType})).join(" ")+"\r\n",n+="c=IN IP4 0.0.0.0\r\n",n+="a=rtcp:9 IN IP4 0.0.0.0\r\n",t.codecs.forEach((function(e){n+=Pk.writeRtpMap(e),n+=Pk.writeFmtp(e),n+=Pk.writeRtcpFb(e)}));var i=0;return t.codecs.forEach((function(e){e.maxptime>i&&(i=e.maxptime)})),i>0&&(n+="a=maxptime:"+i+"\r\n"),t.headerExtensions&&t.headerExtensions.forEach((function(e){n+=Pk.writeExtmap(e)})),n},Pk.parseRtpEncodingParameters=function(e){var t,r,n,i,o,a,s=[],c=Pk.parseRtpParameters(e),u=-1!==gE(t=c.fecMechanisms).call(t,"RED"),d=-1!==gE(r=c.fecMechanisms).call(r,"ULPFEC"),l=Gs(n=JE(i=Pk.matchPrefix(e,"a=ssrc:")).call(i,(function(e){return Pk.parseSsrcMedia(e)}))).call(n,(function(e){return"cname"===e.attribute})),h=l.length>0&&l[0].ssrc,p=JE(o=Pk.matchPrefix(e,"a=ssrc-group:FID")).call(o,(function(e){var t=e.substr(17).split(" ");return JE(t).call(t,(function(e){return Qm(e,10)}))}));p.length>0&&p[0].length>1&&p[0][0]===h&&(a=p[0][1]),c.codecs.forEach((function(e){if("RTX"===e.name.toUpperCase()&&e.parameters.apt){var t={ssrc:h,codecPayloadType:Qm(e.parameters.apt,10)};h&&a&&(t.rtx={ssrc:a}),s.push(t),u&&((t=JSON.parse(eT(t))).fec={ssrc:h,mechanism:d?"red+ulpfec":"red"},s.push(t))}})),0===s.length&&h&&s.push({ssrc:h});var _,v,f=Pk.matchPrefix(e,"b=");return f.length&&(f=0===gE(_=f[0]).call(_,"b=TIAS:")?Qm(f[0].substr(7),10):0===gE(v=f[0]).call(v,"b=AS:")?1e3*Qm(f[0].substr(5),10)*.95-16e3:void 0,s.forEach((function(e){e.maxBitrate=f}))),s},Pk.parseRtcpParameters=function(e){var t,r,n={},i=Gs(t=JE(r=Pk.matchPrefix(e,"a=ssrc:")).call(r,(function(e){return Pk.parseSsrcMedia(e)}))).call(t,(function(e){return"cname"===e.attribute}))[0];i&&(n.cname=i.value,n.ssrc=i.ssrc);var o=Pk.matchPrefix(e,"a=rtcp-rsize");n.reducedSize=o.length>0,n.compound=0===o.length;var a=Pk.matchPrefix(e,"a=rtcp-mux");return n.mux=a.length>0,n},Pk.writeRtcpParameters=function(e){var t="";return e.reducedSize&&(t+="a=rtcp-rsize\r\n"),e.mux&&(t+="a=rtcp-mux\r\n"),void 0!==e.ssrc&&e.cname&&(t+="a=ssrc:"+e.ssrc+" cname:"+e.cname+"\r\n"),t},Pk.parseMsid=function(e){var t,r,n,i=Pk.matchPrefix(e,"a=msid:");if(1===i.length)return{stream:(n=i[0].substr(7).split(" "))[0],track:n[1]};var o=Gs(t=JE(r=Pk.matchPrefix(e,"a=ssrc:")).call(r,(function(e){return Pk.parseSsrcMedia(e)}))).call(t,(function(e){return"msid"===e.attribute}));return o.length>0?{stream:(n=o[0].value.split(" "))[0],track:n[1]}:void 0},Pk.parseSctpDescription=function(e){var t,r=Pk.parseMLine(e),n=Pk.matchPrefix(e,"a=max-message-size:");n.length>0&&(t=Qm(n[0].substr(19),10)),isNaN(t)&&(t=65536);var i=Pk.matchPrefix(e,"a=sctp-port:");if(i.length>0)return{port:Qm(i[0].substr(12),10),protocol:r.fmt,maxMessageSize:t};var o=Pk.matchPrefix(e,"a=sctpmap:");if(o.length>0){var a=o[0].substr(10).split(" ");return{port:Qm(a[0],10),protocol:a[1],maxMessageSize:t}}},Pk.writeSctpDescription=function(e,t){var r=[];return r="DTLS/SCTP"!==e.protocol?["m="+e.kind+" 9 "+e.protocol+" "+t.protocol+"\r\n","c=IN IP4 0.0.0.0\r\n","a=sctp-port:"+t.port+"\r\n"]:["m="+e.kind+" 9 "+e.protocol+" "+t.port+"\r\n","c=IN IP4 0.0.0.0\r\n","a=sctpmap:"+t.port+" "+t.protocol+" 65535\r\n"],void 0!==t.maxMessageSize&&r.push("a=max-message-size:"+t.maxMessageSize+"\r\n"),r.join("")},Pk.generateSessionId=function(){return Math.random().toString().substr(2,21)},Pk.writeSessionBoilerplate=function(e,t,r){var n=void 0!==t?t:2;return"v=0\r\no="+(r||"thisisadapterortc")+" "+(e||Pk.generateSessionId())+" "+n+" IN IP4 127.0.0.1\r\ns=-\r\nt=0 0\r\n"},Pk.getDirection=function(e,t){for(var r=Pk.splitLines(e),n=0;n<r.length;n++)switch(r[n]){case"a=sendrecv":case"a=sendonly":case"a=recvonly":case"a=inactive":return r[n].substr(2)}return t?Pk.getDirection(t):"sendrecv"},Pk.getKind=function(e){return Pk.splitLines(e)[0].split(" ")[0].substr(2)},Pk.isRejected=function(e){return"0"===e.split(" ",2)[1]},Pk.parseMLine=function(e){var t=Pk.splitLines(e)[0].substr(2).split(" ");return{kind:t[0],port:Qm(t[1],10),protocol:t[2],fmt:bm(t).call(t,3).join(" ")}},Pk.parseOLine=function(e){var t=Pk.matchPrefix(e,"o=")[0].substr(2).split(" ");return{username:t[0],sessionId:t[1],sessionVersion:Qm(t[2],10),netType:t[3],addressType:t[4],address:t[5]}},Pk.isValidSDP=function(e){if("string"!=typeof e||0===e.length)return!1;for(var t=Pk.splitLines(e),r=0;r<t.length;r++)if(t[r].length<2||"="!==t[r].charAt(1))return!1;return!0},Ok.exports=Pk;var Fk=Vk.exports,Bk=e({__proto__:null,default:Fk},[Vk.exports]);function jk(e){if(!(!e.RTCIceCandidate||e.RTCIceCandidate&&"foundation"in e.RTCIceCandidate.prototype)){var t=e.RTCIceCandidate;e.RTCIceCandidate=function(e){var r;if("object"===Ll(e)&&e.candidate&&0===gE(r=e.candidate).call(r,"a=")&&((e=JSON.parse(eT(e))).candidate=e.candidate.substr(2)),e.candidate&&e.candidate.length){var n=new t(e),i=Fk.parseCandidate(e.candidate),o=fb(n,i);return o.toJSON=function(){return{candidate:o.candidate,sdpMid:o.sdpMid,sdpMLineIndex:o.sdpMLineIndex,usernameFragment:o.usernameFragment}},o}return new t(e)},e.RTCIceCandidate.prototype=t.prototype,Hb(e,"icecandidate",(function(t){return t.candidate&&ad(t,"candidate",{value:new e.RTCIceCandidate(t.candidate),writable:"false"}),t}))}}function Gk(e){!e.RTCIceCandidate||e.RTCIceCandidate&&"relayProtocol"in e.RTCIceCandidate.prototype||Hb(e,"icecandidate",(function(e){if(e.candidate){var t=Fk.parseCandidate(e.candidate.candidate);"relay"===t.type&&(e.candidate.relayProtocol={0:"tls",1:"tcp",2:"udp"}[t.priority>>24])}return e}))}function Hk(e,t){if(e.RTCPeerConnection){"sctp"in e.RTCPeerConnection.prototype||ad(e.RTCPeerConnection.prototype,"sctp",{get:function(){return void 0===this._sctp?null:this._sctp}});var r=function(e){if(!e||!e.sdp)return!1;var t=Fk.splitSections(e.sdp);return t.shift(),t.some((function(e){var t,r=Fk.parseMLine(e);return r&&"application"===r.kind&&-1!==gE(t=r.protocol).call(t,"SCTP")}))},n=function(e){var t=e.sdp.match(/mozilla...THIS_IS_SDPARTA-(\d+)/);if(null===t||t.length<2)return-1;var r=Qm(t[1],10);return r!=r?-1:r},i=function(e){var r=65536;return"firefox"===t.browser&&(r=t.version<57?-1===e?16384:2147483637:t.version<60?57===t.version?65535:65536:2147483637),r},o=function(e,r){var n=65536;"firefox"===t.browser&&57===t.version&&(n=65535);var i=Fk.matchPrefix(e.sdp,"a=max-message-size:");return i.length>0?n=Qm(i[0].substr(19),10):"firefox"===t.browser&&-1!==r&&(n=2147483637),n},a=e.RTCPeerConnection.prototype.setRemoteDescription;e.RTCPeerConnection.prototype.setRemoteDescription=function(){if(this._sctp=null,"chrome"===t.browser&&t.version>=76){var e=this.getConfiguration(),s=e.sdpSemantics;"plan-b"===s&&ad(this,"sctp",{get:function(){return void 0===this._sctp?null:this._sctp},enumerable:!0,configurable:!0})}if(r(arguments[0])){var c,u=n(arguments[0]),d=i(u),l=o(arguments[0],u);c=0===d&&0===l?Number.POSITIVE_INFINITY:0===d||0===l?Math.max(d,l):Math.min(d,l);var h={};ad(h,"maxMessageSize",{get:function(){return c}}),this._sctp=h}return a.apply(this,arguments)}}}function zk(e){if(e.RTCPeerConnection&&"createDataChannel"in e.RTCPeerConnection.prototype){var t=e.RTCPeerConnection.prototype.createDataChannel;e.RTCPeerConnection.prototype.createDataChannel=function(){var e=t.apply(this,arguments);return r(e,this),e},Hb(e,"datachannel",(function(e){return r(e.channel,e.target),e}))}function r(e,t){var r=e.send;e.send=function(){var n=arguments[0],i=n.length||n.size||n.byteLength;if("open"===e.readyState&&t.sctp&&i>t.sctp.maxMessageSize)throw new TypeError("Message too large (can send a maximum of "+t.sctp.maxMessageSize+" bytes)");return r.apply(e,arguments)}}}function Kk(e){if(e.RTCPeerConnection&&!("connectionState"in e.RTCPeerConnection.prototype)){var t=e.RTCPeerConnection.prototype;ad(t,"connectionState",{get:function(){return{completed:"connected",checking:"connecting"}[this.iceConnectionState]||this.iceConnectionState},enumerable:!0,configurable:!0}),ad(t,"onconnectionstatechange",{get:function(){return this._onconnectionstatechange||null},set:function(e){this._onconnectionstatechange&&(this.removeEventListener("connectionstatechange",this._onconnectionstatechange),delete this._onconnectionstatechange),e&&this.addEventListener("connectionstatechange",this._onconnectionstatechange=e)},enumerable:!0,configurable:!0}),["setLocalDescription","setRemoteDescription"].forEach((function(e){var r=t[e];t[e]=function(){return this._connectionstatechangepoly||(this._connectionstatechangepoly=function(e){var t=e.target;if(t._lastConnectionState!==t.connectionState){t._lastConnectionState=t.connectionState;var r=new Event("connectionstatechange",e);t.dispatchEvent(r)}return e},this.addEventListener("iceconnectionstatechange",this._connectionstatechangepoly)),r.apply(this,arguments)}}))}}function Xk(e,t){if(e.RTCPeerConnection&&!("chrome"===t.browser&&t.version>=71||"safari"===t.browser&&t.version>=605)){var r=e.RTCPeerConnection.prototype.setRemoteDescription;e.RTCPeerConnection.prototype.setRemoteDescription=function(t){var n;if(t&&t.sdp&&-1!==gE(n=t.sdp).call(n,"\na=extmap-allow-mixed")){var i,o=Gs(i=t.sdp.split("\n")).call(i,(function(e){return"a=extmap-allow-mixed"!==Uk(e).call(e)})).join("\n");e.RTCSessionDescription&&t instanceof e.RTCSessionDescription?arguments[0]=new e.RTCSessionDescription({type:t.type,sdp:o}):t.sdp=o}return r.apply(this,arguments)}}}function Wk(e,t){if(e.RTCPeerConnection&&e.RTCPeerConnection.prototype){var r=e.RTCPeerConnection.prototype.addIceCandidate;r&&0!==r.length&&(e.RTCPeerConnection.prototype.addIceCandidate=function(){return arguments[0]?("chrome"===t.browser&&t.version<78||"firefox"===t.browser&&t.version<68||"safari"===t.browser)&&arguments[0]&&""===arguments[0].candidate?Wf.resolve():r.apply(this,arguments):(arguments[1]&&arguments[1].apply(null),Wf.resolve())})}}function qk(e,t){if(e.RTCPeerConnection&&e.RTCPeerConnection.prototype){var r=e.RTCPeerConnection.prototype.setLocalDescription;r&&0!==r.length&&(e.RTCPeerConnection.prototype.setLocalDescription=function(){var e=this,t=arguments[0]||{};if("object"!==Ll(t)||t.type&&t.sdp)return r.apply(this,arguments);if(!(t={type:t.type,sdp:t.sdp}).type)switch(this.signalingState){case"stable":case"have-local-offer":case"have-remote-pranswer":t.type="offer";break;default:t.type="answer"}if(t.sdp||"offer"!==t.type&&"answer"!==t.type)return r.apply(this,[t]);var n="offer"===t.type?this.createOffer:this.createAnswer;return n.apply(this).then((function(t){return r.apply(e,[t])}))})}}var Yk=Object.freeze(Object.defineProperty({__proto__:null,shimRTCIceCandidate:jk,shimRTCIceCandidateRelayProtocol:Gk,shimMaxMessageSize:Hk,shimSendThrowTypeError:zk,shimConnectionState:Kk,removeExtmapAllowMixed:Xk,shimAddIceCandidateNullOrEmpty:Wk,shimParameterlessSetLocalDescription:qk},Symbol.toStringTag,{value:"Module"}));function Jk(e,t){var r=void 0!==ml&&xT(e)||e["@@iterator"];if(!r){if(CT(e)||(r=WT(e))||t&&e&&"number"==typeof e.length){r&&(e=r);var n=0,i=function(){};return{s:i,n:function(){return n>=e.length?{done:!0}:{done:!1,value:e[n++]}},e:function(e){throw e},f:i}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var o,a=!0,s=!1;return{s:function(){r=r.call(e)},n:function(){var e=r.next();return a=e.done,e},e:function(e){s=!0,o=e},f:function(){try{a||null==r.return||r.return()}finally{if(s)throw o}}}}function Qk(e,t){return function(e){if(CT(e))return e}(e)||function(e,t){var r=null==e?null:void 0!==ml&&xT(e)||e["@@iterator"];if(null!=r){var n,i,o=[],a=!0,s=!1;try{for(r=r.call(e);!(a=(n=r.next()).done)&&(o.push(n.value),!t||o.length!==t);a=!0);}catch(c){s=!0,i=c}finally{try{a||null==r.return||r.return()}finally{if(s)throw i}}return o}}(e,t)||WT(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function Zk(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}!function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=e.window,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{shimChrome:!0,shimFirefox:!0,shimSafari:!0},n=Xb,i=qb(t),o={browserDetails:i,commonShim:Yk,extractVersion:Gb,disableLog:zb,disableWarnings:Kb,sdp:Bk};switch(i.browser){case"chrome":if(!AT||!IT||!r.shimChrome)return n("Chrome shim is not included in this adapter release."),o;if(null===i.version)return n("Chrome shim can not determine version, not shimming."),o;n("adapter.js shimming chrome."),o.browserShim=AT,Wk(t,i),qk(t),mT(t,i),gT(t),IT(t,i),yT(t),kT(t,i),ST(t),bT(t),ET(t),RT(t,i),jk(t),Gk(t),Kk(t),Hk(t,i),zk(t),Xk(t,i);break;case"firefox":if(!fk||!sk||!r.shimFirefox)return n("Firefox shim is not included in this adapter release."),o;n("adapter.js shimming firefox."),o.browserShim=fk,Wk(t,i),qk(t),ok(t,i),sk(t,i),ak(t),dk(t),ck(t),uk(t),lk(t),hk(t),pk(t),_k(t),vk(t),jk(t),Kk(t),Hk(t,i),zk(t);break;case"safari":if(!Rk||!r.shimSafari)return n("Safari shim is not included in this adapter release."),o;n("adapter.js shimming safari."),o.browserShim=Rk,Wk(t,i),qk(t),Ek(t),kk(t),yk(t),mk(t),gk(t),Tk(t),Sk(t),Ik(t),jk(t),Gk(t),Hk(t,i),zk(t),Xk(t,i);break;default:n("Unsupported browser!")}}({window:"undefined"==typeof window?void 0:window});var $k=Ye,eI=function(e){return void 0!==e&&($k(e,"value")||$k(e,"writable"))},tI=O,rI=$,nI=tr,iI=eI,oI=A,aI=mc;Ar({target:"Reflect",stat:!0},{get:function e(t,r){var n,i,o=arguments.length<3?t:arguments[2];return nI(t)===o?t[r]:(n=oI.f(t,r))?iI(n)?n.value:void 0===n.get?void 0:tI(n.get,o):rI(i=aI(t))?e(i,r,o):void 0}});var sI=ee.Reflect.get,cI=E,uI=we,dI=$,lI=Ye,hI=rs,pI=o,_I=Function,vI=cI([].concat),fI=cI([].join),mI={},gI=function(e,t,r){if(!lI(mI,t)){for(var n=[],i=0;i<t;i++)n[i]="a["+i+"]";mI[t]=_I("C,a","return new C("+fI(n,",")+")")}return mI[t](e,r)},yI=pI?_I.bind:function(e){var t=uI(this),r=t.prototype,n=hI(arguments,1),i=function(){var r=vI(n,hI(arguments));return this instanceof i?gI(t,r.length,r):t.apply(e,r)};return dI(r)&&(i.prototype=r),i},SI=yI;Ar({target:"Function",proto:!0,forced:Function.bind!==SI},{bind:SI});var bI=Us("Function").bind,EI=ae,TI=bI,kI=Function.prototype,II=function(e){var t=e.bind;return e===kI||EI(kI,e)&&t===kI.bind?TI:t};function RI(e){var t;return(RI=Hl?II(t=Gl).call(t):function(e){return e.__proto__||Gl(e)})(e)}function AI(e,t){for(;!Object.prototype.hasOwnProperty.call(e,t)&&null!==(e=RI(e)););return e}function CI(){var e;"undefined"!=typeof Reflect&&sI?CI=II(e=sI).call(e):CI=function(e,t,r){var n=AI(e,t);if(n){var i=tc(n,t);return i.get?i.get.call(arguments.length<3?e:r):i.value}};return CI.apply(this,arguments)}function wI(e,t){var r;return(wI=Hl?II(r=Hl).call(r):function(e,t){return e.__proto__=t,e})(e,t)}function xI(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Vl(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),ad(e,"prototype",{writable:!1}),t&&wI(e,t)}var OI=Ar,PI=d,DI=yI,MI=yp,NI=tr,LI=$,UI=Hn,VI=i,FI=oe("Reflect","construct"),BI=Object.prototype,jI=[].push,GI=VI((function(){function e(){}return!(FI((function(){}),[],e)instanceof e)})),HI=!VI((function(){FI((function(){}))})),zI=GI||HI;OI({target:"Reflect",stat:!0,forced:zI,sham:zI},{construct:function(e,t){MI(e),NI(t);var r=arguments.length<3?e:MI(arguments[2]);if(HI&&!GI)return FI(e,t,r);if(e==r){switch(t.length){case 0:return new e;case 1:return new e(t[0]);case 2:return new e(t[0],t[1]);case 3:return new e(t[0],t[1],t[2]);case 4:return new e(t[0],t[1],t[2],t[3])}var n=[null];return PI(jI,n,t),new(PI(DI,e,n))}var i=r.prototype,o=UI(LI(i)?i:BI),a=PI(e,o,t);return LI(a)?a:o}});var KI=ee.Reflect.construct;function XI(e,t){if(t&&("object"===Ll(t)||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return Zk(e)}function WI(e){var t=function(){if("undefined"==typeof Reflect||!KI)return!1;if(KI.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(KI(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var r,n=RI(e);if(t){var i=RI(this).constructor;r=KI(n,arguments,i)}else r=n.apply(this,arguments);return XI(this,r)}}var qI=Us("Array").values,YI=vn,JI=Ye,QI=ae,ZI=qI,$I=Array.prototype,eR={DOMTokenList:!0,NodeList:!0},tR=function(e){var t=e.values;return e===$I||QI($I,e)&&t===$I.values||JI(eR,YI(e))?ZI:t},rR=ni,nR=Math.floor,iR=function(e,t){var r=e.length,n=nR(r/2);return r<8?oR(e,t):aR(e,iR(rR(e,0,n),t),iR(rR(e,n),t),t)},oR=function(e,t){for(var r,n,i=e.length,o=1;o<i;){for(n=o,r=e[o];n&&t(e[n-1],r)>0;)e[n]=e[--n];n!==o++&&(e[n]=r)}return e},aR=function(e,t,r,n){for(var i=t.length,o=r.length,a=0,s=0;a<i||s<o;)e[a+s]=a<i&&s<o?n(t[a],r[s])<=0?t[a++]:r[s++]:a<i?t[a++]:r[s++];return e},sR=iR,cR=se.match(/firefox\/(\d+)/i),uR=!!cR&&+cR[1],dR=/MSIE|Trident/.test(se),lR=se.match(/AppleWebKit\/(\d+)\./),hR=!!lR&&+lR[1],pR=Ar,_R=E,vR=we,fR=Xe,mR=Br,gR=RE,yR=gn,SR=i,bR=sR,ER=Iu,TR=uR,kR=dR,IR=_e,RR=hR,AR=[],CR=_R(AR.sort),wR=_R(AR.push),xR=SR((function(){AR.sort(void 0)})),OR=SR((function(){AR.sort(null)})),PR=ER("sort"),DR=!SR((function(){if(IR)return IR<70;if(!(TR&&TR>3)){if(kR)return!0;if(RR)return RR<603;var e,t,r,n,i="";for(e=65;e<76;e++){switch(t=String.fromCharCode(e),e){case 66:case 69:case 70:case 72:r=3;break;case 68:case 71:r=4;break;default:r=2}for(n=0;n<47;n++)AR.push({k:t+n,v:r})}for(AR.sort((function(e,t){return t.v-e.v})),n=0;n<AR.length;n++)t=AR[n].k.charAt(0),i.charAt(i.length-1)!==t&&(i+=t);return"DGBEFHACIJK"!==i}}));pR({target:"Array",proto:!0,forced:xR||!OR||!PR||!DR},{sort:function(e){void 0!==e&&vR(e);var t=fR(this);if(DR)return void 0===e?CR(t):CR(t,e);var r,n,i=[],o=mR(t);for(n=0;n<o;n++)n in t&&wR(i,t[n]);for(bR(i,function(e){return function(t,r){return void 0===r?-1:void 0===t?1:void 0!==e?+e(t,r)||0:yR(t)>yR(r)?1:-1}}(e)),r=mR(i),n=0;n<r;)t[n]=i[n++];for(;n<o;)gR(t,n++);return t}});var MR=Us("Array").sort,NR=ae,LR=MR,UR=Array.prototype,VR=function(e){var t=e.sort;return e===UR||NR(UR,e)&&t===UR.sort?LR:t},FR=Ar,BR=Mo.findIndex,jR="findIndex",GR=!0;jR in[]&&Array(1).findIndex((function(){GR=!1})),FR({target:"Array",proto:!0,forced:GR},{findIndex:function(e){return BR(this,e,arguments.length>1?arguments[1]:void 0)}});var HR=Us("Array").findIndex,zR=ae,KR=HR,XR=Array.prototype,WR=function(e){var t=e.findIndex;return e===XR||zR(XR,e)&&t===XR.findIndex?KR:t},qR=Ar,YR=E;A.f;var JR=Vr,QR=gn,ZR=Eb,$R=W,eA=kb,tA=YR("".startsWith),rA=YR("".slice),nA=Math.min;qR({target:"String",proto:!0,forced:!eA("startsWith")},{startsWith:function(e){var t=QR($R(this));ZR(e);var r=JR(nA(arguments.length>1?arguments[1]:void 0,t.length)),n=QR(e);return tA?tA(t,n,r):rA(t,r,r+n.length)===n}});var iA=Us("String").startsWith,oA=ae,aA=iA,sA=String.prototype,cA=function(e){var t=e.startsWith;return"string"==typeof e||e===sA||oA(sA,e)&&t===sA.startsWith?aA:t},uA=function(e){return e.INVALID_ENGINE="INVALID_ENGINE",e.INVALID_PARAMS="INVALID_PARAMS",e.INVOKED_BEFORE_JOIN_ROOM="INVOKED_BEFORE_JOIN_ROOM",e.INVALID_TOKEN="INVALID_TOKEN",e.EXPIRED_TOKEN="EXPIRED_TOKEN",e.JOIN_ROOM_FAILED="JOIN_ROOM_FAILED",e.UPDATE_TOKEN_WITH_INVALID_TOKEN="UPDATE_TOKEN_WITH_INVALID_TOKEN",e.UPDATE_TOKEN_BEFORE_JOIN="UPDATE_TOKEN_BEFORE_JOIN",e.REPEAT_JOIN="REPEAT_JOIN",e.REPEAT_PUBLISH="REPEAT_PUBLISH",e.REPEAT_PUSH="REPEAT_PUSH",e.REPEAT_PLAY="REPEAT_PLAY",e.PUBLISH_BEFORE_JOIN="PUBLISH_BEFORE_JOIN",e.UNPUBLISH_BEFORE_JOIN="UNPUBLISH_BEFORE_JOIN",e.SUBSCRIBE_BEFORE_JOIN="SUBSCRIBE_BEFORE_JOIN",e.UNSUBSCRIBE_BEFORE_JOIN="UNSUBSCRIBE_BEFORE_JOIN",e.NO_PUBLISH_PERMISSION="NO_PUBLISH_PERMISSION",e.STREAM_NOT_EXIST="STREAM_NOT_EXIST",e.EMPTY_STREAM="EMPTY_STREAM",e.NOT_CONNECTED_YET="NOT_CONNECTED_YET",e.IM_BEFORE_JOIN="IM_BEFORE_JOIN",e.USER_NOT_EXIST="USER_NOT_EXIST",e.ALREADY_IN_ROOM="ALREADY_IN_ROOM",e.KICKED_OUT="KICKED_OUT",e.ROOM_DISMISS="ROOM_DISMISS",e.TOKEN_EXPIRED="TOKEN_EXPIRED",e.DUPLICATE_LOGIN="DUPLICATE_LOGIN",e.INVOKED_BEFORE_CAPTURE="INVOKED_BEFORE_CAPTURE",e.REPEAT_CAPTURE="REPEAT_CAPTURE",e.GET_VIDEO_TRACK_FAILED="GET_VIDEO_TRACK_FAILED",e.GET_AUDIO_TRACK_FAILED="GET_AUDIO_TRACK_FAILED",e.GET_SCREEN_TRACK_FAILED="GET_SCREEN_TRACK_FAILED",e.STREAM_TYPE_NOT_MATCH="STREAM_TYPE_NOT_MATCH",e.CANT_FIND_DOM="CANT_FIND_DOM",e.INVALID_DEVICE_ID="INVALID_DEVICE_ID",e.NO_PERMISSION="NO_PERMISSION",e.NOT_SUPPORTED="NOT_SUPPORTED",e.INTERRUPT="INTERRUPT",e.ICE_SERVER_WRONG="ICE_SERVER_WRONG",e.ESTABLISH_DATACHANNEL_FAILED="ESTABLISH_DATACHANNEL_FAILED",e.LOAD_RESOURCES_FAILED="LOAD_RESOURCES_FAILED",e.SIGNALING_CHANNEL_NOT_OPEN="SIGNALING_CHANNEL_NOT_OPEN",e.TIME_OUT="TIME_OUT",e.REFUSE_OPERATION_IN_DISCONNECT="REFUSE_OPERATION_IN_DISCONNECT",e.ADD_TRANSCEIVER_FAILED="ADD_TRANSCEIVER_FAILED",e.UPDATE_TRACK_FAILED="UPDATE_TRACK_FAILED",e.PUBLISH_FAILED="PUBLISH_FAILED",e.UNPUBLISH_FAILED="UNPUBLISH_FAILED",e.SUBSCRIBE_FAILED="SUBSCRIBE_FAILED",e.UNSUBSCRIBE_FAILED="UNSUBSCRIBE_FAILED",e.OPERATION_CANCEL="OPERATION_CANCEL",e.START_CLOUD_PROXY_AFTER_JOIN="START_CLOUD_PROXY_AFTER_JOIN",e.STOP_CLOUD_PROXY_BEFORE_LEAVE="STOP_CLOUD_PROXY_BEFORE_LEAVE",e.UNEXPECTED_ERROR="UNEXPECTED_ERROR",e.REPEAT_DEVICE_TEST="REPEAT_DEVICE_TEST",e.AUDIO_DEVICE_TEST_FAILED="AUDIO_DEVICE_RECORD_FAILED",e.ALREADY_LOGIN="ALREADY_LOGIN",e.LOGIN_FAILED="LOGIN_FAILED",e.NOT_LOGIN="NOT_LOGIN",e.RTM_DUPLICATE_LOGIN="RTM_DUPLICATE_LOGIN",e.RTM_TOKEN_ERROR="RTM_TOKEN_ERROR",e.USER_MESSAGE_TIMEOUT="USER_MESSAGE_TIMEOUT",e.USER_MESSAGE_BROKEN="USER_MESSAGE_BROKEN",e.USER_MESSAGE_NO_RECEIVER="USER_MESSAGE_NO_RECEIVER",e.USER_MESSAGE_NO_RELAYPATH="USER_MESSAGE_NO_RELAYPATH",e.USER_MESSAGE_EXCEED_QPS="USER_MESSAGE_EXCEED_QPS",e.USER_MESSAGE_SEND_TO_SERVER_ERROR="USER_MESSAGE_SEND_TO_SERVER_ERROR",e.USER_MESSAGE_SERVER_RESPONSE_ERROR="USER_MESSAGE_SERVER_RESPONSE_ERROR",e.USER_MESSAGE_NOT_JOIN="USER_MESSAGE_NOT_JOIN",e.USER_MESSAGE_INIT="USER_MESSAGE_INIT",e.USER_MESSAGE_NO_CONNECTION="USER_MESSAGE_NO_CONNECTION",e.USER_MESSAGE_NOT_LOGIN="USER_MESSAGE_NOT_LOGIN",e.USER_MESSAGE_SERVER_PARAMS_NOTSET="USER_MESSAGE_SERVER_PARAMS_NOTSET",e.USER_MESSAGE_UNKNOWN="USER_MESSAGE_UNKNOWN",e.START_PUBLIC_STREAM_BEFORE_JOIN="START_PUBLIC_STREAM_BEFORE_JOIN",e.RECONNECT_FAILED="RECONNECT_FAILED",e.SUBTITLE_ALREADY_ON="SUBTITLE_ALREADY_ON",e.SUBTITLE_NOT_TURNED_ON="SUBTITLE_NOT_TURNED_ON",e.SUBTITLE_ERR_POSTPROCESS="SUBTITLE_ERR_POSTPROCESS",e.SUBTITLE_ERR_CONNECTION_ERROR="SUBTITLE_ERR_CONNECTION_ERROR",e.SUBTITLE_ERR_PROCESS_ERROR="SUBTITLE_ERR_PROCESS_ERROR",e.SUBTITLE_ERR_UNKNOWN="SUBTITLE_ERR_UNKNOWN",e.UNEXPECTED_INVOKE_FORWARD_STREAM="UNEXPECTED_INVOKE_FORWARD_STREAM",e}(uA||{}),dA=function(e){return e[e.AUDIO_MIXING_ERROR_OK=0]="AUDIO_MIXING_ERROR_OK",e[e.AUDIO_MIXING_ERROR_PRELOAD_FAILED=1]="AUDIO_MIXING_ERROR_PRELOAD_FAILED",e[e.AUDIO_MIXING_ERROR_START_FAILED=2]="AUDIO_MIXING_ERROR_START_FAILED",e[e.AUDIO_MIXING_ERROR_ID_NOT_FOUND=3]="AUDIO_MIXING_ERROR_ID_NOT_FOUND",e[e.AUDIO_MIXING_ERROR_SET_POSITION_FAILED=4]="AUDIO_MIXING_ERROR_SET_POSITION_FAILED",e[e.AUDIO_MIXING_ERROR_INVALID_VOLUME=5]="AUDIO_MIXING_ERROR_INVALID_VOLUME",e[e.AUDIO_MIXING_ERROR_LOAD_CONFLICT=6]="AUDIO_MIXING_ERROR_LOAD_CONFLICT",e[e.AUDIO_MIXING_ERROR_ID_TYPE_NOT_MATCH=7]="AUDIO_MIXING_ERROR_ID_TYPE_NOT_MATCH",e[e.AUDIO_MIXING_ERROR_ID_TYPE_INVALID_PITCH=8]="AUDIO_MIXING_ERROR_ID_TYPE_INVALID_PITCH",e[e.AUDIO_MIXING_ERROR_INVALID_AUDIO_TRACK=9]="AUDIO_MIXING_ERROR_INVALID_AUDIO_TRACK",e}(dA||{}),lA=qd((function e(t,r,n){Yd(this,e),sd(this,"code",void 0),sd(this,"message",void 0),sd(this,"error",void 0),this.code=t,this.message=r,this.error=n})),hA=C,pA=E,_A=rn,vA=J,fA=pA(P.f),mA=pA([].push),gA=function(e){return function(t){for(var r,n=vA(t),i=_A(n),o=i.length,a=0,s=[];o>a;)r=i[a++],hA&&!fA(n,r)||mA(s,e?[r,n[r]]:n[r]);return s}},yA={entries:gA(!0),values:gA(!1)}.entries;Ar({target:"Object",stat:!0},{entries:function(e){return yA(e)}});var SA=ee.Object.entries,bA=Or,EA=gn,TA=W,kA=RangeError,IA=E,RA=Vr,AA=gn,CA=function(e){var t=EA(TA(this)),r="",n=bA(e);if(n<0||n==1/0)throw kA("Wrong number of repetitions");for(;n>0;(n>>>=1)&&(t+=t))1&n&&(r+=t);return r},wA=W,xA=IA(CA),OA=IA("".slice),PA=Math.ceil,DA=function(e){return function(t,r,n){var i,o,a=AA(wA(t)),s=RA(r),c=a.length,u=void 0===n?" ":AA(n);return s<=c||""==u?a:((o=xA(u,PA((i=s-c)/u.length))).length>i&&(o=OA(o,0,i)),e?a+o:o+a)}},MA={start:DA(!1),end:DA(!0)},NA=/Version\/10(?:\.\d+){1,2}(?: [\w./]+)?(?: Mobile\/\w+)? Safari\//.test(se),LA=MA.end;Ar({target:"String",proto:!0,forced:NA},{padEnd:function(e){return LA(this,e,arguments.length>1?arguments[1]:void 0)}});var UA=Us("String").padEnd,VA=ae,FA=UA,BA=String.prototype,jA=function(e){var t=e.padEnd;return"string"==typeof e||e===BA||VA(BA,e)&&t===BA.padEnd?FA:t},GA=Jm;Ar({target:"Number",stat:!0,forced:Number.parseInt!=GA},{parseInt:GA});var HA=ee.Number.parseInt,zA=Math.log,KA=Math.LOG10E;Ar({target:"Math",stat:!0},{log10:Math.log10||function(e){return zA(e)*KA}});var XA,WA=ee.Math.log10,qA=new Uint8Array(16);function YA(){if(!XA&&!(XA="undefined"!=typeof crypto&&crypto.getRandomValues&&crypto.getRandomValues.bind(crypto)||"undefined"!=typeof msCrypto&&"function"==typeof msCrypto.getRandomValues&&msCrypto.getRandomValues.bind(msCrypto)))throw new Error("crypto.getRandomValues() not supported. See https://github.com/uuidjs/uuid#getrandomvalues-not-supported");return XA(qA)}var JA=/^(?:[0-9a-f]{8}-[0-9a-f]{4}-[1-5][0-9a-f]{3}-[89ab][0-9a-f]{3}-[0-9a-f]{12}|00000000-0000-0000-0000-000000000000)$/i;function QA(e){return"string"==typeof e&&JA.test(e)}for(var ZA=[],$A=0;$A<256;++$A)ZA.push(($A+256).toString(16).substr(1));function eC(e,t,r){var n=(e=e||{}).random||(e.rng||YA)();if(n[6]=15&n[6]|64,n[8]=63&n[8]|128,t){r=r||0;for(var i=0;i<16;++i)t[r+i]=n[i];return t}return function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,r=(ZA[e[t+0]]+ZA[e[t+1]]+ZA[e[t+2]]+ZA[e[t+3]]+"-"+ZA[e[t+4]]+ZA[e[t+5]]+"-"+ZA[e[t+6]]+ZA[e[t+7]]+"-"+ZA[e[t+8]]+ZA[e[t+9]]+"-"+ZA[e[t+10]]+ZA[e[t+11]]+ZA[e[t+12]]+ZA[e[t+13]]+ZA[e[t+14]]+ZA[e[t+15]]).toLowerCase();if(!QA(r))throw TypeError("Stringified UUID is invalid");return r}(n)}var tC=function(){return"undefined"==typeof window},rC=function(){return eC()},nC=function(e){return"number"==typeof e},iC={};!function(e){var t="undefined"!=typeof Uint8Array&&"undefined"!=typeof Uint16Array&&"undefined"!=typeof Int32Array;function r(e,t){return Object.prototype.hasOwnProperty.call(e,t)}e.assign=function(e){for(var t=bm(Array.prototype).call(arguments,1);t.length;){var n=t.shift();if(n){if("object"!==Ll(n))throw new TypeError(n+"must be non-object");for(var i in n)r(n,i)&&(e[i]=n[i])}}return e},e.shrinkBuf=function(e,t){return e.length===t?e:e.subarray?e.subarray(0,t):(e.length=t,e)};var n={arraySet:function(e,t,r,n,i){if(t.subarray&&e.subarray)e.set(t.subarray(r,r+n),i);else for(var o=0;o<n;o++)e[i+o]=t[r+o]},flattenChunks:function(e){var t,r,n,i,o,a;for(n=0,t=0,r=e.length;t<r;t++)n+=e[t].length;for(a=new Uint8Array(n),i=0,t=0,r=e.length;t<r;t++)o=e[t],a.set(o,i),i+=o.length;return a}},i={arraySet:function(e,t,r,n,i){for(var o=0;o<n;o++)e[i+o]=t[r+o]},flattenChunks:function(e){return wm([]).apply([],e)}};e.setTyped=function(t){t?(e.Buf8=Uint8Array,e.Buf16=Uint16Array,e.Buf32=Int32Array,e.assign(e,n)):(e.Buf8=Array,e.Buf16=Array,e.Buf32=Array,e.assign(e,i))},e.setTyped(t)}(iC);var oC={},aC={},sC={},cC=iC;function uC(e){for(var t=e.length;--t>=0;)e[t]=0}var dC=256,lC=286,hC=30,pC=15,_C=[0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0],vC=[0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13],fC=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,2,3,7],mC=[16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15],gC=new Array(576);uC(gC);var yC=new Array(60);uC(yC);var SC=new Array(512);uC(SC);var bC=new Array(256);uC(bC);var EC=new Array(29);uC(EC);var TC,kC,IC,RC=new Array(hC);function AC(e,t,r,n,i){this.static_tree=e,this.extra_bits=t,this.extra_base=r,this.elems=n,this.max_length=i,this.has_stree=e&&e.length}function CC(e,t){this.dyn_tree=e,this.max_code=0,this.stat_desc=t}function wC(e){return e<256?SC[e]:SC[256+(e>>>7)]}function xC(e,t){e.pending_buf[e.pending++]=255&t,e.pending_buf[e.pending++]=t>>>8&255}function OC(e,t,r){e.bi_valid>16-r?(e.bi_buf|=t<<e.bi_valid&65535,xC(e,e.bi_buf),e.bi_buf=t>>16-e.bi_valid,e.bi_valid+=r-16):(e.bi_buf|=t<<e.bi_valid&65535,e.bi_valid+=r)}function PC(e,t,r){OC(e,r[2*t],r[2*t+1])}function DC(e,t){var r=0;do{r|=1&e,e>>>=1,r<<=1}while(--t>0);return r>>>1}function MC(e,t,r){var n,i,o=new Array(16),a=0;for(n=1;n<=pC;n++)o[n]=a=a+r[n-1]<<1;for(i=0;i<=t;i++){var s=e[2*i+1];0!==s&&(e[2*i]=DC(o[s]++,s))}}function NC(e){var t;for(t=0;t<lC;t++)e.dyn_ltree[2*t]=0;for(t=0;t<hC;t++)e.dyn_dtree[2*t]=0;for(t=0;t<19;t++)e.bl_tree[2*t]=0;e.dyn_ltree[512]=1,e.opt_len=e.static_len=0,e.last_lit=e.matches=0}function LC(e){e.bi_valid>8?xC(e,e.bi_buf):e.bi_valid>0&&(e.pending_buf[e.pending++]=e.bi_buf),e.bi_buf=0,e.bi_valid=0}function UC(e,t,r,n){var i=2*t,o=2*r;return e[i]<e[o]||e[i]===e[o]&&n[t]<=n[r]}function VC(e,t,r){for(var n=e.heap[r],i=r<<1;i<=e.heap_len&&(i<e.heap_len&&UC(t,e.heap[i+1],e.heap[i],e.depth)&&i++,!UC(t,n,e.heap[i],e.depth));)e.heap[r]=e.heap[i],r=i,i<<=1;e.heap[r]=n}function FC(e,t,r){var n,i,o,a,s=0;if(0!==e.last_lit)do{n=e.pending_buf[e.d_buf+2*s]<<8|e.pending_buf[e.d_buf+2*s+1],i=e.pending_buf[e.l_buf+s],s++,0===n?PC(e,i,t):(PC(e,(o=bC[i])+dC+1,t),0!==(a=_C[o])&&OC(e,i-=EC[o],a),PC(e,o=wC(--n),r),0!==(a=vC[o])&&OC(e,n-=RC[o],a))}while(s<e.last_lit);PC(e,256,t)}function BC(e,t){var r,n,i,o=t.dyn_tree,a=t.stat_desc.static_tree,s=t.stat_desc.has_stree,c=t.stat_desc.elems,u=-1;for(e.heap_len=0,e.heap_max=573,r=0;r<c;r++)0!==o[2*r]?(e.heap[++e.heap_len]=u=r,e.depth[r]=0):o[2*r+1]=0;for(;e.heap_len<2;)o[2*(i=e.heap[++e.heap_len]=u<2?++u:0)]=1,e.depth[i]=0,e.opt_len--,s&&(e.static_len-=a[2*i+1]);for(t.max_code=u,r=e.heap_len>>1;r>=1;r--)VC(e,o,r);i=c;do{r=e.heap[1],e.heap[1]=e.heap[e.heap_len--],VC(e,o,1),n=e.heap[1],e.heap[--e.heap_max]=r,e.heap[--e.heap_max]=n,o[2*i]=o[2*r]+o[2*n],e.depth[i]=(e.depth[r]>=e.depth[n]?e.depth[r]:e.depth[n])+1,o[2*r+1]=o[2*n+1]=i,e.heap[1]=i++,VC(e,o,1)}while(e.heap_len>=2);e.heap[--e.heap_max]=e.heap[1],function(e,t){var r,n,i,o,a,s,c=t.dyn_tree,u=t.max_code,d=t.stat_desc.static_tree,l=t.stat_desc.has_stree,h=t.stat_desc.extra_bits,p=t.stat_desc.extra_base,_=t.stat_desc.max_length,v=0;for(o=0;o<=pC;o++)e.bl_count[o]=0;for(c[2*e.heap[e.heap_max]+1]=0,r=e.heap_max+1;r<573;r++)(o=c[2*c[2*(n=e.heap[r])+1]+1]+1)>_&&(o=_,v++),c[2*n+1]=o,n>u||(e.bl_count[o]++,a=0,n>=p&&(a=h[n-p]),s=c[2*n],e.opt_len+=s*(o+a),l&&(e.static_len+=s*(d[2*n+1]+a)));if(0!==v){do{for(o=_-1;0===e.bl_count[o];)o--;e.bl_count[o]--,e.bl_count[o+1]+=2,e.bl_count[_]--,v-=2}while(v>0);for(o=_;0!==o;o--)for(n=e.bl_count[o];0!==n;)(i=e.heap[--r])>u||(c[2*i+1]!==o&&(e.opt_len+=(o-c[2*i+1])*c[2*i],c[2*i+1]=o),n--)}}(e,t),MC(o,u,e.bl_count)}function jC(e,t,r){var n,i,o=-1,a=t[1],s=0,c=7,u=4;for(0===a&&(c=138,u=3),t[2*(r+1)+1]=65535,n=0;n<=r;n++)i=a,a=t[2*(n+1)+1],++s<c&&i===a||(s<u?e.bl_tree[2*i]+=s:0!==i?(i!==o&&e.bl_tree[2*i]++,e.bl_tree[32]++):s<=10?e.bl_tree[34]++:e.bl_tree[36]++,s=0,o=i,0===a?(c=138,u=3):i===a?(c=6,u=3):(c=7,u=4))}function GC(e,t,r){var n,i,o=-1,a=t[1],s=0,c=7,u=4;for(0===a&&(c=138,u=3),n=0;n<=r;n++)if(i=a,a=t[2*(n+1)+1],!(++s<c&&i===a)){if(s<u)do{PC(e,i,e.bl_tree)}while(0!=--s);else 0!==i?(i!==o&&(PC(e,i,e.bl_tree),s--),PC(e,16,e.bl_tree),OC(e,s-3,2)):s<=10?(PC(e,17,e.bl_tree),OC(e,s-3,3)):(PC(e,18,e.bl_tree),OC(e,s-11,7));s=0,o=i,0===a?(c=138,u=3):i===a?(c=6,u=3):(c=7,u=4)}}uC(RC);var HC=!1;function zC(e,t,r,n){OC(e,0+(n?1:0),3),function(e,t,r,n){LC(e),n&&(xC(e,r),xC(e,~r)),cC.arraySet(e.pending_buf,e.window,t,r,e.pending),e.pending+=r}(e,t,r,!0)}sC._tr_init=function(e){HC||(!function(){var e,t,r,n,i,o=new Array(16);for(r=0,n=0;n<28;n++)for(EC[n]=r,e=0;e<1<<_C[n];e++)bC[r++]=n;for(bC[r-1]=n,i=0,n=0;n<16;n++)for(RC[n]=i,e=0;e<1<<vC[n];e++)SC[i++]=n;for(i>>=7;n<hC;n++)for(RC[n]=i<<7,e=0;e<1<<vC[n]-7;e++)SC[256+i++]=n;for(t=0;t<=pC;t++)o[t]=0;for(e=0;e<=143;)gC[2*e+1]=8,e++,o[8]++;for(;e<=255;)gC[2*e+1]=9,e++,o[9]++;for(;e<=279;)gC[2*e+1]=7,e++,o[7]++;for(;e<=287;)gC[2*e+1]=8,e++,o[8]++;for(MC(gC,287,o),e=0;e<hC;e++)yC[2*e+1]=5,yC[2*e]=DC(e,5);TC=new AC(gC,_C,257,lC,pC),kC=new AC(yC,vC,0,hC,pC),IC=new AC(new Array(0),fC,0,19,7)}(),HC=!0),e.l_desc=new CC(e.dyn_ltree,TC),e.d_desc=new CC(e.dyn_dtree,kC),e.bl_desc=new CC(e.bl_tree,IC),e.bi_buf=0,e.bi_valid=0,NC(e)},sC._tr_stored_block=zC,sC._tr_flush_block=function(e,t,r,n){var i,o,a=0;e.level>0?(2===e.strm.data_type&&(e.strm.data_type=function(e){var t,r=4093624447;for(t=0;t<=31;t++,r>>>=1)if(1&r&&0!==e.dyn_ltree[2*t])return 0;if(0!==e.dyn_ltree[18]||0!==e.dyn_ltree[20]||0!==e.dyn_ltree[26])return 1;for(t=32;t<dC;t++)if(0!==e.dyn_ltree[2*t])return 1;return 0}(e)),BC(e,e.l_desc),BC(e,e.d_desc),a=function(e){var t;for(jC(e,e.dyn_ltree,e.l_desc.max_code),jC(e,e.dyn_dtree,e.d_desc.max_code),BC(e,e.bl_desc),t=18;t>=3&&0===e.bl_tree[2*mC[t]+1];t--);return e.opt_len+=3*(t+1)+5+5+4,t}(e),i=e.opt_len+3+7>>>3,(o=e.static_len+3+7>>>3)<=i&&(i=o)):i=o=r+5,r+4<=i&&-1!==t?zC(e,t,r,n):4===e.strategy||o===i?(OC(e,2+(n?1:0),3),FC(e,gC,yC)):(OC(e,4+(n?1:0),3),function(e,t,r,n){var i;for(OC(e,t-257,5),OC(e,r-1,5),OC(e,n-4,4),i=0;i<n;i++)OC(e,e.bl_tree[2*mC[i]+1],3);GC(e,e.dyn_ltree,t-1),GC(e,e.dyn_dtree,r-1)}(e,e.l_desc.max_code+1,e.d_desc.max_code+1,a+1),FC(e,e.dyn_ltree,e.dyn_dtree)),NC(e),n&&LC(e)},sC._tr_tally=function(e,t,r){return e.pending_buf[e.d_buf+2*e.last_lit]=t>>>8&255,e.pending_buf[e.d_buf+2*e.last_lit+1]=255&t,e.pending_buf[e.l_buf+e.last_lit]=255&r,e.last_lit++,0===t?e.dyn_ltree[2*r]++:(e.matches++,t--,e.dyn_ltree[2*(bC[r]+dC+1)]++,e.dyn_dtree[2*wC(t)]++),e.last_lit===e.lit_bufsize-1},sC._tr_align=function(e){OC(e,2,3),PC(e,256,gC),function(e){16===e.bi_valid?(xC(e,e.bi_buf),e.bi_buf=0,e.bi_valid=0):e.bi_valid>=8&&(e.pending_buf[e.pending++]=255&e.bi_buf,e.bi_buf>>=8,e.bi_valid-=8)}(e)};var KC=function(e,t,r,n){for(var i=65535&e|0,o=e>>>16&65535|0,a=0;0!==r;){r-=a=r>2e3?2e3:r;do{o=o+(i=i+t[n++]|0)|0}while(--a);i%=65521,o%=65521}return i|o<<16|0};var XC=function(){for(var e,t=[],r=0;r<256;r++){e=r;for(var n=0;n<8;n++)e=1&e?3988292384^e>>>1:e>>>1;t[r]=e}return t}();var WC,qC=function(e,t,r,n){var i=XC,o=n+r;e^=-1;for(var a=n;a<o;a++)e=e>>>8^i[255&(e^t[a])];return-1^e},YC={2:"need dictionary",1:"stream end",0:"","-1":"file error","-2":"stream error","-3":"data error","-4":"insufficient memory","-5":"buffer error","-6":"incompatible version"},JC=iC,QC=sC,ZC=KC,$C=qC,ew=YC,tw=-2,rw=258,nw=262,iw=103,ow=113,aw=666;function sw(e,t){return e.msg=ew[t],t}function cw(e){return(e<<1)-(e>4?9:0)}function uw(e){for(var t=e.length;--t>=0;)e[t]=0}function dw(e){var t=e.state,r=t.pending;r>e.avail_out&&(r=e.avail_out),0!==r&&(JC.arraySet(e.output,t.pending_buf,t.pending_out,r,e.next_out),e.next_out+=r,t.pending_out+=r,e.total_out+=r,e.avail_out-=r,t.pending-=r,0===t.pending&&(t.pending_out=0))}function lw(e,t){QC._tr_flush_block(e,e.block_start>=0?e.block_start:-1,e.strstart-e.block_start,t),e.block_start=e.strstart,dw(e.strm)}function hw(e,t){e.pending_buf[e.pending++]=t}function pw(e,t){e.pending_buf[e.pending++]=t>>>8&255,e.pending_buf[e.pending++]=255&t}function _w(e,t){var r,n,i=e.max_chain_length,o=e.strstart,a=e.prev_length,s=e.nice_match,c=e.strstart>e.w_size-nw?e.strstart-(e.w_size-nw):0,u=e.window,d=e.w_mask,l=e.prev,h=e.strstart+rw,p=u[o+a-1],_=u[o+a];e.prev_length>=e.good_match&&(i>>=2),s>e.lookahead&&(s=e.lookahead);do{if(u[(r=t)+a]===_&&u[r+a-1]===p&&u[r]===u[o]&&u[++r]===u[o+1]){o+=2,r++;do{}while(u[++o]===u[++r]&&u[++o]===u[++r]&&u[++o]===u[++r]&&u[++o]===u[++r]&&u[++o]===u[++r]&&u[++o]===u[++r]&&u[++o]===u[++r]&&u[++o]===u[++r]&&o<h);if(n=rw-(h-o),o=h-rw,n>a){if(e.match_start=t,a=n,n>=s)break;p=u[o+a-1],_=u[o+a]}}}while((t=l[t&d])>c&&0!=--i);return a<=e.lookahead?a:e.lookahead}function vw(e){var t,r,n,i,o,a,s,c,u,d,l=e.w_size;do{if(i=e.window_size-e.lookahead-e.strstart,e.strstart>=l+(l-nw)){JC.arraySet(e.window,e.window,l,l,0),e.match_start-=l,e.strstart-=l,e.block_start-=l,t=r=e.hash_size;do{n=e.head[--t],e.head[t]=n>=l?n-l:0}while(--r);t=r=l;do{n=e.prev[--t],e.prev[t]=n>=l?n-l:0}while(--r);i+=l}if(0===e.strm.avail_in)break;if(a=e.strm,s=e.window,c=e.strstart+e.lookahead,u=i,d=void 0,(d=a.avail_in)>u&&(d=u),r=0===d?0:(a.avail_in-=d,JC.arraySet(s,a.input,a.next_in,d,c),1===a.state.wrap?a.adler=ZC(a.adler,s,d,c):2===a.state.wrap&&(a.adler=$C(a.adler,s,d,c)),a.next_in+=d,a.total_in+=d,d),e.lookahead+=r,e.lookahead+e.insert>=3)for(o=e.strstart-e.insert,e.ins_h=e.window[o],e.ins_h=(e.ins_h<<e.hash_shift^e.window[o+1])&e.hash_mask;e.insert&&(e.ins_h=(e.ins_h<<e.hash_shift^e.window[o+3-1])&e.hash_mask,e.prev[o&e.w_mask]=e.head[e.ins_h],e.head[e.ins_h]=o,o++,e.insert--,!(e.lookahead+e.insert<3)););}while(e.lookahead<nw&&0!==e.strm.avail_in)}function fw(e,t){for(var r,n;;){if(e.lookahead<nw){if(vw(e),e.lookahead<nw&&0===t)return 1;if(0===e.lookahead)break}if(r=0,e.lookahead>=3&&(e.ins_h=(e.ins_h<<e.hash_shift^e.window[e.strstart+3-1])&e.hash_mask,r=e.prev[e.strstart&e.w_mask]=e.head[e.ins_h],e.head[e.ins_h]=e.strstart),0!==r&&e.strstart-r<=e.w_size-nw&&(e.match_length=_w(e,r)),e.match_length>=3)if(n=QC._tr_tally(e,e.strstart-e.match_start,e.match_length-3),e.lookahead-=e.match_length,e.match_length<=e.max_lazy_match&&e.lookahead>=3){e.match_length--;do{e.strstart++,e.ins_h=(e.ins_h<<e.hash_shift^e.window[e.strstart+3-1])&e.hash_mask,r=e.prev[e.strstart&e.w_mask]=e.head[e.ins_h],e.head[e.ins_h]=e.strstart}while(0!=--e.match_length);e.strstart++}else e.strstart+=e.match_length,e.match_length=0,e.ins_h=e.window[e.strstart],e.ins_h=(e.ins_h<<e.hash_shift^e.window[e.strstart+1])&e.hash_mask;else n=QC._tr_tally(e,0,e.window[e.strstart]),e.lookahead--,e.strstart++;if(n&&(lw(e,!1),0===e.strm.avail_out))return 1}return e.insert=e.strstart<2?e.strstart:2,4===t?(lw(e,!0),0===e.strm.avail_out?3:4):e.last_lit&&(lw(e,!1),0===e.strm.avail_out)?1:2}function mw(e,t){for(var r,n,i;;){if(e.lookahead<nw){if(vw(e),e.lookahead<nw&&0===t)return 1;if(0===e.lookahead)break}if(r=0,e.lookahead>=3&&(e.ins_h=(e.ins_h<<e.hash_shift^e.window[e.strstart+3-1])&e.hash_mask,r=e.prev[e.strstart&e.w_mask]=e.head[e.ins_h],e.head[e.ins_h]=e.strstart),e.prev_length=e.match_length,e.prev_match=e.match_start,e.match_length=2,0!==r&&e.prev_length<e.max_lazy_match&&e.strstart-r<=e.w_size-nw&&(e.match_length=_w(e,r),e.match_length<=5&&(1===e.strategy||3===e.match_length&&e.strstart-e.match_start>4096)&&(e.match_length=2)),e.prev_length>=3&&e.match_length<=e.prev_length){i=e.strstart+e.lookahead-3,n=QC._tr_tally(e,e.strstart-1-e.prev_match,e.prev_length-3),e.lookahead-=e.prev_length-1,e.prev_length-=2;do{++e.strstart<=i&&(e.ins_h=(e.ins_h<<e.hash_shift^e.window[e.strstart+3-1])&e.hash_mask,r=e.prev[e.strstart&e.w_mask]=e.head[e.ins_h],e.head[e.ins_h]=e.strstart)}while(0!=--e.prev_length);if(e.match_available=0,e.match_length=2,e.strstart++,n&&(lw(e,!1),0===e.strm.avail_out))return 1}else if(e.match_available){if((n=QC._tr_tally(e,0,e.window[e.strstart-1]))&&lw(e,!1),e.strstart++,e.lookahead--,0===e.strm.avail_out)return 1}else e.match_available=1,e.strstart++,e.lookahead--}return e.match_available&&(n=QC._tr_tally(e,0,e.window[e.strstart-1]),e.match_available=0),e.insert=e.strstart<2?e.strstart:2,4===t?(lw(e,!0),0===e.strm.avail_out?3:4):e.last_lit&&(lw(e,!1),0===e.strm.avail_out)?1:2}function gw(e,t,r,n,i){this.good_length=e,this.max_lazy=t,this.nice_length=r,this.max_chain=n,this.func=i}function yw(){this.strm=null,this.status=0,this.pending_buf=null,this.pending_buf_size=0,this.pending_out=0,this.pending=0,this.wrap=0,this.gzhead=null,this.gzindex=0,this.method=8,this.last_flush=-1,this.w_size=0,this.w_bits=0,this.w_mask=0,this.window=null,this.window_size=0,this.prev=null,this.head=null,this.ins_h=0,this.hash_size=0,this.hash_bits=0,this.hash_mask=0,this.hash_shift=0,this.block_start=0,this.match_length=0,this.prev_match=0,this.match_available=0,this.strstart=0,this.match_start=0,this.lookahead=0,this.prev_length=0,this.max_chain_length=0,this.max_lazy_match=0,this.level=0,this.strategy=0,this.good_match=0,this.nice_match=0,this.dyn_ltree=new JC.Buf16(1146),this.dyn_dtree=new JC.Buf16(122),this.bl_tree=new JC.Buf16(78),uw(this.dyn_ltree),uw(this.dyn_dtree),uw(this.bl_tree),this.l_desc=null,this.d_desc=null,this.bl_desc=null,this.bl_count=new JC.Buf16(16),this.heap=new JC.Buf16(573),uw(this.heap),this.heap_len=0,this.heap_max=0,this.depth=new JC.Buf16(573),uw(this.depth),this.l_buf=0,this.lit_bufsize=0,this.last_lit=0,this.d_buf=0,this.opt_len=0,this.static_len=0,this.matches=0,this.insert=0,this.bi_buf=0,this.bi_valid=0}function Sw(e){var t;return e&&e.state?(e.total_in=e.total_out=0,e.data_type=2,(t=e.state).pending=0,t.pending_out=0,t.wrap<0&&(t.wrap=-t.wrap),t.status=t.wrap?42:ow,e.adler=2===t.wrap?0:1,t.last_flush=0,QC._tr_init(t),0):sw(e,tw)}function bw(e){var t,r=Sw(e);return 0===r&&((t=e.state).window_size=2*t.w_size,uw(t.head),t.max_lazy_match=WC[t.level].max_lazy,t.good_match=WC[t.level].good_length,t.nice_match=WC[t.level].nice_length,t.max_chain_length=WC[t.level].max_chain,t.strstart=0,t.block_start=0,t.lookahead=0,t.insert=0,t.match_length=t.prev_length=2,t.match_available=0,t.ins_h=0),r}function Ew(e,t,r,n,i,o){if(!e)return tw;var a=1;if(-1===t&&(t=6),n<0?(a=0,n=-n):n>15&&(a=2,n-=16),i<1||i>9||8!==r||n<8||n>15||t<0||t>9||o<0||o>4)return sw(e,tw);8===n&&(n=9);var s=new yw;return e.state=s,s.strm=e,s.wrap=a,s.gzhead=null,s.w_bits=n,s.w_size=1<<s.w_bits,s.w_mask=s.w_size-1,s.hash_bits=i+7,s.hash_size=1<<s.hash_bits,s.hash_mask=s.hash_size-1,s.hash_shift=~~((s.hash_bits+3-1)/3),s.window=new JC.Buf8(2*s.w_size),s.head=new JC.Buf16(s.hash_size),s.prev=new JC.Buf16(s.w_size),s.lit_bufsize=1<<i+6,s.pending_buf_size=4*s.lit_bufsize,s.pending_buf=new JC.Buf8(s.pending_buf_size),s.d_buf=1*s.lit_bufsize,s.l_buf=3*s.lit_bufsize,s.level=t,s.strategy=o,s.method=r,bw(e)}WC=[new gw(0,0,0,0,(function(e,t){var r=65535;for(r>e.pending_buf_size-5&&(r=e.pending_buf_size-5);;){if(e.lookahead<=1){if(vw(e),0===e.lookahead&&0===t)return 1;if(0===e.lookahead)break}e.strstart+=e.lookahead,e.lookahead=0;var n=e.block_start+r;if((0===e.strstart||e.strstart>=n)&&(e.lookahead=e.strstart-n,e.strstart=n,lw(e,!1),0===e.strm.avail_out))return 1;if(e.strstart-e.block_start>=e.w_size-nw&&(lw(e,!1),0===e.strm.avail_out))return 1}return e.insert=0,4===t?(lw(e,!0),0===e.strm.avail_out?3:4):(e.strstart>e.block_start&&(lw(e,!1),e.strm.avail_out),1)})),new gw(4,4,8,4,fw),new gw(4,5,16,8,fw),new gw(4,6,32,32,fw),new gw(4,4,16,16,mw),new gw(8,16,32,32,mw),new gw(8,16,128,128,mw),new gw(8,32,128,256,mw),new gw(32,128,258,1024,mw),new gw(32,258,258,4096,mw)],aC.deflateInit=function(e,t){return Ew(e,t,8,15,8,0)},aC.deflateInit2=Ew,aC.deflateReset=bw,aC.deflateResetKeep=Sw,aC.deflateSetHeader=function(e,t){return e&&e.state?2!==e.state.wrap?tw:(e.state.gzhead=t,0):tw},aC.deflate=function(e,t){var r,n,i,o;if(!e||!e.state||t>5||t<0)return e?sw(e,tw):tw;if(n=e.state,!e.output||!e.input&&0!==e.avail_in||n.status===aw&&4!==t)return sw(e,0===e.avail_out?-5:tw);if(n.strm=e,r=n.last_flush,n.last_flush=t,42===n.status)if(2===n.wrap)e.adler=0,hw(n,31),hw(n,139),hw(n,8),n.gzhead?(hw(n,(n.gzhead.text?1:0)+(n.gzhead.hcrc?2:0)+(n.gzhead.extra?4:0)+(n.gzhead.name?8:0)+(n.gzhead.comment?16:0)),hw(n,255&n.gzhead.time),hw(n,n.gzhead.time>>8&255),hw(n,n.gzhead.time>>16&255),hw(n,n.gzhead.time>>24&255),hw(n,9===n.level?2:n.strategy>=2||n.level<2?4:0),hw(n,255&n.gzhead.os),n.gzhead.extra&&n.gzhead.extra.length&&(hw(n,255&n.gzhead.extra.length),hw(n,n.gzhead.extra.length>>8&255)),n.gzhead.hcrc&&(e.adler=$C(e.adler,n.pending_buf,n.pending,0)),n.gzindex=0,n.status=69):(hw(n,0),hw(n,0),hw(n,0),hw(n,0),hw(n,0),hw(n,9===n.level?2:n.strategy>=2||n.level<2?4:0),hw(n,3),n.status=ow);else{var a=8+(n.w_bits-8<<4)<<8;a|=(n.strategy>=2||n.level<2?0:n.level<6?1:6===n.level?2:3)<<6,0!==n.strstart&&(a|=32),a+=31-a%31,n.status=ow,pw(n,a),0!==n.strstart&&(pw(n,e.adler>>>16),pw(n,65535&e.adler)),e.adler=1}if(69===n.status)if(n.gzhead.extra){for(i=n.pending;n.gzindex<(65535&n.gzhead.extra.length)&&(n.pending!==n.pending_buf_size||(n.gzhead.hcrc&&n.pending>i&&(e.adler=$C(e.adler,n.pending_buf,n.pending-i,i)),dw(e),i=n.pending,n.pending!==n.pending_buf_size));)hw(n,255&n.gzhead.extra[n.gzindex]),n.gzindex++;n.gzhead.hcrc&&n.pending>i&&(e.adler=$C(e.adler,n.pending_buf,n.pending-i,i)),n.gzindex===n.gzhead.extra.length&&(n.gzindex=0,n.status=73)}else n.status=73;if(73===n.status)if(n.gzhead.name){i=n.pending;do{if(n.pending===n.pending_buf_size&&(n.gzhead.hcrc&&n.pending>i&&(e.adler=$C(e.adler,n.pending_buf,n.pending-i,i)),dw(e),i=n.pending,n.pending===n.pending_buf_size)){o=1;break}o=n.gzindex<n.gzhead.name.length?255&n.gzhead.name.charCodeAt(n.gzindex++):0,hw(n,o)}while(0!==o);n.gzhead.hcrc&&n.pending>i&&(e.adler=$C(e.adler,n.pending_buf,n.pending-i,i)),0===o&&(n.gzindex=0,n.status=91)}else n.status=91;if(91===n.status)if(n.gzhead.comment){i=n.pending;do{if(n.pending===n.pending_buf_size&&(n.gzhead.hcrc&&n.pending>i&&(e.adler=$C(e.adler,n.pending_buf,n.pending-i,i)),dw(e),i=n.pending,n.pending===n.pending_buf_size)){o=1;break}o=n.gzindex<n.gzhead.comment.length?255&n.gzhead.comment.charCodeAt(n.gzindex++):0,hw(n,o)}while(0!==o);n.gzhead.hcrc&&n.pending>i&&(e.adler=$C(e.adler,n.pending_buf,n.pending-i,i)),0===o&&(n.status=iw)}else n.status=iw;if(n.status===iw&&(n.gzhead.hcrc?(n.pending+2>n.pending_buf_size&&dw(e),n.pending+2<=n.pending_buf_size&&(hw(n,255&e.adler),hw(n,e.adler>>8&255),e.adler=0,n.status=ow)):n.status=ow),0!==n.pending){if(dw(e),0===e.avail_out)return n.last_flush=-1,0}else if(0===e.avail_in&&cw(t)<=cw(r)&&4!==t)return sw(e,-5);if(n.status===aw&&0!==e.avail_in)return sw(e,-5);if(0!==e.avail_in||0!==n.lookahead||0!==t&&n.status!==aw){var s=2===n.strategy?function(e,t){for(var r;;){if(0===e.lookahead&&(vw(e),0===e.lookahead)){if(0===t)return 1;break}if(e.match_length=0,r=QC._tr_tally(e,0,e.window[e.strstart]),e.lookahead--,e.strstart++,r&&(lw(e,!1),0===e.strm.avail_out))return 1}return e.insert=0,4===t?(lw(e,!0),0===e.strm.avail_out?3:4):e.last_lit&&(lw(e,!1),0===e.strm.avail_out)?1:2}(n,t):3===n.strategy?function(e,t){for(var r,n,i,o,a=e.window;;){if(e.lookahead<=rw){if(vw(e),e.lookahead<=rw&&0===t)return 1;if(0===e.lookahead)break}if(e.match_length=0,e.lookahead>=3&&e.strstart>0&&(n=a[i=e.strstart-1])===a[++i]&&n===a[++i]&&n===a[++i]){o=e.strstart+rw;do{}while(n===a[++i]&&n===a[++i]&&n===a[++i]&&n===a[++i]&&n===a[++i]&&n===a[++i]&&n===a[++i]&&n===a[++i]&&i<o);e.match_length=rw-(o-i),e.match_length>e.lookahead&&(e.match_length=e.lookahead)}if(e.match_length>=3?(r=QC._tr_tally(e,1,e.match_length-3),e.lookahead-=e.match_length,e.strstart+=e.match_length,e.match_length=0):(r=QC._tr_tally(e,0,e.window[e.strstart]),e.lookahead--,e.strstart++),r&&(lw(e,!1),0===e.strm.avail_out))return 1}return e.insert=0,4===t?(lw(e,!0),0===e.strm.avail_out?3:4):e.last_lit&&(lw(e,!1),0===e.strm.avail_out)?1:2}(n,t):WC[n.level].func(n,t);if(3!==s&&4!==s||(n.status=aw),1===s||3===s)return 0===e.avail_out&&(n.last_flush=-1),0;if(2===s&&(1===t?QC._tr_align(n):5!==t&&(QC._tr_stored_block(n,0,0,!1),3===t&&(uw(n.head),0===n.lookahead&&(n.strstart=0,n.block_start=0,n.insert=0))),dw(e),0===e.avail_out))return n.last_flush=-1,0}return 4!==t?0:n.wrap<=0?1:(2===n.wrap?(hw(n,255&e.adler),hw(n,e.adler>>8&255),hw(n,e.adler>>16&255),hw(n,e.adler>>24&255),hw(n,255&e.total_in),hw(n,e.total_in>>8&255),hw(n,e.total_in>>16&255),hw(n,e.total_in>>24&255)):(pw(n,e.adler>>>16),pw(n,65535&e.adler)),dw(e),n.wrap>0&&(n.wrap=-n.wrap),0!==n.pending?0:1)},aC.deflateEnd=function(e){var t;return e&&e.state?42!==(t=e.state.status)&&69!==t&&73!==t&&91!==t&&t!==iw&&t!==ow&&t!==aw?sw(e,tw):(e.state=null,t===ow?sw(e,-3):0):tw},aC.deflateSetDictionary=function(e,t){var r,n,i,o,a,s,c,u,d=t.length;if(!e||!e.state)return tw;if(2===(o=(r=e.state).wrap)||1===o&&42!==r.status||r.lookahead)return tw;for(1===o&&(e.adler=ZC(e.adler,t,d,0)),r.wrap=0,d>=r.w_size&&(0===o&&(uw(r.head),r.strstart=0,r.block_start=0,r.insert=0),u=new JC.Buf8(r.w_size),JC.arraySet(u,t,d-r.w_size,r.w_size,0),t=u,d=r.w_size),a=e.avail_in,s=e.next_in,c=e.input,e.avail_in=d,e.next_in=0,e.input=t,vw(r);r.lookahead>=3;){n=r.strstart,i=r.lookahead-2;do{r.ins_h=(r.ins_h<<r.hash_shift^r.window[n+3-1])&r.hash_mask,r.prev[n&r.w_mask]=r.head[r.ins_h],r.head[r.ins_h]=n,n++}while(--i);r.strstart=n,r.lookahead=2,vw(r)}return r.strstart+=r.lookahead,r.block_start=r.strstart,r.insert=r.lookahead,r.lookahead=0,r.match_length=r.prev_length=2,r.match_available=0,e.next_in=s,e.input=c,e.avail_in=a,r.wrap=o,0},aC.deflateInfo="pako deflate (from Nodeca project)";var Tw={},kw=iC,Iw=!0,Rw=!0;try{String.fromCharCode.apply(null,[0])}catch(zX){Iw=!1}try{String.fromCharCode.apply(null,new Uint8Array(1))}catch(zX){Rw=!1}for(var Aw=new kw.Buf8(256),Cw=0;Cw<256;Cw++)Aw[Cw]=Cw>=252?6:Cw>=248?5:Cw>=240?4:Cw>=224?3:Cw>=192?2:1;function ww(e,t){if(t<65534&&(e.subarray&&Rw||!e.subarray&&Iw))return String.fromCharCode.apply(null,kw.shrinkBuf(e,t));for(var r="",n=0;n<t;n++)r+=String.fromCharCode(e[n]);return r}Aw[254]=Aw[254]=1,Tw.string2buf=function(e){var t,r,n,i,o,a=e.length,s=0;for(i=0;i<a;i++)55296==(64512&(r=e.charCodeAt(i)))&&i+1<a&&56320==(64512&(n=e.charCodeAt(i+1)))&&(r=65536+(r-55296<<10)+(n-56320),i++),s+=r<128?1:r<2048?2:r<65536?3:4;for(t=new kw.Buf8(s),o=0,i=0;o<s;i++)55296==(64512&(r=e.charCodeAt(i)))&&i+1<a&&56320==(64512&(n=e.charCodeAt(i+1)))&&(r=65536+(r-55296<<10)+(n-56320),i++),r<128?t[o++]=r:r<2048?(t[o++]=192|r>>>6,t[o++]=128|63&r):r<65536?(t[o++]=224|r>>>12,t[o++]=128|r>>>6&63,t[o++]=128|63&r):(t[o++]=240|r>>>18,t[o++]=128|r>>>12&63,t[o++]=128|r>>>6&63,t[o++]=128|63&r);return t},Tw.buf2binstring=function(e){return ww(e,e.length)},Tw.binstring2buf=function(e){for(var t=new kw.Buf8(e.length),r=0,n=t.length;r<n;r++)t[r]=e.charCodeAt(r);return t},Tw.buf2string=function(e,t){var r,n,i,o,a=t||e.length,s=new Array(2*a);for(n=0,r=0;r<a;)if((i=e[r++])<128)s[n++]=i;else if((o=Aw[i])>4)s[n++]=65533,r+=o-1;else{for(i&=2===o?31:3===o?15:7;o>1&&r<a;)i=i<<6|63&e[r++],o--;o>1?s[n++]=65533:i<65536?s[n++]=i:(i-=65536,s[n++]=55296|i>>10&1023,s[n++]=56320|1023&i)}return ww(s,n)},Tw.utf8border=function(e,t){var r;for((t=t||e.length)>e.length&&(t=e.length),r=t-1;r>=0&&128==(192&e[r]);)r--;return r<0||0===r?t:r+Aw[e[r]]>t?r:t};var xw=function(){this.input=null,this.next_in=0,this.avail_in=0,this.total_in=0,this.output=null,this.next_out=0,this.avail_out=0,this.total_out=0,this.msg="",this.state=null,this.data_type=2,this.adler=0},Ow=aC,Pw=iC,Dw=Tw,Mw=YC,Nw=xw,Lw=Object.prototype.toString;function Uw(e){if(!(this instanceof Uw))return new Uw(e);this.options=Pw.assign({level:-1,method:8,chunkSize:16384,windowBits:15,memLevel:8,strategy:0,to:""},e||{});var t=this.options;t.raw&&t.windowBits>0?t.windowBits=-t.windowBits:t.gzip&&t.windowBits>0&&t.windowBits<16&&(t.windowBits+=16),this.err=0,this.msg="",this.ended=!1,this.chunks=[],this.strm=new Nw,this.strm.avail_out=0;var r=Ow.deflateInit2(this.strm,t.level,t.method,t.windowBits,t.memLevel,t.strategy);if(0!==r)throw new Error(Mw[r]);if(t.header&&Ow.deflateSetHeader(this.strm,t.header),t.dictionary){var n;if(n="string"==typeof t.dictionary?Dw.string2buf(t.dictionary):"[object ArrayBuffer]"===Lw.call(t.dictionary)?new Uint8Array(t.dictionary):t.dictionary,0!==(r=Ow.deflateSetDictionary(this.strm,n)))throw new Error(Mw[r]);this._dict_set=!0}}function Vw(e,t){var r=new Uw(t);if(r.push(e,!0),r.err)throw r.msg||Mw[r.err];return r.result}Uw.prototype.push=function(e,t){var r,n,i=this.strm,o=this.options.chunkSize;if(this.ended)return!1;n=t===~~t?t:!0===t?4:0,"string"==typeof e?i.input=Dw.string2buf(e):"[object ArrayBuffer]"===Lw.call(e)?i.input=new Uint8Array(e):i.input=e,i.next_in=0,i.avail_in=i.input.length;do{if(0===i.avail_out&&(i.output=new Pw.Buf8(o),i.next_out=0,i.avail_out=o),1!==(r=Ow.deflate(i,n))&&0!==r)return this.onEnd(r),this.ended=!0,!1;0!==i.avail_out&&(0!==i.avail_in||4!==n&&2!==n)||("string"===this.options.to?this.onData(Dw.buf2binstring(Pw.shrinkBuf(i.output,i.next_out))):this.onData(Pw.shrinkBuf(i.output,i.next_out)))}while((i.avail_in>0||0===i.avail_out)&&1!==r);return 4===n?(r=Ow.deflateEnd(this.strm),this.onEnd(r),this.ended=!0,0===r):2!==n||(this.onEnd(0),i.avail_out=0,!0)},Uw.prototype.onData=function(e){this.chunks.push(e)},Uw.prototype.onEnd=function(e){0===e&&("string"===this.options.to?this.result=this.chunks.join(""):this.result=Pw.flattenChunks(this.chunks)),this.chunks=[],this.err=e,this.msg=this.strm.msg},oC.Deflate=Uw,oC.deflate=Vw,oC.deflateRaw=function(e,t){return(t=t||{}).raw=!0,Vw(e,t)},oC.gzip=function(e,t){return(t=t||{}).gzip=!0,Vw(e,t)};var Fw={},Bw=tr,jw=O,Gw=Ye,Hw=ae,zw=function(){var e=Bw(this),t="";return e.hasIndices&&(t+="d"),e.global&&(t+="g"),e.ignoreCase&&(t+="i"),e.multiline&&(t+="m"),e.dotAll&&(t+="s"),e.unicode&&(t+="u"),e.unicodeSets&&(t+="v"),e.sticky&&(t+="y"),t},Kw=RegExp.prototype,Xw=ae,Ww=function(e){var t=e.flags;return void 0!==t||"flags"in Kw||Gw(e,"flags")||!Hw(Kw,e)?t:jw(zw,e)},qw=RegExp.prototype,Yw=function(e){return e===qw||Xw(qw,e)?Ww(e):e.flags},Jw={},Qw=iC,Zw=15,$w=[3,4,5,6,7,8,9,10,11,13,15,17,19,23,27,31,35,43,51,59,67,83,99,115,131,163,195,227,258,0,0],ex=[16,16,16,16,16,16,16,16,17,17,17,17,18,18,18,18,19,19,19,19,20,20,20,20,21,21,21,21,16,72,78],tx=[1,2,3,4,5,7,9,13,17,25,33,49,65,97,129,193,257,385,513,769,1025,1537,2049,3073,4097,6145,8193,12289,16385,24577,0,0],rx=[16,16,16,16,17,17,18,18,19,19,20,20,21,21,22,22,23,23,24,24,25,25,26,26,27,27,28,28,29,29,64,64],nx=iC,ix=KC,ox=qC,ax=function(e,t){var r,n,i,o,a,s,c,u,d,l,h,p,_,v,f,m,g,y,S,b,E,T,k,I,R;r=e.state,n=e.next_in,I=e.input,i=n+(e.avail_in-5),o=e.next_out,R=e.output,a=o-(t-e.avail_out),s=o+(e.avail_out-257),c=r.dmax,u=r.wsize,d=r.whave,l=r.wnext,h=r.window,p=r.hold,_=r.bits,v=r.lencode,f=r.distcode,m=(1<<r.lenbits)-1,g=(1<<r.distbits)-1;e:do{_<15&&(p+=I[n++]<<_,_+=8,p+=I[n++]<<_,_+=8),y=v[p&m];t:for(;;){if(p>>>=S=y>>>24,_-=S,0===(S=y>>>16&255))R[o++]=65535&y;else{if(!(16&S)){if(0==(64&S)){y=v[(65535&y)+(p&(1<<S)-1)];continue t}if(32&S){r.mode=12;break e}e.msg="invalid literal/length code",r.mode=30;break e}b=65535&y,(S&=15)&&(_<S&&(p+=I[n++]<<_,_+=8),b+=p&(1<<S)-1,p>>>=S,_-=S),_<15&&(p+=I[n++]<<_,_+=8,p+=I[n++]<<_,_+=8),y=f[p&g];r:for(;;){if(p>>>=S=y>>>24,_-=S,!(16&(S=y>>>16&255))){if(0==(64&S)){y=f[(65535&y)+(p&(1<<S)-1)];continue r}e.msg="invalid distance code",r.mode=30;break e}if(E=65535&y,_<(S&=15)&&(p+=I[n++]<<_,(_+=8)<S&&(p+=I[n++]<<_,_+=8)),(E+=p&(1<<S)-1)>c){e.msg="invalid distance too far back",r.mode=30;break e}if(p>>>=S,_-=S,E>(S=o-a)){if((S=E-S)>d&&r.sane){e.msg="invalid distance too far back",r.mode=30;break e}if(T=0,k=h,0===l){if(T+=u-S,S<b){b-=S;do{R[o++]=h[T++]}while(--S);T=o-E,k=R}}else if(l<S){if(T+=u+l-S,(S-=l)<b){b-=S;do{R[o++]=h[T++]}while(--S);if(T=0,l<b){b-=S=l;do{R[o++]=h[T++]}while(--S);T=o-E,k=R}}}else if(T+=l-S,S<b){b-=S;do{R[o++]=h[T++]}while(--S);T=o-E,k=R}for(;b>2;)R[o++]=k[T++],R[o++]=k[T++],R[o++]=k[T++],b-=3;b&&(R[o++]=k[T++],b>1&&(R[o++]=k[T++]))}else{T=o-E;do{R[o++]=R[T++],R[o++]=R[T++],R[o++]=R[T++],b-=3}while(b>2);b&&(R[o++]=R[T++],b>1&&(R[o++]=R[T++]))}break}}break}}while(n<i&&o<s);n-=b=_>>3,p&=(1<<(_-=b<<3))-1,e.next_in=n,e.next_out=o,e.avail_in=n<i?i-n+5:5-(n-i),e.avail_out=o<s?s-o+257:257-(o-s),r.hold=p,r.bits=_},sx=function(e,t,r,n,i,o,a,s){var c,u,d,l,h,p,_,v,f,m=s.bits,g=0,y=0,S=0,b=0,E=0,T=0,k=0,I=0,R=0,A=0,C=null,w=0,x=new Qw.Buf16(16),O=new Qw.Buf16(16),P=null,D=0;for(g=0;g<=Zw;g++)x[g]=0;for(y=0;y<n;y++)x[t[r+y]]++;for(E=m,b=Zw;b>=1&&0===x[b];b--);if(E>b&&(E=b),0===b)return i[o++]=20971520,i[o++]=20971520,s.bits=1,0;for(S=1;S<b&&0===x[S];S++);for(E<S&&(E=S),I=1,g=1;g<=Zw;g++)if(I<<=1,(I-=x[g])<0)return-1;if(I>0&&(0===e||1!==b))return-1;for(O[1]=0,g=1;g<Zw;g++)O[g+1]=O[g]+x[g];for(y=0;y<n;y++)0!==t[r+y]&&(a[O[t[r+y]]++]=y);if(0===e?(C=P=a,p=19):1===e?(C=$w,w-=257,P=ex,D-=257,p=256):(C=tx,P=rx,p=-1),A=0,y=0,g=S,h=o,T=E,k=0,d=-1,l=(R=1<<E)-1,1===e&&R>852||2===e&&R>592)return 1;for(;;){_=g-k,a[y]<p?(v=0,f=a[y]):a[y]>p?(v=P[D+a[y]],f=C[w+a[y]]):(v=96,f=0),c=1<<g-k,S=u=1<<T;do{i[h+(A>>k)+(u-=c)]=_<<24|v<<16|f|0}while(0!==u);for(c=1<<g-1;A&c;)c>>=1;if(0!==c?(A&=c-1,A+=c):A=0,y++,0==--x[g]){if(g===b)break;g=t[r+a[y]]}if(g>E&&(A&l)!==d){for(0===k&&(k=E),h+=S,I=1<<(T=g-k);T+k<b&&!((I-=x[T+k])<=0);)T++,I<<=1;if(R+=1<<T,1===e&&R>852||2===e&&R>592)return 1;i[d=A&l]=E<<24|T<<16|h-o|0}}return 0!==A&&(i[h+A]=g-k<<24|64<<16|0),s.bits=E,0},cx=-2,ux=12,dx=30;function lx(e){return(e>>>24&255)+(e>>>8&65280)+((65280&e)<<8)+((255&e)<<24)}function hx(){this.mode=0,this.last=!1,this.wrap=0,this.havedict=!1,this.flags=0,this.dmax=0,this.check=0,this.total=0,this.head=null,this.wbits=0,this.wsize=0,this.whave=0,this.wnext=0,this.window=null,this.hold=0,this.bits=0,this.length=0,this.offset=0,this.extra=0,this.lencode=null,this.distcode=null,this.lenbits=0,this.distbits=0,this.ncode=0,this.nlen=0,this.ndist=0,this.have=0,this.next=null,this.lens=new nx.Buf16(320),this.work=new nx.Buf16(288),this.lendyn=null,this.distdyn=null,this.sane=0,this.back=0,this.was=0}function px(e){var t;return e&&e.state?(t=e.state,e.total_in=e.total_out=t.total=0,e.msg="",t.wrap&&(e.adler=1&t.wrap),t.mode=1,t.last=0,t.havedict=0,t.dmax=32768,t.head=null,t.hold=0,t.bits=0,t.lencode=t.lendyn=new nx.Buf32(852),t.distcode=t.distdyn=new nx.Buf32(592),t.sane=1,t.back=-1,0):cx}function _x(e){var t;return e&&e.state?((t=e.state).wsize=0,t.whave=0,t.wnext=0,px(e)):cx}function vx(e,t){var r,n;return e&&e.state?(n=e.state,t<0?(r=0,t=-t):(r=1+(t>>4),t<48&&(t&=15)),t&&(t<8||t>15)?cx:(null!==n.window&&n.wbits!==t&&(n.window=null),n.wrap=r,n.wbits=t,_x(e))):cx}function fx(e,t){var r,n;return e?(n=new hx,e.state=n,n.window=null,0!==(r=vx(e,t))&&(e.state=null),r):cx}var mx,gx,yx=!0;function Sx(e){if(yx){var t;for(mx=new nx.Buf32(512),gx=new nx.Buf32(32),t=0;t<144;)e.lens[t++]=8;for(;t<256;)e.lens[t++]=9;for(;t<280;)e.lens[t++]=7;for(;t<288;)e.lens[t++]=8;for(sx(1,e.lens,0,288,mx,0,e.work,{bits:9}),t=0;t<32;)e.lens[t++]=5;sx(2,e.lens,0,32,gx,0,e.work,{bits:5}),yx=!1}e.lencode=mx,e.lenbits=9,e.distcode=gx,e.distbits=5}function bx(e,t,r,n){var i,o=e.state;return null===o.window&&(o.wsize=1<<o.wbits,o.wnext=0,o.whave=0,o.window=new nx.Buf8(o.wsize)),n>=o.wsize?(nx.arraySet(o.window,t,r-o.wsize,o.wsize,0),o.wnext=0,o.whave=o.wsize):((i=o.wsize-o.wnext)>n&&(i=n),nx.arraySet(o.window,t,r-n,i,o.wnext),(n-=i)?(nx.arraySet(o.window,t,r-n,n,0),o.wnext=n,o.whave=o.wsize):(o.wnext+=i,o.wnext===o.wsize&&(o.wnext=0),o.whave<o.wsize&&(o.whave+=i))),0}Jw.inflateReset=_x,Jw.inflateReset2=vx,Jw.inflateResetKeep=px,Jw.inflateInit=function(e){return fx(e,15)},Jw.inflateInit2=fx,Jw.inflate=function(e,t){var r,n,i,o,a,s,c,u,d,l,h,p,_,v,f,m,g,y,S,b,E,T,k,I,R=0,A=new nx.Buf8(4),C=[16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15];if(!e||!e.state||!e.output||!e.input&&0!==e.avail_in)return cx;(r=e.state).mode===ux&&(r.mode=13),a=e.next_out,i=e.output,c=e.avail_out,o=e.next_in,n=e.input,s=e.avail_in,u=r.hold,d=r.bits,l=s,h=c,T=0;e:for(;;)switch(r.mode){case 1:if(0===r.wrap){r.mode=13;break}for(;d<16;){if(0===s)break e;s--,u+=n[o++]<<d,d+=8}if(2&r.wrap&&35615===u){r.check=0,A[0]=255&u,A[1]=u>>>8&255,r.check=ox(r.check,A,2,0),u=0,d=0,r.mode=2;break}if(r.flags=0,r.head&&(r.head.done=!1),!(1&r.wrap)||(((255&u)<<8)+(u>>8))%31){e.msg="incorrect header check",r.mode=dx;break}if(8!=(15&u)){e.msg="unknown compression method",r.mode=dx;break}if(d-=4,E=8+(15&(u>>>=4)),0===r.wbits)r.wbits=E;else if(E>r.wbits){e.msg="invalid window size",r.mode=dx;break}r.dmax=1<<E,e.adler=r.check=1,r.mode=512&u?10:ux,u=0,d=0;break;case 2:for(;d<16;){if(0===s)break e;s--,u+=n[o++]<<d,d+=8}if(r.flags=u,8!=(255&Yw(r))){e.msg="unknown compression method",r.mode=dx;break}if(57344&Yw(r)){e.msg="unknown header flags set",r.mode=dx;break}r.head&&(r.head.text=u>>8&1),512&Yw(r)&&(A[0]=255&u,A[1]=u>>>8&255,r.check=ox(r.check,A,2,0)),u=0,d=0,r.mode=3;case 3:for(;d<32;){if(0===s)break e;s--,u+=n[o++]<<d,d+=8}r.head&&(r.head.time=u),512&Yw(r)&&(A[0]=255&u,A[1]=u>>>8&255,A[2]=u>>>16&255,A[3]=u>>>24&255,r.check=ox(r.check,A,4,0)),u=0,d=0,r.mode=4;case 4:for(;d<16;){if(0===s)break e;s--,u+=n[o++]<<d,d+=8}r.head&&(r.head.xflags=255&u,r.head.os=u>>8),512&Yw(r)&&(A[0]=255&u,A[1]=u>>>8&255,r.check=ox(r.check,A,2,0)),u=0,d=0,r.mode=5;case 5:if(1024&Yw(r)){for(;d<16;){if(0===s)break e;s--,u+=n[o++]<<d,d+=8}r.length=u,r.head&&(r.head.extra_len=u),512&Yw(r)&&(A[0]=255&u,A[1]=u>>>8&255,r.check=ox(r.check,A,2,0)),u=0,d=0}else r.head&&(r.head.extra=null);r.mode=6;case 6:if(1024&Yw(r)&&((p=r.length)>s&&(p=s),p&&(r.head&&(E=r.head.extra_len-r.length,r.head.extra||(r.head.extra=new Array(r.head.extra_len)),nx.arraySet(r.head.extra,n,o,p,E)),512&Yw(r)&&(r.check=ox(r.check,n,p,o)),s-=p,o+=p,r.length-=p),r.length))break e;r.length=0,r.mode=7;case 7:if(2048&Yw(r)){if(0===s)break e;p=0;do{E=n[o+p++],r.head&&E&&r.length<65536&&(r.head.name+=String.fromCharCode(E))}while(E&&p<s);if(512&Yw(r)&&(r.check=ox(r.check,n,p,o)),s-=p,o+=p,E)break e}else r.head&&(r.head.name=null);r.length=0,r.mode=8;case 8:if(4096&Yw(r)){if(0===s)break e;p=0;do{E=n[o+p++],r.head&&E&&r.length<65536&&(r.head.comment+=String.fromCharCode(E))}while(E&&p<s);if(512&Yw(r)&&(r.check=ox(r.check,n,p,o)),s-=p,o+=p,E)break e}else r.head&&(r.head.comment=null);r.mode=9;case 9:if(512&Yw(r)){for(;d<16;){if(0===s)break e;s--,u+=n[o++]<<d,d+=8}if(u!==(65535&r.check)){e.msg="header crc mismatch",r.mode=dx;break}u=0,d=0}r.head&&(r.head.hcrc=Yw(r)>>9&1,r.head.done=!0),e.adler=r.check=0,r.mode=ux;break;case 10:for(;d<32;){if(0===s)break e;s--,u+=n[o++]<<d,d+=8}e.adler=r.check=lx(u),u=0,d=0,r.mode=11;case 11:if(0===r.havedict)return e.next_out=a,e.avail_out=c,e.next_in=o,e.avail_in=s,r.hold=u,r.bits=d,2;e.adler=r.check=1,r.mode=ux;case ux:if(5===t||6===t)break e;case 13:if(r.last){u>>>=7&d,d-=7&d,r.mode=27;break}for(;d<3;){if(0===s)break e;s--,u+=n[o++]<<d,d+=8}switch(r.last=1&u,d-=1,3&(u>>>=1)){case 0:r.mode=14;break;case 1:if(Sx(r),r.mode=20,6===t){u>>>=2,d-=2;break e}break;case 2:r.mode=17;break;case 3:e.msg="invalid block type",r.mode=dx}u>>>=2,d-=2;break;case 14:for(u>>>=7&d,d-=7&d;d<32;){if(0===s)break e;s--,u+=n[o++]<<d,d+=8}if((65535&u)!=(u>>>16^65535)){e.msg="invalid stored block lengths",r.mode=dx;break}if(r.length=65535&u,u=0,d=0,r.mode=15,6===t)break e;case 15:r.mode=16;case 16:if(p=r.length){if(p>s&&(p=s),p>c&&(p=c),0===p)break e;nx.arraySet(i,n,o,p,a),s-=p,o+=p,c-=p,a+=p,r.length-=p;break}r.mode=ux;break;case 17:for(;d<14;){if(0===s)break e;s--,u+=n[o++]<<d,d+=8}if(r.nlen=257+(31&u),u>>>=5,d-=5,r.ndist=1+(31&u),u>>>=5,d-=5,r.ncode=4+(15&u),u>>>=4,d-=4,r.nlen>286||r.ndist>30){e.msg="too many length or distance symbols",r.mode=dx;break}r.have=0,r.mode=18;case 18:for(;r.have<r.ncode;){for(;d<3;){if(0===s)break e;s--,u+=n[o++]<<d,d+=8}r.lens[C[r.have++]]=7&u,u>>>=3,d-=3}for(;r.have<19;)r.lens[C[r.have++]]=0;if(r.lencode=r.lendyn,r.lenbits=7,k={bits:r.lenbits},T=sx(0,r.lens,0,19,r.lencode,0,r.work,k),r.lenbits=k.bits,T){e.msg="invalid code lengths set",r.mode=dx;break}r.have=0,r.mode=19;case 19:for(;r.have<r.nlen+r.ndist;){for(;m=(R=r.lencode[u&(1<<r.lenbits)-1])>>>16&255,g=65535&R,!((f=R>>>24)<=d);){if(0===s)break e;s--,u+=n[o++]<<d,d+=8}if(g<16)u>>>=f,d-=f,r.lens[r.have++]=g;else{if(16===g){for(I=f+2;d<I;){if(0===s)break e;s--,u+=n[o++]<<d,d+=8}if(u>>>=f,d-=f,0===r.have){e.msg="invalid bit length repeat",r.mode=dx;break}E=r.lens[r.have-1],p=3+(3&u),u>>>=2,d-=2}else if(17===g){for(I=f+3;d<I;){if(0===s)break e;s--,u+=n[o++]<<d,d+=8}d-=f,E=0,p=3+(7&(u>>>=f)),u>>>=3,d-=3}else{for(I=f+7;d<I;){if(0===s)break e;s--,u+=n[o++]<<d,d+=8}d-=f,E=0,p=11+(127&(u>>>=f)),u>>>=7,d-=7}if(r.have+p>r.nlen+r.ndist){e.msg="invalid bit length repeat",r.mode=dx;break}for(;p--;)r.lens[r.have++]=E}}if(r.mode===dx)break;if(0===r.lens[256]){e.msg="invalid code -- missing end-of-block",r.mode=dx;break}if(r.lenbits=9,k={bits:r.lenbits},T=sx(1,r.lens,0,r.nlen,r.lencode,0,r.work,k),r.lenbits=k.bits,T){e.msg="invalid literal/lengths set",r.mode=dx;break}if(r.distbits=6,r.distcode=r.distdyn,k={bits:r.distbits},T=sx(2,r.lens,r.nlen,r.ndist,r.distcode,0,r.work,k),r.distbits=k.bits,T){e.msg="invalid distances set",r.mode=dx;break}if(r.mode=20,6===t)break e;case 20:r.mode=21;case 21:if(s>=6&&c>=258){e.next_out=a,e.avail_out=c,e.next_in=o,e.avail_in=s,r.hold=u,r.bits=d,ax(e,h),a=e.next_out,i=e.output,c=e.avail_out,o=e.next_in,n=e.input,s=e.avail_in,u=r.hold,d=r.bits,r.mode===ux&&(r.back=-1);break}for(r.back=0;m=(R=r.lencode[u&(1<<r.lenbits)-1])>>>16&255,g=65535&R,!((f=R>>>24)<=d);){if(0===s)break e;s--,u+=n[o++]<<d,d+=8}if(m&&0==(240&m)){for(y=f,S=m,b=g;m=(R=r.lencode[b+((u&(1<<y+S)-1)>>y)])>>>16&255,g=65535&R,!(y+(f=R>>>24)<=d);){if(0===s)break e;s--,u+=n[o++]<<d,d+=8}u>>>=y,d-=y,r.back+=y}if(u>>>=f,d-=f,r.back+=f,r.length=g,0===m){r.mode=26;break}if(32&m){r.back=-1,r.mode=ux;break}if(64&m){e.msg="invalid literal/length code",r.mode=dx;break}r.extra=15&m,r.mode=22;case 22:if(r.extra){for(I=r.extra;d<I;){if(0===s)break e;s--,u+=n[o++]<<d,d+=8}r.length+=u&(1<<r.extra)-1,u>>>=r.extra,d-=r.extra,r.back+=r.extra}r.was=r.length,r.mode=23;case 23:for(;m=(R=r.distcode[u&(1<<r.distbits)-1])>>>16&255,g=65535&R,!((f=R>>>24)<=d);){if(0===s)break e;s--,u+=n[o++]<<d,d+=8}if(0==(240&m)){for(y=f,S=m,b=g;m=(R=r.distcode[b+((u&(1<<y+S)-1)>>y)])>>>16&255,g=65535&R,!(y+(f=R>>>24)<=d);){if(0===s)break e;s--,u+=n[o++]<<d,d+=8}u>>>=y,d-=y,r.back+=y}if(u>>>=f,d-=f,r.back+=f,64&m){e.msg="invalid distance code",r.mode=dx;break}r.offset=g,r.extra=15&m,r.mode=24;case 24:if(r.extra){for(I=r.extra;d<I;){if(0===s)break e;s--,u+=n[o++]<<d,d+=8}r.offset+=u&(1<<r.extra)-1,u>>>=r.extra,d-=r.extra,r.back+=r.extra}if(r.offset>r.dmax){e.msg="invalid distance too far back",r.mode=dx;break}r.mode=25;case 25:if(0===c)break e;if(p=h-c,r.offset>p){if((p=r.offset-p)>r.whave&&r.sane){e.msg="invalid distance too far back",r.mode=dx;break}p>r.wnext?(p-=r.wnext,_=r.wsize-p):_=r.wnext-p,p>r.length&&(p=r.length),v=r.window}else v=i,_=a-r.offset,p=r.length;p>c&&(p=c),c-=p,r.length-=p;do{i[a++]=v[_++]}while(--p);0===r.length&&(r.mode=21);break;case 26:if(0===c)break e;i[a++]=r.length,c--,r.mode=21;break;case 27:if(r.wrap){for(;d<32;){if(0===s)break e;s--,u|=n[o++]<<d,d+=8}if(h-=c,e.total_out+=h,r.total+=h,h&&(e.adler=r.check=Yw(r)?ox(r.check,i,h,a-h):ix(r.check,i,h,a-h)),h=c,(Yw(r)?u:lx(u))!==r.check){e.msg="incorrect data check",r.mode=dx;break}u=0,d=0}r.mode=28;case 28:if(r.wrap&&Yw(r)){for(;d<32;){if(0===s)break e;s--,u+=n[o++]<<d,d+=8}if(u!==(4294967295&r.total)){e.msg="incorrect length check",r.mode=dx;break}u=0,d=0}r.mode=29;case 29:T=1;break e;case dx:T=-3;break e;case 31:return-4;default:return cx}return e.next_out=a,e.avail_out=c,e.next_in=o,e.avail_in=s,r.hold=u,r.bits=d,(r.wsize||h!==e.avail_out&&r.mode<dx&&(r.mode<27||4!==t))&&bx(e,e.output,e.next_out,h-e.avail_out),l-=e.avail_in,h-=e.avail_out,e.total_in+=l,e.total_out+=h,r.total+=h,r.wrap&&h&&(e.adler=r.check=Yw(r)?ox(r.check,i,h,e.next_out-h):ix(r.check,i,h,e.next_out-h)),e.data_type=r.bits+(r.last?64:0)+(r.mode===ux?128:0)+(20===r.mode||15===r.mode?256:0),(0===l&&0===h||4===t)&&0===T&&(T=-5),T},Jw.inflateEnd=function(e){if(!e||!e.state)return cx;var t=e.state;return t.window&&(t.window=null),e.state=null,0},Jw.inflateGetHeader=function(e,t){var r;return e&&e.state?0==(2&(r=e.state).wrap)?cx:(r.head=t,t.done=!1,0):cx},Jw.inflateSetDictionary=function(e,t){var r,n=t.length;return e&&e.state?0!==(r=e.state).wrap&&11!==r.mode?cx:11===r.mode&&ix(1,t,n,0)!==r.check?-3:bx(e,t,n,n)?(r.mode=31,-4):(r.havedict=1,0):cx},Jw.inflateInfo="pako inflate (from Nodeca project)";var Ex={Z_NO_FLUSH:0,Z_PARTIAL_FLUSH:1,Z_SYNC_FLUSH:2,Z_FULL_FLUSH:3,Z_FINISH:4,Z_BLOCK:5,Z_TREES:6,Z_OK:0,Z_STREAM_END:1,Z_NEED_DICT:2,Z_ERRNO:-1,Z_STREAM_ERROR:-2,Z_DATA_ERROR:-3,Z_BUF_ERROR:-5,Z_NO_COMPRESSION:0,Z_BEST_SPEED:1,Z_BEST_COMPRESSION:9,Z_DEFAULT_COMPRESSION:-1,Z_FILTERED:1,Z_HUFFMAN_ONLY:2,Z_RLE:3,Z_FIXED:4,Z_DEFAULT_STRATEGY:0,Z_BINARY:0,Z_TEXT:1,Z_UNKNOWN:2,Z_DEFLATED:8};var Tx=Jw,kx=iC,Ix=Tw,Rx=Ex,Ax=YC,Cx=xw,wx=function(){this.text=0,this.time=0,this.xflags=0,this.os=0,this.extra=null,this.extra_len=0,this.name="",this.comment="",this.hcrc=0,this.done=!1},xx=Object.prototype.toString;function Ox(e){if(!(this instanceof Ox))return new Ox(e);this.options=kx.assign({chunkSize:16384,windowBits:0,to:""},e||{});var t=this.options;t.raw&&t.windowBits>=0&&t.windowBits<16&&(t.windowBits=-t.windowBits,0===t.windowBits&&(t.windowBits=-15)),!(t.windowBits>=0&&t.windowBits<16)||e&&e.windowBits||(t.windowBits+=32),t.windowBits>15&&t.windowBits<48&&0==(15&t.windowBits)&&(t.windowBits|=15),this.err=0,this.msg="",this.ended=!1,this.chunks=[],this.strm=new Cx,this.strm.avail_out=0;var r=Tx.inflateInit2(this.strm,t.windowBits);if(r!==Rx.Z_OK)throw new Error(Ax[r]);if(this.header=new wx,Tx.inflateGetHeader(this.strm,this.header),t.dictionary&&("string"==typeof t.dictionary?t.dictionary=Ix.string2buf(t.dictionary):"[object ArrayBuffer]"===xx.call(t.dictionary)&&(t.dictionary=new Uint8Array(t.dictionary)),t.raw&&(r=Tx.inflateSetDictionary(this.strm,t.dictionary))!==Rx.Z_OK))throw new Error(Ax[r])}function Px(e,t){var r=new Ox(t);if(r.push(e,!0),r.err)throw r.msg||Ax[r.err];return r.result}Ox.prototype.push=function(e,t){var r,n,i,o,a,s=this.strm,c=this.options.chunkSize,u=this.options.dictionary,d=!1;if(this.ended)return!1;n=t===~~t?t:!0===t?Rx.Z_FINISH:Rx.Z_NO_FLUSH,"string"==typeof e?s.input=Ix.binstring2buf(e):"[object ArrayBuffer]"===xx.call(e)?s.input=new Uint8Array(e):s.input=e,s.next_in=0,s.avail_in=s.input.length;do{if(0===s.avail_out&&(s.output=new kx.Buf8(c),s.next_out=0,s.avail_out=c),(r=Tx.inflate(s,Rx.Z_NO_FLUSH))===Rx.Z_NEED_DICT&&u&&(r=Tx.inflateSetDictionary(this.strm,u)),r===Rx.Z_BUF_ERROR&&!0===d&&(r=Rx.Z_OK,d=!1),r!==Rx.Z_STREAM_END&&r!==Rx.Z_OK)return this.onEnd(r),this.ended=!0,!1;s.next_out&&(0!==s.avail_out&&r!==Rx.Z_STREAM_END&&(0!==s.avail_in||n!==Rx.Z_FINISH&&n!==Rx.Z_SYNC_FLUSH)||("string"===this.options.to?(i=Ix.utf8border(s.output,s.next_out),o=s.next_out-i,a=Ix.buf2string(s.output,i),s.next_out=o,s.avail_out=c-o,o&&kx.arraySet(s.output,s.output,i,o,0),this.onData(a)):this.onData(kx.shrinkBuf(s.output,s.next_out)))),0===s.avail_in&&0===s.avail_out&&(d=!0)}while((s.avail_in>0||0===s.avail_out)&&r!==Rx.Z_STREAM_END);return r===Rx.Z_STREAM_END&&(n=Rx.Z_FINISH),n===Rx.Z_FINISH?(r=Tx.inflateEnd(this.strm),this.onEnd(r),this.ended=!0,r===Rx.Z_OK):n!==Rx.Z_SYNC_FLUSH||(this.onEnd(Rx.Z_OK),s.avail_out=0,!0)},Ox.prototype.onData=function(e){this.chunks.push(e)},Ox.prototype.onEnd=function(e){e===Rx.Z_OK&&("string"===this.options.to?this.result=this.chunks.join(""):this.result=kx.flattenChunks(this.chunks)),this.chunks=[],this.err=e,this.msg=this.strm.msg},Fw.Inflate=Ox,Fw.inflate=Px,Fw.inflateRaw=function(e,t){return(t=t||{}).raw=!0,Px(e,t)},Fw.ungzip=Px;var Dx={};(0,iC.assign)(Dx,oC,Fw,Ex);var Mx,Nx=Dx,Lx={product_line:"rtc",report_version:"5",os:"web",user_agent:tC()?"":null===(Mx=navigator)||void 0===Mx?void 0:Mx.userAgent,platform:"web",product:"webrtc",app_state:"active"},Ux=function(){function e(){var t=this;Yd(this,e),sd(this,"report_common",Lx),sd(this,"dataBuffer",[]),sd(this,"posting",!1),sd(this,"sucSendTimer",void 0),sd(this,"preSucTime",0),sd(this,"errSendTimer",void 0),sd(this,"errSendDelay",100),sd(this,"_logServerUrl",void 0),sd(this,"_retryCount",0),tC()||(window.addEventListener("beforeunload",(function(){clearTimeout(t.errSendTimer),clearTimeout(t.sucSendTimer),t._send(void 0,!0)})),document.addEventListener("visibilitychange",(function(){"visible"===document.visibilityState?t.setCommonStats({app_state:"active"}):"hidden"===document.visibilityState&&t.setCommonStats({app_state:"background"})})))}return qd(e,[{key:"setUrl",value:function(e){this._logServerUrl=e}},{key:"setCommonStats",value:function(e){this.report_common=fb(this.report_common,e)}},{key:"push",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];t?this._send(e):(this.dataBuffer.push(e),!this.posting&&!this.errSendTimer&&Date.now()-this.preSucTime>2e3&&(clearTimeout(this.sucSendTimer),this._send()))}},{key:"_unshift",value:function(e){this.dataBuffer=wm(e).call(e,this.dataBuffer)}},{key:"_send",value:function(e,t){var r,n,i=this;if((e||this.dataBuffer.length)&&this._logServerUrl){var o={data:e||zE(r=this.dataBuffer).call(r,0,Vx(this.dataBuffer,5e5)),header:ud(ud({},this.report_common),{},{http_retry_count:this._retryCount}),from:"web",os:"web",version:"1"},a=new XMLHttpRequest;if(a.timeout=1e4,a.onreadystatechange=function(){if(4===a.readyState){var r;if(e||(i.posting=!1),200===a.status||304===a.status)try{r=JSON.parse(a.responseText)}catch(HX){}r&&0===r.StatusCode?e||t||i._sucSend():e?i._send(e):(i._unshift(o.data),t?i._send():i._errSend())}},a.open("POST",this._logServerUrl,!0),e||(this.posting=!0),!tC()&&vT(n=location.search).call(n,"_rtc_debug_"))a.send(eT(o));else{var s=Nx.gzip(eT(o));a.setRequestHeader("Content-Encoding","gzip"),a.setRequestHeader("Content-Type","application/x-www-form-urlencoded; charset=UTF-8"),a.send(s)}}}},{key:"_sucSend",value:function(){this.errSendDelay=100,this._retryCount=0,this.preSucTime=Date.now(),this.sucSendTimer=window.setTimeout(this._send.bind(this),2e3)}},{key:"_errSend",value:function(){var e=this;this.errSendTimer=window.setTimeout((function(){e._send(),delete e.errSendTimer}),this.errSendDelay),this.errSendDelay*=2,this._retryCount++}}]),e}();function Vx(e,t){for(var r=0,n=0;n<e.length;n++)if((r+=eT(e[n]).length)>t)return n-1;return e.length}var Fx=new Ux,Bx=function(){function e(t){Yd(this,e),sd(this,"report_id",0),sd(this,"modify_ids",{}),this.id=t}return qd(e,[{key:"report",value:function(e,t){var r,n,i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},o=ud(ud(ud({event_key:e,report_id:this.report_id++,rtc_timestamp:Date.now()},this.modify_ids),t),{},{common_extra_info:eT(i)});(Fx.push(o),tC())||(null===(r=(n=window).__onRTCReport)||void 0===r||r.call(n,this.id,o))}},{key:"set",value:function(e){this.modify_ids=fb(this.modify_ids,e)}},{key:"destroy",value:function(){}}]),e}(),jx=MA.start;Ar({target:"String",proto:!0,forced:NA},{padStart:function(e){return jx(this,e,arguments.length>1?arguments[1]:void 0)}});var Gx,Hx=Us("String").padStart,zx=ae,Kx=Hx,Xx=String.prototype,Wx=function(e){var t=e.padStart;return"string"==typeof e||e===Xx||zx(Xx,e)&&t===Xx.padStart?Kx:t},qx=Us("Array").keys,Yx=vn,Jx=Ye,Qx=ae,Zx=qx,$x=Array.prototype,eO={DOMTokenList:!0,NodeList:!0},tO=function(e){var t=e.keys;return e===$x||Qx($x,e)&&t===$x.keys||Jx(eO,Yx(e))?Zx:t},rO="@byted/ve-rtc",nO="@byted/ve-rtc-cache-size",iO=function(){function e(){Yd(this,e),sd(this,"storeKey",void 0),sd(this,"logLevel",void 0),sd(this,"LogfileSize",void 0),sd(this,"db",void 0),sd(this,"logId",void 0),sd(this,"cacheLog",void 0),sd(this,"cachedSize",void 0),sd(this,"preCacheTime",void 0),sd(this,"timer",void 0),sd(this,"_getSize",(function(e){return new Blob(e).size/1048576})),this.storeKey="",this.logId=1,this.cacheLog="",this.logLevel="none",this.LogfileSize=100,this._createStore()}return qd(e,[{key:"_createStore",value:function(){var e=this;if(!tC()&&window.indexedDB){var t=indexedDB.open("@byted/ve-rtc");t.onupgradeneeded=function(){t.result.createObjectStore(rO);try{localStorage.removeItem(nO)}catch(HX){}},t.onerror=function(e){},t.onsuccess=function(){e.db=t.result,e._getCachedSize()}}}},{key:"_getCachedSize",value:function(){var e=this;try{var t=localStorage.getItem(nO);if(t)this.cachedSize=+t;else tR(this).call(this).then((function(t){e.cachedSize=e._getSize(t),e._setCachedSize()}))}catch(HX){}}},{key:"_setCachedSize",value:function(){try{localStorage.setItem(nO,"".concat(this.cachedSize))}catch(HX){}}},{key:"_getStore",value:function(e){if(this.db)return this.db.transaction(rO,e).objectStore(rO)}},{key:"set",value:function(e){var t=this;return new Wf((function(r,n){if("none"===t.logLevel)return r();var i;if(e&&t.preCacheTime&&t.preCacheTime-Date.now()<1e3)return t.cacheLog+=wm(i="\n\n".concat(t.logId,": ")).call(i,e),t.logId++,t.timer||(t.timer=setTimeout((function(){t.set("")}),1e3-(t.preCacheTime-Date.now()))),r();clearTimeout(t.timer),t.timer=null;var o=t._getStore("readwrite");if(!o)return n("get store fail");t.cachedSize&&t.cachedSize>t.LogfileSize&&t.keyEarliest().then((function(e){t.get(e).then((function(r){t.del(e).then((function(){t.cachedSize=t.cachedSize-t._getSize(["".concat(r)]),t._setCachedSize()}))}))}));var a=o.get(t.storeKey);a.onsuccess=function(){try{var i,s,c,u,d,l=wm(i="".concat(a.result||"")).call(i,t.cacheLog),h=e?wm(s=wm(c="".concat(l?"\n\n":"")).call(c,t.logId,": ")).call(s,e):"";o.put(wm(u="".concat(l)).call(u,h),t.storeKey),e&&t.logId++,t.cacheLog="",t.cachedSize=(t.cachedSize||0)+t._getSize([wm(d="".concat(t.cacheLog)).call(d,h)]),t._setCachedSize(),t.preCacheTime=Date.now(),r()}catch(_){var p;if(!e)return n(_);t.cacheLog+=wm(p="\n\n".concat(t.logId,": ")).call(p,e),t.logId++,n(_)}},a.onerror=function(r){var i;if(!e)return n(r);t.cacheLog+=wm(i="\n\n".concat(t.logId,": ")).call(i,e),t.logId++,n(r)}}))}},{key:"get",value:function(e){var t=this;return new Wf((function(r,n){var i=t._getStore("readonly");if(!i)return n();var o=i.get(e);o.onsuccess=function(){r(o.result)},o.onerror=function(e){n(e)}}))}},{key:"del",value:function(){var e=this,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.storeKey;return new Wf((function(r,n){var i=e._getStore("readwrite");if(!i)return n();var o=i.delete(t);o.onsuccess=function(){return r(o.result)},o.onerror=function(e){return n(e)}}))}},{key:"keyEarliest",value:function(){return tO(this).call(this).then((function(e){var t,r=Date.now();return e.forEach((function(e){if(e&&e.length){var n=e.split("-")[0];Number(n)<r&&(r=Number(n),t=e)}})),t}))}},{key:"keys",value:function(){var e=this;return new Wf((function(t,r){var n=e._getStore("readonly");if(!n)return r();if(n.getAllKeys){var i=n.getAllKeys();return i.onsuccess=function(){t(i.result)},void(i.onerror=function(){r()})}var o=[];n.openCursor().onsuccess=function(){this.result&&(o.push(this.result.key),this.result.continue())},n.transaction.oncomplete=function(){return t(o)}}))}},{key:"values",value:function(){var e=this;return new Wf((function(t,r){var n=e._getStore("readonly");if(!n)return r();if(n.getAll){var i=n.getAll();return i.onsuccess=function(){t(i.result)},void(i.onerror=function(){r()})}var o=[];n.openCursor().onsuccess=function(){this.result&&(o.push(this.result.value),this.result.continue())},n.transaction.oncomplete=function(){return t(o)}}))}},{key:"download",value:function(e){e=e||this.storeKey,this.get(e).then((function(t){var r=document.createElement("a");r.download="".concat(e,".txt"),r.href="data:text/paint;utf-8,"+(t||""),r.click()}))}}]),e}(),oO=new iO,aO="[VERTC]",sO=["#0050b3","#0050b3","#0050b3","#0050b3","#0050b3"],cO="undefined"!=typeof window&&vT(Gx=window.location.search).call(Gx,"_rtc_debug_"),uO=function(){function e(t,r,n){Yd(this,e),sd(this,"_indent",void 0),sd(this,"_module",void 0),sd(this,"_id",void 0),this._module=t,this._indent=r}return qd(e,[{key:"print",value:function(e){for(var t,r,n,i,o,a,s,c=arguments.length,u=new Array(c>1?c-1:0),d=1;d<c;d++)u[d-1]=arguments[d];var l=u.shift();try{var h,p,_,v,f=wm(h=[]).call(h,u),m="".concat(l).replace(/\%o/gi,(function(){var e=f.shift();return eT(e)}));oO.set(wm(p=wm(_=wm(v="".concat(aO,"[").concat(this._module,".")).call(v,e,"] ")).call(_,m," ")).call(p,JE(f).call(f,(function(e){return eT(e)})).join(", ")))}catch(HX){}if(cO){for(var g="",y=0;y<this._indent;y++)g+="    ";(t=console).log.apply(t,wm(r=[wm(n=wm(i=wm(o=wm(a=wm(s="%c".concat(dO(),"-")).call(s,aO)).call(a,g,"[")).call(o,this._module,".")).call(i,e,"] ")).call(n,l),"color:".concat(sO[this._indent],";")]).call(r,u))}}}]),e}(),dO=function(){var e,t=new Date;return t.toTimeString().split(" ")[0]+":"+Wx(e=t.getMilliseconds().toString()).call(e,3,"0")},lO=new uO("MessageReportor",1),hO=function(){function e(t){Yd(this,e),sd(this,"_preTime",Date.now()),sd(this,"_one2oneNum",0),sd(this,"_one2manyNum",0),sd(this,"_one2oneMsgCache",new jS),sd(this,"_one2manyMsgCache",new jS),sd(this,"roomId",""),sd(this,"userId",""),sd(this,"rtsSessionId",""),this.id=t}return qd(e,[{key:"needReport",value:function(t){return!!e.config&&(Date.now()-this._preTime>=36e5&&(this._preTime=Date.now(),this._one2oneNum=0,this._one2manyNum=0),"one2one"===t&&this._one2oneNum<e.config.max_one2one_fpt_per_hour&&Math.random()<=e.config.one2one_fpt_ratio/100||"one2many"===t&&this._one2manyNum<e.config.max_one2many_fpt_per_hour&&Math.random()<=e.config.one2many_fpt_ratio/100)}},{key:"cacheP2PMsg",value:function(t){var r;this._one2oneMsgCache.set(t.msg_id,ud({config_version:(null===(r=e.config)||void 0===r?void 0:r.version)||""},t))}},{key:"updateP2PMsg",value:function(e,t){var r=this._one2oneMsgCache.get(e);r&&this._one2oneMsgCache.set(e,ud(ud({},r),t))}},{key:"cacheCustomMsg",value:function(t){var r;this._one2manyMsgCache.set(t.msg_id,ud({config_version:(null===(r=e.config)||void 0===r?void 0:r.version)||""},t))}},{key:"updateOne2ManyMsg",value:function(e,t){var r=this._one2manyMsgCache.get(e);r&&this._one2manyMsgCache.set(e,ud(ud({},r),t))}},{key:"reportP2PMsg",value:function(e){var t,r=this._one2oneMsgCache.get(e);r&&(lO.print("reportP2PMsg",r.type,eT(r)),null===(t=EO(this.id))||void 0===t||t.report("rts_message",r))}},{key:"reportOne2ManyMsg",value:function(e){var t,r=this._one2manyMsgCache.get(e);r&&(lO.print("reportOne2ManyMsg",r.type,eT(r)),null===(t=EO(this.id))||void 0===t||t.report("rts_message",r))}},{key:"reportMsgRecv",value:function(t){var r,n;t.config_version=(null===(r=e.config)||void 0===r?void 0:r.version)||"",lO.print("reportMsgRecv",t.type,eT(t)),null===(n=EO(this.id))||void 0===n||n.report("rts_message",t)}},{key:"destroy",value:function(){this._one2manyNum=0,this._one2oneNum=0,this._one2manyMsgCache.clear(),this._one2oneMsgCache.clear(),this._preTime=Date.now(),this.roomId="",this.userId="",this.rtsSessionId=""}}]),e}();sd(hO,"config",void 0);var pO=new jS,_O={_cache:pO,setConfig:function(e){lO.print("setConfig","get config: "+eT(e)),hO.config=e},setRtsSessionId:function(e,t){var r=pO.get(e);r&&(r.rtsSessionId=t)},createRTSMsgReportor:function(e){var t=pO.get(e)||new hO(e);return pO.set(e,t),t},destroyRTSMsgReportor:function(e){var t=pO.get(e);t&&(t.destroy(),pO.delete(e))},setRoomId:function(e,t){var r=pO.get(e);r&&(r.roomId=t||"")},setUserId:function(e,t){var r=pO.get(e);r&&(r.userId=t||"")},samplingP2PMsg:function(e,t){var r=pO.get(e);if(null!=r&&r.needReport("one2one")){var n,i=wm(n="".concat(t.from)).call(n,t.id),o=t.to?"one2one":"one2server";t.enable_report=!0,t.report_msg_id=t.id,r.cacheP2PMsg({rts_session_id:r.rtsSessionId,msg_id:i,node_role:"src_sdk",from:t.from,to:t.to||"server",type:o,rts_room_id:t.room,req_ts:Date.now(),send_ts:Date.now(),ack_ts:Date.now(),msg_size:0,error_code:0,recv_msg_ts:0,fwd_msg_ts:0,reply_ack_ts:0,cur_dst_uid:""})}return t},updateP2PMsgReq:function(e,t,r){var n,i;t.enable_report&&nC(t.report_msg_id)&&(null===(n=pO.get(e))||void 0===n||n.updateP2PMsg(wm(i="".concat(t.from)).call(i,t.report_msg_id),{send_ts:Date.now(),msg_size:r}))},updateP2PMsgAck:function(e,t,r){if(t.enable_report&&nC(t.report_msg_id)){var n,i,o=pO.get(e);null==o||o.updateP2PMsg(wm(n="".concat(t.from)).call(n,t.report_msg_id),{ack_ts:Date.now(),error_code:r}),null==o||o.reportP2PMsg(wm(i="".concat(t.from)).call(i,t.report_msg_id))}},samplingOne2ManyMsg:function(e,t,r){var n,i=pO.get(e);null!=i&&i.needReport("one2many")&&(r.enable_report=!0,r.report_msg_id=t,i.cacheCustomMsg({rts_session_id:i.rtsSessionId,msg_id:wm(n="".concat(r.clientId)).call(n,t),node_role:"src_sdk",from:r.clientId,to:i.roomId,type:"one2many",rts_room_id:i.roomId,req_ts:Date.now(),send_ts:Date.now(),ack_ts:Date.now(),msg_size:0,error_code:0,recv_msg_ts:0,fwd_msg_ts:0,reply_ack_ts:0,cur_dst_uid:""}));return r},reportP2PMsgRecv:function(e,t,r){if(t.enable_report&&nC(t.report_msg_id)){var n,i=pO.get(e),o=t.to?"one2one":"one2many";null==i||i.reportMsgRecv({rts_session_id:i.rtsSessionId,msg_id:wm(n="".concat(t.from)).call(n,t.report_msg_id),msg_size:r.msg_size,node_role:"dst_sdk",type:o,rts_room_id:t.room,from:t.from,to:t.to||t.room,error_code:0,recv_msg_ts:r.recv_msg_ts,fwd_msg_ts:r.fwd_msg_ts,reply_ack_ts:Date.now(),cur_dst_uid:t.to?"":i.userId,config_version:"",req_ts:0,send_ts:0,ack_ts:0})}},updateOne2ManyMsgAck:function(e,t,r){if(t.enable_report&&nC(t.report_msg_id)){var n,i,o=pO.get(e);if(o)null==o||o.updateOne2ManyMsg(wm(n="".concat(t.clientId)).call(n,t.report_msg_id),{ack_ts:Date.now(),error_code:r}),null==o||o.reportOne2ManyMsg(wm(i="".concat(t.clientId)).call(i,t.report_msg_id))}},updateOne2ManyMsgReq:function(e,t,r){if(t.enable_report&&nC(t.report_msg_id)){var n,i=pO.get(e);if(i)i.updateOne2ManyMsg(wm(n="".concat(t.clientId)).call(n,t.report_msg_id),{send_ts:Date.now(),msg_size:r})}},reportOne2ManyMsgRecv:function(e,t,r){if(t.enable_report&&nC(t.report_msg_id)){var n,i=pO.get(e);null==i||i.reportMsgRecv({rts_session_id:i.rtsSessionId,msg_id:wm(n="".concat(t.clientId)).call(n,t.report_msg_id),msg_size:r.msg_size,node_role:"dst_sdk",type:"one2many",rts_room_id:t.roomId,from:t.clientId,to:t.roomId,error_code:0,recv_msg_ts:r.recv_msg_ts,fwd_msg_ts:r.fwd_msg_ts,reply_ack_ts:Date.now(),cur_dst_uid:i.userId,config_version:"",req_ts:0,send_ts:0,ack_ts:0})}}},vO=function(){function e(t){Yd(this,e),sd(this,"_timer",void 0),sd(this,"userMessage",{}),sd(this,"roomMessage",{}),this.id=t,this._setTimer()}return qd(e,[{key:"_setTimer",value:function(){var e=this;!function t(){e._reportAndgReset(),clearTimeout(e._timer),e._timer=setTimeout(t,1e4)}()}},{key:"_reportAndgReset",value:function(){(an(this.userMessage).length||an(this.roomMessage).length)&&(this._report(),this._reset())}},{key:"_report",value:function(){var e,t,r,n=this;null===(e=EO(this.id))||void 0===e||e.report("rtc_message_statistics",{dc_user_message:JE(t=an(this.userMessage)).call(t,(function(e){return n.userMessage[e]})),dc_room_message:JE(r=an(this.roomMessage)).call(r,(function(e){return n.roomMessage[e]})),media_server_ip:""})}},{key:"_reset",value:function(){this.userMessage={},this.roomMessage={}}},{key:"_checkInitUserMessage",value:function(e,t){var r,n;this.userMessage[wm(r="".concat(t,"-")).call(r,e)]||(this.userMessage[wm(n="".concat(t,"-")).call(n,e)]={dc_peer_user_id:e,dc_send_total:0,dc_recv_total:0,dc_send_ack:0,dc_send_fail:0,dc_fail_timeout:0,dc_fail_no_receiver:0,dc_fail_no_relay_path:0,dc_cost_time:0,dc_cost_e2s:0,dc_cost_s2s:0,dc_least_time:1/0,dc_most_time:0,dc_cost_peer_s2e:0,dc_send_ack_100:0,dc_send_ack_200:0,dc_send_ack_400:0,dc_send_ack_1s:0,dc_message_type:t,dc_send_binary:0})}},{key:"_sendUserMessage",value:function(e,t,r){var n,i;(this._checkInitUserMessage(e,t),this.userMessage[wm(n="".concat(t,"-")).call(n,e)].dc_send_total++,r)&&this.userMessage[wm(i="".concat(t,"-")).call(i,e)].dc_send_binary++}},{key:"_recvUserMessage",value:function(e,t){var r;this._checkInitUserMessage(e,t),this.userMessage[wm(r="".concat(t,"-")).call(r,e)].dc_recv_total++}},{key:"_sendUserFail",value:function(e,t,r){var n,i=this.userMessage[wm(n="".concat(t,"-")).call(n,e)];i&&(i.dc_send_fail++,this._handleUserFail(i,r))}},{key:"_handleUserFail",value:function(e,t){var r;t&&(t.code||t.err)&&(vT(r=["TIME_OUT","USER_MESSAGE_TIMEOUT"]).call(r,t.code)?e.dc_fail_timeout++:3===t.err?e.dc_fail_no_receiver++:4===t.err?e.dc_fail_no_relay_path++:1===t.err&&e.dc_fail_timeout++)}},{key:"_sendUserAck",value:function(e,t,r,n,i){var o,a=this.userMessage[wm(o="".concat(t,"-")).call(o,e)];a&&(a.dc_send_ack++,a.dc_cost_time+=r,a.dc_cost_s2s+=n||0,a.dc_cost_peer_s2e+=i,a.dc_cost_e2s+=r-(n||0)-i,r<=100?(a.dc_send_ack_100++,a.dc_send_ack_200++,a.dc_send_ack_400++,a.dc_send_ack_1s++):r<=200?(a.dc_send_ack_200++,a.dc_send_ack_400++,a.dc_send_ack_1s++):r<=400?(a.dc_send_ack_400++,a.dc_send_ack_1s++):r<=1e3&&a.dc_send_ack_1s++,r<a.dc_least_time&&(a.dc_least_time=r),r>a.dc_most_time&&(a.dc_most_time=r))}},{key:"sendRoomMessage",value:function(e,t){this.roomMessage[e]||(this.roomMessage[e]={dc_room_id:e,dc_send_total:0,dc_send_ack:0,dc_cost_time:0,dc_least_time:1/0,dc_most_time:0,dc_send_fail:0,dc_send_ack_100:0,dc_send_ack_200:0,dc_send_ack_400:0,dc_send_ack_1s:0,dc_send_binary:0}),this.roomMessage[e].dc_send_total++,t&&this.roomMessage[e].dc_send_binary++}},{key:"sendRoomFail",value:function(e){var t=this.roomMessage[e];t&&t.dc_send_fail++}},{key:"sendRoomAck",value:function(e,t){var r=this.roomMessage[e];r&&(r.dc_send_ack++,r.dc_cost_time+=t,t<r.dc_least_time&&(r.dc_least_time=t),t>r.dc_most_time&&(r.dc_most_time=t),t<=100?(r.dc_send_ack_100++,r.dc_send_ack_200++,r.dc_send_ack_400++,r.dc_send_ack_1s++):t<=200?(r.dc_send_ack_200++,r.dc_send_ack_400++,r.dc_send_ack_1s++):t<=400?(r.dc_send_ack_400++,r.dc_send_ack_1s++):t<=1e3&&r.dc_send_ack_1s++)}},{key:"sendP2PMessage",value:function(e,t){this._sendUserMessage(e,"p2p",t)}},{key:"recvP2PMessage",value:function(e){this._recvUserMessage(e,"p2p")}},{key:"sendP2PFail",value:function(e,t){this._sendUserFail(e,"p2p",t)}},{key:"sendP2PAck",value:function(e,t,r,n){this._sendUserAck(e,"p2p",t,r,n)}},{key:"sendP2POutRoomMessage",value:function(e,t){this._sendUserMessage(e,"p2p_outside_room",t)}},{key:"recvP2POutRoomMessage",value:function(e){this._recvUserMessage(e,"p2p_outside_room")}},{key:"sendP2POutRoomFail",value:function(e,t){this._sendUserFail(e,"p2p_outside_room",t)}},{key:"sendP2POutRoomAck",value:function(e,t,r,n){this._sendUserAck(e,"p2p_outside_room",t,r,n)}},{key:"sendP2serverMessage",value:function(e){this._sendUserMessage("","p2server",e)}},{key:"sendP2serverFail",value:function(e){this._sendUserFail("","p2server",e)}},{key:"sendP2serveAck",value:function(e,t,r){this._sendUserAck("","p2server",e,t,r)}},{key:"countP2PMessage",value:function(e,t,r,n,i){this.sendP2PMessage(t,r),e?this.sendP2PAck(t,Date.now()-n,i.s2s_time,i.s2e_time):this.sendP2PFail(t,i)}},{key:"countRoomMessage",value:function(e,t,r,n){this.sendRoomMessage(t,r),e?this.sendRoomAck(t,Date.now()-n):this.sendRoomFail(t)}},{key:"countUserMessageOutsideRoom",value:function(e,t,r,n,i){this.sendP2POutRoomMessage(t,r),e?this.sendP2POutRoomAck(t,Date.now()-n,i.s2s_time,i.s2e_time):this.sendP2POutRoomFail(t,i)}},{key:"countServerMessage",value:function(e,t,r,n){this.sendP2serverMessage(t),e?(n=n||{},this.sendP2serveAck(Date.now()-r,n.s2s_time||0,n.s2e_time||0)):this.sendP2serverFail(n)}},{key:"destroy",value:function(){this._reset(),clearTimeout(this._timer)}}]),e}(),fO=function(e){Fx.setCommonStats(e)},mO=function(e){Fx.setUrl(e)},gO=new Bx("global"),yO=function(e,t,r){gO.report("rtc_sdk_api_call",{sdk_api_name:e,error_code:t,message:r})},SO=function(e,t){var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"",i=arguments.length>4?arguments[4]:void 0;gO.report("rtc_invoke_status",{sdk_api_name:e,message:t,error_code:r,stream_id:n,elapse:0},i)},bO=new jS,EO=function(e){return bO.get(e)};function TO(){for(var e=arguments.length,t=new Array(e),r=0;r<e;r++)t[r]=arguments[r];return function(e,r,n){if("function"==typeof n.value){var i=n.value;n.value=function(){for(var e,n=arguments.length,o=new Array(n),a=0;a<n;a++)o[a]=arguments[a];var s,c,u=this.engineId||this.id,d={};(t.forEach((function(e,t){d[e]=o[t]})),"joinRoom"===r)&&(null===(s=EO(u))||void 0===s||s.set({room_id:o[1],user_id:null===(c=o[2])||void 0===c?void 0:c.userId}));null===(e=EO(u))||void 0===e||e.report("rtc_sdk_api_call",{sdk_api_name:r,message:eT(RO(o)),error_code:0},d);var l=i.apply(this,o);return"function"==typeof(null==l?void 0:l.then)?l.then((function(e){return kO(u,r,[e||{}]),e})).catch((function(e){throw kO(u,r,e.message,e.code),e})):(kO(u,r,[l||{}]),l)}}}}var kO=function(e,t,r){var n,i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0,o=arguments.length>4?arguments[4]:void 0,a={sdk_callback_name:t,error_code:i,message:eT(Array.isArray(r)?RO(r):r)};o&&(a.room_id=o),null===(n=EO(e))||void 0===n||n.report("rtc_sdk_callback",a)},IO=function(e,t,r){var n,i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0,o=arguments.length>4&&void 0!==arguments[4]?arguments[4]:"",a=arguments.length>5?arguments[5]:void 0;null===(n=EO(e))||void 0===n||n.report("rtc_invoke_status",{sdk_api_name:t,message:r,error_code:i,stream_id:o,elapse:0},a)};function RO(e){return JE(e).call(e,(function e(t){var r;if(null!=t&&t._reportName)return t._reportName;if(t instanceof HTMLElement)return t.toString();if(t instanceof ArrayBuffer||ArrayBuffer.isView(t)){var n,i,o=ArrayBuffer.isView(t)?t.buffer:t,a=o.byteLength,s=[];if(a>10){var c,u,d,l,h=new DataView(o),p=JE(c=XT({length:5})).call(c,(function(e,t){return h.getUint8(t)})),_=JE(u=JE(d=XT({length:5})).call(d,(function(e,t){return a-1-t})).reverse()).call(u,(function(e){return h.getUint8(e)}));s=wm(l=[]).call(l,qT(p),["..."],qT(_))}else s=XT(new Uint8Array(o));return wm(n=wm(i="".concat(t.constructor.name,"(")).call(i,a,") [")).call(n,s.join(", "),"]")}if(t instanceof ImageData)return"ImageData";if(Array.isArray(t))return JE(t).call(t,e);if(vT(r=["[object Object]","[object MediaStreamTrack]"]).call(r,Object.prototype.toString.call(t))){var v={};for(var f in t)v[f]=e(t[f]);return v}return t}))}var AO=function(e){var t,r=EO(e.engineId),n={keys:tO(e),labelSelector:"",sdkVersion:e.sdkVersion,deviceType:"web",appId:e.appId},i=JE(t=e.requestDomains).call(t,(function(e){return"https://".concat(e,"/decision/v1/multi")}));null==r||r.report("rtc_get_config",{error_code:0,message:eT(n),elapse:0,host:i.join(","),type:"request",config_id:"",enable_cloud_proxy:!1});var o=JE(i).call(i,function(){var e=km(Em().mark((function e(t,r){var i;return Em().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,fetch(t,{method:"POST",body:eT(n)}).then((function(e){return e.json()}));case 2:return i=e.sent,e.abrupt("return",{result:i,index:r});case 4:case"end":return e.stop()}}),e)})));return function(t,r){return e.apply(this,arguments)}}());return new Wf((function(e){(function(e){return new Wf((function(t,r){var n=(e=Array.isArray(e)?e:[]).length,i=[];0===n?r([]):e.forEach((function(e){e.then((function(e){t(e)}),(function(e){n--,i.push(e),0===n&&r(i)}))}))}))})(o).then((function(t){var n=t.result,o=t.index;null==r||r.report("rtc_get_config",{error_code:200,message:eT(n),elapse:0,host:i[o],type:"response",config_id:"",enable_cloud_proxy:!1}),e(n)})).catch((function(e){var t;null==r||r.report("rtc_get_config",{error_code:500,message:null===(t=e[0])||void 0===t?void 0:t.message,elapse:0,host:"",type:"response",config_id:"",enable_cloud_proxy:!1})}))}))},CO=new TextDecoder,wO=new TextEncoder,xO=function(){return eC()},OO=function(){return Date.now()};function PO(e){for(var t=0,r=arguments.length,n=new Array(r>1?r-1:0),i=1;i<r;i++)n[i-1]=arguments[i];for(var o=0,a=n;o<a.length;o++){var s=a[o];t+=s.length}for(var c=new e(t),u=0,d=0,l=n;d<l.length;d++){var h=l[d];c.set(h,u),u+=h.length}return c}var DO=function(){function e(){Yd(this,e)}var t,r;return qd(e,null,[{key:"token2auth",value:function(t,r,n,i){return i?"Bearer ".concat(i):"Basic ".concat(e.createUnsafeToken(t,r,n))}},{key:"createUnsafeToken",value:function(e,t,r){var n;return window.btoa(Gs(n=[e,t,r]).call(n,(function(e){return null!==e})).join(":"))}},{key:"merge",value:function(){for(var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=0,i=SA(t);n<i.length;n++){var o=Qk(i[n],2),a=o[0],s=o[1];null!==s&&"object"===Ll(s)?e.merge(t[a],r[a]):void 0!==r[a]&&(t[a]=r[a])}}},{key:"ab2str",value:function(e){return CO.decode(e)}},{key:"ab2obj",value:function(t){try{var r=e.ab2str(t);return JSON.parse(r)}catch(n){return{}}}},{key:"str2ab",value:function(e){return wO.encode(e).buffer}},{key:"ab2b64str",value:(r=km(Em().mark((function e(t){var r;return Em().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,new Wf((function(e){var r=new FileReader;r.onload=function(){return e(r.result)},r.readAsDataURL(new Blob([t]))}));case 2:return r=e.sent,e.abrupt("return",r.split(",",2)[1]);case 4:case"end":return e.stop()}}),e)}))),function(e){return r.apply(this,arguments)})},{key:"b64str2ab",value:(t=km(Em().mark((function e(t){return Em().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",fetch("data:application/octet;base64,"+t).then((function(e){return e.arrayBuffer()})));case 1:case"end":return e.stop()}}),e)}))),function(e){return t.apply(this,arguments)})}]),e}();function MO(){for(var e,t,r=(+jA(e=bm(t="".concat(Math.random())).call(t,-7)).call(e,7,"0")).toString(2),n=jA(r).call(r,28,"1").split(""),i=[];n.length;)i.push(zE(n).call(n,0,7));return JE(i).call(i,(function(e,t){var r=t===i.length-1?"0":"1";return HA(r+e.join(""),2)}))}var NO=function(){return Math.floor(65535*Math.random())};function LO(e){return"string"==typeof e&&gE(e).call(e,"__web__rtc__rtt__")>-1}var UO,VO,FO,BO,jO,GO,HO,zO,KO=function(){var e=km(Em().mark((function e(){var t,r,n,i=arguments;return Em().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=i.length>0&&void 0!==i[0]&&i[0],(r=new RTCPeerConnection({iceServers:[],iceTransportPolicy:"all",bundlePolicy:"max-bundle",rtcpMuxPolicy:"require",sdpSemantics:"unified-plan"})).createDataChannel("default"),r.addTransceiver("audio",{direction:"recvonly"}),r.addTransceiver("video",{direction:"recvonly"}),t&&(r.addTransceiver("audio",{direction:"sendonly"}),r.addTransceiver("video",{direction:"sendonly"})),e.next=8,r.createOffer();case 8:return n=e.sent,r.close(),e.abrupt("return",n.sdp);case 11:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}(),XO=function(e){return new Wf((function(t,r){var n=(e=Array.isArray(e)?e:[]).length,i=[];0===n?r([]):e.forEach((function(e){e.then((function(e){t(e)}),(function(e){n--,i.push(e),0===n&&r(i)}))}))}))};function WO(e){return+Math.max(-127,10*WA(Math.pow(e/255,2))).toFixed(2)}function qO(e){return(e&Sd.AUDIO)===Sd.AUDIO}function YO(e){return(e&Sd.VIDEO)===Sd.VIDEO}function JO(e){var t={};return an(e).forEach((function(r){"object"===Ll(e[r])?t[r]=JO(e[r]):cA(r).call(r,"_")||(t[r]=e[r])})),t}function QO(e){var t=new DataView(e.buffer);if(t.byteLength<=4||65535!==t.getUint16(0))return{seiCount:1,seis:[e]};for(var r={seiCount:0,seis:[]},n=!1,i=2;i<t.byteLength;){var o=t.getUint16(i);if(i+=2,t.byteLength-i<o){n=!0;break}var a=new Uint8Array(e.buffer,i,o);if(i+=o,t.byteLength-i>0&&t.byteLength-i<=2){n=!0;break}r.seiCount++,r.seis.push(a)}return n&&(r.seiCount=1,r.seis=[e]),r}function ZO(e){return null==e?"undefined | null":"string"==typeof e?e:eT({contentHint:e.contentHint,enabled:e.enabled,id:e.id,kind:e.kind,label:e.label,muted:e.muted,readyState:e.readyState})}function $O(e){return void 0===e}function eP(e){return function(t,r,n){var i=n.value;n.value=function(){var t;console.warn(wm(t="[RTC WebSDK]: Api: ".concat(r," has been abandoned from version ")).call(t,e));for(var n=arguments.length,o=new Array(n),a=0;a<n;a++)o[a]=arguments[a];return i.apply(this,o)}}}function tP(e){console.warn("[RTC WebSDK]: "+e)}function rP(e){return"number"==typeof e?e:"number"==typeof(null==e?void 0:e.exact)?e.exact:"number"==typeof(null==e?void 0:e.ideal)?e.ideal:"number"==typeof(null==e?void 0:e.max)?e.max:"number"==typeof(null==e?void 0:e.min)?e.min:1}var nP=function(){return"undefined"==typeof window},iP=nP()?"":window.navigator.userAgent;function oP(){var e="none";return nP()||(null!==iP.match("Firefox")?e="mozilla":null!==iP.match("Chrome")?(e="chrome-stable",null!==iP.match("Electron")&&(e="electron")):(null!==iP.match("Safari")||null!==iP.match("AppleWebKit"))&&(e="safari")),e}var aP="mozilla"===oP(),sP="safari"===oP(),cP="chrome-stable"===oP(),uP=!nP()&&/CriOS/i.test(iP),dP=!nP()&&/Edg\//i.test(iP),lP=!nP()&&/EdgA/i.test(iP),hP=!nP()&&/EdgiOS/i.test(iP),pP=dP||lP||hP;!nP()&&/(iPhone|iPod)/i.exec(iP);var _P=!nP()&&(!!/(iPad)/i.exec(iP)||/Macintosh/i.test(iP)&&"ontouchend"in document),vP=!nP()&&/Macintosh/i.test(iP),fP=!nP()&&/MicroMessenger/i.test(iP),mP=!nP()&&vT(UO=iP.toLowerCase()).call(UO,"mobile");!nP()&&/SM-\w+/i.test(iP);var gP=!nP()&&!!/(iPhone|iPad|iPod)/i.exec(iP),yP=!nP()&&/Android/i.test(iP),SP=!nP()&&/Windows/i.test(iP),bP=0,EP=!nP()&&(null===(VO=iP.match(/version\/(\d+)/i))||void 0===VO?void 0:VO[1]);sP&&EP&&(bP=+EP);var TP=!nP()&&(null===(FO=iP.match(/Firefox\/(\d+)/i))||void 0===FO?void 0:FO[1]);aP&&TP&&(bP=+TP);var kP=bP,IP=bP,RP=null!==(BO=!nP()&&(null===(jO=iP.match(/ ([\d_]+) like Mac OS X/i))||void 0===jO||null===(GO=jO[1])||void 0===GO?void 0:JE(HO=GO.split("_")).call(HO,(function(e){return Qm(e)}))))&&void 0!==BO?BO:[],AP=0,CP=!nP()&&(null===(zO=iP.match(/Chrome\/(\d+)/i))||void 0===zO?void 0:zO[1]);CP&&(AP=+CP);var wP=AP,xP="VolcEngine",OP="RTC_DEVICE_ID",PP="RTC_ACCESS_NODE",DP="RTC_ACCESS_URLS",MP="ENGINE_WEB_CONFIG",NP=function(){function e(){Yd(this,e)}return qd(e,[{key:"get",value:function(e){var t=localStorage.getItem(e);if(!t)return null;try{var r=JSON.parse(t);return r.ttl>0&&Date.now()-r.saveTime>r.ttl?(this.delete(e),null):r.message}catch(n){return null}}},{key:"set",value:function(e,t){var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:-1,n={ttl:r,saveTime:Date.now(),message:t};try{return localStorage.setItem(e,eT(n)),!0}catch(i){return!1}}},{key:"getTtl",value:function(e){var t=localStorage.getItem(e);if(!t)return null;try{return JSON.parse(t).ttl}catch(r){return null}}},{key:"delete",value:function(e){try{return localStorage.removeItem(e),!0}catch(t){return!1}}}]),e}(),LP=function(e){xI(r,e);var t=WI(r);function r(){return Yd(this,r),t.apply(this,arguments)}return qd(r,[{key:"getDeviceId",value:function(){if(nP())return"";var e=this.get(OP);return e&&!/^[0-9a-f]{8}(-[0-9a-f]{4}){3}-[0-9a-f]{12}$/.test(e)||(e=function(e){for(var t="",r=0;r<e;r++)t+=Math.floor(10*Math.random());return t}(30)),this.setDeviceId(e),e}},{key:"setDeviceId",value:function(e){return fO({device_id:e}),this.set(OP,e),e}},{key:"getAccessNode",value:function(e){var t;return this.get(wm(t="".concat(PP,"_").concat(e,"-")).call(t,xP))}},{key:"setAccessNode",value:function(e,t,r){var n;return this.set(wm(n="".concat(PP,"_").concat(e,"-")).call(n,xP),t,1e3*r)}},{key:"deleteAccessNode",value:function(e,t){var r,n=this.getAccessNode(e),i=this.getTtl(wm(r="".concat(PP,"_").concat(e,"-")).call(r,xP));Array.isArray(n)&&n.length>0&&((n=Gs(n).call(n,(function(e){return e.mediaID!==t.mediaID&&e.msgKey!==t.msgKey}))).length>0?this.setAccessNode(e,n,i||0):this.clearAccessNode(e))}},{key:"clearAccessNode",value:function(e){var t;this.delete(wm(t="".concat(PP,"_").concat(e,"-")).call(t,xP))}},{key:"getAccessUrls",value:function(){return this.get("".concat(DP,"-").concat(xP))}},{key:"setAccessUrls",value:function(e){var t=JE(e).call(e,(function(e){var t,r=e.host,n=e.path;return wm(t="https://".concat(r)).call(t,n)}));return this.set("".concat(DP,"-").concat(xP),t)}},{key:"clearAccessUrls",value:function(){this.delete("".concat(DP,"-").concat(xP))}},{key:"getEngineWebConfig",value:function(e,t){var r,n,i,o=wm(r=wm(n="".concat(e,"_")).call(n,t,"_")).call(r,this.getDeviceId()),a=this.get(MP);return(null==a||null===(i=sE(a).call(a,(function(e){return e.key===o})))||void 0===i?void 0:i.config)||{}}},{key:"setEngineWebConfig",value:function(e,t,r){var n,i;if(r){var o=wm(n=wm(i="".concat(e,"_")).call(i,t,"_")).call(n,this.getDeviceId()),a=this.get(MP)||[];return(a=Gs(a).call(a,(function(e){return e.key!==o}))).push({key:o,config:r}),this.set(MP,bm(a).call(a,-5))}}}]),r}(NP),UP=new LP,VP=new uO("JoinRoomConfig",0),FP=function(){function e(t){var r;Yd(this,e),sd(this,"_useTcpAfterJoinTimeout",e.DEFAULT_CONF.useTcpAfterJoinTimeout),sd(this,"_joinWithTcpOnly",e.DEFAULT_CONF.joinWithTcpOnly),sd(this,"_joinWithTcpOnlyDelay",e.DEFAULT_CONF.joinWithTcpOnlyDelay),sd(this,"_blackBrowserRegexList",[]),this._engineId=t,gE(r=location.search).call(r,"__rtc_tcp_only__")>-1&&(this._joinWithTcpOnly=!0,this._joinWithTcpOnlyDelay=0),this._report()}return qd(e,[{key:"useTcpAfterJoinTimeout",get:function(){return this._useTcpAfterJoinTimeout}},{key:"useTcpJoin",get:function(){return this._joinWithTcpOnly}},{key:"useTcpJoinDelay",get:function(){return this._joinWithTcpOnlyDelay}},{key:"isBlackBrower",value:function(){var e;return sE(e=this._blackBrowserRegexList).call(e,(function(e){return new RegExp(e).test(navigator.userAgent)}))}},{key:"setServerConfig",value:function(e){var t,r,n,i,o,a,s=!1;"boolean"==typeof(null==e||null===(t=e.use_tcp_after_join_timeout)||void 0===t?void 0:t.enable)&&(this._useTcpAfterJoinTimeout=null===(i=e.use_tcp_after_join_timeout)||void 0===i?void 0:i.enable,s=!0);"boolean"==typeof(null==e||null===(r=e.join_with_tcp_only)||void 0===r?void 0:r.enable)&&(this._joinWithTcpOnly=null===(o=e.join_with_tcp_only)||void 0===o?void 0:o.enable,s=!0);"number"==typeof(null==e||null===(n=e.join_with_tcp_only)||void 0===n?void 0:n.delay_ms)&&(this._joinWithTcpOnlyDelay=null===(a=e.join_with_tcp_only)||void 0===a?void 0:a.delay_ms,s=!0);e&&Array.isArray(e.black_browser_regex_list)&&(this._blackBrowserRegexList=e.black_browser_regex_list,s=!0),s&&this._report()}},{key:"toString",value:function(){return eT({use_tcp_after_join_timeout:this._useTcpAfterJoinTimeout,join_with_tcp_only:this._joinWithTcpOnly,join_with_tcp_only_delay:this._joinWithTcpOnlyDelay,black_browser_regex_list:this._blackBrowserRegexList})}},{key:"_report",value:function(){VP.print("_report",this.toString()),IO(this._engineId,"web_join_room_config",this.toString())}}],[{key:"setDefaulConf",value:function(t){var r=t.useTcpAfterJoinTimeout,n=t.joinWithTcpOnly,i=t.joinWithTcpOnlyDelay;return"boolean"==typeof r&&(e.DEFAULT_CONF.useTcpAfterJoinTimeout=r),"boolean"==typeof n&&(e.DEFAULT_CONF.joinWithTcpOnly=n),"number"==typeof i&&(e.DEFAULT_CONF.joinWithTcpOnlyDelay=Math.max(0,i)),e.DEFAULT_CONF}}]),e}();sd(FP,"DEFAULT_CONF",{useTcpAfterJoinTimeout:!0,joinWithTcpOnly:!1,joinWithTcpOnlyDelay:5e3});var BP="access.rtc.volcvideo.com,access2-hl.rtc.volcvideo.com,rtcg-access.volcvideos.com".split(",");function jP(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"";return/^https?:\/\/.+/.test(e)||(e="https://"+e),"".concat(e,"/dispatch/v1/AccessInfo?Action=GetAccessInfo")}var GP="https://web-log-report.rtc.volcvideo.com/video/v1/webrtc_log/",HP="common.rtc.volcvideo.com,rtcg.volcvideos.com".split(","),zP={VERSION:"4.54.0",ICE_CONFIG_REQUEST_URLS_INTERNAL:JE(BP).call(BP,jP),ICE_CONFIG_REQUEST_URLS:[],EXPECTED_ADDR:"",LOG_SERVER_URL:GP,CONFIG_REQUEST_DOMAINS:HP,DEVICE_ID:"",OVERSEA:!1,PLATFORM:"",PRODUCT:"",FORCE_ENABLED_REPORT_CALLBACKS:[],SKIP_WEB_AUDIO_IN_TRACK:!1,AUDIO_STALL:!0,VIDEO_STALL:!0,STATS_SCALLBACK_SUPPORT:!0,JOIN_ROOM_CONFIG:FP.DEFAULT_CONF};function KP(e,t){var r;if(yO("setParameter",0,wm(r="key: ".concat(e,", value: ")).call(r,t)),"VERSION"!==e){if("JOIN_ROOM_CONFIG"===e)return FP.setDefaulConf(t);if("ICE_CONFIG_REQUEST_URLS"===e)return"string"==typeof t&&(t=[t]),void(zP.ICE_CONFIG_REQUEST_URLS=JE(t).call(t,jP));if("PLATFORM"!==e||"string"!=typeof t)if("PRODUCT"!==e||"string"!=typeof t){if("FORCE_ENABLED_REPORT_CALLBACKS"===e)return"string"==typeof t&&(t=[t]),void(zP.FORCE_ENABLED_REPORT_CALLBACKS=t);if("LOG_SERVER_URL"===e){var n=t===kd.overseas?"https://web-log-report.volcvideos.com/video/v1/webrtc_log//":t===kd.domestic?GP:"string"==typeof t?t:void 0;n&&(zP.LOG_SERVER_URL=n,mO(n))}else if("OVERSEA"===e)return fO({extra_is_oversea:t?"1":"0"}),void(zP.OVERSEA=t);"DEVICE_ID"===e&&UP.setDeviceId(t),zP[e]=t}else fO({product:t});else fO({platform:t})}}function XP(e){return"DEVICE_ID"===e?UP.getDeviceId():zP[e]}function WP(e,t,r){var n,i,o,a,s,c,u,d,l;return{type:"publicstream",action:t,publicStreamID:e,publicStreamMeta:{audio:{},video:{fps:(null===(n=r.video)||void 0===n?void 0:n.fps)||15,bitrate:1e3*((null===(i=r.video)||void 0===i?void 0:i.kBitRate)||40),width:(null===(o=r.video)||void 0===o?void 0:o.width)||640,height:(null===(a=r.video)||void 0===a?void 0:a.height)||360},layout:{layoutMode:2,interpolationMode:(null===(s=r.layout)||void 0===s?void 0:s.interpolationMode)||Ad.PREV_FRAME,canvas:{bgColor:(null===(c=r.layout)||void 0===c?void 0:c.backgroundColor)||"#000000",bgImage:(null===(u=r.layout)||void 0===u?void 0:u.backgroundImage)||""},regions:(null===(d=r.layout)||void 0===d||null===(l=d.regions)||void 0===l?void 0:JE(l).call(l,(function(e){return{roomId:e.roomId,userId:e.userId,alterImage:e.alertImage||"",alpha:!e.alpha||+e.alpha>1||+e.alpha<=0?1:+e.alpha,x:!e.x||+e.x>=1||+e.x<0?0:+e.x,y:!e.y||+e.y>=1||+e.y<0?0:+e.y,w:!e.w||+e.w>1||+e.w<=0?1:+e.w,h:!e.h||+e.h>1||+e.h<=0?1:+e.h,zorder:!e.zorder||+e.zorder<0||+e.zorder>100?0:+e.zorder,renderMode:void 0===e.renderMode?1:e.renderMode,streamType:e.isScreenStream?1:0,mediaType:e.mediaType||0,sourceCrop:e.sourceCrop}})))||[]}}}}var qP={width:640,height:480,frameRate:15,maxKbps:600},YP={width:1920,height:1080,frameRate:15,maxKbps:3e3};function JP(e,t){if("boolean"!=typeof e)throw new lA(uA.INVALID_PARAMS,"Invalid ".concat(t,": The value should be boolean type."))}function QP(e,t){var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:Number.POSITIVE_INFINITY;if(e<r||e>n||"number"!=typeof e){var i,o,a=new lA(uA.INVALID_PARAMS,wm(i=wm(o="Invalid ".concat(t,": the value range is [")).call(o,r,", ")).call(i,n,"]. integer only"));throw a}}function ZP(e,t){var r,n,i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,o=arguments.length>3&&void 0!==arguments[3]?arguments[3]:Number.POSITIVE_INFINITY;if(null==e)throw new lA(uA.INVALID_PARAMS,"".concat(t," cannot be empty"));if(!iD(e,i,o))throw new lA(uA.INVALID_PARAMS,wm(r=wm(n="Invalid ".concat(t,": The value should be string type. Length of the string: [")).call(n,i,",")).call(r,o,"]"))}function $P(e,t,r){var n;if(!vT(r).call(r,e))throw new lA(uA.INVALID_PARAMS,wm(n="Invalid ".concat(t,": The value can only be set as ")).call(n,eT(r)))}function eD(e){if(!(e instanceof MediaStreamTrack))throw new lA(uA.INVALID_PARAMS,"Invalid track, The value should be MediaStreamTrack type.")}function tD(e,t){if(oD(e))throw new lA(uA.INVALID_PARAMS,"Invalid ".concat(t,", should not be empty"))}function rD(e,t){if(!(e instanceof ArrayBuffer))throw new lA(uA.INVALID_PARAMS,"Invalid ".concat(t,", should be ArrayBuffer"))}function nD(e){try{for(var t=navigator.mediaDevices.getSupportedConstraints(),r=0,n=an(e);r<n.length;r++){var i=n[r];t[i]||delete e[i]}}catch(o){}}function iD(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:Number.POSITIVE_INFINITY;return"string"==typeof e&&e.length<=r&&e.length>=t}function oD(e){return null==e}function aD(e){if("string"!=typeof e||!/^[a-zA-Z0-9@._\-]{1,128}$/.test(e))throw new lA(uA.INVALID_PARAMS,"The RoomId must be within 128 bytes. The supported characters: a-z,A-Z,0-9,@,-,_,.")}function sD(e){if("string"!=typeof e||!/^[a-zA-Z0-9@._\-]{1,128}$/.test(e))throw new lA(uA.INVALID_PARAMS,"The userId must be within 128 bytes. The supported characters: a-z,A-Z,0-9,@,-,_,.")}function cD(e){if("string"!=typeof e||!/^[a-zA-Z0-9@._\-]{1,128}$/.test(e))throw new lA(uA.INVALID_PARAMS,"The publicStreamId must be within 128 bytes. The supported characters: a-z,A-Z,0-9,@,-,_,.")}function uD(e){tD(e,"userInfo"),sD(e.userId),oD(e.extraInfo)||ZP(e.extraInfo,"userInfo.extraInfo",1,200)}function dD(e){tD(e,"roomConfig"),JP(e.isAutoPublish,"roomConfig.isAutoPublish"),JP(e.isAutoSubscribeAudio,"roomConfig.isAutoSubscribeAudio"),JP(e.isAutoSubscribeVideo,"roomConfig.isAutoSubscribeVideo"),oD(e.roomProfileType)||$P(e.roomProfileType,"roomConfig",[Pd.communication,Pd.chat,Pd.chatRoom,Pd.coHost,Pd.meeting,Pd.classRoom])}function lD(e){tD(e,"videoPlayerOption")}function hD(e){var t,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:64;if(!e||0===(null==e?void 0:e.byteLength))throw new lA(uA.INVALID_PARAMS,"The message cannot be empty");if((null===(t=e instanceof ArrayBuffer?e:DO.str2ab(eT(e)))||void 0===t?void 0:t.byteLength)>1e3*r)throw new lA(uA.INVALID_PARAMS,"The message length must be less than ".concat(r,"K"))}function pD(e){var t,r=XP("FORCE_ENABLED_REPORT_CALLBACKS");return!(null==r||!vT(r).call(r,e))||!vT(t=[Xd.onRemoteStreamStats,Xd.onLocalStreamStats,Xd.onAudioVolumeIndication,Xd.onLocalAudioPropertiesReport,Xd.onRemoteAudioPropertiesReport]).call(t,e)}function _D(e){if("number"!=typeof(null==e?void 0:e.width)||"number"!=typeof(null==e?void 0:e.height))throw new lA(uA.INVALID_PARAMS,"remoteVideoConfig must contain width, height, frameRate")}function vD(e,t){if("number"!=typeof e||Number.isNaN(e)||!(e>=1)){var r=e;if(!(null!=r&&r.min||null!=r&&r.max||null!=r&&r.exact||null!=r&&r.ideal))throw new lA(uA.INVALID_PARAMS,"".concat(t," is not a valid ConstrainULong"))}}function fD(e){var t,r=Jk(e);try{for(r.s();!(t=r.n()).done;){var n=t.value;QP(null==n?void 0:n.maxKbps,"maxKbps"),vD(null==n?void 0:n.width,"width"),vD(null==n?void 0:n.height,"height"),vD(null==n?void 0:n.frameRate,"frameRate")}}catch(i){r.e(i)}finally{r.f()}}function mD(e,t){var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:Number.NEGATIVE_INFINITY,n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:Number.POSITIVE_INFINITY;return QP(e,t,Number.NEGATIVE_INFINITY,Number.POSITIVE_INFINITY),e=(e=e>r?e:r)<n?e:n}var gD={exports:{}};!function(e){var t=Object.prototype.hasOwnProperty,r="~";function n(){}function i(e,t,r){this.fn=e,this.context=t,this.once=r||!1}function o(e,t,n,o,a){if("function"!=typeof n)throw new TypeError("The listener must be a function");var s=new i(n,o||e,a),c=r?r+t:t;return e._events[c]?e._events[c].fn?e._events[c]=[e._events[c],s]:e._events[c].push(s):(e._events[c]=s,e._eventsCount++),e}function a(e,t){0==--e._eventsCount?e._events=new n:delete e._events[t]}function s(){this._events=new n,this._eventsCount=0}Object.create&&(n.prototype=Object.create(null),(new n).__proto__||(r=!1)),s.prototype.eventNames=function(){var e,n,i=[];if(0===this._eventsCount)return i;for(n in e=this._events)t.call(e,n)&&i.push(r?bm(n).call(n,1):n);return xs?wm(i).call(i,xs(e)):i},s.prototype.listeners=function(e){var t=r?r+e:e,n=this._events[t];if(!n)return[];if(n.fn)return[n.fn];for(var i=0,o=n.length,a=new Array(o);i<o;i++)a[i]=n[i].fn;return a},s.prototype.listenerCount=function(e){var t=r?r+e:e,n=this._events[t];return n?n.fn?1:n.length:0},s.prototype.emit=function(e,t,n,i,o,a){var s=r?r+e:e;if(!this._events[s])return!1;var c,u,d=this._events[s],l=arguments.length;if(d.fn){switch(d.once&&this.removeListener(e,d.fn,void 0,!0),l){case 1:return d.fn.call(d.context),!0;case 2:return d.fn.call(d.context,t),!0;case 3:return d.fn.call(d.context,t,n),!0;case 4:return d.fn.call(d.context,t,n,i),!0;case 5:return d.fn.call(d.context,t,n,i,o),!0;case 6:return d.fn.call(d.context,t,n,i,o,a),!0}for(u=1,c=new Array(l-1);u<l;u++)c[u-1]=arguments[u];d.fn.apply(d.context,c)}else{var h,p=d.length;for(u=0;u<p;u++)switch(d[u].once&&this.removeListener(e,d[u].fn,void 0,!0),l){case 1:d[u].fn.call(d[u].context);break;case 2:d[u].fn.call(d[u].context,t);break;case 3:d[u].fn.call(d[u].context,t,n);break;case 4:d[u].fn.call(d[u].context,t,n,i);break;default:if(!c)for(h=1,c=new Array(l-1);h<l;h++)c[h-1]=arguments[h];d[u].fn.apply(d[u].context,c)}}return!0},s.prototype.on=function(e,t,r){return o(this,e,t,r,!1)},s.prototype.once=function(e,t,r){return o(this,e,t,r,!0)},s.prototype.removeListener=function(e,t,n,i){var o=r?r+e:e;if(!this._events[o])return this;if(!t)return a(this,o),this;var s=this._events[o];if(s.fn)s.fn!==t||i&&!s.once||n&&s.context!==n||a(this,o);else{for(var c=0,u=[],d=s.length;c<d;c++)(s[c].fn!==t||i&&!s[c].once||n&&s[c].context!==n)&&u.push(s[c]);u.length?this._events[o]=1===u.length?u[0]:u:a(this,o)}return this},s.prototype.removeAllListeners=function(e){var t;return e?(t=r?r+e:e,this._events[t]&&a(this,t)):(this._events=new n,this._eventsCount=0),this},s.prototype.off=s.prototype.removeListener,s.prototype.addListener=s.prototype.on,s.prefixed=r,s.EventEmitter=s,e.exports=s}(gD);var yD=gD.exports,SD=new uO("VERTC",0),bD=function(e){xI(r,e);var t=WI(r);function r(){return Yd(this,r),t.apply(this,arguments)}return qd(r,[{key:"safeEmit",value:function(e){var t=this.listenerCount(e);try{for(var n,i,o=arguments.length,a=new Array(o>1?o-1:0),s=1;s<o;s++)a[s-1]=arguments[s];return(n=CI(RI(r.prototype),"emit",this)).call.apply(n,wm(i=[this,e]).call(i,a))}catch(HX){return SD.print("safeEmit","safeEmit() | event listener threw an error [event:%s]:%o",e,HX),console.error(HX),Boolean(t)}}}]),r}(gD.exports.EventEmitter),ED=O,TD=tr,kD=$,ID=eI,RD=Jt,AD=A,CD=mc,wD=V;Ar({target:"Reflect",stat:!0,forced:i((function(){var e=function(){},t=RD.f(new e,"a",{configurable:!0});return!1!==Reflect.set(e.prototype,"a",1,t)}))},{set:function e(t,r,n){var i,o,a,s=arguments.length<4?t:arguments[3],c=AD.f(TD(t),r);if(!c){if(kD(o=CD(t)))return e(o,r,n,s);c=wD(0)}if(ID(c)){if(!1===c.writable||!kD(s))return!1;if(i=AD.f(s,r)){if(i.get||i.set||!1===i.writable)return!1;i.value=n,RD.f(s,r,i)}else RD.f(s,r,wD(0,n))}else{if(void 0===(a=c.set))return!1;ED(a,s,n)}return!0}});var xD=ee.Reflect.set,OD=hi.f("asyncIterator");function PD(e){var t,r,n,i=2;for(void 0!==ml&&(r=OD,n=Nl);i--;){if(r&&null!=(t=e[r]))return t.call(e);if(n&&null!=(t=e[n]))return new DD(t.call(e));r="@@asyncIterator",n="@@iterator"}throw new TypeError("Object is not async iterable")}function DD(e){function t(e){if(Object(e)!==e)return Wf.reject(new TypeError(e+" is not an object."));var t=e.done;return Wf.resolve(e.value).then((function(e){return{value:e,done:t}}))}return(DD=function(e){this.s=e,this.n=e.next}).prototype={s:null,n:null,next:function(){return t(this.n.apply(this.s,arguments))},return:function(e){var r=this.s.return;return void 0===r?Wf.resolve({value:e,done:!0}):t(r.apply(this.s,arguments))},throw:function(e){var r=this.s.return;return void 0===r?Wf.reject(e):t(r.apply(this.s,arguments))}},new DD(e)}var MD=[{maxLayers:3,totalPixels:2073600},{maxLayers:3,totalPixels:921600},{maxLayers:3,totalPixels:518400},{maxLayers:2,totalPixels:230400},{maxLayers:2,totalPixels:129600},{maxLayers:1,totalPixels:57600},{maxLayers:1,totalPixels:0}];Ug("Set",(function(e){return function(){return e(this,arguments.length?arguments[0]:void 0)}}),ey);var ND=ee.Set;Ar({target:"Set",stat:!0,forced:!0},{from:uy}),Ar({target:"Set",stat:!0,forced:!0},{of:ly});var LD=O,UD=we,VD=tr,FD=function(){for(var e=VD(this),t=UD(e.add),r=0,n=arguments.length;r<n;r++)LD(t,e,arguments[r]);return e};Ar({target:"Set",proto:!0,real:!0,forced:!0},{addAll:FD}),Ar({target:"Set",proto:!0,real:!0,forced:!0},{deleteAll:vy});var BD=mh,jD=tr,GD=Yt,HD=BD,zD=Nh;Ar({target:"Set",proto:!0,real:!0,forced:!0},{every:function(e){var t=jD(this),r=HD(t),n=GD(e,arguments.length>1?arguments[1]:void 0);return!zD(r,(function(e,r){if(!n(e,e,t))return r()}),{IS_ITERATOR:!0,INTERRUPTED:!0}).stopped}});var KD=oe,XD=O,WD=we,qD=tr,YD=kp,JD=Nh;Ar({target:"Set",proto:!0,real:!0,forced:!0},{difference:function(e){var t=qD(this),r=new(YD(t,KD("Set")))(t),n=WD(r.delete);return JD(e,(function(e){XD(n,r,e)})),r}});var QD=oe,ZD=O,$D=we,eM=tr,tM=Yt,rM=kp,nM=BD,iM=Nh;Ar({target:"Set",proto:!0,real:!0,forced:!0},{filter:function(e){var t=eM(this),r=nM(t),n=tM(e,arguments.length>1?arguments[1]:void 0),i=new(rM(t,QD("Set"))),o=$D(i.add);return iM(r,(function(e){n(e,e,t)&&ZD(o,i,e)}),{IS_ITERATOR:!0}),i}});var oM=tr,aM=Yt,sM=BD,cM=Nh;Ar({target:"Set",proto:!0,real:!0,forced:!0},{find:function(e){var t=oM(this),r=sM(t),n=aM(e,arguments.length>1?arguments[1]:void 0);return cM(r,(function(e,r){if(n(e,e,t))return r(e)}),{IS_ITERATOR:!0,INTERRUPTED:!0}).result}});var uM=oe,dM=O,lM=we,hM=tr,pM=kp,_M=Nh;Ar({target:"Set",proto:!0,real:!0,forced:!0},{intersection:function(e){var t=hM(this),r=new(pM(t,uM("Set"))),n=lM(t.has),i=lM(r.add);return _M(e,(function(e){dM(n,t,e)&&dM(i,r,e)})),r}});var vM=O,fM=we,mM=tr,gM=Nh;Ar({target:"Set",proto:!0,real:!0,forced:!0},{isDisjointFrom:function(e){var t=mM(this),r=fM(t.has);return!gM(e,(function(e,n){if(!0===vM(r,t,e))return n()}),{INTERRUPTED:!0}).stopped}});var yM=oe,SM=O,bM=we,EM=R,TM=tr,kM=mh,IM=Nh;Ar({target:"Set",proto:!0,real:!0,forced:!0},{isSubsetOf:function(e){var t=kM(this),r=TM(e),n=r.has;return EM(n)||(r=new(yM("Set"))(e),n=bM(r.has)),!IM(t,(function(e,t){if(!1===SM(n,r,e))return t()}),{IS_ITERATOR:!0,INTERRUPTED:!0}).stopped}});var RM=O,AM=we,CM=tr,wM=Nh;Ar({target:"Set",proto:!0,real:!0,forced:!0},{isSupersetOf:function(e){var t=CM(this),r=AM(t.has);return!wM(e,(function(e,n){if(!1===RM(r,t,e))return n()}),{INTERRUPTED:!0}).stopped}});var xM=Ar,OM=tr,PM=gn,DM=BD,MM=Nh,NM=E([].join),LM=[].push;xM({target:"Set",proto:!0,real:!0,forced:!0},{join:function(e){var t=OM(this),r=DM(t),n=void 0===e?",":PM(e),i=[];return MM(r,LM,{that:i,IS_ITERATOR:!0}),NM(i,n)}});var UM=oe,VM=Yt,FM=O,BM=we,jM=tr,GM=kp,HM=BD,zM=Nh;Ar({target:"Set",proto:!0,real:!0,forced:!0},{map:function(e){var t=jM(this),r=HM(t),n=VM(e,arguments.length>1?arguments[1]:void 0),i=new(GM(t,UM("Set"))),o=BM(i.add);return zM(r,(function(e){FM(o,i,n(e,e,t))}),{IS_ITERATOR:!0}),i}});var KM=we,XM=tr,WM=BD,qM=Nh,YM=TypeError;Ar({target:"Set",proto:!0,real:!0,forced:!0},{reduce:function(e){var t=XM(this),r=WM(t),n=arguments.length<2,i=n?void 0:arguments[1];if(KM(e),qM(r,(function(r){n?(n=!1,i=r):i=e(i,r,r,t)}),{IS_ITERATOR:!0}),n)throw YM("Reduce of empty set with no initial value");return i}});var JM=tr,QM=Yt,ZM=BD,$M=Nh;Ar({target:"Set",proto:!0,real:!0,forced:!0},{some:function(e){var t=JM(this),r=ZM(t),n=QM(e,arguments.length>1?arguments[1]:void 0);return $M(r,(function(e,r){if(n(e,e,t))return r()}),{IS_ITERATOR:!0,INTERRUPTED:!0}).stopped}});var eN=oe,tN=O,rN=we,nN=tr,iN=kp,oN=Nh;Ar({target:"Set",proto:!0,real:!0,forced:!0},{symmetricDifference:function(e){var t=nN(this),r=new(iN(t,eN("Set")))(t),n=rN(r.delete),i=rN(r.add);return oN(e,(function(e){tN(n,r,e)||tN(i,r,e)})),r}});var aN=oe,sN=we,cN=tr,uN=kp,dN=Nh;Ar({target:"Set",proto:!0,real:!0,forced:!0},{union:function(e){var t=cN(this),r=new(uN(t,aN("Set")))(t);return dN(e,sN(r.add),{that:r}),r}});var lN=ND,hN=function(){var e=km(Em().mark((function e(){return Em().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(e.prev=0,!nP()&&window.RTCPeerConnection&&window.RTCPeerConnection.prototype.addTransceiver&&window.RTCPeerConnection.prototype.createDataChannel){e.next=3;break}return e.abrupt("return",!1);case 3:return e.next=5,bN();case 5:if(e.t0=e.sent,!e.t0){e.next=10;break}return e.next=9,SN();case 9:e.t0=e.sent;case 10:return e.abrupt("return",e.t0);case 13:return e.prev=13,e.t1=e.catch(0),e.abrupt("return",!1);case 16:case"end":return e.stop()}}),e,null,[[0,13]])})));return function(){return e.apply(this,arguments)}}(),pN=function(){var e=km(Em().mark((function e(){var t;return Em().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=[],e.next=3,bN();case 3:if(e.t0=e.sent,!e.t0){e.next=8;break}return e.next=7,SN();case 7:e.t0=e.sent;case 8:if(!e.t0){e.next=10;break}t.push("H264");case 10:return e.next=12,TN();case 12:if(e.t1=e.sent,!e.t1){e.next=17;break}return e.next=16,EN();case 16:e.t1=e.sent;case 17:if(!e.t1){e.next=19;break}t.push("vp8");case 19:return e.abrupt("return",t);case 20:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}(),_N=function(){var e=km(Em().mark((function e(){var t;return Em().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,pN();case 2:return t=e.sent,e.abrupt("return",JE(t).call(t,(function(e){return e.toUpperCase()})));case 4:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}(),vN={};function fN(e){var t;if(sE(t=["level-asymmetry-allowed=1;packetization-mode=1;profile-level-id=42e01f","profile-level-id=42e01f;level-asymmetry-allowed=1;packetization-mode=1","packetization-mode=1;profile-level-id=42e01f;level-asymmetry-allowed=1"]).call(t,(function(t){return null==e?void 0:vT(e).call(e,t)}))){for(var r=navigator.userAgent.toLowerCase(),n=!1,i=0,o=["miuibrowser"];i<o.length;i++){var a=o[i];vT(r).call(r,a)&&(n=!0)}return!n}return!1}var mN=function(){var e=km(Em().mark((function e(t){var r,n;return Em().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return(r=new RTCPeerConnection({sdpSemantics:"unified-plan"})).addTransceiver("video",{direction:t}),e.next=4,r.createOffer();case 4:return n=e.sent,r.close(),e.abrupt("return",n.sdp.toLowerCase());case 7:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),gN=function(){var e=km(Em().mark((function e(){var t,r;return Em().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,mN("sendonly");case 2:if(r=e.sent,!vT(t=navigator.userAgent).call(t,"VivoBrowser")){e.next=7;break}return e.next=6,mN("sendonly");case 6:r=e.sent;case 7:return vN.h264encode=fN(r),vN.vp8encode=gE(r).call(r,"vp8")>-1,e.abrupt("return",vN);case 10:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}(),yN=function(){var e=km(Em().mark((function e(){var t,r;return Em().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,mN("recvonly");case 2:if(r=e.sent,!vT(t=navigator.userAgent).call(t,"VivoBrowser")){e.next=7;break}return e.next=6,mN("recvonly");case 6:r=e.sent;case 7:return vN.h264decode=fN(r),vN.vp8decode=gE(r).call(r,"vp8")>-1,e.abrupt("return",vN);case 10:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}(),SN=function(){var e=km(Em().mark((function e(){return Em().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(void 0!==vN.h264encode){e.next=9;break}return e.prev=1,e.next=4,gN();case 4:e.next=9;break;case 6:return e.prev=6,e.t0=e.catch(1),e.abrupt("return",!1);case 9:return e.abrupt("return",vN.h264encode||!1);case 10:case"end":return e.stop()}}),e,null,[[1,6]])})));return function(){return e.apply(this,arguments)}}(),bN=function(){var e=km(Em().mark((function e(){return Em().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(void 0!==vN.h264decode){e.next=9;break}return e.prev=1,e.next=4,yN();case 4:e.next=9;break;case 6:return e.prev=6,e.t0=e.catch(1),e.abrupt("return",!1);case 9:return e.abrupt("return",vN.h264decode||!1);case 10:case"end":return e.stop()}}),e,null,[[1,6]])})));return function(){return e.apply(this,arguments)}}(),EN=function(){var e=km(Em().mark((function e(){return Em().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(void 0!==vN.vp8encode){e.next=9;break}return e.prev=1,e.next=4,gN();case 4:e.next=9;break;case 6:return e.prev=6,e.t0=e.catch(1),e.abrupt("return",!1);case 9:return e.abrupt("return",vN.vp8encode||!1);case 10:case"end":return e.stop()}}),e,null,[[1,6]])})));return function(){return e.apply(this,arguments)}}(),TN=function(){var e=km(Em().mark((function e(){return Em().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(void 0!==vN.vp8decode){e.next=9;break}return e.prev=1,e.next=4,yN();case 4:e.next=9;break;case 6:return e.prev=6,e.t0=e.catch(1),e.abrupt("return",!1);case 9:return e.abrupt("return",vN.vp8decode||!1);case 10:case"end":return e.stop()}}),e,null,[[1,6]])})));return function(){return e.apply(this,arguments)}}(),kN=function(){return"undefined"!=typeof TransformStream&&"undefined"!=typeof RTCRtpSender&&"undefined"!=typeof RTCRtpReceiver&&void 0!==RTCRtpSender.prototype.createEncodedStreams&&void 0!==RTCRtpReceiver.prototype.createEncodedStreams},IN=function(){return vP?cP&&wP>=70||aP&&IP>=80||sP&&kP>=14:SP?cP&&wP>=70||aP&&IP>=80:gP?RP[0]>=14:!!yP&&(cP&&wP>=86)},RN=cP&&wP<=114,AN=new jS,CN=function(){var e=km(Em().mark((function e(t){return Em().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",new Wf((function(e,r){var n=XP("STATS_SCALLBACK_SUPPORT");if(cP&&void 0===window.InstallTrigger&&RN&&n)try{t.getStats((function(t){var r=[];t.result().forEach((function(e){if(!vT(PN).call(PN,e.type)){var t={};e.names().forEach((function(r){t[r]=e.stat(r)})),r.push(ud(ud({},t),{},{id:e.id,type:e.type,timestamp:e.timestamp}))}})),e({all:r,getTrackStats:function(e){return Gs(r).call(r,(function(t){return"ssrc"!==t.type||t.googTrackId===e}))}})}))}catch(HX){r(HX)}else e({all:[],getTrackStats:function(){return[]}})})));case 1:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),wN=function(){var e=km(Em().mark((function e(t){var r,n,i,o,a,s,c;return Em().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,t.getStats();case 2:return n=e.sent,i={all:[]},o=new jS,n.forEach((function(e){var t=o.get(e.type)||new jS;t.set(e.id,e),o.set(e.type,t),i.all.push(e)})),a=function(e,t){e.forEach((function(e){var r,n,i,a,s,c,u=e.codecId,d=e.transportId,l=e.trackId,h=e.playoutId;if(null===(r=o.get(ON.codec))||void 0===r||r.forEach((function(e){e.id===u&&t.add(e)})),null===(n=o.get(ON.transport))||void 0===n||n.forEach((function(e){e.id===d&&(s=e,t.add(e))})),null===(i=o.get(ON.track))||void 0===i||i.forEach((function(e){e.id===l&&t.add(e)})),null===(a=o.get(ON.mediaPlayout))||void 0===a||a.forEach((function(e){e.id===h&&t.add(e)})),s){var p,_,v=s,f=v.localCertificateId,m=v.remoteCertificateId,g=v.selectedCandidatePairId;null===(p=o.get(ON.certificate))||void 0===p||p.forEach((function(e){(e.id===f||e.id===m)&&t.add(e)})),null===(_=o.get(ON.candidatePair))||void 0===_||_.forEach((function(e){e.id===g&&(c=e,t.add(e))}))}if(c){var y,S,b=c,E=b.localCandidateId,T=b.remoteCandidateId;null===(y=o.get(ON.localCandidate))||void 0===y||y.forEach((function(e){e.id===E&&t.add(e)})),null===(S=o.get(ON.remoteCandidate))||void 0===S||S.forEach((function(e){e.id===T&&t.add(e)}))}}))},o.get(ON.mediaSource)?null===(s=o.get(ON.mediaSource))||void 0===s||s.forEach((function(e){var t,r=new lN;r.add(e);var n=[];null===(t=o.get(ON.outboundRtp))||void 0===t||t.forEach((function(t){var i;t.mediaSourceId===e.id&&(r.add(t),n.push(t),null===(i=o.get(ON.remoteInboundRtp))||void 0===i||i.forEach((function(e){e.localId===t.id&&r.add(e)})))})),a(n,r),i[e.trackIdentifier]=XT(r)})):o.get(ON.track)&&(null===(c=o.get(ON.track))||void 0===c||c.forEach((function(e){var t,r=new lN;r.add(e);var n=[];null===(t=o.get(ON.outboundRtp))||void 0===t||t.forEach((function(t){var i;t.trackId===e.id&&(r.add(t),n.push(t),null===(i=o.get(ON.remoteInboundRtp))||void 0===i||i.forEach((function(e){e.localId===t.id&&r.add(e)})))})),a(n,r),i[e.trackIdentifier]=XT(r)}))),null===(r=o.get(ON.inboundRtp))||void 0===r||r.forEach((function(e){var t,r=new lN;r.add(e),null===(t=o.get(ON.remoteOutboundRtp))||void 0===t||t.forEach((function(t){t.localId===e.id&&r.add(t)})),a([e],r);var n,s=e.trackIdentifier;s||(null===(n=o.get(ON.track))||void 0===n||n.forEach((function(t){t.id===e.trackId&&(s=t.trackIdentifier)})));i[s]=XT(r)})),e.abrupt("return",i);case 10:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),xN=function(){var e=km(Em().mark((function e(t,r,n){var i,o,a,s,c,u;return Em().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(i=null==r?void 0:r.id,t instanceof RTCPeerConnection){e.next=3;break}return e.abrupt("return",[]);case 3:if(!aP&&!sP){e.next=10;break}return o=[],e.next=7,t.getStats(r);case 7:return e.sent.forEach((function(e){o.push(e)})),e.abrupt("return",o);case 10:return(!(a=AN.get(t))||Date.now()-a.timestamp>150)&&(a={timestamp:Date.now(),statsPromise:wN(t),extraStatsPromise:CN(t)},AN.set(t,a)),e.next=14,a.statsPromise;case 14:if(s=e.sent,c=(i?s[i]:s.all)||[],n){e.next=21;break}return e.next=19,a.extraStatsPromise;case 19:u=e.sent,c=wm(c).call(c,(i?u.getTrackStats(i):u.all)||[]);case 21:return e.abrupt("return",c);case 22:case"end":return e.stop()}}),e)})));return function(t,r,n){return e.apply(this,arguments)}}(),ON=function(e){return e.codec="codec",e.inboundRtp="inbound-rtp",e.outboundRtp="outbound-rtp",e.remoteInboundRtp="remote-inbound-rtp",e.remoteOutboundRtp="remote-outbound-rtp",e.mediaSource="media-source",e.csrc="csrc",e.peerConnection="peer-connection",e.dataChannel="data-channel",e.stream="stream",e.track="track",e.transceiver="transceiver",e.sender="sender",e.receiver="receiver",e.transport="transport",e.sctpTransport="sctp-transport",e.candidatePair="candidate-pair",e.localCandidate="local-candidate",e.remoteCandidate="remote-candidate",e.certificate="certificate",e.iceServer="ice-server",e.mediaPlayout="media-playout",e}(ON||{}),PN=["codec","inbound-rtp","outbound-rtp","remote-inbound-rtp","remote-outbound-rtp","media-source","csrc","peer-connection","data-channel","stream","track","transceiver","sender","receiver","transport","sctp-transport","candidate-pair","local-candidate","remote-candidate","certificate","ice-server"],DN={},MN={},NN={exports:{}},LN=NN.exports={v:[{name:"version",reg:/^(\d*)$/}],o:[{name:"origin",reg:/^(\S*) (\d*) (\d*) (\S*) IP(\d) (\S*)/,names:["username","sessionId","sessionVersion","netType","ipVer","address"],format:"%s %s %d %s IP%d %s"}],s:[{name:"name"}],i:[{name:"description"}],u:[{name:"uri"}],e:[{name:"email"}],p:[{name:"phone"}],z:[{name:"timezones"}],r:[{name:"repeats"}],t:[{name:"timing",reg:/^(\d*) (\d*)/,names:["start","stop"],format:"%d %d"}],c:[{name:"connection",reg:/^IN IP(\d) (\S*)/,names:["version","ip"],format:"IN IP%d %s"}],b:[{push:"bandwidth",reg:/^(TIAS|AS|CT|RR|RS):(\d*)/,names:["type","limit"],format:"%s:%s"}],m:[{reg:/^(\w*) (\d*) ([\w/]*)(?: (.*))?/,names:["type","port","protocol","payloads"],format:"%s %d %s %s"}],a:[{push:"rtp",reg:/^rtpmap:(\d*) ([\w\-.]*)(?:\s*\/(\d*)(?:\s*\/(\S*))?)?/,names:["payload","codec","rate","encoding"],format:function(e){return e.encoding?"rtpmap:%d %s/%s/%s":e.rate?"rtpmap:%d %s/%s":"rtpmap:%d %s"}},{push:"fmtp",reg:/^fmtp:(\d*) ([\S| ]*)/,names:["payload","config"],format:"fmtp:%d %s"},{name:"control",reg:/^control:(.*)/,format:"control:%s"},{name:"rtcp",reg:/^rtcp:(\d*)(?: (\S*) IP(\d) (\S*))?/,names:["port","netType","ipVer","address"],format:function(e){return null!=e.address?"rtcp:%d %s IP%d %s":"rtcp:%d"}},{push:"rtcpFbTrrInt",reg:/^rtcp-fb:(\*|\d*) trr-int (\d*)/,names:["payload","value"],format:"rtcp-fb:%s trr-int %d"},{push:"rtcpFb",reg:/^rtcp-fb:(\*|\d*) ([\w-_]*)(?: ([\w-_]*))?/,names:["payload","type","subtype"],format:function(e){return null!=e.subtype?"rtcp-fb:%s %s %s":"rtcp-fb:%s %s"}},{push:"ext",reg:/^extmap:(\d+)(?:\/(\w+))?(?: (urn:ietf:params:rtp-hdrext:encrypt))? (\S*)(?: (\S*))?/,names:["value","direction","encrypt-uri","uri","config"],format:function(e){return"extmap:%d"+(e.direction?"/%s":"%v")+(e["encrypt-uri"]?" %s":"%v")+" %s"+(e.config?" %s":"")}},{name:"extmapAllowMixed",reg:/^(extmap-allow-mixed)/},{push:"crypto",reg:/^crypto:(\d*) ([\w_]*) (\S*)(?: (\S*))?/,names:["id","suite","config","sessionConfig"],format:function(e){return null!=e.sessionConfig?"crypto:%d %s %s %s":"crypto:%d %s %s"}},{name:"setup",reg:/^setup:(\w*)/,format:"setup:%s"},{name:"connectionType",reg:/^connection:(new|existing)/,format:"connection:%s"},{name:"mid",reg:/^mid:([^\s]*)/,format:"mid:%s"},{name:"msid",reg:/^msid:(.*)/,format:"msid:%s"},{name:"ptime",reg:/^ptime:(\d*(?:\.\d*)*)/,format:"ptime:%d"},{name:"maxptime",reg:/^maxptime:(\d*(?:\.\d*)*)/,format:"maxptime:%d"},{name:"direction",reg:/^(sendrecv|recvonly|sendonly|inactive)/},{name:"icelite",reg:/^(ice-lite)/},{name:"iceUfrag",reg:/^ice-ufrag:(\S*)/,format:"ice-ufrag:%s"},{name:"icePwd",reg:/^ice-pwd:(\S*)/,format:"ice-pwd:%s"},{name:"fingerprint",reg:/^fingerprint:(\S*) (\S*)/,names:["type","hash"],format:"fingerprint:%s %s"},{push:"candidates",reg:/^candidate:(\S*) (\d*) (\S*) (\d*) (\S*) (\d*) typ (\S*)(?: raddr (\S*) rport (\d*))?(?: tcptype (\S*))?(?: generation (\d*))?(?: network-id (\d*))?(?: network-cost (\d*))?/,names:["foundation","component","transport","priority","ip","port","type","raddr","rport","tcptype","generation","network-id","network-cost"],format:function(e){var t="candidate:%s %d %s %d %s %d typ %s";return t+=null!=e.raddr?" raddr %s rport %d":"%v%v",t+=null!=e.tcptype?" tcptype %s":"%v",null!=e.generation&&(t+=" generation %d"),t+=null!=e["network-id"]?" network-id %d":"%v",t+=null!=e["network-cost"]?" network-cost %d":"%v"}},{name:"endOfCandidates",reg:/^(end-of-candidates)/},{name:"remoteCandidates",reg:/^remote-candidates:(.*)/,format:"remote-candidates:%s"},{name:"iceOptions",reg:/^ice-options:(\S*)/,format:"ice-options:%s"},{push:"ssrcs",reg:/^ssrc:(\d*) ([\w_-]*)(?::(.*))?/,names:["id","attribute","value"],format:function(e){var t="ssrc:%d";return null!=e.attribute&&(t+=" %s",null!=e.value&&(t+=":%s")),t}},{push:"ssrcGroups",reg:/^ssrc-group:([\x21\x23\x24\x25\x26\x27\x2A\x2B\x2D\x2E\w]*) (.*)/,names:["semantics","ssrcs"],format:"ssrc-group:%s %s"},{name:"msidSemantic",reg:/^msid-semantic:\s?(\w*) (\S*)/,names:["semantic","token"],format:"msid-semantic: %s %s"},{push:"groups",reg:/^group:(\w*) (.*)/,names:["type","mids"],format:"group:%s %s"},{name:"rtcpMux",reg:/^(rtcp-mux)/},{name:"rtcpRsize",reg:/^(rtcp-rsize)/},{name:"sctpmap",reg:/^sctpmap:([\w_/]*) (\S*)(?: (\S*))?/,names:["sctpmapNumber","app","maxMessageSize"],format:function(e){return null!=e.maxMessageSize?"sctpmap:%s %s %s":"sctpmap:%s %s"}},{name:"xGoogleFlag",reg:/^x-google-flag:([^\s]*)/,format:"x-google-flag:%s"},{push:"rids",reg:/^rid:([\d\w]+) (\w+)(?: ([\S| ]*))?/,names:["id","direction","params"],format:function(e){return e.params?"rid:%s %s %s":"rid:%s %s"}},{push:"imageattrs",reg:new RegExp("^imageattr:(\\d+|\\*)[\\s\\t]+(send|recv)[\\s\\t]+(\\*|\\[\\S+\\](?:[\\s\\t]+\\[\\S+\\])*)(?:[\\s\\t]+(recv|send)[\\s\\t]+(\\*|\\[\\S+\\](?:[\\s\\t]+\\[\\S+\\])*))?"),names:["pt","dir1","attrs1","dir2","attrs2"],format:function(e){return"imageattr:%s %s %s"+(e.dir2?" %s %s":"")}},{name:"simulcast",reg:new RegExp("^simulcast:(send|recv) ([a-zA-Z0-9\\-_~;,]+)(?:\\s?(send|recv) ([a-zA-Z0-9\\-_~;,]+))?$"),names:["dir1","list1","dir2","list2"],format:function(e){return"simulcast:%s %s"+(e.dir2?" %s %s":"")}},{name:"simulcast_03",reg:/^simulcast:[\s\t]+([\S+\s\t]+)$/,names:["value"],format:"simulcast: %s"},{name:"framerate",reg:/^framerate:(\d+(?:$|\.\d+))/,format:"framerate:%s"},{name:"sourceFilter",reg:/^source-filter: *(excl|incl) (\S*) (IP4|IP6|\*) (\S*) (.*)/,names:["filterMode","netType","addressTypes","destAddress","srcList"],format:"source-filter: %s %s %s %s %s"},{name:"bundleOnly",reg:/^(bundle-only)/},{name:"label",reg:/^label:(.+)/,format:"label:%s"},{name:"sctpPort",reg:/^sctp-port:(\d+)$/,format:"sctp-port:%s"},{name:"maxMessageSize",reg:/^max-message-size:(\d+)$/,format:"max-message-size:%s"},{push:"tsRefClocks",reg:/^ts-refclk:([^\s=]*)(?:=(\S*))?/,names:["clksrc","clksrcExt"],format:function(e){return"ts-refclk:%s"+(null!=e.clksrcExt?"=%s":"")}},{name:"mediaClk",reg:/^mediaclk:(?:id=(\S*))? *([^\s=]*)(?:=(\S*))?(?: *rate=(\d+)\/(\d+))?/,names:["id","mediaClockName","mediaClockValue","rateNumerator","rateDenominator"],format:function(e){var t="mediaclk:";return t+=null!=e.id?"id=%s %s":"%v%s",t+=null!=e.mediaClockValue?"=%s":"",t+=null!=e.rateNumerator?" rate=%s":"",t+=null!=e.rateDenominator?"/%s":""}},{name:"keywords",reg:/^keywds:(.+)$/,format:"keywds:%s"},{name:"content",reg:/^content:(.+)/,format:"content:%s"},{name:"bfcpFloorCtrl",reg:/^floorctrl:(c-only|s-only|c-s)/,format:"floorctrl:%s"},{name:"bfcpConfId",reg:/^confid:(\d+)/,format:"confid:%s"},{name:"bfcpUserId",reg:/^userid:(\d+)/,format:"userid:%s"},{name:"bfcpFloorId",reg:/^floorid:(.+) (?:m-stream|mstrm):(.+)/,names:["id","mStream"],format:"floorid:%s mstrm:%s"},{push:"invalid",names:["value"]}]};an(LN).forEach((function(e){LN[e].forEach((function(e){e.reg||(e.reg=/(.*)/),e.format||(e.format="%s")}))})),function(e){var t=function(e){return String(Number(e))===e?Number(e):e},r=function(e,r,n){var i=e.name&&e.names;e.push&&!r[e.push]?r[e.push]=[]:i&&!r[e.name]&&(r[e.name]={});var o=e.push?{}:i?r[e.name]:r;!function(e,r,n,i){if(i&&!n)r[i]=t(e[1]);else for(var o=0;o<n.length;o+=1)null!=e[o+1]&&(r[n[o]]=t(e[o+1]))}(n.match(e.reg),o,e.names,e.name),e.push&&r[e.push].push(o)},n=NN.exports,i=RegExp.prototype.test.bind(/^([a-z])=(.*)/);e.parse=function(e){var t,o={},a=[],s=o;return Gs(t=e.split(/(\r\n|\r|\n)/)).call(t,i).forEach((function(e){var t=e[0],i=bm(e).call(e,2);"m"===t&&(a.push({rtp:[],fmtp:[]}),s=a[a.length-1]);for(var o=0;o<(n[t]||[]).length;o+=1){var c=n[t][o];if(c.reg.test(i))return r(c,s,i)}})),o.media=a,o};var o=function(e,r){var n=r.split(/=(.+)/,2);return 2===n.length?e[n[0]]=t(n[1]):1===n.length&&r.length>1&&(e[n[0]]=void 0),e};e.parseParams=function(e){var t;return tb(t=e.split(/;\s?/)).call(t,o,{})},e.parseFmtpConfig=e.parseParams,e.parsePayloads=function(e){var t;return JE(t=e.toString().split(" ")).call(t,Number)},e.parseRemoteCandidates=function(e){for(var r,n=[],i=JE(r=e.split(" ")).call(r,t),o=0;o<i.length;o+=3)n.push({component:i[o],ip:i[o+1],port:i[o+2]});return n},e.parseImageAttributes=function(e){var t;return JE(t=e.split(" ")).call(t,(function(e){var t;return tb(t=e.substring(1,e.length-1).split(",")).call(t,o,{})}))},e.parseSimulcastStreamList=function(e){var r;return JE(r=e.split(";")).call(r,(function(e){var r;return JE(r=e.split(",")).call(r,(function(e){var r,n=!1;return"~"!==e[0]?r=t(e):(r=t(e.substring(1,e.length)),n=!0),{scid:r,paused:n}}))}))}}(MN);var UN=NN.exports,VN=/%[sdv%]/g,FN=function(e){var t=1,r=arguments,n=r.length;return e.replace(VN,(function(e){if(t>=n)return e;var i=r[t];switch(t+=1,e){case"%%":return"%";case"%s":return String(i);case"%d":return Number(i);case"%v":return""}}))},BN=function(e,t,r){var n=[e+"="+(t.format instanceof Function?t.format(t.push?r:r[t.name]):t.format)];if(t.names)for(var i=0;i<t.names.length;i+=1){var o=t.names[i];t.name?n.push(r[t.name][o]):n.push(r[t.names[i]])}else n.push(r[t.name]);return FN.apply(null,n)},jN=["v","o","s","i","u","e","p","c","b","t","r","z","a"],GN=["i","c","b","a"],HN=MN,zN=function(e,t){t=t||{},null==e.version&&(e.version=0),null==e.name&&(e.name=" "),e.media.forEach((function(e){null==e.payloads&&(e.payloads="")}));var r=t.outerOrder||jN,n=t.innerOrder||GN,i=[];return r.forEach((function(t){UN[t].forEach((function(r){r.name in e&&null!=e[r.name]?i.push(BN(t,r,e)):r.push in e&&null!=e[r.push]&&e[r.push].forEach((function(e){i.push(BN(t,r,e))}))}))})),e.media.forEach((function(e){i.push(BN("m",UN.m[0],e)),n.forEach((function(t){UN[t].forEach((function(r){r.name in e&&null!=e[r.name]?i.push(BN(t,r,e)):r.push in e&&null!=e[r.push]&&e[r.push].forEach((function(e){i.push(BN(t,r,e))}))}))}))})),i.join("\r\n")+"\r\n"};DN.write=zN,DN.parse=HN.parse,DN.parseParams=HN.parseParams,DN.parseFmtpConfig=HN.parseFmtpConfig,DN.parsePayloads=HN.parsePayloads,DN.parseRemoteCandidates=HN.parseRemoteCandidates,DN.parseImageAttributes=HN.parseImageAttributes,DN.parseSimulcastStreamList=HN.parseSimulcastStreamList;var KN=new uO("FirefoxHandler",3),XN=Math.pow(2,32),WN="kp34Za0H+aVf862l",qN="o/i14u9pJrxRKAsu";function YN(e){return e>XN-18?(KN.print("generateAllSsrc","reset start id",e),YN(e=e-XN+1e4+18)):{audio:e,audioFec:e+1,audioRtx:e+2,video:e+3,videoFec:e+4,videoRtx:e+5,next:e+18}}var JN=function(e,t,r){var n,i,o,a=arguments.length>3&&void 0!==arguments[3]?arguments[3]:qN;return[{id:r,attribute:"cname",value:a},{id:r,attribute:"msid",value:wm(n=wm(i="".concat(e," ")).call(i,e,"-")).call(n,t)},{id:r,attribute:"mslabel",value:"".concat(e)},{id:r,attribute:"label",value:wm(o="".concat(e,"-")).call(o,t)}]},QN=function(e,t){var r,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},i=t.video,o=t.videoRtx,a=t.videoFec,s=[i,o],c=n.cname,u=n.flexfec;u&&s.push(a);var d,l=tb(s).call(s,(function(t,r){return wm(t).call(t,JN(e,"video",r,c))}),[]),h=[{semantics:"FID",ssrcs:wm(r="".concat(i," ")).call(r,o)}];u&&h.push({semantics:"FEC-FR",ssrcs:wm(d="".concat(i," ")).call(d,a)});return{ssrcs:l,ssrcGroups:h}};function ZN(e){return e.direction="inactive",e.port=0,delete e.ext,delete e.ssrcs,delete e.ssrcGroups,delete e.simulcast,delete e.simulcast_03,delete e.rids,delete e.extmapAllowMixed,delete e.bundleOnly,e}var $N=function(e,t,r){var n=!(arguments.length>3&&void 0!==arguments[3])||arguments[3],i=ud(ud({},e),{},{media:[]});return n&&(i.invalid=[{value:"realx-exts:rscp"}]),t&&i.media.push(t),r&&i.media.push(r),delete i.groups,delete i.msidSemantic,DN.write(i)};function eL(e){return tL.apply(this,arguments)}function tL(){return(tL=km(Em().mark((function e(t){var r,n,i,o,a;return Em().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r={},n=t.publicIPs,i=t.certFingerprint,o=t.iceParams,a=t.iceConfig,r.fingerprint={type:"sha-256",hash:i},r.icePwd=o.serverIcePwd,e.next=6,nL(o.serverIceUfrag);case 6:return r.iceUfrag=e.sent,r.candidates=rL(n,a),r.setup="active",r.iceOptions="renomination",e.abrupt("return",r);case 11:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function rL(e,t){if(!Array.isArray(e))return[];var r=0,n=2130706431,i=[];return e.forEach((function(e){var o={component:1,ip:e.ip,type:"host",generation:e.generation};e.udpPorts&&!t.tcpOnly&&e.udpPorts.forEach((function(e){i.push(ud(ud({},o),{},{foundation:r++,transport:"udp",port:e,priority:n}))})),e.tcpPorts&&e.tcpPorts.forEach((function(e){i.push(ud(ud({},o),{},{foundation:r++,transport:"tcp",port:e,tcptype:"passive",priority:2130705431}))}))})),i}var nL=function(){var e=km(Em().mark((function e(t){var r,n,i,o,a,s,c,u;return Em().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=new TextEncoder,i=n.encode("PREC"),e.t0=Uint8Array,e.next=5,DO.b64str2ab(t);case 5:return e.t1=e.sent,o=new e.t0(e.t1),a=bm(r=n.encode(Date.now().toString())).call(r,-4),(s=new Uint8Array(2))[0]=0,s[1]=1,c=PO(Uint8Array,i,o,a,s),e.next=14,DO.ab2b64str(c.buffer);case 14:return u=e.sent,e.abrupt("return",u);case 16:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),iL=function(e,t){var r=0;if(Array.isArray(e.fmtp)&&Array.isArray(e.rtp)){var n,i=Jk(e.fmtp);try{for(i.s();!(n=i.n()).done;){var o,a,s,c=n.value;if(vT(o=c.config).call(o,"level-asymmetry-allowed=1")&&vT(a=c.config).call(a,"packetization-mode=1")&&vT(s=c.config).call(s,"profile-level-id=42e01f")){r=c.payload;break}}}catch(_){i.e(_)}finally{i.f()}for(var u=0;u<e.rtp.length;u++){var d=e.rtp[u];if("H264"===t){if(d.payload===r){var l;e.rtp.unshift(zE(l=e.rtp).call(l,u,1)[0]);break}}else if(d.codec===t){var h;e.rtp.unshift(zE(h=e.rtp).call(h,u,1)[0]);break}}var p=[];e.rtp.forEach((function(e){return p.push(e.payload)})),e.payloads=p.join(" ")}},oL=new uO("BasicHandler",3),aL=function(e){xI(n,e);var t,r=WI(n);function n(e,t){var i;return Yd(this,n),sd(Zk(i=r.call(this)),"_peerConnection",void 0),sd(Zk(i),"_dataChannel",void 0),sd(Zk(i),"_context",void 0),sd(Zk(i),"peerConnectionMode",0),sd(Zk(i),"peerConnectionId",""),sd(Zk(i),"id",void 0),sd(Zk(i),"_monitor",void 0),sd(Zk(i),"_nextSsrc",Math.floor(Math.random()*XN+1e4)),sd(Zk(i),"_aSendonlyAnswerTpl",void 0),sd(Zk(i),"_vSendonlyAnswerTpl",void 0),sd(Zk(i),"_enableSubFlexfec",!1),sd(Zk(i),"audioTrack4ff",void 0),sd(Zk(i),"setLocalDescription",void 0),sd(Zk(i),"setRemoteDescription",void 0),i.peer=t,i.id=e.id,i._monitor=EO(i.id),i._peerConnection=t.getOriginRTCPeerConnection(),i._dataChannel=t.getOriginRTCDataChannel(),i.setLocalDescription=t.setLocalDescription.bind(t),i.setRemoteDescription=t.setRemoteDescription.bind(t),i._context=e,i.peer.on("ontrack",(function(e){i.emit("ontrack",e)})),i}return qd(n,[{key:"destroy",value:function(){oL.print("destroy",this.peerConnectionId||""),CI(RI(n.prototype),"removeAllListeners",this).call(this)}},{key:"getTransceivers",value:function(){return this._peerConnection.getTransceivers()}},{key:"_simulcast",value:function(e,t,r,n,i){var o,a,s,c=[];1===e.videoEncodeConfig.length?(c=function(e,t){var r=[];if(t<=1)return r;var n=Math.min(e.width,e.height)/90;return r.push({scaleResolutionDownBy:n,width:Math.floor(e.width/n),height:Math.floor(e.height/n),maxkbps:100,frameRate:10}),t<=2||r.unshift({scaleResolutionDownBy:2,width:Math.floor(e.width/2),height:Math.floor(e.height/2),maxkbps:Math.floor(e.maxKbps/2),frameRate:e.frameRate>=30?Math.floor(e.frameRate/2):e.frameRate}),r}(t,i),oL.print("simulcast() ","simulcastLayers: %o",c)):(c=JE(o=bm(a=bm(s=e.videoEncodeConfig).call(s,1)).call(a,1-i)).call(o,(function(e){var r=rP(e.width),n=t.width/r;return{width:r,height:Math.floor(t.height/n),scaleResolutionDownBy:n,frameRate:rP(e.frameRate)||15,maxkbps:e.maxKbps||600}})),oL.print("simulcast() ","simulcastLayers2: %o",c));var u=[!0];c.forEach((function(e,t){var i,o={maxBitrate:1e3*e.maxkbps,scaleResolutionDownBy:e.scaleResolutionDownBy,rid:"".concat(t+1),maxFramerate:e.frameRate};null===(i=r.sendEncodings)||void 0===i||i.unshift(o),n.push({width:e.width,height:e.height,framerate:e.frameRate,maxkbps:e.maxkbps,rid:"".concat(t+1)}),u.push(!0)})),this._context&&(this._context.activeSimStreams=u)}},{key:"internalPublish",value:function(e){var t=e.stream,r=e.videoTrack,n=e.audioTrack,i=e.enableSimulcast,o=e.pubAudio,a=e.pubVideo,s={direction:"sendonly",streams:[t]},c={direction:"sendonly",streams:[t]},u=[],d=[];if(Array.isArray(null==e?void 0:e.videoEncodeConfig)&&e.videoEncodeConfig.length){var l=null==r?void 0:r.getTrack(),h=ud({},qP);if(l){var p=null==l?void 0:l.getSettings();h={width:Math.floor(p.width),height:Math.floor(p.height),frameRate:Math.floor(p.frameRate)}}"number"!=typeof h.frameRate&&(h.frameRate=30);var _=null==e?void 0:e.videoEncodeConfig[0],v={maxBitrate:1e3*_.maxKbps,rid:"0"};if(e.prevBitrate=_.maxKbps,c.sendEncodings=[v],u.push({width:h.width,height:h.height,framerate:h.frameRate,maxkbps:_.maxKbps,rid:"0"}),!aP&&i){var f,m,g=function(e){for(var t=0,r=e.width*e.height,n=0;n<MD.length;n++)if(r>=MD[n].totalPixels){t=n;break}if(0===t)return MD[t].maxLayers;var i=MD[t-1].totalPixels;return(i-r)/(i-MD[t].totalPixels)<.1?MD[t-1].maxLayers:MD[t].maxLayers}(h);if(oL.print("simulcast() ","maxLayers: %o",g),g>1)this._simulcast(e,ud(ud({},h),{},{maxKbps:_.maxKbps}),c,u,g),null!==(f=this._context)&&void 0!==f&&null!==(m=f.serverConfig)&&void 0!==m&&m.simulcastOnDemand&&(d=JE(u).call(u,(function(e,t){return ud(ud({},e),{},{video_index:t,sub_index:t})})))}}oL.print("publish videoTransceiverInit videoDescriptions","",c,u);var y=null==n?void 0:n.getTrack("preprocessing");(null==n?void 0:n.mixType)!==Hd.PLAYOUT&&null!=n&&n.mixedAudioTrack&&(y=null==n?void 0:n.mixedAudioTrack),y=o&&y?y:"audio";var S=null==r?void 0:r.getTrack("preprocessing");S=a&&S?S:"video";try{this._reportRtcInvokeStatus("Handler.internalPublish",eT({aTrack:ZO(y),vTrack:ZO(S),audioTransceiverInit:s,videoTransceiverInit:c}))}catch(HX){}return{semantics:"unified-plan",videoDescriptions:u,subVideoDescriptions:d,audioTransceiverInit:{track:y,init:s},videoTransceiverInit:{track:S,init:c}}}},{key:"updateMaxBitrate",value:function(e){var t,r,n,i;oL.print("updateMaxBitrate()");var o=null===(t=e.videoTrack)||void 0===t?void 0:t.getTrack(),a=e.videoTransceiver;if(o&&e.pubVideo&&a){var s=null===(r=e.videoEncodeConfig)||void 0===r||null===(n=r[0])||void 0===n?void 0:n.maxKbps;if(s){if(s===e.prevBitrate)return void oL.print("updateMaxBitrate()","no change");e.prevBitrate=s}var c=null===(i=a.sender)||void 0===i?void 0:i.getParameters();if(c){var u;c.encodings=null==c||null===(u=c.encodings)||void 0===u?void 0:JE(u).call(u,(function(t){var r,n=+t.rid||0,i=null===(r=e.videoEncodeConfig[n])||void 0===r?void 0:r.maxKbps;return"number"==typeof i&&(t.maxBitrate=1e3*i),t})),null==a||a.sender.setParameters(c);try{this._reportRtcInvokeStatus("Handler.updateScaleResolutionDownBy",eT(c.encodings))}catch(HX){}}}else oL.print("updateMaxBitrate()","no pub")}},{key:"getStats",value:function(e,t){return xN(this._peerConnection,e,t)}},{key:"setCurrentDescription",value:(t=km(Em().mark((function e(){return Em().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:case"end":return e.stop()}}),e)}))),function(){return t.apply(this,arguments)})},{key:"createAVMlineAnswerTpl",value:function(e){var t=this;DN.parse(e).media.forEach((function(e){if("audio"===e.type){if("sendonly"===e.direction){var r,n=null==e?void 0:sE(r=e.rtp).call(r,(function(e){return"opus"===e.codec}));if(n&&null!=e&&e.fmtp){var i,o=null==e?void 0:sE(i=e.fmtp).call(i,(function(e){return e.payload===n.payload}));o&&t._context&&(o.config+=";stereo=1;sprop-stereo=1")}t._aSendonlyAnswerTpl=e}}else"video"===e.type&&("sendonly"===e.direction&&(t._vSendonlyAnswerTpl=e),Array.isArray(e.rtp)&&e.rtp.forEach((function(e){var r;null!==(r=e.codec)&&void 0!==r&&vT(r).call(r,"flexfec")&&(t._enableSubFlexfec=!0)})))}))}},{key:"pc",get:function(){return this._peerConnection}},{key:"addBitrateLimit",value:function(e,t){null==e||e.rtp.forEach((function(r){var n,i=r.codec,o=r.payload;if(vT(n=["vp8","h264"]).call(n,i.toLocaleLowerCase())){var a,s,c=sE(a=e.fmtp).call(a,(function(e){return e.payload===o}));if(c)c.config=wm(s=[]).call(s,qT(c.config.split(";")),["x-google-min-bitrate=100","x-google-start-bitrate=".concat(t)]).join(";");else e.fmtp.push({payload:o,config:"x-google-min-bitrate=100;x-google-start-bitrate=".concat(t)})}}))}},{key:"_report",value:function(e,t,r){var n;null===(n=this._monitor)||void 0===n||n.report(e,ud(ud({},t),{},{connection_id:this.peer.getConnectionId(),group_connection_id:this.peer.getGroupConnectionId()}),r)}},{key:"_reportRtcInvokeStatus",value:function(e,t){var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"",i=arguments.length>4?arguments[4]:void 0;this._report("rtc_invoke_status",{sdk_api_name:e,message:t,error_code:r,stream_id:n,elapse:0},i)}}]),n}(gD.exports.EventEmitter),sL=E,cL=Fg,uL=Zm.exports.getWeakData,dL=vp,lL=tr,hL=z,pL=$,_L=Nh,vL=Ye,fL=Zi.set,mL=Zi.getterFor,gL=Mo.find,yL=Mo.findIndex,SL=sL([].splice),bL=0,EL=function(e){return e.frozen||(e.frozen=new TL)},TL=function(){this.entries=[]},kL=function(e,t){return gL(e.entries,(function(e){return e[0]===t}))};TL.prototype={get:function(e){var t=kL(this,e);if(t)return t[1]},has:function(e){return!!kL(this,e)},set:function(e,t){var r=kL(this,e);r?r[1]=t:this.entries.push([e,t])},delete:function(e){var t=yL(this.entries,(function(t){return t[0]===e}));return~t&&SL(this.entries,t,1),!!~t}};var IL,RL={getConstructor:function(e,t,r,n){var i=e((function(e,i){dL(e,o),fL(e,{type:t,id:bL++,frozen:void 0}),hL(i)||_L(i,e[n],{that:e,AS_ENTRIES:r})})),o=i.prototype,a=mL(t),s=function(e,t,r){var n=a(e),i=uL(lL(t),!0);return!0===i?EL(n).set(t,r):i[n.id]=r,e};return cL(o,{delete:function(e){var t=a(this);if(!pL(e))return!1;var r=uL(e);return!0===r?EL(t).delete(e):r&&vL(r,t.id)&&delete r[t.id]},has:function(e){var t=a(this);if(!pL(e))return!1;var r=uL(e);return!0===r?EL(t).has(e):r&&vL(r,t.id)}}),cL(o,r?{get:function(e){var t=a(this);if(pL(e)){var r=uL(e);return!0===r?EL(t).get(e):r?r[t.id]:void 0}},set:function(e,t){return s(this,e,t)}}:{add:function(e){return s(this,e,!0)}}),i}},AL=n,CL=E,wL=Fg,xL=Zm.exports,OL=Ug,PL=RL,DL=$,ML=og,NL=Zi.enforce,LL=Vi,UL=!AL.ActiveXObject&&"ActiveXObject"in AL,VL=function(e){return function(){return e(this,arguments.length?arguments[0]:void 0)}},FL=OL("WeakMap",VL,PL);if(LL&&UL){IL=PL.getConstructor(VL,"WeakMap",!0),xL.enable();var BL=FL.prototype,jL=CL(BL.delete),GL=CL(BL.has),HL=CL(BL.get),zL=CL(BL.set);wL(BL,{delete:function(e){if(DL(e)&&!ML(e)){var t=NL(this);return t.frozen||(t.frozen=new IL),jL(this,e)||t.frozen.delete(e)}return jL(this,e)},has:function(e){if(DL(e)&&!ML(e)){var t=NL(this);return t.frozen||(t.frozen=new IL),GL(this,e)||t.frozen.has(e)}return GL(this,e)},get:function(e){if(DL(e)&&!ML(e)){var t=NL(this);return t.frozen||(t.frozen=new IL),GL(this,e)?HL(this,e):t.frozen.get(e)}return HL(this,e)},set:function(e,t){if(DL(e)&&!ML(e)){var r=NL(this);r.frozen||(r.frozen=new IL),GL(this,e)?zL(this,e,t):r.frozen.set(e,t)}else zL(this,e,t);return this}})}var KL=ee.WeakMap;Ar({target:"WeakMap",proto:!0,real:!0,forced:!0},{emplace:yy}),Ar({target:"WeakMap",stat:!0,forced:!0},{from:uy}),Ar({target:"WeakMap",stat:!0,forced:!0},{of:ly}),Ar({target:"WeakMap",proto:!0,real:!0,forced:!0},{deleteAll:vy}),Ar({target:"WeakMap",proto:!0,real:!0,forced:!0},{upsert:BS});var XL=KL,WL=function(e){xI(p,e);var t,r,n,i,o,a,s,c,u,d,l,h=WI(p);function p(){var e,t,r;return Yd(this,p),sd(Zk(r=h.call(this)),"inited",!1),sd(Zk(r),"deviceMap",{audioinput:new jS,audiooutput:new jS,videoinput:new jS}),sd(Zk(r),"checkDeviceChangeTimer",null),sd(Zk(r),"isSupportedPermissionsQuery",!1),sd(Zk(r),"isGrantedMicrophonePermission",!1),sd(Zk(r),"isGrantedCameraPermission",!1),r.isSupportedPermissionsQuery=!nP()&&!(null===(e=navigator)||void 0===e||null===(t=e.permissions)||void 0===t||!t.query),r._handleDeviceChange=r._handleDeviceChange.bind(Zk(r)),!nP()&&r.refreshDevices(),r}return qd(p,[{key:"refreshDevices",value:(l=km(Em().mark((function e(){var t,r,n=this;return Em().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(navigator.mediaDevices){e.next=2;break}return e.abrupt("return");case 2:if(t=void 0,!aP){e.next=12;break}return e.prev=4,e.next=7,navigator.mediaDevices.getUserMedia({audio:!0});case 7:t=e.sent,e.next=12;break;case 10:e.prev=10,e.t0=e.catch(4);case 12:return e.next=14,navigator.mediaDevices.enumerateDevices();case 14:r=e.sent,t&&t.getTracks().forEach((function(e){return e.stop()})),r.forEach((function(e){var t;e.deviceId&&(null===(t=n.deviceMap[e.kind])||void 0===t||t.set(e.deviceId,e))})),this.inited||this.initListener(),this.inited=!0;case 19:case"end":return e.stop()}}),e,this,[[4,10]])}))),function(){return l.apply(this,arguments)})},{key:"initListener",value:(d=km(Em().mark((function e(){var t,r,n,i,o=this;return Em().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(void 0!==(null===(t=navigator.mediaDevices)||void 0===t?void 0:t.ondevicechange)&&"function"==typeof(null===(r=navigator.mediaDevices)||void 0===r?void 0:r.addEventListener)?navigator.mediaDevices.addEventListener("devicechange",(function(){o._handleDeviceChange(),setTimeout((function(){o._handleDeviceChange()}),300)})):this.checkDeviceChangeTimer=window.setInterval((function(){o._handleDeviceChange()}),3e3),!this.isSupportedPermissionsQuery){e.next=22;break}return e.prev=2,e.next=5,navigator.permissions.query({name:"microphone"});case 5:n=e.sent,this.isGrantedMicrophonePermission="granted"===n.state,n.addEventListener("change",(function(){o.isGrantedMicrophonePermission="granted"===n.state})),e.next=12;break;case 10:e.prev=10,e.t0=e.catch(2);case 12:return e.prev=12,e.next=15,navigator.permissions.query({name:"camera"});case 15:i=e.sent,this.isGrantedCameraPermission="granted"===i.state,i.addEventListener("change",(function(){o.isGrantedCameraPermission="granted"===i.state})),e.next=22;break;case 20:e.prev=20,e.t1=e.catch(12);case 22:case"end":return e.stop()}}),e,this,[[2,10],[12,20]])}))),function(){return d.apply(this,arguments)})},{key:"_handleDeviceChange",value:(u=km(Em().mark((function e(){var t,r,n,i,o,a,s,c=this;return Em().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(o=void 0,!aP){e.next=5;break}return e.next=4,navigator.mediaDevices.getUserMedia({audio:!0});case 4:o=e.sent;case 5:return e.next=7,navigator.mediaDevices.enumerateDevices();case 7:a=e.sent,a=Gs(a).call(a,(function(e){return!!e.deviceId})),o&&o.getTracks().forEach((function(e){return e.stop()})),s=XT(wm(t=[]).call(t,qT(tR(r=this.deviceMap.audioinput).call(r)),qT(tR(n=this.deviceMap.videoinput).call(n)),qT(tR(i=this.deviceMap.audiooutput).call(i)))),(mP||_P)&&!s.length&&a.length&&a.forEach((function(e){var t;null===(t=c.deviceMap[e.kind])||void 0===t||t.set(e.deviceId,e)})),a.forEach((function(e){var t,r,n=c.deviceMap[e.kind].get(e.deviceId);c.deviceMap[e.kind].set(e.deviceId,e),n||(vT(t=e.kind).call(t,"video")?c.emit(Xd.onVideoDeviceStateChanged,{mediaDeviceInfo:e,deviceState:"active"}):vT(r=e.kind).call(r,"audio")&&c.emit(Xd.onAudioDeviceStateChanged,{mediaDeviceInfo:e,deviceState:"active"}))})),s.forEach((function(e){var t,r;sE(a).call(a,(function(t){return t.deviceId===e.deviceId&&t.kind===e.kind}))||(c.deviceMap[e.kind].delete(e.deviceId),vT(t=e.kind).call(t,"video")?c.emit(Xd.onVideoDeviceStateChanged,{mediaDeviceInfo:e,deviceState:"inactive"}):vT(r=e.kind).call(r,"audio")&&c.emit(Xd.onAudioDeviceStateChanged,{mediaDeviceInfo:e,deviceState:"inactive"}))}));case 14:case"end":return e.stop()}}),e,this)}))),function(){return u.apply(this,arguments)})},{key:"getUserMedia",value:(c=km(Em().mark((function e(t){var r;return Em().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,navigator.mediaDevices.getUserMedia(t);case 2:return r=e.sent,null!=t&&t.audio&&(this.isGrantedMicrophonePermission=!0),null!=t&&t.video&&(this.isGrantedCameraPermission=!0),this.refreshDevices(),e.abrupt("return",r);case 7:case"end":return e.stop()}}),e,this)}))),function(e){return c.apply(this,arguments)})},{key:"checkPermissionsByDevices",value:(s=km(Em().mark((function e(){var t,r;return Em().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t={audio:!1,video:!1},navigator.mediaDevices){e.next=3;break}return e.abrupt("return",t);case 3:return e.next=5,navigator.mediaDevices.enumerateDevices();case 5:return r=e.sent,t.audio=Gs(r).call(r,(function(e){return"audioinput"===e.kind&&e.label&&e.deviceId})).length>0,t.video=Gs(r).call(r,(function(e){return"videoinput"===e.kind&&e.label&&e.deviceId})).length>0,e.abrupt("return",t);case 9:case"end":return e.stop()}}),e)}))),function(){return s.apply(this,arguments)})},{key:"getPermissions",value:(a=km(Em().mark((function e(){var t,r,n,i,o,a,s,c=this,u=arguments;return Em().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(r=u.length>0&&void 0!==u[0]?u[0]:{},n=r.audio,i=r.video,o=r.force,n||i||(n=!0,i=!0),a={audio:!1,video:!1},o){e.next=30;break}if(!this.isSupportedPermissionsQuery){e.next=20;break}if(!n||!i){e.next=14;break}if(!this.isGrantedMicrophonePermission||!this.isGrantedCameraPermission){e.next=12;break}return a.audio=!0,a.video=!0,e.abrupt("return",a);case 12:e.next=18;break;case 14:if(!(n&&this.isGrantedMicrophonePermission||i&&this.isGrantedCameraPermission)){e.next=18;break}return a.audio=this.isGrantedMicrophonePermission,a.video=this.isGrantedCameraPermission,e.abrupt("return",a);case 18:case 26:e.next=30;break;case 20:return e.next=22,this.checkPermissionsByDevices();case 22:if(s=e.sent,!n||!i){e.next=28;break}if(!s.audio||!s.video){e.next=26;break}return e.abrupt("return",s);case 28:if(!(n&&s.audio||i&&s.video)){e.next=30;break}return e.abrupt("return",s);case 30:if(null===(t=navigator.mediaDevices)||void 0===t||!t.getUserMedia){e.next=33;break}return e.next=33,navigator.mediaDevices.getUserMedia({audio:n,video:i}).then((function(e){e&&(e.getTracks().forEach((function(e){return e.stop()})),n&&(a.audio=!0,c.isGrantedMicrophonePermission=!0),i&&(a.video=!0,c.isGrantedCameraPermission=!0))})).catch((function(){}));case 33:return e.next=35,this.refreshDevices();case 35:return e.abrupt("return",a);case 36:case"end":return e.stop()}}),e,this)}))),function(){return a.apply(this,arguments)})},{key:"enumerateDevices",value:(o=km(Em().mark((function e(){var t,r,n,i;return Em().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.getPermissions();case 2:return e.next=4,this.refreshDevices();case 4:return e.abrupt("return",XT(wm(t=[]).call(t,qT(tR(r=this.deviceMap.audioinput).call(r)),qT(tR(n=this.deviceMap.videoinput).call(n)),qT(tR(i=this.deviceMap.audiooutput).call(i)))));case 5:case"end":return e.stop()}}),e,this)}))),function(){return o.apply(this,arguments)})},{key:"enumerateAudioCaptureDevices",value:(i=km(Em().mark((function e(){var t;return Em().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.getPermissions({audio:!0});case 2:return e.next=4,this.refreshDevices();case 4:return e.abrupt("return",XT(tR(t=this.deviceMap.audioinput).call(t)));case 5:case"end":return e.stop()}}),e,this)}))),function(){return i.apply(this,arguments)})},{key:"enumerateVideoCaptureDevices",value:(n=km(Em().mark((function e(){var t;return Em().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.getPermissions({video:!0});case 2:return e.next=4,this.refreshDevices();case 4:return e.abrupt("return",XT(tR(t=this.deviceMap.videoinput).call(t)));case 5:case"end":return e.stop()}}),e,this)}))),function(){return n.apply(this,arguments)})},{key:"enumerateAudioPlaybackDevices",value:(r=km(Em().mark((function e(){var t;return Em().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.getPermissions({audio:!0});case 2:return e.next=4,this.refreshDevices();case 4:return e.abrupt("return",XT(tR(t=this.deviceMap.audiooutput).call(t)));case 5:case"end":return e.stop()}}),e,this)}))),function(){return r.apply(this,arguments)})},{key:"getDeviceById",value:(t=km(Em().mark((function e(t){var r;return Em().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.enumerateDevices();case 2:return r=e.sent,e.abrupt("return",sE(r).call(r,(function(e){return e.deviceId===t})));case 4:case"end":return e.stop()}}),e,this)}))),function(e){return t.apply(this,arguments)})}]),p}(bD),qL=new WL;!nP()&&(window.__rtc_dd__=qL);var YL=new uO("InternalEventBus",1),JL=function(e){return e.ON_IOS_INTERRUPTION_START="ON_IOS_INTERRUPTION_START",e.ON_IOS_INTERRUPTION_END="ON_IOS_INTERRUPTION_END",e.ON_IOS_LOCAL_TRACK_MUTE="ON_IOS_LOCAL_TRACK_MUTE",e.ON_IOS_LOCAL_TRACK_UNMUTE="ON_IOS_LOCAL_TRACK_UNMUTE",e}(JL||{}),QL=function(e){xI(r,e);var t=WI(r);function r(){return Yd(this,r),t.apply(this,arguments)}return qd(r,[{key:"emit",value:function(e){var t,n;YL.print(e);for(var i=arguments.length,o=new Array(i>1?i-1:0),a=1;a<i;a++)o[a-1]=arguments[a];return(t=CI(RI(r.prototype),"emit",this)).call.apply(t,wm(n=[this,e]).call(n,o))}}]),r}(gD.exports.EventEmitter),ZL=new QL,$L=new uO("AudioContext",1),eU=function(){function e(){var t=this;Yd(this,e),sd(this,"_audioContextInstance",void 0),sd(this,"_previousState",""),sd(this,"_currentState",""),sd(this,"_contextStuckAt",0);var r=0;nP()||setInterval((function(){if(t._audioContextInstance){var e=t._audioContextInstance.currentTime;t._contextStuckAt?t._contextStuckAt!==e&&(t._contextStuckAt=0,$L.print("currentTime resume"),SO("currentTime resume","")):e&&r===e&&(t._contextStuckAt=e,$L.print("currentTime stuck",t._contextStuckAt),t._audioContextInstance.suspend(),t._audioContextInstance.resume(),SO("AudioContext currentTime stuck",t._contextStuckAt)),r=e}}),3e3)}return qd(e,[{key:"getAudioContextInstance",value:function(){var e=this;if(!this._audioContextInstance){var t=window.AudioContext||window.webkitAudioContext;this._audioContextInstance=new t,this._audioContextInstance.onstatechange=function(){var t,r,n;$L.print("state change",null===(t=e._audioContextInstance)||void 0===t?void 0:t.state),e._previousState=e._currentState,e._currentState=(null===(r=e._audioContextInstance)||void 0===r?void 0:r.state)||"","interrupted"===(null===(n=e._audioContextInstance)||void 0===n?void 0:n.state)&&e._audioContextInstance.resume(),(gP||_P)&&("running"===e._previousState&&"interrupted"===e._currentState&&ZL.emit(JL.ON_IOS_INTERRUPTION_START),"interrupted"===e._previousState&&"running"===e._currentState&&ZL.emit(JL.ON_IOS_INTERRUPTION_END))}}return this._audioContextInstance}}]),e}(),tU=function(){function e(t){Yd(this,e),sd(this,"_ctx",void 0),sd(this,"_analyserNode",void 0),sd(this,"_audioSource",void 0);var r=rU.getAudioContextInstance();if(t instanceof MediaStreamTrack){var n=new MediaStream;n.addTrack(t),this._audioSource=r.createMediaStreamSource(n)}else this._audioSource=r.createMediaElementSource(t),this._audioSource.connect(r.destination);var i=r.createAnalyser();this._audioSource.connect(i),this._analyserNode=i,this._ctx=r}var t;return qd(e,[{key:"getAudioLevel",value:function(){var e;"suspended"===(null===(e=this._ctx)||void 0===e?void 0:e.state)&&this._ctx.resume();var t=new Uint8Array(2048);this._analyserNode.getByteTimeDomainData(t);var r=0;t.forEach((function(e){return r=Math.max(r,Math.abs(e-128))}));var n=r/128*255;return n>2?n:0}},{key:"resume",value:(t=km(Em().mark((function e(){var t;return Em().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,null===(t=this._ctx)||void 0===t?void 0:t.resume();case 2:case"end":return e.stop()}}),e,this)}))),function(){return t.apply(this,arguments)})},{key:"destroy",value:function(){this._audioSource.disconnect(),this._analyserNode.disconnect()}}]),e}(),rU=new eU,nU=function(e){return e[e.CAPTURE=0]="CAPTURE",e[e.PRE_PROCESSING=1]="PRE_PROCESSING",e[e.ENCODE=2]="ENCODE",e[e.TRANSFER=3]="TRANSFER",e[e.POST_PROCESSING=4]="POST_PROCESSING",e[e.DECODE=5]="DECODE",e[e.RENDERING=6]="RENDERING",e}(nU||{}),iU=function(){function e(t){Yd(this,e),sd(this,"_plugins",new jS),this.id=t}var t;return qd(e,[{key:"register",value:function(e){var t=this._plugins.get(e.type)||[];if(WR(t).call(t,(function(t){return t.name===e.name}))>-1)throw new Error("Failed to register ".concat(e.name,": name is repeated."));t.push(e),this._plugins.set(e.type,t)}},{key:"getPluginsByType",value:function(e){return this._plugins.get(e)||[]}},{key:"getPluginByName",value:function(e,t){var r;return sE(r=this._plugins.get(e)||[]).call(r,(function(e){return e.name===t}))}},{key:"getPreProcessingTrack",value:(t=km(Em().mark((function e(t){var r,n,i,o,a;return Em().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:r=this._plugins.get(1)||[],n=t.getTrack(),i=Jk(r),e.prev=3,i.s();case 5:if((o=i.n()).done){e.next=12;break}return a=o.value,e.next=9,a.effect(t,n);case 9:n=e.sent;case 10:e.next=5;break;case 12:e.next=17;break;case 14:e.prev=14,e.t0=e.catch(3),i.e(e.t0);case 17:return e.prev=17,i.f(),e.finish(17);case 20:return e.abrupt("return",n);case 21:case"end":return e.stop()}}),e,this,[[3,14,17,20]])}))),function(e){return t.apply(this,arguments)})},{key:"destroy",value:function(){this._plugins.forEach((function(e){e.forEach((function(e){return e.destroy()}))})),this._plugins.clear()}}]),e}(),oU=function(e){return e[e.EXTERNAL=0]="EXTERNAL",e[e.INTERNAL=1]="INTERNAL",e}(oU||{}),aU=new uO("VERTC",0),sU=new XL,cU=function(e){xI(r,e);var t=WI(r);function r(e,n){var i;return Yd(this,r),sd(Zk(i=t.call(this)),"sourceType",1),sd(Zk(i),"mediaType",void 0),sd(Zk(i),"_trackId",void 0),sd(Zk(i),"_ac",void 0),sd(Zk(i),"_sourceNode",void 0),sd(Zk(i),"_gainNode",void 0),sd(Zk(i),"_destNode",void 0),sd(Zk(i),"_channelCount",void 0),i._trackId=e,i.mediaType=n,"audio"===n&&IN()&&!XP("SKIP_WEB_AUDIO_IN_TRACK")&&(i._ac=rU.getAudioContextInstance(),i._gainNode=i._ac.createGain(),i._destNode=i._ac.createMediaStreamDestination(),i._gainNode.connect(i._destNode)),i}return qd(r,[{key:"getId",value:function(){return this._trackId}},{key:"setVolume",value:function(e){this._gainNode&&(this._gainNode.gain.value=e/100)}},{key:"getVolume",value:function(){return this._gainNode?Math.round(100*this._gainNode.gain.value):-1}},{key:"channelCount",get:function(){var e;return null!==(e=this._channelCount)&&void 0!==e?e:0}},{key:"connectAudioTrack",value:function(e){var t;if(this._channelCount=e.getSettings().channelCount,!IN()||XP("SKIP_WEB_AUDIO_IN_TRACK"))return e;this._sourceNode&&(this._sourceNode.mediaStream.getTracks().forEach((function(e){e.stop()})),delete this._sourceNode);var r,n=new MediaStream;(n.addTrack(e),this._sourceNode=null===(t=this._ac)||void 0===t?void 0:t.createMediaStreamSource(n),this._gainNode)&&(null===(r=this._sourceNode)||void 0===r||r.connect(this._gainNode));return this._destNode.stream.getTracks()[0]}},{key:"destroy",value:function(){var e,t,r,n;(null===(e=this._sourceNode)||void 0===e||e.mediaStream.getTracks().forEach((function(e){e.stop()})),13!==kP)&&(null===(n=this._destNode)||void 0===n||n.stream.getTracks().forEach((function(e){e.stop()})));null===(t=this._sourceNode)||void 0===t||t.disconnect(),null===(r=this._gainNode)||void 0===r||r.disconnect(),delete this._sourceNode,delete this._gainNode,delete this._destNode}}]),r}(bD),uU=function(e){xI(n,e);var t,r=WI(n);function n(e,t,i){var o;return Yd(this,n),sd(Zk(o=r.call(this,t,i)),"_mediaTrack",void 0),sd(Zk(o),"_preProcessingTrack",void 0),sd(Zk(o),"_originTrack",void 0),sd(Zk(o),"handleTrackEnded",(function(){o.emit("track-ended",Zk(o)),o.close()})),sd(Zk(o),"handleMute",(function(){o.emit("track-mute",Zk(o))})),sd(Zk(o),"handleUnmute",(function(){o.emit("track-unmute",Zk(o))})),o._mediaTrack="audio"===o.mediaType?o.connectAudioTrack(e):e,o._originTrack=e,o._initListeners(),o}return qd(n,[{key:"getTrack",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"origin";return"origin"===e?this._mediaTrack:this._preProcessingTrack||this._mediaTrack}},{key:"setTrack",value:function(e,t){this._mediaTrack="audio"===this.mediaType?this.connectAudioTrack(e):e,this._originTrack=e,t&&this.generatePreProcessingTrack(t)}},{key:"generatePreProcessingTrack",value:(t=km(Em().mark((function e(t){var r;return Em().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return this._preProcessingTrack=void 0,e.prev=1,e.next=4,t.getPreProcessingTrack(this);case 4:(r=e.sent)instanceof MediaStreamTrack&&(this._preProcessingTrack=r),e.next=11;break;case 8:e.prev=8,e.t0=e.catch(1),console.error(e.t0);case 11:case"end":return e.stop()}}),e,this,[[1,8]])}))),function(e){return t.apply(this,arguments)})},{key:"getOrgTrack",value:function(){return this._originTrack}},{key:"close",value:function(){var e,t,r,n,i;return this._mediaTrack.onended=null,this._mediaTrack.onmute=null,this._mediaTrack.onunmute=null,null===(e=this._originTrack)||void 0===e||e.removeEventListener("ended",this.handleTrackEnded),null===(t=this._originTrack)||void 0===t||t.removeEventListener("mute",this.handleMute),null===(r=this._originTrack)||void 0===r||r.removeEventListener("unmute",this.handleUnmute),null===(n=this._preProcessingTrack)||void 0===n||n.stop(),"audio"===this.mediaType?this.destroy():null===(i=this._mediaTrack)||void 0===i?void 0:i.stop()}},{key:"_initListeners",value:function(){this._originTrack instanceof MediaStreamTrack&&(this._originTrack.addEventListener("ended",this.handleTrackEnded),this._originTrack.addEventListener("mute",this.handleMute),this._originTrack.addEventListener("unmute",this.handleUnmute))}}]),n}(cU),dU=function(e){xI(r,e);var t=WI(r);function r(e,n,i){var o;return Yd(this,r),sd(Zk(o=t.call(this,n,i)),"_mediaTrack",void 0),sd(Zk(o),"_originTrack",void 0),o._mediaTrack="audio"===o.mediaType?o.connectAudioTrack(e):e,o._originTrack=e,o}return qd(r,[{key:"getTrack",value:function(){return this._mediaTrack}},{key:"getOrgTrack",value:function(){return this._originTrack}},{key:"close",value:function(){return this.destroy()}}]),r}(cU),lU=function(e){xI(n,e);var t,r=WI(n);function n(e,t){var i;return Yd(this,n),sd(Zk(i=r.call(this,e,t,"video")),"resolution",void 0),sd(Zk(i),"dummy",!1),i.resolution={width:0,height:0},i}return qd(n,[{key:"updateVideoCaptureConfig",value:(t=km(Em().mark((function e(t){var r,n;return Em().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this.getTrack()){e.next=2;break}return e.abrupt("return");case 2:return aU.print("updateVideoEncoderConfig","update localVideoTrack: ",t),delete(r=ud({},t)).contentHint,aP&&(r.frameRate={ideal:30,max:30}),e.next=8,this.getTrack().applyConstraints(r);case 8:((n=this.getTrack().getSettings()).width&&n.width!==this.resolution.width||n.height&&n.height!==this.resolution.height)&&(this.resolution={width:n.width,height:n.height},this.emit("resolution-change",this.resolution));case 10:case"end":return e.stop()}}),e,this)}))),function(e){return t.apply(this,arguments)})},{key:"replaceTrack",value:function(e){this.setTrack(e)}},{key:"setContentHint",value:function(e){var t;this._mediaTrack&&"contentHint"in this._mediaTrack&&vT(t=["text","motion","detail"]).call(t,e)&&(this._mediaTrack.contentHint=e)}}]),n}(uU),hU=function(e){xI(n,e);var t,r=WI(n);function n(e,t){var i;return Yd(this,n),sd(Zk(i=r.call(this,e,t,"audio")),"audioCaptureConfig",void 0),sd(Zk(i),"_audioLevelFetcher",void 0),sd(Zk(i),"mixedAudioTrack",void 0),sd(Zk(i),"mixType",Hd.PLAYOUT_AND_PUBLISH),i}return qd(n,[{key:"getAudioLevel",value:function(){return this._audioLevelFetcher||(this._audioLevelFetcher=new tU(this.getTrack("preprocessing"))),this._audioLevelFetcher.getAudioLevel()}},{key:"updateAudioCaptureConfig",value:(t=km(Em().mark((function e(){var t;return Em().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this.audioCaptureConfig){e.next=2;break}return e.abrupt("return");case 2:return aU.print("updateAudioCaptureConfig","update localAudioTrack: ",this.audioCaptureConfig),e.next=5,null===(t=this.getOrgTrack())||void 0===t?void 0:t.applyConstraints(this.audioCaptureConfig);case 5:case"end":return e.stop()}}),e,this)}))),function(){return t.apply(this,arguments)})}]),n}(uU),pU=function(e){xI(r,e);var t=WI(r);function r(e,n){return Yd(this,r),t.call(this,e,n,"video")}return qd(r)}(dU),_U=function(e){xI(r,e);var t=WI(r);function r(e,n){var i;return Yd(this,r),sd(Zk(i=t.call(this,e,n,"audio")),"_audioLevelFetcher",void 0),i}return qd(r,[{key:"getAudioLevel",value:function(){return this._audioLevelFetcher||(this._audioLevelFetcher=new tU(this.getTrack())),this._audioLevelFetcher.getAudioLevel()}}]),r}(dU),vU=function(e){xI(r,e);var t=WI(r);function r(){var e,n;Yd(this,r);for(var i=arguments.length,o=new Array(i),a=0;a<i;a++)o[a]=arguments[a];return sd(Zk(n=t.call.apply(t,wm(e=[this]).call(e,o))),"streamIndex",yd.STREAM_INDEX_MAIN),n}return qd(r)}(hU),fU=function(e){xI(r,e);var t=WI(r);function r(){var e,n;Yd(this,r);for(var i=arguments.length,o=new Array(i),a=0;a<i;a++)o[a]=arguments[a];return sd(Zk(n=t.call.apply(t,wm(e=[this]).call(e,o))),"streamIndex",yd.STREAM_INDEX_MAIN),n}return qd(r)}(lU),mU=function(e){xI(r,e);var t=WI(r);function r(){var e,n;Yd(this,r);for(var i=arguments.length,o=new Array(i),a=0;a<i;a++)o[a]=arguments[a];return sd(Zk(n=t.call.apply(t,wm(e=[this]).call(e,o))),"streamIndex",yd.STREAM_INDEX_MAIN),sd(Zk(n),"sourceType",0),n}return qd(r)}(lU),gU=function(e){xI(r,e);var t=WI(r);function r(){var e,n;Yd(this,r);for(var i=arguments.length,o=new Array(i),a=0;a<i;a++)o[a]=arguments[a];return sd(Zk(n=t.call.apply(t,wm(e=[this]).call(e,o))),"streamIndex",yd.STREAM_INDEX_MAIN),sd(Zk(n),"sourceType",0),n}return qd(r)}(hU),yU=function(e){xI(r,e);var t=WI(r);function r(){var e,n;Yd(this,r);for(var i=arguments.length,o=new Array(i),a=0;a<i;a++)o[a]=arguments[a];return sd(Zk(n=t.call.apply(t,wm(e=[this]).call(e,o))),"streamIndex",yd.STREAM_INDEX_SCREEN),n}return qd(r)}(lU),SU=function(e){xI(r,e);var t=WI(r);function r(){var e,n;Yd(this,r);for(var i=arguments.length,o=new Array(i),a=0;a<i;a++)o[a]=arguments[a];return sd(Zk(n=t.call.apply(t,wm(e=[this]).call(e,o))),"streamIndex",yd.STREAM_INDEX_SCREEN),n}return qd(r)}(hU),bU=function(e){xI(r,e);var t=WI(r);function r(){var e,n;Yd(this,r);for(var i=arguments.length,o=new Array(i),a=0;a<i;a++)o[a]=arguments[a];return sd(Zk(n=t.call.apply(t,wm(e=[this]).call(e,o))),"streamIndex",yd.STREAM_INDEX_SCREEN),sd(Zk(n),"sourceType",0),n}return qd(r)}(lU),EU=function(e){xI(r,e);var t=WI(r);function r(){var e,n;Yd(this,r);for(var i=arguments.length,o=new Array(i),a=0;a<i;a++)o[a]=arguments[a];return sd(Zk(n=t.call.apply(t,wm(e=[this]).call(e,o))),"streamIndex",yd.STREAM_INDEX_SCREEN),sd(Zk(n),"sourceType",0),n}return qd(r)}(hU);function TU(e,t){return kU.apply(this,arguments)}function kU(){return(kU=km(Em().mark((function e(t,r){var n;return Em().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return(n=new fU(t,xO())).dummy=!0,e.next=4,n.generatePreProcessingTrack(r);case 4:return e.abrupt("return",n);case 5:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function IU(e,t){return RU.apply(this,arguments)}function RU(){return(RU=km(Em().mark((function e(t,r){var n;return Em().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return(n=new yU(t,xO())).dummy=!0,e.next=4,n.generatePreProcessingTrack(r);case 4:return e.abrupt("return",n);case 5:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function AU(e,t){return CU.apply(this,arguments)}function CU(){return(CU=km(Em().mark((function e(t,r){var n,i,o,a,s,c,u,d;return Em().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return o=(null==t||null===(n=t.deviceId)||void 0===n?void 0:n.exact)||"default",a=EO(r.id),e.prev=2,aU.print("createCameraVideoTrack","constraints:",t),null==a||a.report("rtc_video_capture_event",{event_type:"start",media_device_id:o}),s=OO(),aP&&(t.frameRate={ideal:30,max:30}),e.next=9,qL.getUserMedia({video:t});case 9:i=e.sent,null==a||a.report("rtc_video_capture_event",{event_type:"start_capture_result",media_device_id:o,reason:"success",elapse:OO()-s}),e.next=17;break;case 13:throw e.prev=13,e.t0=e.catch(2),null==a||a.report("rtc_video_capture_event",{event_type:"running_failed",media_device_id:o,error_code:e.t0.code,reason:e.t0.name+e.t0.message}),new lA(uA.GET_VIDEO_TRACK_FAILED,wm(c="throw error from getUserMedia. [".concat(e.t0.name||"unknown name","]: ")).call(c,e.t0.message||"unknown message","."),e.t0);case 17:return u=i.getVideoTracks()[0],sU.set(u,i),d=new fU(u,xO()),e.next=22,d.generatePreProcessingTrack(r);case 22:return e.abrupt("return",d);case 23:case"end":return e.stop()}}),e,null,[[2,13]])})))).apply(this,arguments)}function wU(e,t){return xU.apply(this,arguments)}function xU(){return(xU=km(Em().mark((function e(t,r){var n,i,o,a,s,c,u,d,l;return Em().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return aU.print("createMicrophoneAudioTrack","constraints:",t),o=(null==t||null===(n=t.deviceId)||void 0===n?void 0:n.exact)||"default",a=EO(r.id),e.prev=3,null==a||a.report("rtc_video_capture_event",{event_type:"start",media_device_id:o}),s=OO(),(c=r.getPluginByName(nU.PRE_PROCESSING,"RTCAIAnsExtension"))&&(c.isOpen()?(t.autoGainControl=!0,t.noiseSuppression=!1):t.noiseSuppression=!0),e.next=10,qL.getUserMedia({audio:t});case 10:i=e.sent,null==a||a.report("rtc_video_capture_event",{event_type:"start_capture_result",media_device_id:o,reason:"success",elapse:OO()-s}),e.next=18;break;case 14:throw e.prev=14,e.t0=e.catch(3),null==a||a.report("rtc_video_capture_event",{event_type:"running_failed",media_device_id:o,error_code:e.t0.code,reason:e.t0.name+e.t0.message}),new lA(uA.GET_AUDIO_TRACK_FAILED,wm(u="throw error from getUserMedia. [".concat(e.t0.name||"unknown name","]: ")).call(u,e.t0.message||"unknown message","."),e.t0);case 18:return d=i.getAudioTracks()[0],sU.set(d,i),l=new vU(d,xO()),e.next=23,l.generatePreProcessingTrack(r);case 23:return e.abrupt("return",l);case 24:case"end":return e.stop()}}),e,null,[[3,14]])})))).apply(this,arguments)}function OU(){return PU.apply(this,arguments)}function PU(){return PU=km(Em().mark((function e(){var t,r,n,i,o,a,s,c,u,d,l=arguments;return Em().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=l.length>0&&void 0!==l[0]&&l[0],r=l.length>1?l[1]:void 0,n=l.length>2?l[2]:void 0,aU.print("createScreenTracks","withAudio: %o, constraints: %o",t,n),o=EO(r.id),e.prev=5,null==o||o.report("rtc_video_capture_event",{event_type:"start",media_device_id:"screen"}),a=OO(),e.next=10,navigator.mediaDevices.getDisplayMedia({video:!(n&&(!sP||16!==kP))||n,audio:!!t&&{channelCount:2,noiseSuppression:!1,echoCancellation:!1,autoGainControl:!1}});case 10:i=e.sent,null==o||o.report("rtc_video_capture_event",{event_type:"start_capture_result",media_device_id:"screen",reason:"success",elapse:OO()-a}),e.next=18;break;case 14:throw e.prev=14,e.t0=e.catch(5),null==o||o.report("rtc_video_capture_event",{event_type:"running_failed",media_device_id:"screen",error_code:e.t0.code,reason:e.t0.name+e.t0.message}),new lA(uA.GET_SCREEN_TRACK_FAILED,"throw error from getDisplayMedia",e.t0);case 18:return s=i.getVideoTracks()[0],c=new yU(s,xO()),e.next=22,c.generatePreProcessingTrack(r);case 22:if(!(u=i.getAudioTracks()[0])){e.next=28;break}return d=new SU(u,xO()),e.next=27,d.generatePreProcessingTrack(r);case 27:return e.abrupt("return",[c,d]);case 28:return e.abrupt("return",[c,void 0]);case 29:case"end":return e.stop()}}),e,null,[[5,14]])}))),PU.apply(this,arguments)}function DU(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:xO();return new _U(e,t)}function MU(e,t){return NU.apply(this,arguments)}function NU(){return(NU=km(Em().mark((function e(t,r){var n;return Em().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=new mU(t,xO()),e.next=3,n.generatePreProcessingTrack(r);case 3:return e.abrupt("return",n);case 4:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function LU(e,t){return UU.apply(this,arguments)}function UU(){return(UU=km(Em().mark((function e(t,r){var n;return Em().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=new gU(t,xO()),e.next=3,n.generatePreProcessingTrack(r);case 3:return e.abrupt("return",n);case 4:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function VU(e,t){return FU.apply(this,arguments)}function FU(){return(FU=km(Em().mark((function e(t,r){var n;return Em().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=new bU(t,xO()),e.next=3,n.generatePreProcessingTrack(r);case 3:return e.abrupt("return",n);case 4:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function BU(e,t){return jU.apply(this,arguments)}function jU(){return(jU=km(Em().mark((function e(t,r){var n;return Em().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=new EU(t,xO()),e.next=3,n.generatePreProcessingTrack(r);case 3:return e.abrupt("return",n);case 4:case"end":return e.stop()}}),e)})))).apply(this,arguments)}var GU=hU,HU=_U,zU=function(e){return e[e.NONE=0]="NONE",e}(zU||{}),KU=function(){function e(){Yd(this,e)}return qd(e,null,[{key:"getNalunits",value:function(t){if(t.length-t.position<4)return[];var r=t.position;return 1===t.getInt32(r)||0===t.getInt16(r)&&1===t.getInt8(r+2)?e.getAnnexbNals(t):e.getAvccNals(t)}},{key:"getAnnexbNals",value:function(t){for(var r=[],n=e.getHeaderPositionAnnexB(t),i=n.pos,o=i;i<t.length-4;){var a,s,c=new Uint8Array(bm(a=t.buffer).call(a,i,i+n.headerLength));n.pos===t.position&&t.skip(n.headerLength),o=(n=e.getHeaderPositionAnnexB(t)).pos;var u={header:c,body:new Uint8Array(bm(s=t.buffer).call(s,i+c.byteLength,o)),type:-1};e.analyseNal(u),u.type<=9&&0!==u.type&&r.push(u),t.skip(o-t.position),i=o}return r}},{key:"getAvccNals",value:function(t){for(var r=[];t.position<t.length-4;){var n=t.getInt32(t.position);if(!(t.length-t.position>=n))break;var i,o,a=new Uint8Array(bm(i=t.buffer).call(i,t.position,t.position+4));t.skip(4);var s=new Uint8Array(bm(o=t.buffer).call(o,t.position,t.position+n));t.skip(n);var c={header:a,body:s,type:-1};e.analyseNal(c),c.type<=9&&0!==c.type&&r.push(c)}return r}},{key:"analyseNal",value:function(e){var t=31&e.body[0];switch(e.type=t,t){case 1:e.ndr=!0;break;case 5:e.idr=!0;break;case 6:e.sei=!0;break;case 7:e.sps=!0;break;case 8:e.pps=!0}}},{key:"getHeaderPositionAnnexB",value:function(e){for(var t=e.position,r=0,n=e.length;3!==r&&4!==r&&t<n-4;)0===e.getInt16(t)?1===e.getInt16(t+2)?r=4:1===e.getInt8(t+2)?r=3:t++:t++;return t===n-4&&(0===e.getInt16(t)?1===e.getInt16(t+2)?r=4:t=n:(t++,0===e.getInt16(t)&&1===e.getInt8(t)?r=3:t=n)),{pos:t,headerLength:r}}}]),e}(),XU=function(){function e(t){Yd(this,e),sd(this,"_position",0),sd(this,"_dataview",void 0),this._dataview=new DataView(t)}return qd(e,[{key:"length",get:function(){return this.buffer.byteLength}},{key:"buffer",get:function(){return this._dataview.buffer}},{key:"position",get:function(){return this._position},set:function(e){this._position=e}},{key:"back",value:function(e){this.position-=e}},{key:"getUint8",value:function(e){return this._dataview.getUint8(e)}},{key:"getInt8",value:function(e){return this._dataview.getInt8(e)}},{key:"getInt16",value:function(e){return this._dataview.getInt16(e)}},{key:"getUint16",value:function(e){return this._dataview.getUint16(e)}},{key:"getUint32",value:function(e){return this._dataview.getUint32(e)}},{key:"getInt32",value:function(e){return this._dataview.getInt32(e)}},{key:"skip",value:function(t){for(var r=Math.floor(t/4),n=t%4,i=0;i<r;i++)e.readByte(this,4);n>0&&e.readByte(this,n)}},{key:"readUint8",value:function(){return e.readByte(this,1)}},{key:"readUint16",value:function(){return e.readByte(this,2)}},{key:"readUint24",value:function(){return e.readByte(this,3)}},{key:"readUint32",value:function(){return e.readByte(this,4)}},{key:"readUint64",value:function(){return e.readByte(this,8)}},{key:"readInt8",value:function(){return e.readByte(this,1,!0)}},{key:"readInt16",value:function(){return e.readByte(this,2,!0)}},{key:"readInt32",value:function(){return e.readByte(this,4,!0)}},{key:"writeUint32",value:function(e){return new Uint8Array([e>>>24&255,e>>>16&255,e>>>8&255,255&e])}}],[{key:"readByte",value:function(e,t,r){var n;switch(t){case 1:n=r?e.getInt8(e.position):e.getUint8(e.position);break;case 2:n=r?e.getInt16(e.position):e.getUint16(e.position);break;case 3:if(r)throw new Error("not supported for readByte 3");n=e.getUint8(e.position)<<16,n|=e.getUint8(e.position+1)<<8,n|=e.getUint8(e.position+2);break;case 4:n=r?e.getInt32(e.position):e.getUint32(e.position);break;case 8:if(r)throw new Error("not supported for readBody 8");n=e.getUint32(e.position)<<32,n|=e.getUint32(e.position+4);break;default:n=""}return e.position+=t,n}}]),e}(),WU=function(e){return e[e.internal=0]="internal",e[e.external=1]="external",e[e.bypass=2]="bypass",e}(WU||{}),qU=new Uint8Array([109,167,53,190,103,90,72,1,170,89,63,164,194,199,19,85]),YU=new Uint8Array([109,167,53,190,103,90,72,1,170,89,63,164,194,199,19,84]),JU=function(e){for(var t=[],r=0;r<e.length;r++)e[r]<=3&&0===e[r-1]&&0===e[r-2]&&t.push(3),t.push(e[r]);return new Uint8Array(t)};function QU(e){for(var t=[];e>=255;)e-=255,t.push(255);return t.push(e),new Uint8Array(t)}function ZU(e){for(var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,r=0;255===e[t]&&t<e.byteLength;)t++,r+=255;return t<e.byteLength&&(r+=e[t++]),[r,t]}var $U=function(){function e(){Yd(this,e)}return qd(e,null,[{key:"generateSEI",value:function(e){var t,r=arguments.length>1&&void 0!==arguments[1]&&arguments[1],n=new Uint8Array([0,0,0,1]),i=new Uint8Array([6]),o=new Uint8Array([5]),a=r?qU:YU,s=QU(e.byteLength+a.byteLength),c=JU(e);return new Uint8Array(wm(t=[]).call(t,qT(n),qT(i),qT(o),qT(s),qT(a),qT(c),[128]))}},{key:"decodeSeiBody",value:function(e){var t=function(e){for(var t=[],r=0;r<e.length;r++)e[r]<=3&&0===e[r-1]&&0===e[r-2]||t.push(e[r]);return new Uint8Array(t)}(e=bm(e).call(e,0,e.length-1));if(!(t.byteLength<2)){var r=0;if(5===t[1]||100===t[1]){var n=Qk(ZU(t,r+=2),2),i=n[0],o=2,a=(r=n[1])+i;return t.byteLength>=YU.byteLength&&i>=YU.byteLength&&bm(t).call(t,r,r+YU.byteLength).toString()===YU.toString()?(r+=YU.byteLength,o=1):t.byteLength>=YU.byteLength&&i>=YU.byteLength&&bm(t).call(t,r,r+qU.byteLength).toString()===qU.toString()&&(r+=qU.byteLength,o=0),{type:o,payload:bm(t).call(t,r,a)}}}}},{key:"parseInternalSEI",value:function(e){var t=new jS,r=0;if(0===e.type){for(;e.payload.byteLength-r>=2;){var n=Qk(ZU(e.payload,r),2),i=n[0];r=n[1];var o,a=Qk(ZU(e.payload,r),2),s=a[0];if(r=a[1],t.get(i)||!(s<=e.payload.byteLength-r))break;t.set(i,bm(o=e.payload).call(o,r,r+s)),r+=s}return t}}},{key:"makeInternalSei",value:function(e){var t,r=[],n=Jk(e);try{for(n.s();!(t=n.n()).done;){var i=Qk(t.value,2),o=i[0],a=i[1],s=QU(o),c=QU(a.byteLength);r.push(s,c,a)}}catch(l){n.e(l)}finally{n.f()}var u=tb(r).call(r,(function(e,t){return e+t.byteLength}),0),d=new Uint8Array(u);return tb(r).call(r,(function(e,t){return d.set(t,e),e+t.byteLength}),0),d}}]),e}(),eV=new uO("Stats",3),tV=function(){function e(t){Yd(this,e),sd(this,"player",void 0),sd(this,"_timer",void 0),sd(this,"handler",void 0),sd(this,"_monitor",void 0),sd(this,"_destroyed",!1),this._context=t,this._monitor=EO(t.id)}return qd(e,[{key:"setVar",value:function(e){this.handler=e}},{key:"stopReport",value:function(e){var t;this._timer&&(eV.print("stopReport","invoke"),clearTimeout(this._timer),delete this._timer,IO(this._context.id,"del_media_statistics_timer",wm(t="reason: ".concat(e,", stack: ")).call(t,(new Error).stack),0,this._stream.streamId||""))}},{key:"filterIllegal",value:function(e){var t={};return an(e).forEach((function(r){null===e[r]||void 0===e[r]||Number.isNaN(e[r])||(t[r]=e[r])})),t}},{key:"destroy",value:function(){eV.print("destroy","invoke"),IO(this._context.id,"media_statistics_destroy","".concat((new Error).stack),0,"".concat(this._stream.streamId)),this.stopReport("destroy"),this._destroyed=!0}}]),e}(),rV=function(e){xI(i,e);var t,r,n=WI(i);function i(e,t){var r;return Yd(this,i),(r=n.call(this,e))._stream=t,r}return qd(i,[{key:"setLocalStreamStatsEvtInterval",value:function(e,t){var r,n,i,o=this;if(!this._timer){eV.print("setLocalStreamStatsEvtInterval","invoke"),this.setVar(t),this._destroyed=!1;var a={audio:{},video:{}},s=this._stream,c=null===(r=s.audioTrack)||void 0===r?void 0:r.getTrack("preprocessing"),u=null===(n=s.videoTrack)||void 0===n?void 0:n.getTrack("preprocessing");this.getAudioStats(c,a,null===(i=s.audioTrack)||void 0===i?void 0:i.getAudioLevel()),this.getVideoStats(u,a);var d=function(){var e=km(Em().mark((function e(){var t,r,n,i,c,u,d;return Em().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return i=null===(t=s.audioTrack)||void 0===t?void 0:t.getTrack("preprocessing"),c=null===(r=s.videoTrack)||void 0===r?void 0:r.getTrack("preprocessing"),e.next=4,o.getAudioStats(i,a,null===(n=s.audioTrack)||void 0===n?void 0:n.getAudioLevel());case 4:return u=e.sent,e.next=7,o.getVideoStats(c,a);case 7:return d=e.sent,e.abrupt("return",{audioStats:u,videoStats:d,isScreen:s.isScreen});case 9:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}(),l=function(){var t=km(Em().mark((function t(){var r;return Em().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,d();case 2:r=t.sent,e(r),o._destroyed||(o._timer=setTimeout(l,2e3));case 5:case"end":return t.stop()}}),t)})));return function(){return t.apply(this,arguments)}}();this._timer=setTimeout(l,2e3)}}},{key:"getAudioStats",value:(r=km(Em().mark((function e(t,r,n){var i,o,a,s,c,u,d,l,h,p,_,v,f,m,g;return Em().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(s={},c={timestamp:Date.now()},u=this._stream,d=u.streamId,l=u.audioMid,h=u.isScreen,p=u.pubAttributes,_=u.pubAudio,v=u.audioTrack,f={media_type:"audio",is_screen:!!h,direction:"up",stream_id:d,vid:l,connection_status:navigator.onLine,track_enabled:null==t?void 0:t.enabled,capture_state:p.localaudio?"capture_state_on":"capture_state_off",mute_state:_?"mute_state_off":"mute_state_on"},v&&(f.playback_volume=v.getVolume()),t&&this.handler){e.next=7;break}return e.abrupt("return",s);case 7:return e.next=9,this.handler.getStats(t);case 9:if((m=e.sent).length){e.next=12;break}return e.abrupt("return",s);case 12:if(m.forEach((function(e){var t=e.type,r=e.packetsSent,n=e.packetsLost,i=e.bytesSent,o=e.clockRate,a=e.roundTripTime,u=e.channels,d=e.audioLevel;e.googRtt;var l=e.mimeType,h=e.availableIncomingBitrate,p=e.availableOutgoingBitrate,_=e.bytesReceived,v=e.nominated,m=e.id,g=e.currentRoundTripTime,y=e.state,S=e.writable,b=e.requestsReceived,E=e.responsesReceived,T=e.requestsSent,k=e.consentRequestsSent,I=e.responsesSent,R=e.jitter,A=e.candidateType,C=e.ip,w=e.address,x=e.networkType,O=e.port,P=e.protocol,D=e.nackCount,M=e.retransmittedBytesSent,N=e.retransmittedPacketsSent,L=e.audioInputLevel,U=e.ssrc,V=e.totalAudioEnergy,F=e.totalSamplesDuration,B=e.mediaType,j=e.fractionLost;"outbound-rtp"===t?(c.packetsSent=r,c.bytesSent=i,f.bytes=i,f.packetsSent=r,f.nackCount=D,f.ssrc=U,f.retransmitted_bytes_sent=M,f.retransmitted_packets_sent=N,c.retransmittedBytesSent=M,c.retransmittedPacketsSent=N):"remote-inbound-rtp"===t?(c.packetsLost=n,f.packetsLost=n,f.net_jitter=1e3*R,s.rtt=1e3*a,f.rtt=s.rtt,s._fractionLost=j||0):"codec"===t?(s.recordSampleRate=o,s.numChannels=u,f.codecName=l):"media-source"===t&&void 0!==d?(f.audio_level=d?-10*WA(Math.pow(d,2)):d,f.volume=255*d,f.total_audio_energy=V,f.totalInputDuration=F):"ssrc"===t&&"audio"===B?f.send_level=L:"candidate-pair"===t?(f.ice_available_incoming_bitrate=h,f.ice_available_outgoing_bitrate=p,f.ice_bytes_received=_,f.ice_bytes_sent=i,f.ice_nominated=+v,f.ice_pair_id=m,f.ice_pair_rtt=g,f.ice_pair_state=y,f.ice_pair_writable=S,f.recv_ping_requests=b,f.recv_ping_responses=E,f.sent_ping_requests_before_first_response=T,f.sent_ping_requests_total=T+(k||0),f.sent_ping_responses=I):"local-candidate"===t?(f.local_candidate_type=A,f.local_ip=C||w,f.local_network_type=x,f.local_port=O,f.protocol=P):"remote-candidate"===t&&(f.remote_candidate_type=A,f.remote_ip=C||w,f.remote_port=O);var G=XP("STATS_SCALLBACK_SUPPORT");RN&&G||"media-source"===t&&(f.send_level=d)})),void 0===f.volume&&void 0!==n&&(f.volume=n,f.audio_level=n?-10*WA(Math.pow(n/255,2)):n),(g=r.audio).timestamp){e.next=18;break}return r.audio=c,e.abrupt("return",this.filterIllegal(s));case 18:return void 0!==c.packetsLost&&(s.audioLossRate=(c.packetsLost-g.packetsLost)/(c.packetsSent-g.packetsSent),s.audioLossRate=Number.isNaN(s.audioLossRate)?0:s.audioLossRate,f.fraction_lost=s.audioLossRate),s.statsInterval=c.timestamp-g.timestamp,f.stats_interval=s.statsInterval,s.sendKBitrate=(c.bytesSent-g.bytesSent||0)/s.statsInterval*8,f.mediaBitratebps=Math.round(1e3*s.sendKBitrate),f.bandwidth=Math.round(f.mediaBitratebps/1024),void 0!==c.retransmittedBytesSent&&(f.retransmitBitratebps=(c.retransmittedBytesSent-g.retransmittedBytesSent||0)/s.statsInterval),r.audio=c,f.vendor_mode=(null===(i=this._stream)||void 0===i?void 0:i.vendorCode)||0,f.pc_session_id=null===(o=this.handler)||void 0===o?void 0:o.peerConnectionId,null===(a=this._monitor)||void 0===a||a.report("rtc_media_statistics",f),s._retransmittedRate=(c.retransmittedPacketsSent-g.retransmittedPacketsSent)/(c.packetsSent-g.packetsSent),void 0===s.audioLossRate&&(s.audioLossRate=s._retransmittedRate,f.fraction_lost=s.audioLossRate),s._fractionLost=Math.max(s._fractionLost,s.audioLossRate),e.abrupt("return",this.filterIllegal(s));case 33:case"end":return e.stop()}}),e,this)}))),function(e,t,n){return r.apply(this,arguments)})},{key:"getVideoStats",value:(t=km(Em().mark((function e(t,r){var n,i,o,a,s,c,u,d,l,h,p,_,v,f,m,g,y,S,b,E,T,k;return Em().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n={},i={timestamp:Date.now(),simulcast:{}},o=this._stream,a=o.streamId,s=o.videoMid,c=o.isScreen,u=o.pubAttributes,d=o.enableSimulcast,l=o.pubVideo,e.t0=ud,e.t1={media_type:"video",is_screen:!!c,direction:"up",stream_id:a,vid:s,connection_status:navigator.onLine,track_enabled:null==t?void 0:t.enabled,capture_state:u.localvideo?"capture_state_on":"capture_state_off",mute_state:l?"mute_state_off":"mute_state_on"},e.next=7,this._stream.requestVideoFrameCallback();case 7:if(e.t2=e.sent,h=(0,e.t0)(e.t1,e.t2),t&&this.handler){e.next=11;break}return e.abrupt("return",n);case 11:return h.cap_frame_width=t.getSettings().width,h.cap_frame_height=t.getSettings().height,h.frameRateSent=t.getSettings().frameRate,n.isScreen=c,e.next=17,this.handler.getStats(t);case 17:if((p=e.sent).length){e.next=20;break}return e.abrupt("return",n);case 20:if(_=0,p.forEach((function(e){var t=e.type,o=e.framesEncoded,a=e.packetsLost,s=e.bytesSent,c=e.framesSent,u=e.retransmittedBytesSent,l=e.totalPacketSendDelay,p=e.totalEncodeTime,v=e.firCount,f=e.targetBitrate,m=e.roundTripTime,g=e.mimeType,y=e.frameWidth,S=e.frameHeight,b=e.packetsSent,E=e.googActualEncBitrate,T=e.googAvailableReceiveBandwidth,k=e.googAvailableSendBandwidth,I=e.googAvgEncodeMs,R=e.googBucketDelay,A=e.googEncodeUsagePercent,C=e.googFrameRateInput,w=e.availableIncomingBitrate,x=e.availableOutgoingBitrate,O=e.bytesReceived,P=e.nominated,D=e.id,M=e.currentRoundTripTime,N=e.state,L=e.writable,U=e.candidateType,V=e.ip,F=e.address,B=e.networkType,j=e.port,G=e.nackCount,H=e.pliCount,z=e.protocol,K=e.qpSum,X=e.requestsReceived,W=e.responsesReceived,q=e.googRetransmitBitrate,Y=e.requestsSent,J=e.consentRequestsSent,Q=e.responsesSent,Z=e.ssrc,$=e.googTargetEncBitrate,ee=e.googTransmitBitrate,te=e.retransmittedPacketsSent,re=e.encoderImplementation,ne=e.jitter,ie=e.rid,oe=e.fractionLost,ae=e.googAdaptationChanges,se=e.qualityLimitationReason,ce=e.qualityLimitationDurations,ue=e.googFirsReceived,de=e.googFrameRateSent,le=e.keyFramesEncoded,he=e.scalabilityMode,pe=e.framesPerSecond,_e=e.frames;"outbound-rtp"===t?(d&&(ie?i.simulcast[ie]=e:i.simulcast[_]=e,_++),i.framesEncoded=o||i.framesEncoded||0,h.key_frames_encoded=le||0,i.bytesSent=s||i.bytesSent||0,i.framesSent=c||i.framesSent,h.bytes=s||h.bytes||0,i.packetsSent=b||i.packetsSent||0,h.packetsSent=b||h.packetsSent||0,h.nackCount=G||h.nackCount||0,h.pli_count=H||h.pli_count||0,h.qp_sum=K||h.qp_sum||0,h.ssrc=Z||h.ssrc||0,h.retransmitted_packets_sent=te,i.retransmittedPacketsSent=te,i.retransmittedBytesSent=u,h.encoder_implementation=re,h.qualityLimitationReason=se,h.qualityLimitationDurations=ce,h.scalabilityMode=he,void 0!==y&&((!n.encodedFrameWidth||y>n.encodedFrameWidth)&&(n.encodedFrameWidth=y),(!n.encodedFrameHeight||S>n.encodedFrameHeight)&&(n.encodedFrameHeight=S),h.frame_size_height=S,h.frame_size_width=y)):"track"===t?(n.encodedFrameWidth=y,n.encodedFrameHeight=S,h.frame_size_height=S,h.frame_size_width=y):"remote-inbound-rtp"===t?(i.packetsLost=a,n.rtt=1e3*m,h.rtt=n.rtt,h.jitter=1e3*ne,h.packetsLost=a,n._fractionLost=oe||0):"codec"===t?(n.codecType=g,h.codecName=g):"candidate-pair"===t?(h.ice_available_incoming_bitrate=w,h.ice_available_outgoing_bitrate=x,h.ice_bytes_received=O,h.ice_bytes_sent=s,h.ice_nominated=+P,h.ice_pair_id=D,h.ice_pair_rtt=M,h.ice_pair_state=N,h.ice_pair_writable=L,h.recv_ping_requests=X,h.recv_ping_responses=W,h.sent_ping_requests_before_first_response=Y,h.sent_ping_requests_total=Y+J,h.sent_ping_responses=Q):"local-candidate"===t?(h.local_candidate_type=U,h.local_ip=V||F,h.local_network_type=B,h.local_port=j,h.protocol=z):"remote-candidate"===t?(h.remote_candidate_type=U,h.remote_ip=V||F,h.remote_port=j):"VideoBwe"===t?(h.encBitratebps=E,h.available_receive_bandwidth=T,h.available_send_bandwidth=k,h.bucket_delay=R,h.retransmitBitratebps=q,h.targetEncBitratebps=$,h.transmit_bitrate=ee,n._sendBandWidth=+k):"ssrc"===t&&(h.avg_encode_ms=I,h.encodeUsage=A,h.frame_rate_input=C,h.orignal_input_Framerate=+C,h.ddaptationChanges=ae,h.firsReceived=ue,h.frameRateSent=de);var ve=XP("STATS_SCALLBACK_SUPPORT");if(!RN||!ve){var fe=r.video,me=i.timestamp-fe.timestamp;if("outbound-rtp"===t){var ge=s-fe.bytesSent,ye=u-fe.retransmittedBytesSent;h.encBitratebps=Math.round(8e3*(ge-ye)/me),h.bucket_delay=l/b,h.retransmitBitratebps=Math.round(8e3*ye/me),h.targetEncBitratebps=f,h.transmit_bitrate=Math.round(1e3*(s-fe.bytesSent)*8/me),h.avg_encode_ms=1e3*p/o,h.firsReceived=v+H}else"candidate-pair"===t?(h.available_send_bandwidth=x,n._sendBandWidth=x):"media-source"===t&&(h.frame_rate_input=pe,h.orignal_input_Framerate=+pe,h.frame_input=_e)}})),(v=r.video).timestamp){e.next=26;break}return r.video=i,e.abrupt("return",this.filterIllegal(n));case 26:return n.statsInterval=i.timestamp-v.timestamp,h.stats_interval=n.statsInterval,f=an(i.simulcast),d?(h.sim_enc_width=[],h.sim_enc_height=[],h.sim_enc_bps=[],h.sim_enc_framerate=[],h.sim_enc_key_frames=[],h.sim_rids=[],h.sim_enc_bandwidth=[],h.sim_sent_framerate=[],h.sim_fraction_lost=[],h.sim_keyencoded=[],h.active_sim_streams=(null===(m=this._context)||void 0===m?void 0:m.activeSimStreams)||[],h.sim_retransmittedRate=[],b=!1,VR(f).call(f,(function(e,t){return+e-+t})).forEach((function(e){var t=i.simulcast[e],r=t.frameWidth,o=t.frameHeight,a=t.bytesSent,s=t.framesEncoded,c=t.framesSent,u=t.packetsLost,d=t.packetsSent,l=t.qualityLimitationReason,p=t.qualityLimitationDurations,_=t.qualityLimitationResolutionChanges,f=t.retransmittedPacketsSent,m=t.pliCount,g=t.keyFramesEncoded;void 0!==l&&(h.sim_qualityLimitationReason||(h.sim_qualityLimitationReason=[],h.sim_qualityLimitationDurations=[],h.sim_qualityLimitationResolutionChanges=[]),h.sim_qualityLimitationReason.push(l),h.sim_qualityLimitationDurations.push(p),h.sim_qualityLimitationResolutionChanges.push(_));var y=v.simulcast[e];if(h.sim_enc_width.push(r||0),h.sim_enc_height.push(o||0),h.sim_enc_key_frames.push(g||0),y){var S=(a-y.bytesSent||0)/n.statsInterval;h.sim_enc_bps.push(Math.round(8e3*S)),h.sim_enc_bandwidth.push(Math.round(8e3*S/1024));var E=1e3*(s-y.framesEncoded)/n.statsInterval;h.sim_enc_framerate.push(Math.round(E)),h.sim_rids.push(e);var T=void 0!==c?c-y.framesSent:s-y.framesEncoded,k=1e3*T/n.statsInterval;h.sim_sent_framerate.push(Math.round(k));var I=(u-y.packetsLost)/(d-y.packetsSent);n._retransmittedRate=(f-y.retransmittedPacketsSent)/(d-y.packetsSent),I=Number.isNaN(I)?0:I,h.sim_fraction_lost.push(I),h.sim_keyencoded.push(m-y.pliCount>0),h.sim_retransmittedRate.push(n._retransmittedRate),r>0&&!b&&(n.sentKBitrate=8*S,n.encoderOutputFrameRate=E,n.encodedFrameCount=T,n.sentFrameRate=k,n.videoLossRate=I,b=!0)}})),h.vendor_mode=(null===(g=this._stream)||void 0===g?void 0:g.vendorCode)||0,h.pc_session_id=null===(y=this.handler)||void 0===y?void 0:y.peerConnectionId,null===(S=this._monitor)||void 0===S||S.report("rtc_media_statistics",h)):(n.encodedFrameCount=void 0!==i.framesSent?i.framesSent-v.framesSent:i.framesEncoded-v.framesEncoded,n.sentKBitrate=(i.bytesSent-v.bytesSent||0)/n.statsInterval*8,h.bitrate=Math.round(1e3*n.sentKBitrate),h.bandwidth=Math.round(h.bitrate/1024),n.encoderOutputFrameRate=1e3*(i.framesEncoded-v.framesEncoded)/n.statsInterval,h.frame_rate_encoded=Math.round(n.encoderOutputFrameRate),n.sentFrameRate=1e3*n.encodedFrameCount/n.statsInterval,h.frame_rate_sent=Math.round(n.sentFrameRate),n.videoLossRate=(i.packetsLost-v.packetsLost)/(i.packetsSent-v.packetsSent),n.videoLossRate=Number.isNaN(n.videoLossRate)?0:n.videoLossRate,h.fraction_lost=n.videoLossRate,n._retransmittedRate=(i.retransmittedPacketsSent-v.retransmittedPacketsSent)/(i.packetsSent-v.packetsSent),h.vendor_mode=(null===(E=this._stream)||void 0===E?void 0:E.vendorCode)||0,h.pc_session_id=null===(T=this.handler)||void 0===T?void 0:T.peerConnectionId,null===(k=this._monitor)||void 0===k||k.report("rtc_media_statistics",h)),r.video=i,n._fractionLost=Math.max(n._fractionLost,n.videoLossRate),e.abrupt("return",this.filterIllegal(n));case 33:case"end":return e.stop()}}),e,this)}))),function(e,r){return t.apply(this,arguments)})}]),i}(tV),nV=function(e){xI(o,e);var t,r,n,i=WI(o);function o(e,t){var r;return Yd(this,o),sd(Zk(r=i.call(this,e)),"isPaused",void 0),sd(Zk(r),"pauseStart",void 0),sd(Zk(r),"pauseDuration",void 0),sd(Zk(r),"_audioStallCount",void 0),sd(Zk(r),"_setAudioStallCount",void 0),sd(Zk(r),"_audioStallTimer",void 0),sd(Zk(r),"_audioStallInterval",void 0),sd(Zk(r),"_audioStallRatio",void 0),sd(Zk(r),"_videoInWaiting",void 0),r._stream=t,r._videoInWaiting=!1,r.pauseDuration=0,r}return qd(o,[{key:"setRemoteStreamStatsEvtInterval",value:(n=km(Em().mark((function e(t,r){var n,i,a,s,c,u,d,l,h,p,_,v,f,m,g,y=this;return Em().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!this._timer){e.next=2;break}return e.abrupt("return");case 2:return eV.print("setRemoteStreamStatsEvtInterval","invoke"),this.setVar(r),this._audioStallInterval=o.audioStallInterval||100,this._audioStallRatio=o.audioStallRatio||.6,s={audio:{},video:{}},this._destroyed=!1,c=this._stream,u=null===(n=c.audioTrack)||void 0===n?void 0:n.getOrgTrack(),d=null===(i=c.videoTrack)||void 0===i?void 0:i.getTrack(),this.getRemoteVideoStats(d,s),e.next=14,this.getRemoteAudioStats(u,s,null===(a=this._stream.audioTrack)||void 0===a?void 0:a.getAudioLevel());case 14:this._stopAudioStallTimer(),l=0,h=0,_=[],v=0,f=OO(),this._setAudioStallCount=function(){if(zP.AUDIO_STALL&&y._audioStallInterval>0&&void 0!==s.audio.concealedSamples){var e=s.audio.concealedSamples,t=s.audio.totalSamplesReceived;f=OO();var r={isStall:!1,counted:!1,diff:0},n=.5*y._audioStallInterval;y._audioStallCount=km(Em().mark((function i(){var o,a,s,u,d,p,m,g,S,b,E,T,k,I,R,A,C,w,x,O;return Em().wrap((function(i){for(;;)switch(i.prev=i.next){case 0:if(a=c.hasAudio,s=c.subAudio,u=c.virtual,d=c.virtualOccupy,a&&s){i.next=7;break}return r.isStall=!1,r.counted=!1,_.push({reason:wm(p="hasAudio: ".concat(a,", subAudio: ")).call(p,s)}),f=OO(),i.abrupt("return",{stall_count:l,stall_duration:h,stall_list:_,stats_count:v});case 7:if(!u||d){i.next=13;break}return r.isStall=!1,r.counted=!1,_.push({reason:wm(m="virtual: ".concat(u,", virtualOccupy: ")).call(m,d)}),f=OO(),i.abrupt("return",{stall_count:l,stall_duration:h,stall_list:_,stats_count:v});case 13:return g=null===(o=c.audioTrack)||void 0===o?void 0:o.getOrgTrack(),S=Date.now(),i.next=17,y.handler.getStats(g,!0);case 17:if(b=i.sent,E=Date.now(),T=OO(),!((k=T-f)<n)){i.next=24;break}return _.push({diff:k,start:f,end:T,get_stats_cost:E-S,get_stats_start:S,get_stats_end:E,reason:wm(I="diff(".concat(k,") < minInterval(")).call(I,n,")")}),i.abrupt("return",{stall_count:l,stall_duration:h,stall_list:_,stats_count:v});case 24:if(R=b.length,A=sE(b).call(b,(function(e){return"inbound-rtp"===e.type}))){i.next=29;break}return _.push({diff:k,start:f,end:T,get_stats_cost:E-S,get_stats_start:S,get_stats_end:E,reason:R?"no inbound-rtp":"no report"}),i.abrupt("return",{stall_count:l,stall_duration:h,stall_list:_,stats_count:v});case 29:return C=A.concealedSamples,w=A.totalSamplesReceived,O=w-t,(x=C-e)>=0&&O>=0&&x>=y._audioStallRatio*O?(_.push({concealed:x,received:O,diff:k,start:f,end:T,get_stats_cost:E-S,get_stats_start:S,get_stats_end:E,is_stall:!0}),r.isStall?(r.counted?h+=k:(h=h+r.diff+k,l++),r.counted=!0):k>=200?(h+=k,l++,r.counted=!0):(r.counted=!1,r.diff=k),r.isStall=!0):(_.push({concealed:x,received:O,diff:k,start:f,end:T,get_stats_cost:E-S,get_stats_start:S,get_stats_end:E}),r.isStall=!1,r.counted=!1),e=C,t=w,f=T,v++,i.abrupt("return",{stall_count:l,stall_duration:h,stall_list:_,stats_count:v});case 38:case"end":return i.stop()}}),i)}))),p=function(){var e=km(Em().mark((function e(){return Em().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!y._audioStallCount&&y._setAudioStallCount&&y._setAudioStallCount(),!y._audioStallCount){e.next=6;break}return e.next=4,y._audioStallCount();case 4:y._audioStallTimer&&clearTimeout(y._audioStallTimer),y._audioStallTimer=setTimeout(p,y._audioStallInterval);case 6:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}(),y._audioStallTimer&&clearTimeout(y._audioStallTimer),y._audioStallTimer=setTimeout(p,y._audioStallInterval)}},this._setAudioStallCount(),m=function(){var e=km(Em().mark((function e(){var t,r,n,i,o,a,u;return Em().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return i=null===(t=c.audioTrack)||void 0===t?void 0:t.getOrgTrack(),o=null===(r=c.videoTrack)||void 0===r?void 0:r.getTrack(),e.next=4,y.getRemoteAudioStats(i,s,null===(n=y._stream.audioTrack)||void 0===n?void 0:n.getAudioLevel());case 4:return a=e.sent,l=0,h=0,_=[],v=0,e.next=11,y.getRemoteVideoStats(o,s);case 11:return u=e.sent,e.abrupt("return",{audioStats:a,videoStats:u,isScreen:c.isScreen,userId:c.userId,streamId:c.streamId});case 13:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}(),g=function(){var e=km(Em().mark((function e(){var r;return Em().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,m();case 2:r=e.sent,t(r),p&&(f=OO(),y._audioStallTimer&&clearTimeout(y._audioStallTimer),y._audioStallTimer=setTimeout(p,y._audioStallInterval)),y._timer&&clearTimeout(y._timer),y._destroyed||(y._timer=setTimeout(g,2e3));case 7:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}(),this._timer&&clearTimeout(this._timer),this._timer=setTimeout(g,2e3);case 26:case"end":return e.stop()}}),e,this)}))),function(e,t){return n.apply(this,arguments)})},{key:"_stopAudioStallTimer",value:function(){clearTimeout(this._audioStallTimer),this._audioStallCount=void 0,this._setAudioStallCount=void 0,this.pauseDuration=0}},{key:"unsubscribe",value:function(){eV.print("unsubscribe","invoke"),CI(RI(o.prototype),"stopReport",this).call(this,"unsubscribe"),this._stopAudioStallTimer(),this._videoInWaiting=!1}},{key:"getRemoteAudioStats",value:(r=km(Em().mark((function e(t,r,n){var i,o,a,s,c,u,d,l,h,p,_,v,f,m,g,y,S,b,E,T,k,I,R,A,C,w,x=this;return Em().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(d={},l={},h=this._stream,p=h.streamId,_=h.userId,v=h.isScreen,f=h.audioMid,m=h.subMediaType,g=h._attributes,y=h.virtual,S=h.audioTrack,b={media_type:"audio",is_screen:!!v,direction:"down",stream_id:p,stream_user_id:_,vid:f,audio_mux:y,connection_status:navigator.onLine,track_enabled:null==t?void 0:t.enabled,mute_state:qO(m)?"mute_state_off":"mute_state_on",remote_user_capture_state:g.localaudio?"capture_state_on":"capture_state_off",remote_user_mute_state:g.localaudio&&g.audiostream?"mute_state_off":"mute_state_on"},S&&(b.playback_volume=S.getVolume()),t&&this.handler){e.next=7;break}return e.abrupt("return",d);case 7:return e.next=9,this.handler.getStats(t);case 9:if((E=e.sent).length){e.next=12;break}return e.abrupt("return",d);case 12:if(E.forEach((function(e){var t=e.type,r=e.packetsLost,i=e.packetsReceived,o=e.bytesReceived,a=e.jitterBufferDelay,s=e.jitterBufferEmittedCount,c=e.clockRate,u=e.channels,h=e.totalSamplesReceived,_=e.concealedSamples,v=e.silentConcealedSamples,f=e.concealmentEvents,m=e.totalRoundTripTime,g=e.packetsDiscarded,y=e.state,S=e.currentRoundTripTime,E=e.audioLevel,T=e.totalAudioEnergy,k=e.totalSamplesDuration,I=e.mimeType,R=e.googDecodingNormal,A=e.googDecodingMuted,C=e.availableIncomingBitrate,w=e.availableOutgoingBitrate,O=e.bytesSent,P=e.nominated,D=e.id,M=e.writable,N=e.jitter,L=e.candidateType,U=e.ip,V=e.address,F=e.networkType,B=e.port,j=e.protocol,G=e.audioOutputLevel,H=e.requestsReceived,z=e.responsesReceived,K=e.requestsSent,X=e.consentRequestsSent,W=e.responsesSent,q=e.ssrc;e.kind;var Y=e.nackCount,J=e.lastPacketReceivedTimestamp,Q=e.concealmentevents,Z=e.fecPacketsReceived;if("inbound-rtp"===t)l.packetsLost=r,l.packetsReceived=i,b.packetsLost=r,b.packetsReceived=i,b.packetsDiscarded=g,b.nackCount=Y,b.lastPacketReceivedTimestamp=J,b.concealmentevents=Q,l.bytesReceived=o,void 0!==a&&(d.jitterBufferDelay=a/s*1e3,b.average_jitter_buffer_delay_ms=d.jitterBufferDelay),void 0!==h&&(l.totalSamplesReceived=h,d.concealedSamples=_,l.concealedSamples=_,l.silentConcealedSamples=v,b.concealedSamples=_,d.concealmentEvents=f,b.totalSamplesReceived=h),void 0!==Z&&(b.fec_packets_received=Z,l.fecPacketsReceived=Z),b.jitter=1e3*N,b.ssrc=q,void 0!==E&&0!==E?(b.audio_level=E?-10*WA(Math.pow(E,2)):E,b.volume=255*E):(b.volume=null!=n?n:255*E,b.audio_level=n?-10*WA(Math.pow(n/255,2)):n),void 0!==T&&(b.total_audio_energy=T),void 0!==k&&(b.totalAudioDuration=k);else if("codec"===t)d.recordSampleRate=c,u&&(d.numChannels=u),b.codecName=I;else if("candidate-pair"===t){var $,ee,te;b.ice_available_incoming_bitrate=C,b.ice_available_outgoing_bitrate=w,b.ice_bytes_received=o,b.ice_bytes_sent=O,b.ice_nominated=+P,b.ice_pair_id=D,b.ice_pair_rtt=S,b.rtt=1e3*S,b.rtt&&null!==($=x._context)&&void 0!==$&&null!==(ee=$.streamRTT)&&void 0!==ee&&null!==(te=ee[p])&&void 0!==te&&te.audio&&(b.total_rtt_ms=Math.round(b.rtt+x._context.streamRTT[p].audio)),b.ice_pair_state=y,b.ice_pair_writable=M,b.recv_ping_requests=H,b.recv_ping_responses=z,b.sent_ping_requests_before_first_response=K,b.sent_ping_requests_total=K+(X||0),b.sent_ping_responses=W,"succeeded"===y&&(d.rtt=1e3*S,d.total_rtt=1e3*m)}else"track"===t&&void 0!==E?(0===E&&0!==n?(b.volume=n,b.audio_level=n?-10*WA(Math.pow(n/255,2)):n):(b.audio_level=E?-10*WA(Math.pow(E,2)):E,b.volume=255*E),b.total_audio_energy=T,b.totalAudioDuration=k):"ssrc"===t?(b.decodingNormal=R,b.recvAudioLevel=G,b.decodingMuted=A):"local-candidate"===t?(b.local_candidate_type=L,b.local_ip=U||V,b.local_network_type=F,b.local_port=B,b.protocol=j):"remote-candidate"===t&&(b.remote_candidate_type=L,b.remote_ip=U||V,b.remote_port=B)})),(T=r.audio).timestamp){e.next=18;break}return l.timestamp=Date.now(),r.audio=l,e.abrupt("return",this.filterIllegal(d));case 18:if(k={},void 0!==l.concealedSamples&&(b.interval_concealed_samples=l.concealedSamples-T.concealedSamples,b.interval_samples_received=l.totalSamplesReceived-T.totalSamplesReceived,b.interval_silent_concealed_samples=l.silentConcealedSamples-T.silentConcealedSamples),!(this._audioStallInterval>0&&void 0!==T.concealedSamples)){e.next=36;break}if(!this._audioStallCount&&this._setAudioStallCount&&this._setAudioStallCount(),clearTimeout(this._audioStallTimer),!this._audioStallCount){e.next=36;break}return e.next=26,this._audioStallCount();case 26:I=e.sent,R=I.stall_count,A=I.stall_duration,C=I.stall_list,w=I.stats_count,k.stall_list=C,k.stats_count=w,b.concealedSamples===b.interval_concealed_samples&&b.totalSamplesReceived===b.interval_samples_received?(b.stall_count=0,b.stall_duration=0):(b.stall_count=R,b.stall_duration=A),d.stallCount=b.stall_count,d.stallDuration=b.stall_duration;case 36:return l.timestamp=Date.now(),d.audioLossRate=(l.packetsLost-T.packetsLost)/(l.packetsReceived-T.packetsReceived+(l.packetsLost-T.packetsLost)),d.audioLossRate=Number.isNaN(d.audioLossRate)?0:d.audioLossRate,b.fraction_lost=d.audioLossRate,d.statsInterval=l.timestamp-T.timestamp,b.stats_interval=d.statsInterval,d.receivedKBitrate=(l.bytesReceived-T.bytesReceived||0)/d.statsInterval*8,b.bandwidth=Math.round(1e3*d.receivedKBitrate/1024),void 0!==l.concealedSamples&&(d.receivedSampleRate=1e3*b.interval_samples_received/d.statsInterval),void 0!==l.fecPacketsReceived&&(b.fecBitratebps=(l.fecPacketsReceived-T.fecPacketsReceived||0)/d.statsInterval),b.average_jitter_buffer_delay_ms&&b.total_rtt_ms&&(d.e2eDelay=b.average_jitter_buffer_delay_ms+b.total_rtt_ms),null!==(i=this._context)&&void 0!==i&&null!==(o=i.streamRTT)&&void 0!==o&&null!==(a=o[p])&&void 0!==a&&a.audio&&(d.totalRtt=(b.rtt?b.rtt:0)+this._context.streamRTT[p].audio),r.audio=l,b.vendor_mode=(null===(s=this._stream)||void 0===s?void 0:s.vendorCode)||0,b.pc_session_id=null===(c=this.handler)||void 0===c?void 0:c.peerConnectionId,null===(u=this._monitor)||void 0===u||u.report("rtc_media_statistics",b,k),e.abrupt("return",this.filterIllegal(d));case 53:case"end":return e.stop()}}),e,this)}))),function(e,t,n){return r.apply(this,arguments)})},{key:"getRemoteVideoStats",value:(t=km(Em().mark((function e(t,r){var n,i,o,a,s,c,u,d,l,h,p,_,v,f,m,g,y,S,b=this;return Em().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return u={},d={timestamp:Date.now()},l=this._stream,h=l.streamId,p=l.userId,_=l.isScreen,v=l.subMediaType,f=l._attributes,e.t0=ud,e.t1={media_type:"video",is_screen:!!_,direction:"down",stream_id:h,stream_user_id:p,vid:this._stream.videoMid,connection_status:navigator.onLine,track_enabled:null==t?void 0:t.enabled,mute_state:YO(v)?"mute_state_off":"mute_state_on",remote_user_capture_state:f.localvideo?"capture_state_on":"capture_state_off",remote_user_mute_state:f.localvideo&&f.videostream?"mute_state_off":"mute_state_on"},e.next=7,this._stream.requestVideoFrameCallback();case 7:if(e.t2=e.sent,m=(0,e.t0)(e.t1,e.t2),t&&this.handler){e.next=11;break}return e.abrupt("return",u);case 11:return u.isScreen=_,e.next=14,this.handler.getStats(t);case 14:if((g=e.sent).length){e.next=17;break}return e.abrupt("return",u);case 17:if(g.forEach((function(e){var t=e.type,r=e.frameHeight,n=e.frameWidth,i=e.packetsLost,o=e.packetsReceived,a=e.bytesReceived,s=e.framesDecoded,c=e.jitterBufferDelay,l=e.jitterBufferEmittedCount,p=e.mimeType,_=e.firCount,v=e.availableIncomingBitrate,f=e.availableOutgoingBitrate,g=e.bytesSent,y=e.nominated,S=e.id,E=e.currentRoundTripTime,T=e.state,k=e.writable,I=e.candidateType,R=e.ip,A=e.address,C=e.networkType,w=e.port,x=e.nackCount,O=e.pliCount,P=e.protocol,D=e.requestsReceived,M=e.responsesReceived,N=e.requestsSent,L=e.consentRequestsSent,U=e.responsesSent,V=e.ssrc,F=e.jitter,B=e.framesReceived,j=e.keyFramesDecoded,G=e.totalDecodeTime,H=e.decoderImplementation,z=e.lastPacketReceivedTimestamp,K=e.framesDropped;if("inbound-rtp"===t)d.packetsLost=i,m.packetsLost=i,d.packetsReceived=o,m.packetsReceived=o,d.bytesReceived=a,m.bytes=a,d.framesDecoded=s,d.totalDecodeTime=G,void 0!==c&&(d.jitterBufferDelay=c/l*1e3,m.average_jitter_buffer_delay_ms=d.jitterBufferDelay),m.fir_count=_,m.nackCount=x,d.nackCount=x,m.pli_count=O,m.ssrc=V,m.framesDropped=K,m.jitter=1e3*F,m.framesReceived=B,d.framesReceived=B,m.framesDecoded=s,m.key_frames_decoded=j,m.decoder_name=H,m.last_packet_received_timestamp=z,void 0!==n&&(u.width=n,m.frame_size_width=n,u.height=r,m.frame_size_height=r);else if("track"===t&&void 0!==n)u.width=n,m.frame_size_width=n,u.height=r,m.frame_size_height=r,void 0!==B&&(m.framesReceived=B,d.framesReceived=B);else if("codec"===t)m.codecName=p;else if("candidate-pair"===t){var X,W,q;m.ice_available_incoming_bitrate=v,m.ice_available_outgoing_bitrate=f,m.ice_bytes_received=a,m.ice_bytes_sent=g,m.ice_nominated=+y,m.ice_pair_id=S,m.ice_pair_rtt=E,m.rtt=1e3*E,m.rtt&&null!==(X=b._context)&&void 0!==X&&null!==(W=X.streamRTT)&&void 0!==W&&null!==(q=W[h])&&void 0!==q&&q.video&&(m.total_rtt_ms=Math.round(m.rtt+b._context.streamRTT[h].video)),u.rtt=m.rtt,m.ice_pair_state=T,m.ice_pair_writable=k,m.recv_ping_requests=D,m.recv_ping_responses=M,m.sent_ping_requests_before_first_response=N,m.sent_ping_requests_total=N+(L||0),m.sent_ping_responses=U}else"local-candidate"===t?(m.local_candidate_type=I,m.local_ip=R||A,m.local_network_type=C,m.local_port=w,m.protocol=P):"remote-candidate"===t&&(m.remote_candidate_type=I,m.remote_ip=R||A,m.remote_port=w)})),(y=r.video).timestamp){e.next=22;break}return r.video=d,e.abrupt("return",this.filterIllegal(u));case 22:return u.videoLossRate=(d.packetsLost-y.packetsLost)/(d.packetsReceived-y.packetsReceived+(d.packetsLost-y.packetsLost)),y.totalDecodeTime&&y.framesDecoded&&d.framesDecoded!==y.framesDecoded&&(m.decode_elapse_per_frame=+((d.totalDecodeTime-y.totalDecodeTime)/(d.framesDecoded-y.framesDecoded)*1e3).toFixed(2)),u._retransmittedRate=(d.nackCount-y.nackCount)/(d.packetsReceived-y.packetsReceived+(d.packetsLost-y.packetsLost)),u.videoLossRate=Number.isNaN(u.videoLossRate)?0:u.videoLossRate,m.fraction_lost=u.videoLossRate,u.statsInterval=d.timestamp-y.timestamp,m.stats_interval=u.statsInterval,u.receivedKBitrate=(d.bytesReceived-y.bytesReceived||0)/u.statsInterval*8,m.bitrate=Math.round(1e3*u.receivedKBitrate),m.bandwidth=Math.round(m.bitrate/1024),u.decoderOutputFrameRate=1e3*(d.framesDecoded-y.framesDecoded)/u.statsInterval,u.receivedFrameRate=1e3*(d.framesReceived-y.framesReceived)/u.statsInterval,m.frame_rate_decoded=Math.round(u.decoderOutputFrameRate),m.frame_rate_received=Math.round(u.receivedFrameRate),m.average_jitter_buffer_delay_ms&&m.total_rtt_ms&&(u.e2eDelay=m.average_jitter_buffer_delay_ms+m.total_rtt_ms),null!==(n=this._context)&&void 0!==n&&null!==(i=n.streamRTT)&&void 0!==i&&null!==(o=i[h])&&void 0!==o&&o.video&&(u.totalRtt=(m.rtt?m.rtt:0)+this._context.streamRTT[h].video),r.video=d,this.processStall(this._stream,m,u,_),this.isPaused?(S=d.timestamp-(this.pauseStart||0),m.pause_duration=this.pauseDuration+(S>500?S:0),this.pauseStart=d.timestamp):m.pause_duration=this.pauseDuration,m.pause_duration=Math.min(m.stall_duration||m.stuck_length||0,m.pause_duration),this.pauseDuration=0,m.vendor_mode=(null===(a=this._stream)||void 0===a?void 0:a.vendorCode)||0,m.pc_session_id=null===(s=this.handler)||void 0===s?void 0:s.peerConnectionId,null===(c=this._monitor)||void 0===c||c.report("rtc_media_statistics",m),e.abrupt("return",this.filterIllegal(u));case 47:case"end":return e.stop()}}),e,this)}))),function(e,r){return t.apply(this,arguments)})},{key:"processStall",value:function(e,t,r,n){var i=0,o=0,a=0;if(e.recordedVideoFrames&&this.player&&this.player.played){e.recordedVideoFrames.forEach((function(e){e.isStall&&(i+=e.stallCount,o+=e.stallDuration),a=e.playTime})),e.recordedVideoFrames.length||(o=2e3,i=this._videoInWaiting?0:1,this._videoInWaiting=!0);var s=e.recordedVideoFrames.pop();s&&(s.isStall?this._videoInWaiting=!0:this._videoInWaiting=!1),e.recordedVideoFrames=[]}t.stall_count=i,n?(t.stuck_length=Math.min(o,t.stats_interval),t.stall_duration=void 0):(t.stall_duration=Math.min(o,t.stats_interval),t.stuck_length=void 0),t.play_time=a,r.stallCount=i,r.stallDuration=o}},{key:"destroy",value:function(){CI(RI(o.prototype),"destroy",this).call(this),CI(RI(o.prototype),"stopReport",this).call(this,"destroy"),this._stopAudioStallTimer(),this._videoInWaiting=!1}}],[{key:"audioStallConfig",set:function(e){o.audioStallInterval=((null==e?void 0:e.audio_stall_interval)||200)/2,o.audioStallRatio=null==e?void 0:e.audio_stall_ratio}}]),o}(tV);sd(nV,"audioStallInterval",void 0),sd(nV,"audioStallRatio",void 0);var iV,oV,aV,sV,cV=new uO("Stream",0),uV=function(e){xI(r,e);var t=WI(r);function r(e){var n;return Yd(this,r),sd(Zk(n=t.call(this)),"videoDom",void 0),sd(Zk(n),"audioMid",void 0),sd(Zk(n),"videoMid",void 0),sd(Zk(n),"videoTransceiver",void 0),sd(Zk(n),"audioTransceiver",void 0),sd(Zk(n),"vendorHandler",void 0),sd(Zk(n),"vendorCode",0),sd(Zk(n),"engineId",void 0),n.engineId=e.id,n}return qd(r,[{key:"requestVideoFrameCallback",value:function(){var e=this;return new Wf((function(t){var r,n=null===(r=e.videoDom)||void 0===r?void 0:r.requestVideoFrameCallback;if("function"==typeof n){var i=function(e,r){var n={};an(r).forEach((function(e){var t=e.replace(/[a-z]{1}[A-Z]{1}/g,(function(e){var t;return wm(t="".concat(e[0],"_")).call(t,e[1].toLowerCase())}));n["video_".concat(t)]=r[e]})),clearInterval(o),t(n)};n.call(e.videoDom,i);var o=setTimeout((function(){var r;null===(r=e.videoDom)||void 0===r||r.cancelVideoFrameCallback(i),t({})}),500)}else t({})}))}},{key:"stopReport",value:function(e){this.statsReport.stopReport(e)}},{key:"destroy",value:function(){var e,t;delete this.audioMid,delete this.videoMid,this.statsReport.destroy(),null===(e=this.observer)||void 0===e||e.reset(),delete this.videoTransceiver,delete this.audioTransceiver,null===(t=this.vendorHandler)||void 0===t||t.destroy(),this.vendorCode=0,delete this.vendorHandler}}]),r}(bD),dV=function(e){return e[e.INIT=0]="INIT",e[e.SUB_ING=1]="SUB_ING",e[e.SUB_ED=2]="SUB_ED",e}(dV||{}),lV=function(e){xI(r,e);var t=WI(r);function r(e){var n;return Yd(this,r),sd(Zk(n=t.call(this,e)),"isScreen",!1),sd(Zk(n),"stream",void 0),sd(Zk(n),"streamId",void 0),sd(Zk(n),"seiList",[]),sd(Zk(n),"videoTrack",void 0),sd(Zk(n),"audioTrack",void 0),sd(Zk(n),"videoEncodeConfig",[qP]),sd(Zk(n),"subVideoDescriptions",[]),sd(Zk(n),"enableSimulcast",!1),sd(Zk(n),"observer",void 0),sd(Zk(n),"statsReport",void 0),sd(Zk(n),"prevBitrate",0),sd(Zk(n),"pubAudio",!1),sd(Zk(n),"pubVideo",!1),sd(Zk(n),"pubAttributes",void 0),sd(Zk(n),"pcSessionId",void 0),n.stream=new MediaStream,n.pubAttributes={localaudio:!1,localvideo:!1,videostream:!1,audiostream:!1,extvideo:!1,extaudio:!1},n.statsReport=new rV(e,Zk(n)),n}return qd(r,[{key:"audioHasCapture",get:function(){return this.pubAttributes.localaudio}},{key:"audioHasPublish",get:function(){return this.pubAttributes.audiostream}},{key:"videoHasCapture",get:function(){return this.pubAttributes.localvideo}},{key:"videoHasPublish",get:function(){return this.pubAttributes.videostream}},{key:"hasPublished",get:function(){return!!this.audioMid&&!!this.videoMid}},{key:"isEmptyStream",get:function(){return!this.audioTrack&&!this.videoTrack}},{key:"initStreamId",get:function(){return this.stream.id}},{key:"startReport",value:function(e,t){this.statsReport.setLocalStreamStatsEvtInterval(e,t)}},{key:"initVideoEncodedTransform",value:function(){var e=this;if(this.videoTransceiver&&this.videoTransceiver.sender){var t=this.videoTransceiver.sender;if(kN()){var r=t.createEncodedStreams(),n=r.readable,i=r.writable,o=new TransformStream({transform:function(t,r){var n=e.seiList[0];if(n){var i,o=$U.generateSEI(n.content),a=new Uint8Array(o.byteLength+t.data.byteLength);if(0===n.repeatCount)zE(i=e.seiList).call(i,0,1);n.repeatCount--,a.set(new Uint8Array(t.data)),a.set(o,t.data.byteLength),t.data=a.buffer,r.enqueue(t)}else r.enqueue(t)}});n.pipeThrough(o).pipeTo(i)}}else cV.print("no sender found when trying to bind encodedTransform")}},{key:"initAudioEncodedTransform",value:function(){if(this.audioTransceiver&&this.audioTransceiver.sender){var e=this.audioTransceiver.sender.createEncodedStreams(),t=e.readable,r=e.writable;t.pipeThrough(new TransformStream({transform:function(e,t){t.enqueue(e)}})).pipeTo(r)}else cV.print("no sender found when trying to bind encodedTransform")}},{key:"clean",value:function(){IO(this.engineId,"localstream_clean","".concat((new Error).stack),0,this.streamId||""),CI(RI(r.prototype),"destroy",this).call(this),this.prevBitrate=0,this.subVideoDescriptions=[]}},{key:"switchTrackEnableState",value:function(e,t){var r,n;"audio"===e?n=this.audioTrack:"video"===e&&(n=this.videoTrack);var i=null===(r=n)||void 0===r?void 0:r.getTrack();return!(!i||(null==i?void 0:i.enabled)===t)&&(i.enabled=t,!0)}}]),r}(uV),hV=function(e){xI(r,e);var t=WI(r);function r(e,n,i,o,a,s){var c;return Yd(this,r),sd(Zk(c=t.call(this,e)),"streamId",void 0),sd(Zk(c),"userId",void 0),sd(Zk(c),"isScreen",void 0),sd(Zk(c),"isPublic",void 0),sd(Zk(c),"hasVideo",void 0),sd(Zk(c),"hasAudio",void 0),sd(Zk(c),"_attributes",void 0),sd(Zk(c),"streamState",void 0),sd(Zk(c),"observer",void 0),sd(Zk(c),"statsReport",void 0),sd(Zk(c),"subVideo",void 0),sd(Zk(c),"subAudio",void 0),sd(Zk(c),"subMediaType",void 0),sd(Zk(c),"subLayer",void 0),sd(Zk(c),"_sequenceId",void 0),sd(Zk(c),"stream",void 0),sd(Zk(c),"videoTrack",void 0),sd(Zk(c),"audioTrack",void 0),sd(Zk(c),"recordedVideoFrames",void 0),sd(Zk(c),"stillExist",void 0),sd(Zk(c),"originalMediaType",void 0),sd(Zk(c),"priority",void 0),sd(Zk(c),"originalStreamIndex",0),sd(Zk(c),"virtual",void 0),sd(Zk(c),"pcSessionId",void 0),sd(Zk(c),"_virtualOccupy",void 0),c.virtual=!1,c._virtualOccupy=!1,c.userId=n,c.isScreen=o,c.isPublic=a,c.streamId=i,c.hasAudio=s.audiostream&&s.localaudio,c.hasVideo=s.videostream&&s.localvideo,c._attributes=s,c.vendorCode=(null==s?void 0:s.vendorCode)||0,c.subVideo=!1,c.subAudio=!1,c._sequenceId=0,c.subMediaType=zU.NONE,c.subLayer={spatialLayer:0,spatialSubLayer:-1},c.streamState=0,c.statsReport=new nV(e,Zk(c)),c.enableVendorMode&&(c.pcSessionId=rC()),c}return qd(r,[{key:"vendor",get:function(){return this._attributes.vendorCode}},{key:"audioHasCapture",get:function(){return this._attributes.localaudio}},{key:"audioHasPublish",get:function(){return this._attributes.audiostream}},{key:"videoHasCapture",get:function(){return this._attributes.localvideo}},{key:"videoHasPublish",get:function(){return this._attributes.videostream}},{key:"sequenceId",get:function(){return this._sequenceId||-1},set:function(e){"number"==typeof e&&(this._sequenceId=e)}},{key:"enableVendorMode",get:function(){return"number"==typeof this.attributes.vendorCode&&0!==this.attributes.vendorCode}},{key:"hasSubscribed",get:function(){return 2===this.streamState}},{key:"attributes",get:function(){return this._attributes},set:function(e){this.hasVideo=e.localvideo&&e.videostream,this.hasAudio=e.localaudio&&e.audiostream,this._attributes=e,this.vendorCode=e.vendorCode||0}},{key:"virtualOccupy",get:function(){return this._virtualOccupy},set:function(e){var t;if(this._virtualOccupy&&!e)null===(t=this.observer)||void 0===t||t.setPushTrack(!1);else if(!this._virtualOccupy&&e){var r;null===(r=this.observer)||void 0===r||r.setPushTrack(!0)}this._virtualOccupy=e}},{key:"initVideoEncodedTransform",value:function(){var e=this;if(this.videoTransceiver&&this.videoTransceiver.receiver){var t=this.videoTransceiver.receiver.createEncodedStreams(),r=t.readable,n=t.writable;r.pipeThrough(new TransformStream({transform:function(t,r){KU.getNalunits(new XU(t.data)).forEach((function(t){if(t.sei){var r=$U.decodeSeiBody(t.body);r&&r.type!==WU.internal&&e.safeEmit("onSEIMessage",r.payload)}})),r.enqueue(t)}})).pipeTo(n)}else cV.print("no receiver found when trying to bind encodedTransform")}},{key:"initAudioEncodedTransform",value:function(){if(this.audioTransceiver&&this.audioTransceiver.receiver){var e=this.audioTransceiver.receiver.createEncodedStreams(),t=e.readable,r=e.writable;t.pipeThrough(new TransformStream({transform:function(e,t){t.enqueue(e)}})).pipeTo(r)}else cV.print("no receiver found when trying to bind encodedTransform")}},{key:"ontrack",value:function(e){var t,r,n,i,o,a;try{var s;IO(this.engineId,"Stream.ontrack",eT({uid:this.userId,streamId:this.streamId,streams:tb(s=e.streams).call(s,(function(e,t){return e+(null==(r=t)?"undefined | null":"string"==typeof r?r:eT({id:r.id,active:r.active}));var r}),""),transceiver:(i=e.transceiver,null==i?"undefined | null":"string"==typeof i?i:eT({currentDirection:i.currentDirection,direction:i.direction,mid:i.mid,stopped:i.stopped,receiver:(a=i.receiver,null==a?"undefined | null":"string"==typeof a?a:eT({track:ZO(a.track)})),sender:(o=i.sender,null==o?"undefined | null":"string"==typeof o?o:eT({track:ZO(o.track)}))})),track:ZO(e.track)}),0,this.streamId||"")}catch(HX){}if(this.enableVendorMode||null!==(t=e.streams)&&void 0!==t&&null!==(r=t[0])&&void 0!==r&&null!==(n=r.id)&&void 0!==n&&vT(n).call(n,this.streamId)){var c,u=e.track;"video"===(null==u?void 0:u.kind)?this._setVideoTrack(u):"audio"===(null===(c=e.track)||void 0===c?void 0:c.kind)&&this._setAudioTrack(u),this._setStream(e.streams[0])}this.safeEmit("ontrack",e)}},{key:"clean",value:function(){var e,t;cV.print("clean",wm(e="exec stream.clean ".concat(this.streamId," ")).call(e,this.userId)),IO(this.engineId,"remotestream_clean","".concat((new Error).stack),0,this.streamId),CI(RI(r.prototype),"destroy",this).call(this),this.subAudio=!1,this.subVideo=!1,this.sequenceId=0,this.videoTrack=void 0,null===(t=this.audioTrack)||void 0===t||t.close(),this.audioTrack=void 0,this.stream=void 0,this.recordedVideoFrames=void 0,delete this.priority}},{key:"destroy",value:function(){this.clean(),this.attributes={audiostream:!1,localaudio:!1,localvideo:!1,videostream:!1,extvideo:!1,extaudio:!1,videoDescriptions:[]}}},{key:"resetHasSubscribed",value:function(){this.streamState=0}},{key:"_setStream",value:function(e){var t=this;this.stream=e,e.onaddtrack=function(e){"video"===e.track.kind?t._setVideoTrack(e.track):"audio"===e.track.kind&&t._setAudioTrack(e.track)}}},{key:"_setAudioTrack",value:function(e){var t,r;(null===(t=this.audioTrack)||void 0===t||null===(r=t.getTrack())||void 0===r?void 0:r.id)!==(null==e?void 0:e.id)&&(this.audioTrack=DU(e),this.emit("ontrack",this.audioTrack))}},{key:"_setVideoTrack",value:function(e){var t,r;(null===(t=this.videoTrack)||void 0===t||null===(r=t.getTrack())||void 0===r?void 0:r.id)!==(null==e?void 0:e.id)&&(this.videoTrack=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:xO();return new pU(e,t)}(e),this.emit("ontrack",this.videoTrack))}}]),r}(uV),pV=new uO("queue",4),_V=function(e){return e[e.ADD=0]="ADD",e[e.CLOSE=1]="CLOSE",e}(_V||{}),vV=function(e){return e.publish="publish",e.unpublish="unpublish",e.subscribe="subscribe",e.unsubscribe="unsubscribe",e.pushtrack="pushtrack",e.removetrack="removetrack",e}(vV||{}),fV=(sd(iV={},"publish","unpublish"),sd(iV,"subscribe","unsubscribe"),sd(iV,"pushtrack","removetrack"),iV),mV=(sd(oV={},"publish",0),sd(oV,"subscribe",0),sd(oV,"pushtrack",0),sd(oV,"unpublish",1),sd(oV,"unsubscribe",1),sd(oV,"removetrack",1),oV),gV=function(e){xI(r,e);var t=WI(r);function r(){var e;return Yd(this,r),sd(Zk(e=t.call(this)),"_queue",void 0),e._queue=[],e}return qd(r,[{key:"queue",get:function(){return this._queue}},{key:"enqueue",value:function(e){var t,r=this._queue.length,n="";return this._queue=Gs(t=this._queue).call(t,(function(t){return t.streamId!==e.streamId||e.action!==fV[t.action]||(n=t.streamId,pV.print("offsetStreamId",n),!1)})),this._queue.length===r&&this._queue.push(e),this.emit("start"),n}},{key:"dequeue",value:function(){var e;if(!this._queue.length)return null;var t=this._queue.length;cP&&wP>=86&&wP<=92&&(t=Math.min(this._queue.length,5));for(var r=mV[this._queue[0].action],n=1;n<t;n++){var i;if(mV[this._queue[n].action]!==r)return{sdpStrategy:r,items:zE(i=this._queue).call(i,0,n)}}return{sdpStrategy:r,items:zE(e=this._queue).call(e,0,t)}}}]),r}(yD),yV=new uO("ChromeHandler",3),SV=kN(),bV=function(e){xI(u,e);var t,r,n,i,o,a,s,c=WI(u);function u(e,t){var r;return Yd(this,u),sd(Zk(r=c.call(this,e,t)),"name","chrome"),sd(Zk(r),"_queueBusy",!1),sd(Zk(r),"_sdpQueue",void 0),sd(Zk(r),"_aSendonlyOfferTpl",void 0),sd(Zk(r),"_vSendonlyOfferTpl",void 0),sd(Zk(r),"_aRecvonlyOfferTpl",void 0),sd(Zk(r),"_vRecvonlyOfferTpl",void 0),sd(Zk(r),"_mid",10),sd(Zk(r),"_inactiveMlineIndex",[]),sd(Zk(r),"_mlinesCache",{}),sd(Zk(r),"setDescription",void 0),r.setDescription=t.setDescription.bind(t),r._sdpQueue=new gV,r._sdpQueue.on("start",(function(){r._queueBusy||"stable"!==r._peerConnection.signalingState||(yV.print("dequeue start"),r.dequeue())})),r}return qd(u,[{key:"destroy",value:function(){CI(RI(u.prototype),"destroy",this).call(this),this._mlinesCache={}}},{key:"publish",value:(s=km(Em().mark((function e(t){var r,n,i,o,a,s,c,d,l,h,p,_,v,f,m,g,y,S,b,E,T,k,I,R,A,C,w,x,O,P,D,M,N,L,U,V,F;return Em().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return d=t.stream,l=t.enableSimulcast,h=CI(RI(u.prototype),"internalPublish",this).call(this,t),p=h.videoDescriptions,_=h.subVideoDescriptions,v=h.audioTransceiverInit,f=h.videoTransceiverInit,m=YN(this._nextSsrc),this._nextSsrc=m.next,g="".concat(this._mid++),y="".concat(this._mid++),S=ud(ud(ud({},this._aSendonlyOfferTpl),this.peer._offerIce),{},{mid:g,msid:wm(r="".concat(d.id," ")).call(r,d.id,"-audio"),ssrcs:JN(d.id,"audio",m.audio,WN)}),b=ud(ud(ud({},this._vSendonlyOfferTpl),this.peer._offerIce),{},{mid:y,msid:wm(n="".concat(d.id," ")).call(n,d.id,"-video")}),l?(yV.print("subVideoDesc","desc: %o ",_),delete b.ssrcGroups,delete b.ssrcs,E=[],b.rids=JE(p).call(p,(function(e){var t=e.rid;return E.unshift(t),{id:t,direction:"send"}})),b.simulcast={dir1:"send",list1:E.join(";")}):(T=QN(d.id,m,{cname:WN}),k=T.ssrcs,I=T.ssrcGroups,b.ssrcs=k,b.ssrcGroups=I),null!==(i=this._context)&&void 0!==i&&null!==(o=i.serverConfig)&&void 0!==o&&o.audioRed&&Array.isArray(S.rtp)&&(-1!==(A=WR(R=S.rtp).call(R,(function(e){return"red"===e.codec})))&&(w=zE(C=S.rtp).call(C,A,1),x=Qk(w,1),O=x[0],S.rtp.unshift(O)),P=[],S.rtp.forEach((function(e){return P.push(e.payload)})),S.payloads=P.join(" ")),null!==(a=this._context)&&void 0!==a&&null!==(s=a.serverConfig)&&void 0!==s&&s.videoCodec&&iL(b,null===(D=this._context)||void 0===D||null===(M=D.serverConfig)||void 0===M?void 0:M.videoCodec),(sP||gP)&&Array.isArray(b.ext)&&(b.ext=Gs(N=b.ext).call(N,(function(e){var t;return!(null!=e&&null!==(t=e.uri)&&void 0!==t&&vT(t).call(t,"video-orientation"))}))),(L=null==S?void 0:sE(c=S.rtp).call(c,(function(e){return"opus"===e.codec})))&&S.fmtp&&(F=sE(U=S.fmtp).call(U,(function(e){return e.payload===L.payload})))&&null!==(V=this._context)&&void 0!==V&&V.audioProfileManager&&(F.config=this._context.audioProfileManager.getOpusConfigStr(F.config)),l||sP||this.addBitrateLimit(b,t.videoEncodeConfig[0].maxKbps),this._mlinesCache[t.stream.id]=[S,b],e.abrupt("return",{partialSdp:$N(this.peer._offerSession,S,b),audioMid:g,videoMid:y,type:"incroffer",semantics:"unified-plan",videoDescriptions:p,subVideoDescriptions:_,audioTransceiverInit:v,videoTransceiverInit:f,peerConnectionMode:this.peerConnectionMode});case 17:case"end":return e.stop()}}),e,this)}))),function(e){return s.apply(this,arguments)})},{key:"subscribe",value:(a=km(Em().mark((function e(t,r){var n,i,o,a,s,c,u,d,l,h,p,_,v,f,m,g,y,S,b,E,T,k,I,R,A,C,w,x,O,P,D,M,N,L,U,V=this;return Em().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(yV.print("subscribe"),a="incroffer",s="unified-plan",this._aRecvonlyOfferTpl&&this._vRecvonlyOfferTpl){e.next=9;break}return e.next=6,this._genOfferSdp();case 6:return c=e.sent,e.next=9,this.createAVMlineOfferTpl(c);case 9:if(u="",d="",l=!1,h=!1,p=void 0,_=void 0,this._mlinesCache[t.streamId]=[p,_],t.virtual?(u="".concat(this._mid++),l=!0):r.multiChatMode?(u="".concat(this._mid++),d="".concat(this._mid++),h=!0):(l=!0,h=!0,u="".concat(this._mid++),d="".concat(this._mid++)),u&&(p=ud(ud({},this._aRecvonlyOfferTpl),{},{mid:u})),l&&(this._mlinesCache[t.streamId][0]=p,v={track:"audio",init:{direction:"recvonly"}}),d&&(_=ud(ud({},this._vRecvonlyOfferTpl),{},{mid:d})),h&&(this._mlinesCache[t.streamId][1]=_,f={track:"video",init:{direction:"recvonly"}}),m=$N(this.peer._offerSession,p,_),g=void 0,t.enableVendorMode||r.multiChatMode||t.virtual||!this._aSendonlyAnswerTpl||!this._vSendonlyAnswerTpl){e.next=32;break}return g=YN(this._nextSsrc),this._nextSsrc=g.next,R=ud(ud(ud({},this._aSendonlyAnswerTpl),this.peer._answerIce),{},{mid:u,msid:wm(y=wm(S="".concat(t.streamId)).call(S,null!==(b=this._context)&&void 0!==b&&b.avSync?"":"-audio"," ")).call(y,t.streamId,"-audio"),ssrcs:JN(t.streamId,"audio",g.audio)}),A=ud(ud(ud({},this._vSendonlyAnswerTpl),this.peer._answerIce),{},{mid:d,msid:wm(E=wm(T="".concat(t.streamId)).call(T,null!==(k=this._context)&&void 0!==k&&k.avSync?"":"-video"," ")).call(E,t.streamId,"-video")},QN(t.streamId,g,{flexfec:this._enableSubFlexfec})),C=new Wf((function(e){V._sdpQueue.enqueue({action:vV.subscribe,streamId:t.streamId,audioMid:u,videoMid:d,audioTransceiverInit:v,videoTransceiverInit:f,signalingAck:{sdp:DN.write(ud(ud({},V.peer._answerSession),{},{media:[R,A]})),sequenceId:t.sequenceId?++t.sequenceId:0},stream:t,sdp:m,onSuccess:function(){yV.print("subscribe()","sub success"),e(0)}})})),e.next=31,C;case 31:null===(I=g)||void 0===I||delete I.next;case 32:return(w=null===(n=p)||void 0===n?void 0:sE(i=n.rtp).call(i,(function(e){return"opus"===e.codec})))&&null!==(o=p)&&void 0!==o&&o.fmtp&&(P=null===(x=p)||void 0===x?void 0:sE(O=x.fmtp).call(O,(function(e){return e.payload===w.payload})))&&this._context&&(P.config+=";stereo=1;sprop-stereo=1"),t.isPublic&&wP>=86&&null!=(L=null===(D=_)||void 0===D?void 0:Gs(M=D.rtp).call(M,(function(e){return"H264"===e.codec})))&&L.length&&null!==(N=_)&&void 0!==N&&N.fmtp&&(null===(U=_)||void 0===U||U.fmtp.forEach((function(e){sE(L).call(L,(function(t){return t.payload===e.payload}))&&(e.config+=";sps-pps-idr-in-keyframe=1")}))),e.abrupt("return",{partialSdp:m,audioMid:u,videoMid:d,type:a,semantics:s,audioTransceiverInit:v,videoTransceiverInit:f,allSsrc:g,peerConnectionMode:this.peerConnectionMode});case 36:case"end":return e.stop()}}),e,this)}))),function(e,t){return a.apply(this,arguments)})},{key:"handleAck",value:(o=km(Em().mark((function e(t){return Em().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(yV.print("handleAck()","item: %o",t),!t.generatorSsrc){e.next=4;break}return yV.print("already set remote"),e.abrupt("return","");case 4:return e.abrupt("return",this._sdpQueue.enqueue(t));case 5:case"end":return e.stop()}}),e,this)}))),function(e){return o.apply(this,arguments)})},{key:"dequeue",value:(i=km(Em().mark((function e(){var t,r,n,i,o,a,s,c,u,d,l,h,p,_,v,f=this;return Em().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this._queueBusy=!0,t=this._sdpQueue.dequeue(),yV.print("dequeue()","ret: %o",t),t){e.next=6;break}return this._queueBusy=!1,e.abrupt("return");case 6:if(e.prev=6,r=t.items,n=t.sdpStrategy,i=[],o=[],a=[],n!==_V.ADD){e.next=15;break}return e.delegateYield(Em().mark((function e(){var t,n;return Em().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:delete(t=ud({},f.peer._answerIce)).candidates,s=!1,c=!1,e.prev=4,d=PD(r);case 6:return e.next=8,d.next();case 8:if(!(s=!(l=e.sent).done)){e.next=16;break}if(n=l.value,"break"!==function(){var e=n.audioMid,r=n.videoMid,s=n.action,c=n.audioTransceiverInit,u=n.videoTransceiverInit,d=n.signalingAck,l=n.stream,h=l instanceof hV;if(n.onSuccess&&a.push(n.onSuccess),h&&(null==d?void 0:d.sequenceId)<l.sequenceId)return"break";var p,_={},v={},m=DN.parse(d.sdp);Array.isArray(m.media)&&VR(p=m.media).call(p,(function(e,t){var r;return null==e||null===(r=e.type)||void 0===r?void 0:r.localeCompare(null==t?void 0:t.type)})).forEach((function(n){"audio"===(n=ud(ud({},n),t)).type?(_=n).mid=e:(v=n).mid=r}));var g,y=l.streamId;if(s===vV.publish&&(y=null===(g=l.stream)||void 0===g?void 0:g.id),!f._mlinesCache[y])return"break";var S=Qk(f._mlinesCache[y],2),b=S[0],E=S[1];if(c&&b){l.audioTransceiver=f._peerConnection.addTransceiver(c.track,c.init),f._reportRtcInvokeStatus("chromeHandler.addTrack",eT({audioStreamTrack:ZO(c.track)}));var T=f._inactiveMlineIndex.shift();T||(T=f.peer._offerMlines.length),f.peer._offerMlines[T]=ud({},b),f.peer._answerMlines[T]=_,SV&&l.initAudioEncodedTransform()}if(u&&E){var k,I;l.videoTransceiver=f._peerConnection.addTransceiver(u.track,u.init),f._reportRtcInvokeStatus("chromeHandler.addTrack",eT({videoStreamTrack:ZO(u.track)}));var R,A,C=f._inactiveMlineIndex.shift();C||(C=f.peer._offerMlines.length),f.peer._offerMlines[C]=ud({},E),s===vV.publish&&null!==(k=f._context)&&void 0!==k&&null!==(I=k.serverConfig)&&void 0!==I&&I.videoCodec&&iL(v,null===(R=f._context)||void 0===R||null===(A=R.serverConfig)||void 0===A?void 0:A.videoCodec),f.peer._answerMlines[C]=v,SV&&l.initVideoEncodedTransform()}i.push(l.streamId||""),o.push(h?l.userId:"local"),h&&(l.sequenceId=null==d?void 0:d.sequenceId),delete f._mlinesCache[y]}()){e.next=13;break}return e.abrupt("break",16);case 13:s=!1,e.next=6;break;case 16:e.next=22;break;case 18:e.prev=18,e.t0=e.catch(4),c=!0,u=e.t0;case 22:if(e.prev=22,e.prev=23,!s||null==d.return){e.next=27;break}return e.next=27,d.return();case 27:if(e.prev=27,!c){e.next=30;break}throw u;case 30:return e.finish(27);case 31:return e.finish(22);case 32:case"end":return e.stop()}}),e,null,[[4,18,22,32],[23,,27,31]])}))(),"t0",13);case 13:e.next=20;break;case 15:v={},r.forEach((function(e){var t=e.audioMid,r=e.videoMid,n=e.action;v[t]=t,n!==vV.removetrack&&(v[r]=r),v[t]=t})),this.peer._offerMlines=JE(h=this.peer._offerMlines).call(h,(function(e,t){return v[e.mid]&&(e=ZN(e),f._inactiveMlineIndex.push(t)),e})),VR(p=this._inactiveMlineIndex).call(p,(function(e,t){return e-t})),this.peer._answerMlines=JE(_=this.peer._answerMlines).call(_,(function(e){return v[e.mid]&&(e=ZN(e)),e}));case 20:return e.next=22,this.setDescription(i.length?{streamId:i.join(","),streamUserId:o.join(",")}:void 0);case 22:try{a.forEach((function(e){return e()}))}catch(HX){}yV.print("dequeue","loop"),e.next=29;break;case 26:e.prev=26,e.t1=e.catch(6),yV.print("dequeue","unknown error: %o",e.t1);case 29:return e.prev=29,this.dequeue(),e.finish(29);case 32:case"end":return e.stop()}}),e,this,[[6,26,29,32]])}))),function(){return i.apply(this,arguments)})},{key:"getDefaultSdp",value:(n=km(Em().mark((function e(){var t,r,n,i;return Em().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this._genOfferSdp();case 2:return r=e.sent,this.createAVMlineOfferTpl(r),n=DN.parse(r),i=[],n.media=Gs(t=n.media).call(t,(function(e){var t;return"recvonly"===e.direction&&(Array.isArray(e.ext)&&(e.ext=Gs(t=e.ext).call(t,(function(e){return"urn:ietf:params:rtp-hdrext:sdes:rtp-stream-id"!==e.uri}))),i.push(e.mid+""),!0)})),n.groups=[{mids:i.join(" "),type:"BUNDLE"}],e.abrupt("return",{sdp:DN.write(n),semantics:"unified-plan",type:"incroffer"});case 9:case"end":return e.stop()}}),e,this)}))),function(){return n.apply(this,arguments)})},{key:"rollback",value:(r=km(Em().mark((function e(t){return Em().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:delete this._mlinesCache[t];case 1:case"end":return e.stop()}}),e,this)}))),function(e){return r.apply(this,arguments)})},{key:"createAVMlineOfferTpl",value:function(e){var t=this;DN.parse(e).media.forEach((function(e){if("audio"===e.type)if("sendonly"===e.direction)t._aSendonlyOfferTpl=e;else{var r;if(Array.isArray(e.ext))e.ext=Gs(r=e.ext).call(r,(function(e){return"urn:ietf:params:rtp-hdrext:sdes:rtp-stream-id"!==e.uri}));t._aRecvonlyOfferTpl=e}else if("video"===e.type)if("sendonly"===e.direction)t._vSendonlyOfferTpl=e;else{var n;if(Array.isArray(e.ext))e.ext=Gs(n=e.ext).call(n,(function(e){return"urn:ietf:params:rtp-hdrext:sdes:rtp-stream-id"!==e.uri}));t._vRecvonlyOfferTpl=e}}))}},{key:"_genOfferSdp",value:(t=km(Em().mark((function e(){var t,r;return Em().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,KO(!0);case 3:if(t=e.sent){e.next=6;break}throw"pc.createOffer() return empty.";case 6:e.next=12;break;case 8:throw e.prev=8,e.t0=e.catch(0),r="Get offer Error. ".concat(e.t0.message|e.t0),new lA(uA.NOT_SUPPORTED,r);case 12:return e.abrupt("return",t);case 13:case"end":return e.stop()}}),e,null,[[0,8]])}))),function(){return t.apply(this,arguments)})}]),u}(aL),EV=new uO("FirefoxHandler",3),TV=function(e){xI(d,e);var t,r,n,i,o,a,s,c,u=WI(d);function d(){var e,t;Yd(this,d);for(var r=arguments.length,n=new Array(r),i=0;i<r;i++)n[i]=arguments[i];return sd(Zk(t=u.call.apply(u,wm(e=[this]).call(e,n))),"name","firefox"),sd(Zk(t),"_aRecvonlyOfferTpl",void 0),t}return qd(d,[{key:"publish",value:(c=km(Em().mark((function e(t){var r,n,i,o,a,s,c,u,l,h,p,_,v,f,m=this;return Em().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return i=CI(RI(d.prototype),"internalPublish",this).call(this,t),o=i.videoDescriptions,a=i.subVideoDescriptions,s=i.audioTransceiverInit,c=i.videoTransceiverInit,t.audioTransceiver=this._peerConnection.addTransceiver(s.track,s.init),t.videoTransceiver=this._peerConnection.addTransceiver(c.track,c.init),u=OO(),this._report("rtc_begin_create_offer",{direction:"up",stream_id:"",stream_user_id:"",pc_session_id:this.peerConnectionId,vendor_mode:0}),e.next=7,this._peerConnection.createOffer();case 7:return l=e.sent,this._report("rtc_create_offer",{direction:"up",error_code:0,stream_id:"",stream_user_id:"",elapse:OO()-u}),(h=DN.parse(l.sdp)).media=null===(r=h.media)||void 0===r?void 0:JE(r).call(r,(function(e){return ud(ud({},e),m.peer._offerIce)})),e.next=13,this.setLocalDescription(DN.write(h));case 13:return p=t.audioTransceiver.mid,_=t.videoTransceiver.mid,v=null,f=null,h.media=null===(n=h.media)||void 0===n?void 0:JE(n).call(n,(function(e){if("".concat(e.mid)===p){var t,r,n=null===(t=v=e)||void 0===t?void 0:sE(r=t.rtp).call(r,(function(e){return"opus"===e.codec}));if(n&&v.fmtp){var i,o,a=sE(i=v.fmtp).call(i,(function(e){return e.payload===n.payload}));a&&null!==(o=m._context)&&void 0!==o&&o.audioProfileManager&&(a.config=m._context.audioProfileManager.getOpusConfigStr(a.config))}}else if("".concat(e.mid)===_){var s,c,u,d;null!==(s=m._context)&&void 0!==s&&null!==(c=s.serverConfig)&&void 0!==c&&c.videoCodec&&iL(e,null===(u=m._context)||void 0===u||null===(d=u.serverConfig)||void 0===d?void 0:d.videoCodec),f=e}return e})),this.addBitrateLimit(f,t.videoEncodeConfig[0].maxKbps),e.next=21,this.setLocalDescription(DN.write(h));case 21:return e.abrupt("return",{partialSdp:$N(h,v,f,!1),audioMid:p,videoMid:_,type:"incroffer",semantics:"unified-plan",videoDescriptions:o,subVideoDescriptions:a,audioTransceiverInit:s,videoTransceiverInit:c,peerConnectionMode:this.peerConnectionMode});case 22:case"end":return e.stop()}}),e,this)}))),function(e){return c.apply(this,arguments)})},{key:"subscribe",value:(s=km(Em().mark((function e(t,r){var n,i,o,a,s,c,u,d,l,h,p,_,v,f,m,g,y,S,b,E,T,k,I,R,A=this;return Em().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return EV.print("subscribe()"),c="",u="",d=!1,l=!1,h=void 0,p=void 0,t.virtual?d=!0:(r.multiChatMode||(d=!0),l=!0),d&&(t.audioTransceiver=this._peerConnection.addTransceiver("audio",{direction:"recvonly"})),l&&(t.videoTransceiver=this._peerConnection.addTransceiver("video",{direction:"recvonly"})),_=OO(),this._report("rtc_begin_create_offer",{direction:"up",stream_id:t.streamId,stream_user_id:t.userId,pc_session_id:this.peerConnectionId,vendor_mode:0}),e.next=14,this._peerConnection.createOffer();case 14:return v=e.sent,this._report("rtc_create_offer",{error_code:0,direction:"up",stream_id:t.streamId,stream_user_id:t.userId,elapse:OO()-_}),(f=DN.parse(v.sdp)).media=null===(n=f.media)||void 0===n?void 0:JE(n).call(n,(function(e){return ud(ud({},e),A.peer._offerIce)})),JE(i=f.media).call(i,(function(e){var t,r;"video"===e.type&&(e.ext=null===(t=e.ext)||void 0===t?void 0:Gs(t).call(t,(function(e){var t;return-1===gE(t=e.uri).call(t,"abs-send-time")})),e.rtcpFb=null===(r=e.rtcpFb)||void 0===r?void 0:Gs(r).call(r,(function(e){return"goog-remb"!==e.type})))})),e.next=21,this.setLocalDescription(DN.write(f),{streamId:t.streamId||"",streamUserId:t.userId});case 21:if(c=null===(o=t.audioTransceiver)||void 0===o?void 0:o.mid,u=null===(a=t.videoTransceiver)||void 0===a?void 0:a.mid,null===(s=f.media)||void 0===s||s.forEach((function(e){"".concat(e.mid)===c?h=e:"".concat(e.mid)===u&&(p=e)})),c&&h||(c="audio_".concat(u),h=ud(ud({},this._aRecvonlyOfferTpl),{},{mid:c})),t.audioMid=c,t.videoMid=u,m=void 0,r.multiChatMode||t.virtual||!this._aSendonlyAnswerTpl||!this._aSendonlyAnswerTpl){e.next=36;break}return m=YN(this._nextSsrc),this._nextSsrc=m.next,I=ud(ud(ud({},this._aSendonlyAnswerTpl),this.peer._answerIce),{},{mid:c,msid:wm(g=wm(y="".concat(t.streamId)).call(y,null!==(S=this._context)&&void 0!==S&&S.avSync?"":"-audio"," ")).call(g,t.streamId,"-audio"),ssrcs:JN(t.streamId,"audio",m.audio)}),R=ud(ud(ud({},this._vSendonlyAnswerTpl),this.peer._answerIce),{},{mid:u,msid:wm(b=wm(E="".concat(t.streamId)).call(E,null!==(T=this._context)&&void 0!==T&&T.avSync?"":"-video"," ")).call(b,t.streamId,"-video")},QN(t.streamId,m,{flexfec:this._enableSubFlexfec})),e.next=35,this._internalSetRemoteDescription([I,R],t);case 35:null===(k=m)||void 0===k||delete k.next;case 36:return e.abrupt("return",{partialSdp:$N(f,h,p,!1),audioMid:c,videoMid:u,type:"incroffer",semantics:"unified-plan",audioTransceiverInit:t.audioTransceiver?{track:"audio",init:{direction:"recvonly"}}:void 0,videoTransceiverInit:t.videoTransceiver?{track:"video",init:{direction:"recvonly"}}:void 0,allSsrc:m,peerConnectionMode:this.peerConnectionMode});case 37:case"end":return e.stop()}}),e,this)}))),function(e,t){return s.apply(this,arguments)})},{key:"handleAck",value:(a=km(Em().mark((function e(t){var r,n,i,o;return Em().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(r=t.signalingAck,n=t.stream,(i=t.action)!==vV.unpublish&&i!==vV.unsubscribe&&i!==vV.removetrack){e.next=5;break}return e.next=4,this.close(n);case 4:return e.abrupt("return",n.streamId||"");case 5:if(!t.generatorSsrc){e.next=8;break}return EV.print("already set remote"),e.abrupt("return","");case 8:return o=DN.parse(null==r?void 0:r.sdp),e.next=11,this._internalSetRemoteDescription(o.media,n);case 11:return e.abrupt("return","");case 12:case"end":return e.stop()}}),e,this)}))),function(e){return a.apply(this,arguments)})},{key:"_internalSetRemoteDescription",value:(o=km(Em().mark((function e(t,r){var n,i,o,a,s,c,u,d,l=this;return Em().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return s={},(c=DN.parse(null===(n=this._peerConnection.remoteDescription)||void 0===n?void 0:n.sdp)).media.forEach((function(e){void 0!==e.mid&&(s[e.mid]=e)})),t.forEach((function(e){if("audio"===(e=ud(ud({},e),l.peer._answerIce)).type&&(r.audioMid?(e.mid=r.audioMid,s[r.audioMid]=e):s[e.mid]=e),"video"===e.type){if(r instanceof lV&&IP<=87){var t,n,i,o,a={};Array.isArray(e.rtp)&&(e.rtp=Gs(t=e.rtp).call(t,(function(e){return"rtx"!==e.codec||(a[e.payload]=e.payload,!1)}))),"string"==typeof e.payloads&&(e.payloads=Gs(n=e.payloads.split(" ")).call(n,(function(e){return!a[e]})).join(" ")),Array.isArray(e.fmtp)&&(e.fmtp=Gs(i=e.fmtp).call(i,(function(e){return!a[e.payload]}))),Array.isArray(e.rtcpFb)&&(e.fmtp=Gs(o=e.fmtp).call(o,(function(e){return!a[e.payload]})))}r.videoMid?(e.mid=r.videoMid,s[r.videoMid]=e):s[e.mid]=e}})),u=DN.parse(null===(i=this._peerConnection.localDescription)||void 0===i?void 0:i.sdp),d=JE(o=u.media).call(o,(function(e){var t=s[e.mid];return"inactive"===e.direction?e:t})),c.groups=u.groups,c.media=d,JE(a=c.media).call(a,(function(e){var t,r;"video"===e.type&&(e.ext=null===(t=e.ext)||void 0===t?void 0:Gs(t).call(t,(function(e){var t;return-1===gE(t=e.uri).call(t,"abs-send-time")})),e.rtcpFb=null===(r=e.rtcpFb)||void 0===r?void 0:Gs(r).call(r,(function(e){return"goog-remb"!==e.type})))})),e.next=11,this.setRemoteDescription(DN.write(c));case 11:case"end":return e.stop()}}),e,this)}))),function(e,t){return o.apply(this,arguments)})},{key:"getDefaultSdp",value:(i=km(Em().mark((function e(){var t,r,n,i,o;return Em().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return i=DN.parse(null===(t=this._peerConnection.localDescription)||void 0===t?void 0:t.sdp),this.createAVMlineOfferTpl(null===(r=this._peerConnection.localDescription)||void 0===r?void 0:r.sdp),o=[],i.media=Gs(n=i.media).call(n,(function(e){return"recvonly"===e.direction&&(e.mid=e.mid+1,o.push(e.mid+""),!0)})),i.groups=[{mids:o.join(" "),type:"BUNDLE"}],e.abrupt("return",{sdp:DN.write(i),semantics:"unified-plan",type:"incroffer"});case 6:case"end":return e.stop()}}),e,this)}))),function(){return i.apply(this,arguments)})},{key:"rollback",value:(n=km(Em().mark((function e(t,r,n){return Em().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return EV.print("rollback()"),e.abrupt("return",this.close(r));case 2:case"end":return e.stop()}}),e,this)}))),function(e,t,r){return n.apply(this,arguments)})},{key:"close",value:(r=km(Em().mark((function e(t,r){var n,i,o,a,s,c,u,d,l,h=this;return Em().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return EV.print("close()"),a={},t.audioTransceiver&&t.audioMid&&(t.audioTransceiver.stop(),a[t.audioMid]=t.audioMid),t.videoTransceiver&&t.videoMid&&!r&&(t.videoTransceiver.stop(),a[t.videoMid]=t.videoMid),s=[],e.next=7,this._peerConnection.createOffer();case 7:return c=e.sent,(u=DN.parse(null==c?void 0:c.sdp)).media=JE(n=u.media).call(n,(function(e){return a[e.mid]&&(e=ZN(e)),"inactive"!==e.direction&&s.push(e.mid),ud(ud({},e),h.peer._offerIce)})),d=DN.parse(null===(i=this._peerConnection.remoteDescription)||void 0===i?void 0:i.sdp),l={},d.media.forEach((function(e){void 0!==e.mid&&(l[e.mid]=e)})),d.media=JE(o=u.media).call(o,(function(e){return"inactive"===e.direction?e:l[e.mid]})),u.groups&&d.groups&&(u.groups[0].mids=s.join(" "),d.groups[0].mids=s.join(" ")),e.next=17,this.setLocalDescription(DN.write(u));case 17:return e.next=19,this.setRemoteDescription(DN.write(d));case 19:case"end":return e.stop()}}),e,this)}))),function(e,t){return r.apply(this,arguments)})},{key:"setCurrentDescription",value:(t=km(Em().mark((function e(){return Em().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this._peerConnection.createOffer();case 2:if(!this._peerConnection.localDescription||!this._peerConnection.remoteDescription){e.next=7;break}return e.next=5,this._peerConnection.setLocalDescription(this._peerConnection.localDescription);case 5:return e.next=7,this._peerConnection.setRemoteDescription(this._peerConnection.remoteDescription);case 7:case"end":return e.stop()}}),e,this)}))),function(){return t.apply(this,arguments)})},{key:"createAVMlineOfferTpl",value:function(e){var t=this;DN.parse(e).media.forEach((function(e){"audio"===e.type&&(t._aRecvonlyOfferTpl=e)}))}}]),d}(aL),kV=function(e,t){return aP?new TV(e,t):new bV(e,t)},IV=function(e){return e.streamRemovedBySchedule308="stream removed",e.clientRePublish="client republish",e.publishStreamFaied="publish failed",e.clientUnPublish="client unpublished",e.clientDisconnected="client disconnected",e.videoMuted="video muted",e}(IV||{}),RV=function(e){return e.PushLimitWarn="PushLimitWarn",e}(RV||{}),AV=function(e){return e.ON_ADD_STREAM="onAddStream",e.ON_ADD_STREAM_LIST="onAddStreamList",e.ON_REMOVE_STREAM="onRemoveStream",e.ON_REMOVE_STREAM_LIST="onRemoveStreamList",e.USER_DISCONNECTION="userDisconnection",e.USER_DISCONNECTION_LIST="userDisconnectionList",e.USER_CONNECTION="userConnection",e.USER_CONNECTION_LIST="userConnectionList",e.ON_UPDATE_STREAM_ATTRIBUTES="onUpdateStreamAttributes",e.ON_UPDATE_ROOM_ATTRIBUTES="onUpdateRoomAttributes",e.ON_UPDATE_USER_ATTRIBUTES="onUpdateUserAttributes",e.ON_PUSH_TRACK="onPushTrack",e.ON_REMOVE_TRACK="onRemoveTrack",e.ON_CUSTOM_MESSAGE="onCustomMessage",e.NODE_CHANGE="nodeChange",e.USER_MESSAGE_RECEIVED="userMessageReceived",e.USER_BINARY_MESSAGE_RECEIVED="userBinaryMessageReceived",e.USER_MESSAGE_RECEIVED_OUTSIDE_ROOM="userMessageReceivedOutsideRoom",e.USER_BINARY_MESSAGE_RECEIVED_OUTSIDE_ROOM="userBinaryMessageReceivedOutsideRoom",e.POST_PROCESSING_MESSAGE="postProcessingMessage",e.ON_USER_TOKEN_WILL_EXPIRE="onUserTokenWillExpire",e.STREAM_CONTROL_MESSAGE="streamControlMessage",e.ON_SPEAKER_CHANGE="onSpeakerChange",e.ON_STREAM_FAILED="streamFailed",e.ON_NOTIFY_RECONNECT="notifyReconnect",e.ON_FORWARD_DST_ROOM_USER_KICK="onForwardDstRoomUserKick",e}(AV||{}),CV=function(e){return e.RSCP="RSCP",e.RTT="RTT",e.SSC="SSC",e}(CV||{}),wV=function(e){return e.ON_CONNECTION_STATE_CHANGE="onConnectionStateChange",e.ON_VENDOR_CONNECTION_STATE_CHANGE="onVendorConnectionStateChange",e.ABNORMAL_DISCONNECTION="normalConnection",e}(wV||{}),xV=function(e){return e.userLeave="userLeave",e.connectionLost="connectionLost",e.userDuplicateLogin="userDuplicateLogin",e.kickedByAdmin="kickedByAdmin",e.roleChanged="roleChanged",e.onUserTokenDidExpire="onUserTokenDidExpire",e}(xV||{}),OV=function(e){return e[e.roomDismissByAdmin=2]="roomDismissByAdmin",e}(OV||{}),PV=new uO("Locker",2),DV=1,MV=function(){function e(t){var r;Yd(this,e),sd(this,"lockingPromise",Wf.resolve()),sd(this,"locks",0),sd(this,"name",""),sd(this,"lockId",void 0),this.lockId=DV++,t&&(this.name=t),PV.print(wm(r="[lock-".concat(this.name,"-")).call(r,this.lockId,"] is created."))}return qd(e,[{key:"isLocked",get:function(){return this.locks>0}},{key:"lock",value:function(){var e,t,r,n=this;this.locks+=1,PV.print(wm(e=wm(t="[lock-".concat(this.name,"-")).call(t,this.lockId,"] locked, current queue ")).call(e,this.locks,"."));var i=new Wf((function(e){r=function(){var t,r;n.locks-=1,PV.print(wm(t=wm(r="[lock-".concat(n.name,"-")).call(r,n.lockId,"] unlocked, current queue ")).call(t,n.locks,".")),e()}})),o=this.lockingPromise.then((function(){return r}));return this.lockingPromise=this.lockingPromise.then((function(){return i})),o}}]),e}(),NV=function(e){return e.RESUBSCRIBE="resubscribe",e.STREAM_FAILED="stream_failed",e.SUBSCRIBE_PUSH_TRACK="subscribe_push_track",e.REMOVE_PUSH_TRACK="remove_push_track",e.VIDEO_FIRST_FRAME="video_first_frame",e.ON_USER_PUBLISH_STATE_CHANGE="on_user_publish_state_change",e.ON_USER_START_AUDIO_CAPTURE="on_user_start_audio_capture",e.ON_USER_STOP_AUDIO_CAPTURE="on_user_stop_audio_capture",e.ON_USER_START_VIDEO_CAPTURE="on_user_start_video_capture",e.ON_USER_STOP_VIDEO_CAPTURE="on_user_stop_video_capture",e.ON_SEI_MESSAGED_RECEIVED="on_sei_messaged_received",e.ON_PUBLISH_RESULT="on_publish_result",e.ON_UPDATE_TOKEN_SUCCESS="on_update_token_success",e.ON_REMOTE_STREAM_STATS="ON_REMOTE_STREAM_STATS",e.ON_LOCAL_STREAM_STATS="ON_LOCAL_STREAM_STATS",e.ON_USER_LEAVE="on_user_leave",e.ON_ROOM_ERROR="on_room_error",e.ON_NETWORK_QUALITY="on_network_quality",e.ON_SIMULCAST_SUBSCRIBE_FALLBACK="on_simulcast_subscribe_fallback",e.ON_REMOTE_VIDEO_SIZE_CHANGED="on_remote_video_size_changed",e.RECONNECT_FAILED="reconnect_failed",e.ON_SUBTITLE_STATE_CHANGED="ON_SUBTITLE_STATE_CHANGED",e.ON_SUBTITLE_MESSAGE_RECEIVED="ON_SUBTITLE_MESSAGE_RECEIVED",e.ON_VIDEO_STREAM_BANNED="ON_VIDEO_STREAM_BANNED",e.ON_AUDIO_STREAM_BANNED="ON_AUDIO_STREAM_BANNED",e.ON_FORWARD_STREAM_ERROR="ON_FORWARD_STREAM_ERROR",e.ON_REJOIN_WITH_TCP="ON_REJOIN_WITH_TCP",e.ON_ICE_CONNECT_WITH_TCP="ON_ICE_CONNECT_WITH_TCP",e}(NV||{}),LV=function(e){return e[e.START=1]="START",e[e.START_SUCCESS=2]="START_SUCCESS",e[e.START_FAILED=3]="START_FAILED",e[e.UPDATE=4]="UPDATE",e[e.UPDATE_SUCCESS=5]="UPDATE_SUCCESS",e[e.UPDATE_FAILED=6]="UPDATE_FAILED",e[e.STOP=7]="STOP",e[e.STOP_SUCCESS=8]="STOP_SUCCESS",e[e.STOP_FAILED=9]="STOP_FAILED",e}(LV||{}),UV=function(e){return e[e.PUB=0]="PUB",e[e.UNPUB=1]="UNPUB",e}(UV||{}),VV=function(e){return e[e.SUB=0]="SUB",e[e.UNSUB=1]="UNSUB",e}(VV||{}),FV=(sd(aV={},Pd.communication,[0]),sd(aV,Pd.chat,[0]),sd(aV,Pd.chatRoom,[1,"IES_chatroom"]),sd(aV,Pd.coHost,[1,"IES_PK"]),sd(aV,Pd.meeting,[16]),sd(aV,Pd.classRoom,[0]),aV),BV=kN(),jV=function(e){xI(s,e);var t,r,n,i,o,a=WI(s);function s(e,t){var r;return Yd(this,s),sd(Zk(r=a.call(this,e,t)),"peerConnectionId",xO()),sd(Zk(r),"peerConnectionMode",1),sd(Zk(r),"name","vendor"),sd(Zk(r),"direction","up"),sd(Zk(r),"stream",void 0),t.on("ice_state",(function(e){r._report("rtc_ice_state",{pc_session_id:r.peerConnectionId,direction:r.direction,error_code:0,ice_state:e.toUpperCase(),message:"",peer_connection_id:r.peerConnectionId,stream_id:"",stream_user_id:""})})),r}return qd(s,[{key:"publish",value:(o=km(Em().mark((function e(t){var r,n,i,o,a,c,u,d,l,h,p=this;return Em().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t.enableSimulcast=!1,this.stream=t,r=CI(RI(s.prototype),"internalPublish",this).call(this,t),n=r.videoDescriptions,i=r.subVideoDescriptions,o=r.audioTransceiverInit,a=r.videoTransceiverInit,t.audioTransceiver=this._peerConnection.addTransceiver(o.track,o.init),t.videoTransceiver=this._peerConnection.addTransceiver(a.track,a.init),BV&&(t.initAudioEncodedTransform(),t.initVideoEncodedTransform()),this._report("rtc_begin_create_offer",{direction:"up",stream_id:"",stream_user_id:"",pc_session_id:this.peerConnectionId,vendor_mode:(null==t?void 0:t.vendorCode)||0}),e.next=9,this._peerConnection.createOffer();case 9:return c=e.sent,u=OO(),d=DN.parse(c.sdp),Array.isArray(d.media)&&(d.media=JE(l=d.media).call(l,(function(e){var r,n,i,o,a;if("video"===e.type)null!==(r=p._context)&&void 0!==r&&null!==(n=r.serverConfig)&&void 0!==n&&n.videoCodec&&iL(e,null===(i=p._context)||void 0===i||null===(o=i.serverConfig)||void 0===o?void 0:o.videoCodec),(sP||gP)&&Array.isArray(e.ext)&&(e.ext=Gs(a=e.ext).call(a,(function(e){var t;return!(null!=e&&null!==(t=e.uri)&&void 0!==t&&vT(t).call(t,"video-orientation"))}))),sP||p.addBitrateLimit(e,t.videoEncodeConfig[0].maxKbps);else if("audio"===e.type){var s,c=null==e?void 0:sE(s=e.rtp).call(s,(function(e){return"opus"===e.codec}));if(c&&e.fmtp){var u,d,l=sE(u=e.fmtp).call(u,(function(e){return e.payload===c.payload}));l&&null!==(d=p._context)&&void 0!==d&&d.audioProfileManager&&(l.config=p._context.audioProfileManager.getOpusConfigStr(l.config))}}return e}))),h=new RTCSessionDescription({type:"offer",sdp:DN.write(d)}),e.prev=14,e.next=17,this._peerConnection.setLocalDescription(h);case 17:this._report("rtc_set_description",{error_code:0,message:h.sdp||"",is_local:"1",direction:"up",stream_id:"",stream_user_id:"",elapse:OO()-u},{type:"offer"}),e.next=24;break;case 20:throw e.prev=20,e.t0=e.catch(14),this._report("rtc_set_description",{error_code:-1,message:e.t0.message+h.sdp,is_local:"1",direction:"up",stream_id:"",stream_user_id:"",elapse:OO()-u},{type:"offer"}),e.t0;case 24:return e.abrupt("return",{partialSdp:h.sdp||"",audioMid:"0",videoMid:"1",type:"offer",semantics:"unified-plan",videoDescriptions:n,subVideoDescriptions:i,audioTransceiverInit:o,videoTransceiverInit:a,peerConnectionMode:this.peerConnectionMode,peerConnectionId:this.peerConnectionId});case 25:case"end":return e.stop()}}),e,this,[[14,20]])}))),function(e){return o.apply(this,arguments)})},{key:"subscribe",value:(i=km(Em().mark((function e(t){var r,n,i,o,a,s=this;return Em().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return this.stream=t,this.direction="down",t.audioTransceiver=this._peerConnection.addTransceiver("audio",{direction:"recvonly"}),t.videoTransceiver=this._peerConnection.addTransceiver("video",{direction:"recvonly"}),BV&&(t.initAudioEncodedTransform(),t.initVideoEncodedTransform()),this._report("rtc_begin_create_offer",{direction:"down",stream_id:t.streamId,stream_user_id:t.userId,pc_session_id:this.peerConnectionId,vendor_mode:t.vendorCode||0}),e.next=8,this._peerConnection.createOffer();case 8:return r=e.sent,n=OO(),i=DN.parse(r.sdp),Array.isArray(i.media)&&(i.media=JE(o=i.media).call(o,(function(e){if("audio"===e.type){var t,r=null==e?void 0:sE(t=e.rtp).call(t,(function(e){return"opus"===e.codec}));if(r&&null!=e&&e.fmtp){var n,i=null==e?void 0:sE(n=e.fmtp).call(n,(function(e){return e.payload===r.payload}));i&&s._context&&(i.config+=";stereo=1;sprop-stereo=1")}}return e}))),a=new RTCSessionDescription({type:"offer",sdp:DN.write(i)}),e.prev=13,e.next=16,this._peerConnection.setLocalDescription(a);case 16:this._report("rtc_set_description",{error_code:0,message:a.sdp||"",is_local:"1",direction:"down",stream_id:t.streamId,stream_user_id:t.userId,elapse:OO()-n},{type:"offer"}),e.next=23;break;case 19:throw e.prev=19,e.t0=e.catch(13),this._report("rtc_set_description",{error_code:-1,message:e.t0.message+a.sdp,is_local:"1",direction:"down",stream_id:t.streamId,stream_user_id:t.userId,elapse:OO()-n},{type:"offer"}),e.t0;case 23:return e.abrupt("return",{partialSdp:a.sdp||"",audioMid:"0",videoMid:"1",type:"offer",semantics:"unified-plan",peerConnectionMode:this.peerConnectionMode,peerConnectionId:this.peerConnectionId});case 24:case"end":return e.stop()}}),e,this,[[13,19]])}))),function(e){return i.apply(this,arguments)})},{key:"handleAck",value:(n=km(Em().mark((function e(t){var r,n,i,o,a,s,c;return Em().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t.action!==vV.publish&&t.action!==vV.subscribe){e.next=16;break}return n=new RTCSessionDescription({sdp:null===(r=t.signalingAck)||void 0===r?void 0:r.sdp,type:"answer"}),i=OO(),e.prev=3,e.next=6,this._peerConnection.setRemoteDescription(n);case 6:this._report("rtc_set_description",{error_code:0,message:n.sdp||"",is_local:"1",direction:"down",stream_id:null===(o=t.stream)||void 0===o?void 0:o.userId,stream_user_id:(null===(a=t.stream)||void 0===a?void 0:a.streamId)||"",elapse:OO()-i},{type:"answer"}),e.next=13;break;case 9:throw e.prev=9,e.t0=e.catch(3),this._report("rtc_set_description",{error_code:-1,message:e.t0.message+n.sdp,is_local:"1",direction:"down",stream_id:null===(s=t.stream)||void 0===s?void 0:s.userId,stream_user_id:(null===(c=t.stream)||void 0===c?void 0:c.streamId)||"",elapse:OO()-i},{type:"offer"}),e.t0;case 13:"function"==typeof t.onSuccess&&t.onSuccess(),e.next=17;break;case 16:t.action!==vV.unpublish&&t.action!==vV.unsubscribe||this.destroy();case 17:return e.abrupt("return","");case 18:case"end":return e.stop()}}),e,this,[[3,9]])}))),function(e){return n.apply(this,arguments)})},{key:"destroy",value:function(){this.peer.destroy(),CI(RI(s.prototype),"destroy",this).call(this)}},{key:"getDefaultSdp",value:(r=km(Em().mark((function e(){return Em().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",{sdp:"",type:"offer",semantics:""});case 1:case"end":return e.stop()}}),e)}))),function(){return r.apply(this,arguments)})},{key:"connect",value:function(){throw new Error("Method not implemented.")}},{key:"rollback",value:(t=km(Em().mark((function e(){return Em().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:try{this._peerConnection.close()}catch(t){}case 1:case"end":return e.stop()}}),e,this)}))),function(){return t.apply(this,arguments)})}]),s}(aL),GV=function(e){return e[e.AUTOPLAY_FAILED=-1e3]="AUTOPLAY_FAILED",e[e.TRACK_ERROR=-1001]="TRACK_ERROR",e[e.Fetch_MODIFY=-1002]="Fetch_MODIFY",e[e.BLACK_BROWSER=-1003]="BLACK_BROWSER",e}(GV||{}),HV={start_interval:100,multiplier:2,max_interval:3e4},zV=function(){function e(){Yd(this,e),sd(this,"_times",0),sd(this,"_config",HV),sd(this,"initTs",OO())}return qd(e,[{key:"getRetryDelay",value:function(){return Math.min(this._config.max_interval,Math.pow(this._config.multiplier,this._times++)*this._config.start_interval)}},{key:"setConfig",value:function(e){this._config=e}},{key:"reset",value:function(){this._times=0}}]),e}(),KV=new uO("ICERequest",4),XV=function(){function e(t){Yd(this,e),sd(this,"_reconnectTimer",void 0),sd(this,"_abortControllers",[]),sd(this,"_monitor",void 0),sd(this,"_groupConfigId",xO()),sd(this,"_retryLimiter",new zV),sd(this,"_timer",void 0),this._ctx=t,this._monitor=EO(t.id)}var t,r,n,i;return qd(e,[{key:"getICENode",value:(i=km(Em().mark((function e(t){var r;return Em().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return KV.print("getICENode","invoke"),e.prev=1,e.next=4,this._getAccessWithRetry(t);case 4:if(0!==(r=e.sent).length){e.next=7;break}throw"server return empty nodes.";case 7:e.next=13;break;case 9:throw e.prev=9,e.t0=e.catch(1),this._reportRtcInvokeStatus("es.join.getNodeFailed",e.t0),new lA(uA.ICE_SERVER_WRONG,"get ICE config failed: ".concat(e.t0),e.t0);case 13:return KV.print("getICENode","success"),this._reportRtcInvokeStatus("es.join.getNodeSuccess",r),e.abrupt("return",r);case 16:case"end":return e.stop()}}),e,this,[[1,9]])}))),function(e){return i.apply(this,arguments)})},{key:"_getAccessWithRetry",value:function(e){var t=this,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return 0!==r&&KV.print("_getAccessWithRetry()","invoke feedbackInfo: %o, 201count: %o",e,r),new Wf((function(n,i){t._getAccessNode(e).then((function(e){t._retryLimiter.reset(),n(e)})).catch((function(o){if(Array.isArray(o)&&o.length>0){if(WR(o).call(o,(function(e){return 400<=e.code&&e.code<500}))>-1)return t._retryLimiter.reset(),i("HTTP request failed(4xx)");if(o.every((function(e){var t;return 201===e.code||201===(null===(t=e.error)||void 0===t?void 0:t.code)}))&&r++,3===r)return t._retryLimiter.reset(),i("HTTP request failed(201)")}var a=t._retryLimiter.getRetryDelay();KV.print("_getAccessWithRetry()","_getAccessWithRetry error, will retry after ".concat(a,"ms"),o),t._reconnectTimer=self.setTimeout((function(){t._getAccessWithRetry(e,r).then(n).catch(i)}),a)}))}))}},{key:"_getAccessNode",value:(n=km(Em().mark((function e(t){var r=this;return Em().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",new Wf((function(e,n){var i=UP.getAccessNode(r._ctx.appId);i?(KV.print("getAccessNode","use cache node."),e(Array.isArray(i)?i:[i]),r._timer=window.setTimeout((function(){r._getAccessNodeFromServer(t),r._reportRtcInvokeStatus("es.R.node.cache",i),delete r._timer}),0)):r._getAccessNodeFromServer(t).then(e).catch(n)})));case 1:case"end":return e.stop()}}),e)}))),function(e){return n.apply(this,arguments)})},{key:"_getAccessNodeFromServer",value:(r=km(Em().mark((function e(t){var r,n,i,o=this;return Em().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=this._getAccessUrls(),n=r.urls,i=r.needFallback,e.abrupt("return",this.getICEConfigFromServer(n,t).then((function(e){var t=e.nodes;return!o._ctx.useCloudProxy&&UP.setAccessNode(o._ctx.appId,t,e.ttl||11200),e.dispatchDomains&&!o._ctx.useCloudProxy&&UP.setAccessUrls(e.dispatchDomains),t})).catch((function(e){if(i)return o._reportRtcInvokeStatus("es.R.req.fallback",""),UP.clearAccessUrls(),o._getAccessNodeFromServer(t);throw e})));case 2:case"end":return e.stop()}}),e,this)}))),function(e){return r.apply(this,arguments)})},{key:"_getAccessUrls",value:function(){var e=UP.getAccessUrls()||[],t=!0;return this._reportRtcInvokeStatus("es.R.req.cache.urls",e),0===e.length&&(e=zP.ICE_CONFIG_REQUEST_URLS,t=!1,this._reportRtcInvokeStatus("es.R.req.external.urls",e)),0===e.length&&(e=zP.ICE_CONFIG_REQUEST_URLS_INTERNAL,t=!1,this._reportRtcInvokeStatus("es.R.req.internal.urls",e)),{urls:e,needFallback:t}}},{key:"getICEConfigFromServer",value:(t=km(Em().mark((function e(t,r){var n,i,o,a,s,c=this;return Em().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return i=xO(),o={appID:this._ctx.appId,deviceID:UP.getDeviceId(),connectSessionID:i,os:"web",sdkVersion:zP.VERSION,isOversea:zP.OVERSEA,expectedAddr:XP("EXPECTED_ADDR"),productPlatform:"VolcEngine",enableCloudProxy:this._ctx.useCloudProxy,expectedIDC:this._ctx.expectedIDC},r&&(o.feedbackInfo=r,delete o.expectedAddr),a=Date.now(),null===(n=this._monitor)||void 0===n||n.report("rtc_get_access",{error_code:0,message:eT(o),elapse:0,type:"request",host:t.join(","),config_id:i,group_config_id:this._groupConfigId}),s=JE(t).call(t,function(){var e=km(Em().mark((function e(t,r){var n,i,a,s,u;return Em().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return i=new AbortController,c._abortControllers.push(i),e.prev=2,e.next=5,fetch(t,{method:"POST",headers:{"Content-Type":"application/json"},mode:"cors",body:eT(o),signal:i.signal});case 5:a=e.sent,e.next=12;break;case 8:throw e.prev=8,e.t0=e.catch(2),r=fetch,d=void 0,vT(d=Function.prototype.toString.call(r)).call(d,"[native code]")||null===(s=c._monitor)||void 0===s||s.report("rtc_error",{error_code:GV.Fetch_MODIFY,message:"get access failed, possibly due to modifying the browser's Fetch API."},{origin_error:e.t0}),e.t0;case 12:if(c._abortControllers=Gs(n=c._abortControllers).call(n,(function(e){return e!==i})),200===a.status){e.next=15;break}throw{message:a.statusText,code:a.status};case 15:return e.next=17,a.json();case 17:if(200===(u=e.sent).code){e.next=20;break}throw u;case 20:if(0!==u.nodes.length){e.next=22;break}throw{code:u.code,message:eT(u)};case 22:return e.abrupt("return",{url:t,result:u});case 23:case"end":return e.stop()}var r,d}),e,null,[[2,8]])})));return function(t,r){return e.apply(this,arguments)}}()),e.abrupt("return",XO(s).then((function(e){var t,r=e.result,n=e.url;return null===(t=c._monitor)||void 0===t||t.report("rtc_get_access",{error_code:200,message:eT(r),elapse:Date.now()-a,type:"response",host:n,config_id:i,group_config_id:c._groupConfigId}),r})).catch((function(e){var r,n,o,s;throw null===(r=c._monitor)||void 0===r||r.report("rtc_get_access",{error_code:+((null===(n=e[0])||void 0===n?void 0:n.code)||(null===(o=e[0])||void 0===o?void 0:o.server_code)),message:null===(s=e[0])||void 0===s?void 0:s.message,elapse:Date.now()-a,type:"response",host:t.join(","),config_id:i,group_config_id:c._groupConfigId},{error:eT(e)}),e})));case 7:case"end":return e.stop()}}),e,this)}))),function(e,r){return t.apply(this,arguments)})},{key:"destroy",value:function(){this._abortControllers.forEach((function(e){return e.abort()})),this._reconnectTimer&&(window.clearTimeout(this._reconnectTimer),delete this._reconnectTimer),this._timer&&(window.clearTimeout(this._timer),delete this._timer)}},{key:"_reportRtcInvokeStatus",value:function(e,t){var r,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,i=arguments.length>3?arguments[3]:void 0;null===(r=this._monitor)||void 0===r||r.report("rtc_invoke_status",{sdk_api_name:e,message:t,error_code:n,stream_id:"",elapse:0,group_config_id:this._groupConfigId},i)}}]),e}(),WV={iceServers:[],iceTransportPolicy:"all",bundlePolicy:"max-bundle",rtcpMuxPolicy:"require",sdpSemantics:"unified-plan",encodedInsertableStreams:!!kN()||void 0},qV=function(e){return e[e.DC_ERROR=0]="DC_ERROR",e[e.DC_CLOSE=1]="DC_CLOSE",e[e.ICE_FAILED=2]="ICE_FAILED",e[e.DESTROY=3]="DESTROY",e[e.TIMEOUT=4]="TIMEOUT",e}(qV||{}),YV=0,JV=function(e){xI(s,e);var t,r,n,i,o,a=WI(s);function s(e,t){var r;return Yd(this,s),sd(Zk(r=a.call(this)),"uuid",(YV++).toString()),sd(Zk(r),"_peerConnectionId",""),sd(Zk(r),"audioTrack4ff",void 0),sd(Zk(r),"_pc",void 0),sd(Zk(r),"_dc",void 0),sd(Zk(r),"_iceNode",void 0),sd(Zk(r),"_initSctpEvents",!1),sd(Zk(r),"_monitor",void 0),sd(Zk(r),"_offerIce",{}),sd(Zk(r),"_answerIce",{}),sd(Zk(r),"_offerSession",void 0),sd(Zk(r),"_answerSession",void 0),sd(Zk(r),"_offerMlines",[]),sd(Zk(r),"_answerMlines",[]),sd(Zk(r),"_connectReject",void 0),sd(Zk(r),"_logger",new uO("PeerConnection_".concat(r.uuid),4)),r._ctx=e,r._groupConnectionId=t,r._monitor=EO(e.id),r._pc=new RTCPeerConnection(WV),r._pc.ontrack=function(e){var t,n,i,o,a=null===(t=e.streams)||void 0===t||null===(n=t[0])||void 0===n?void 0:n.id;r._print("pc.ontrack",wm(i=wm(o="".concat(e.track.kind," ")).call(o,e.track.id," ")).call(i,a)),"ff-stream"===a&&(r.audioTrack4ff=e.track),r.emit("ontrack",e)},r._pc.onconnectionstatechange=function(e){var t;r._print("onconnectionstatechange",wm(t="".concat(r._pc.connectionState,". ice -> ")).call(t,r._pc.iceConnectionState)),"failed"!==r._pc.iceConnectionState&&"closed"!==r._pc.iceConnectionState&&"failed"!==r._pc.connectionState||r.emit("disconnect","ice failed")},r._pc.oniceconnectionstatechange=function(){var e=r._pc.iceConnectionState;r._report("rtc_pre_ice_state",{message:e,ice_state:e.toUpperCase()}),r.emit("ice_state",e)},r}return qd(s,[{key:"getOriginRTCPeerConnection",value:function(){return this._pc}},{key:"getOriginRTCDataChannel",value:function(){return this._dc}},{key:"getConnectionId",value:function(){return this._peerConnectionId}},{key:"getGroupConnectionId",value:function(){return this._groupConnectionId}},{key:"connect",value:(o=km(Em().mark((function e(t){var r,n,i,o,a,s,c,u,d,l,h=this;return Em().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return this._print("connect","invoke. %o",t),this._iceNode=t,this._dc=this._pc.createDataChannel("signaling",{negotiated:!0,id:100}),this._dc.binaryType="arraybuffer",e.next=6,this._genIceInfo(t);case 6:return r=e.sent,n=r.offerIce,i=r.answerIce,this._offerIce=n,this._answerIce=i,this._peerConnectionId=i.iceUfrag||"",aP&&(this._pc.addTransceiver("audio",{direction:"recvonly"}),this._pc.addTransceiver("video",{direction:"recvonly"})),e.next=15,this._pc.createOffer();case 15:if(o=e.sent,a=DN.parse(o.sdp),s=Qk(a.media,1),c=s[0],this._offerIce.fingerprint=a.fingerprint||c.fingerprint,!aP){e.next=30;break}return a.media=JE(u=a.media).call(u,(function(e){var t,r,n=ud(ud({},e),h._offerIce);return"video"===n.type&&(n.ext=null===(t=n.ext)||void 0===t?void 0:Gs(t).call(t,(function(e){var t;return-1===gE(t=e.uri).call(t,"abs-send-time")})),n.rtcpFb=null===(r=n.rtcpFb)||void 0===r?void 0:Gs(r).call(r,(function(e){return"goog-remb"!==e.type}))),n})),(l=ud({},a)).fingerprint=this._answerIce.fingerprint,l.media=JE(d=l.media).call(d,(function(e){return delete(e=ud(ud({},e),h._answerIce)).bundleOnly,e.port=9,"application"===e.type?e.sctpmap={sctpmapNumber:5e3,app:"webrtc-datachannel",maxMessageSize:262144}:("audio"===e.type&&(e.msid="ff-stream ff-stream-audio"),e.direction="sendonly"),e})),e.next=26,this.setLocalDescription(DN.write(a));case 26:return e.next=28,this.setRemoteDescription(DN.write(l));case 28:e.next=38;break;case 30:delete a.media,this._offerSession=ud({},a),this._answerSession=ud({},a),this._answerSession.fingerprint&&(this._answerSession.fingerprint=this._answerIce.fingerprint),this._offerMlines=[ud(ud(ud({},c),this._offerIce),{},{mid:"".concat(0)})],this._answerMlines=[ud(ud(ud({},c),this._answerIce),{},{sctpmap:{sctpmapNumber:5e3,app:"webrtc-datachannel",maxMessageSize:262144},mid:"".concat(0)})],this.setDescription();case 38:return e.next=40,new Wf((function(e,t){h._connectReject=t,h._dc.onopen=function(){h._print("connect","dataChannel open"),h._reportRtcInvokeStatus("es.dc.open",""),e(""),delete h._connectReject},h._dc.onerror=function(e){var t,r;h._report("rtc_signaling_msg_error",{error_code:e.error.sdpLineNumber,message:e.error.errorDetail,reason:"invalid data"}),h._reportRtcInvokeStatus("es.dc.error",""),null===(t=h._connectReject)||void 0===t||t.call(h,{message:"dc.onerror, ".concat(null===(r=e.error)||void 0===r?void 0:r.errorDetail),code:0}),h.emit("disconnect","dc onerror"),delete h._connectReject},h._dc.onclose=function(e){var t;h._reportRtcInvokeStatus("es.dc.close",""),null===(t=h._connectReject)||void 0===t||t.call(h,{message:"dc.onclose",code:1}),h.emit("disconnect","dc onclose"),delete h._connectReject},h._pc.addEventListener("connectionstatechange",(function(e){var t,r;"failed"!==h._pc.iceConnectionState&&"closed"!==h._pc.iceConnectionState&&"failed"!==h._pc.connectionState||(null===(t=h._connectReject)||void 0===t||t.call(h,{message:wm(r="pc.connectionstatechange -> ".concat(h._pc.connectionState,", ice -> ")).call(r,h._pc.iceConnectionState),code:2}),delete h._connectReject)})),setTimeout((function(){var e;null===(e=h._connectReject)||void 0===e||e.call(h,{code:4,message:"connect timeout"}),delete h._connectReject}),8e3)}));case 40:return this._print("connect","dataChannel establish success"),e.abrupt("return",this._dc);case 42:case"end":return e.stop()}}),e,this)}))),function(e){return o.apply(this,arguments)})},{key:"setDescription",value:(i=km(Em().mark((function e(t){var r,n;return Em().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return this._print("setDescription","invoke."),this._offerSession.media=this._offerMlines,this._answerSession.media=this._answerMlines,r=[],this._offerMlines.forEach((function(e){"inactive"!==e.direction&&r.push(e.mid)})),this._offerSession.groups&&this._answerSession.groups&&(this._offerSession.groups[0].mids=r.join(" "),this._answerSession.groups[0].mids=r.join(" ")),n=OO(),t&&this._report("rtc_begin_create_offer",{direction:"local"===t.streamUserId?"up":"down",stream_id:t.streamId,stream_user_id:t.streamUserId,pc_session_id:this._peerConnectionId,vendor_mode:0}),e.next=10,this._pc.createOffer();case 10:return t&&this._report("rtc_create_offer",{error_code:0,direction:"local"===t.streamUserId?"up":"down",stream_id:t.streamId,stream_user_id:t.streamUserId,elapse:OO()-n}),e.next=13,this.setLocalDescription(DN.write(this._offerSession),t);case 13:return e.next=15,this.setRemoteDescription(DN.write(this._answerSession),t);case 15:case"end":return e.stop()}}),e,this)}))),function(e){return i.apply(this,arguments)})},{key:"setLocalDescription",value:(n=km(Em().mark((function e(t,r){var n,i,o,a=this;return Em().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=OO(),e.prev=1,e.next=4,this._pc.setLocalDescription(new RTCSessionDescription({type:"offer",sdp:t}));case 4:this._report("rtc_set_description",{error_code:0,message:t,is_local:"1",direction:"local"===(null==r?void 0:r.streamUserId)?"up":"down",stream_id:(null==r?void 0:r.streamId)||"",stream_user_id:(null==r?void 0:r.streamUserId)||"",elapse:OO()-n},{type:"offer"}),this._initSctpEvents||(this._initSctpEvents=!0,(o=null===(i=this._pc)||void 0===i?void 0:i.sctp)&&(o.onstatechange=function(){a._reportRtcInvokeStatus("sctp","sctp state change TO: ".concat(o.state))},o.transport&&(o.transport.onstatechange=function(){var e;a._reportRtcInvokeStatus("dtls","dtls state change TO: ".concat(null==o||null===(e=o.transport)||void 0===e?void 0:e.state))}))),e.next=12;break;case 8:e.prev=8,e.t0=e.catch(1),console.error("setLocal",e.t0),this._report("rtc_set_description",{error_code:-1,message:e.t0.message+t,is_local:"1",direction:"local"===(null==r?void 0:r.streamUserId)?"up":"down",stream_id:"",stream_user_id:"",elapse:OO()-n},{type:"offer"});case 12:case"end":return e.stop()}}),e,this,[[1,8]])}))),function(e,t){return n.apply(this,arguments)})},{key:"setRemoteDescription",value:(r=km(Em().mark((function e(t,r){var n;return Em().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=OO(),e.prev=1,e.next=4,this._pc.setRemoteDescription(new RTCSessionDescription({type:"answer",sdp:t}));case 4:this._report("rtc_set_description",{error_code:0,message:t,is_local:"0",direction:"local"===(null==r?void 0:r.streamUserId)?"up":"down",stream_id:(null==r?void 0:r.streamId)||"",stream_user_id:(null==r?void 0:r.streamUserId)||"",elapse:OO()-n},{type:"answer"}),e.next=11;break;case 7:e.prev=7,e.t0=e.catch(1),console.error("setRemote",e.t0),this._report("rtc_set_description",{error_code:-1,message:e.t0.message+t,is_local:"0",direction:"local"===(null==r?void 0:r.streamUserId)?"up":"down",stream_id:(null==r?void 0:r.streamId)||"",stream_user_id:(null==r?void 0:r.streamUserId)||"",elapse:OO()-n},{type:"answer"});case 11:case"end":return e.stop()}}),e,this,[[1,7]])}))),function(e,t){return r.apply(this,arguments)})},{key:"disconnect",value:function(){var e,t;null===(e=this._connectReject)||void 0===e||e.call(this,{code:3,message:"invoke destroy()"}),delete this._connectReject,this._pc.close(),null===(t=this._dc)||void 0===t||t.close(),this._pc.ontrack=null}},{key:"destroy",value:function(){this._print("destroy",this._peerConnectionId),CI(RI(s.prototype),"removeAllListeners",this).call(this),this.disconnect()}},{key:"_genIceInfo",value:(t=km(Em().mark((function e(t){var r,n,i,o;return Em().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return i={iceUfrag:null===(r=t.iceParams)||void 0===r?void 0:r.clientIceUfrag,icePwd:null===(n=t.iceParams)||void 0===n?void 0:n.clientIcePwd,iceOptions:"renomination"},e.next=3,eL(t);case 3:return o=e.sent,e.abrupt("return",{offerIce:i,answerIce:o});case 5:case"end":return e.stop()}}),e)}))),function(e){return t.apply(this,arguments)})},{key:"_print",value:function(e){for(var t,r,n=arguments.length,i=new Array(n>1?n-1:0),o=1;o<n;o++)i[o-1]=arguments[o];(t=this._logger).print.apply(t,wm(r=["".concat(e)]).call(r,i))}},{key:"_report",value:function(e,t,r){var n,i,o,a;null===(n=this._monitor)||void 0===n||n.report(e,ud(ud({},t),{},{connection_id:this._peerConnectionId,group_connection_id:this._groupConnectionId}),ud(ud({},r),{},{tcp_only:null===(i=this._iceNode)||void 0===i?void 0:i.iceConfig.tcpOnly,ms_addr:eT((null===(o=this._iceNode)||void 0===o?void 0:JE(a=o.publicIPs).call(a,(function(e){return{ip:e.ip,tcp:e.tcpPorts,udp:e.udpPorts}})))||[])}))}},{key:"_reportRtcInvokeStatus",value:function(e,t){var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"",i=arguments.length>4?arguments[4]:void 0;this._report("rtc_invoke_status",{sdk_api_name:e,message:t,error_code:r,stream_id:n,elapse:0},i)}}]),s}(bD);function QV(e,t){if(null==e)return{};var r,n,i=function(e,t){if(null==e)return{};var r,n,i={},o=an(e);for(n=0;n<o.length;n++)r=o[n],gE(t).call(t,r)>=0||(i[r]=e[r]);return i}(e,t);if(xs){var o=xs(e);for(n=0;n<o.length;n++)r=o[n],gE(t).call(t,r)>=0||Object.prototype.propertyIsEnumerable.call(e,r)&&(i[r]=e[r])}return i}var ZV=function(e){return e[e.SEND=0]="SEND",e[e.FEEDBACK=1]="FEEDBACK",e}(ZV||{}),$V=function(e){return e[e.P2P=0]="P2P",e[e.SIGNAL=1]="SIGNAL",e[e.BROADCAST=2]="BROADCAST",e[e.BUSINESS_SERVER=3]="BUSINESS_SERVER",e}($V||{}),eF=function(e){return e[e.SUCCESS=0]="SUCCESS",e[e.TIMEOUT=1]="TIMEOUT",e[e.BROKEN=2]="BROKEN",e[e.NO_RECEIVER=3]="NO_RECEIVER",e[e.NO_RELAYPATH=4]="NO_RELAYPATH",e[e.EXCEED_QPS=5]="EXCEED_QPS",e[e.SEND_TO_SERVER_ERROR=17]="SEND_TO_SERVER_ERROR",e[e.SERVER_RESPONSE_ERROR=18]="SERVER_RESPONSE_ERROR",e[e.NOT_JOIN=100]="NOT_JOIN",e[e.NOT_LOGIN=105]="NOT_LOGIN",e[e.SERVER_PARAMS_NOTSET=106]="SERVER_PARAMS_NOTSET",e[e.UNKNOWN=1e3]="UNKNOWN",e}(eF||{}),tF=(sd(sV={},0,[0,"success"]),sd(sV,1,[uA.USER_MESSAGE_TIMEOUT,"timeout, failed to send."]),sd(sV,2,[uA.USER_MESSAGE_BROKEN,"dataChannel broken, failed to send."]),sd(sV,3,[uA.USER_MESSAGE_NO_RECEIVER,"cannot find the receiver."]),sd(sV,4,[uA.USER_MESSAGE_NO_RECEIVER,"cannot find relay path."]),sd(sV,5,[uA.USER_MESSAGE_EXCEED_QPS,"cannot find relay path."]),sd(sV,17,[uA.USER_MESSAGE_SEND_TO_SERVER_ERROR,"failed to send to business server."]),sd(sV,18,[uA.USER_MESSAGE_SERVER_RESPONSE_ERROR,"business server response error."]),sd(sV,100,[uA.USER_MESSAGE_NOT_JOIN,"not join room"]),sd(sV,105,[uA.USER_MESSAGE_NOT_LOGIN,"not login."]),sd(sV,106,[uA.USER_MESSAGE_SERVER_PARAMS_NOTSET,"server param is not set."]),sd(sV,1e3,[uA.USER_MESSAGE_UNKNOWN,"unknown."]),sV),rF=["msg"],nF=new uO("DataChannelSignaling",3),iF=[],oF=function(e){return e[e.C2S=0]="C2S",e[e.C2C=1]="C2C",e[e.C2GW=2]="C2GW",e[e.C2CDirect=3]="C2CDirect",e[e.C2RTM=4]="C2RTM",e}(oF||{}),aF=function(e){xI(a,e);var t,r,n,i,o=WI(a);function a(e,t){var r;return Yd(this,a),sd(Zk(r=o.call(this)),"_singlingCache",new jS),sd(Zk(r),"_p2pCache",new jS),sd(Zk(r),"_rttIds",{}),sd(Zk(r),"_p2pMessageId",1),sd(Zk(r),"_clearDataChannelListener",void 0),sd(Zk(r),"_monitor",void 0),r.id=e,r._dataChannel=t,r._clearDataChannelListener=r._handleHandler(),r._monitor=EO(e),r}return qd(a,[{key:"destroy",value:function(){var e=this;this._dataChannel&&(this._clearDataChannelListener(),this._dataChannel.close()),this._singlingCache.forEach((function(t,r){t.error(new lA(uA.OPERATION_CANCEL,"disconnect")),e._singlingCache.delete(r)})),this._singlingCache.clear(),this._p2pCache.clear(),this._p2pMessageId=1,this._rttIds={}}},{key:"sendSignaling",value:function(e,t,r){var n,i=this,o=arguments.length>3&&void 0!==arguments[3]?arguments[3]:6e4;return null===(n=this._monitor)||void 0===n||n.report("rtc_signaling",{error_code:0,message:eT(t),signaling_event:"call-".concat(e),signaling_type:"Send",stream_id:t.streamId,stream_user_id:t.streamUserId,direction:"up"}),new Wf((function(n,a){var s,c=i._genHeader(r);c.id=MO();var u=c.id.join("-"),d="customMessage"===e;d&&_O.samplingOne2ManyMsg(i.id,+c.id.join(""),t);var l=setTimeout((function(){i._singlingCache.delete(u),a(new lA(uA.TIME_OUT,"".concat(e," message time out"))),d&&_O.updateOne2ManyMsgAck(i.id,t,999)}),o);i._singlingCache.set(u,{signalingType:e,success:function(e){clearTimeout(l),n(e),d&&_O.updateOne2ManyMsgAck(i.id,t,0)},error:function(e){clearTimeout(l),a(e),d&&_O.updateOne2ManyMsgAck(i.id,t,e.code)}}),nF.print("Signal",wm(s=">>>>>> [".concat(e,"][")).call(s,u,"]"),t),i._sendMessage(e,c,t)}))}},{key:"sendPingSignaling",value:function(){return this.sendSignaling("CheckConnectivity",{ts:Date.now()},{functionType:2})}},{key:"sendP2PMessage",value:(i=km(Em().mark((function e(t,r){var n,i,o;return Em().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(n=t.msg,i=QV(t,rF),o=n instanceof ArrayBuffer,e.t0=this,e.t1=_O,e.t2=this.id,e.t3=ud,e.t4=ud({ver:1,id:this._p2pMessageId++,time:Date.now(),dir:ZV.SEND,type:$V.P2P,err:eF.SUCCESS},i),e.t5={},e.t6=o,!o){e.next=15;break}return e.next=12,DO.ab2b64str(n);case 12:e.t7=e.sent,e.next=16;break;case 15:e.t7=n;case 16:return e.t8=e.t7,e.t9={binary:e.t6,msg:e.t8},e.t10=(0,e.t3)(e.t4,e.t5,e.t9),e.t11=e.t1.samplingP2PMsg.call(e.t1,e.t2,e.t10),e.t12=r,e.abrupt("return",e.t0._sendP2PMessage.call(e.t0,e.t11,e.t12));case 22:case"end":return e.stop()}}),e,this)}))),function(e,t){return i.apply(this,arguments)})},{key:"_sendP2PMessage",value:function(e){var t=this,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return LO(e.msg)?this._rttIds[e.id]=e.id:e.dir===ZV.SEND&&nF.print("_sendP2PMessage [DC Signaling p2p >>]",eT(e)),new Wf((function(n,i){var o=t._genHeader(ud(ud({needAck:!0,functionType:1},r),{},{id:MO()}));if(e.dir===ZV.SEND){var a=setTimeout((function(){t._p2pCache.delete(e.id),i(new lA(uA.USER_MESSAGE_TIMEOUT,"P2P message timeout")),_O.updateP2PMsgAck(t.id,e,999)}),12e3);t._p2pCache.set(e.id,{success:function(r,i){clearTimeout(a),n(i),_O.updateP2PMsgAck(t.id,e,0)},error:function(r){var n;clearTimeout(a),_O.updateP2PMsgAck(t.id,e,r.err);var o=Qk(tF[r.err]||[uA.USER_MESSAGE_UNKNOWN,wm(n="err: ".concat(r.err,", msg: ")).call(n,r.msg)],2),s=o[0],c=o[1];i({err:r.err,code:s,message:r.msg||c})}})}try{t._sendMessage("p2p",o,e)}catch(s){throw s.code===uA.NOT_CONNECTED_YET&&(s.code=uA.USER_MESSAGE_BROKEN),s}}))}},{key:"_sendMessage",value:function(e,t,r){var n;if(!this._dataChannel||"open"!==this._dataChannel.readyState)throw new lA(uA.NOT_CONNECTED_YET,"DataChannel not open");var i=t.version+(+t.zip<<5)+(+t.encrypt<<6),o=+t.needAck+(+t.direction<<1)+(+t.functionType<<2)+(+t.binary<<6),a=DO.str2ab(eT([e,r])),s=PO(Uint8Array,wm(n=[i,o]).call(n,qT(t.id||[])),new Uint8Array(a));this._dataChannel.send(s.buffer),"p2p"===e?_O.updateP2PMsgReq(this.id,r,s.buffer.byteLength):"customMessage"===e&&_O.updateOne2ManyMsgReq(this.id,r,s.buffer.byteLength)}},{key:"_dispartData",value:function(e){var t=new Uint8Array(e),r=0,n=t[r++],i=t[r++],o={version:15&n,zip:16==(16&n),encrypt:32==(32&n),needAck:1==(1&i),direction:(2&i)>>1,functionType:(60&i)>>2,binary:64==(64&i)};if(o.needAck||1===o.direction){for(;r<=6;r++)if(128!=(128&t[r])){r++;break}o.id=XT(bm(t).call(t,2,r))}return{header:o,data:bm(t).call(t,r)}}},{key:"_feedbackSignaling",value:function(e,t,r){var n,i,o=this._genHeader({needAck:!0,direction:1,id:JE(n=e.split("-")).call(n,(function(e){return+e}))});vT(iF).call(iF,t)||nF.print("Signal",wm(i=">>>>>> [".concat(t,"-res][")).call(i,e,"]"));this._sendMessage("".concat(t,"-res"),o,r)}},{key:"_handleMessage",value:(n=km(Em().mark((function e(t){var r,n,i,o,a,s,c,u,d;return Em().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:r=Date.now(),n=t.byteLength,i=this._dispartData(t),o=i.data,(a=i.header).zip&&((s=new Nx.Inflate).push(o,!0),o=s.result),c=DO.ab2str(o),u=[],e.prev=8,u=JSON.parse(c),e.next=16;break;case 12:return e.prev=12,e.t0=e.catch(8),e.t0 instanceof Error&&(null===(d=this._monitor)||void 0===d||d.report("rtc_signaling_msg_error",{error_code:-1,message:e.t0.message,reason:"message parse failed"})),e.abrupt("return");case 16:e.t1=a.functionType,e.next=0===e.t1?19:1===e.t1?21:2===e.t1?23:25;break;case 19:return this.C2S(a,u,c,n,r),e.abrupt("break",26);case 21:return this.C2C(u,n,r),e.abrupt("break",26);case 23:return this.C2GW(a,u,c),e.abrupt("break",26);case 25:return e.abrupt("break",26);case 26:case"end":return e.stop()}}),e,this,[[8,12]])}))),function(e){return n.apply(this,arguments)})},{key:"C2S",value:(r=km(Em().mark((function e(t,r,n,i,o){var a,s,c,u,d;return Em().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(s=(null===(a=t.id)||void 0===a?void 0:a.join("-"))||"",1!==t.direction){e.next=5;break}this._handleAckMessage(s,r[0]||{},n),e.next=18;break;case 5:if(!Array.isArray(r)){e.next=18;break}if(u=r[0],r=r[1],vT(iF).call(iF,u)||nF.print("Signal","<<<<<< ".concat(u),r,s),this._feedbackSignaling(s,u,u===AV.ON_CUSTOM_MESSAGE?ud(ud({},r),{},{message:""}):""),!r.binary||"string"!=typeof r.message){e.next=14;break}return e.next=13,DO.b64str2ab(r.message);case 13:r.message=e.sent;case 14:d=Date.now(),this.emit(u,ud({},r)),u===AV.ON_CUSTOM_MESSAGE&&_O.reportOne2ManyMsgRecv(this.id,r,{msg_size:i,recv_msg_ts:o,fwd_msg_ts:d}),null===(c=this._monitor)||void 0===c||c.report("rtc_signaling",{error_code:0,message:n,signaling_event:"on-".concat(u),signaling_type:"Recv",stream_id:r.streamId,stream_user_id:r.clientId,direction:"down"});case 18:case"end":return e.stop()}}),e,this)}))),function(e,t,n,i,o){return r.apply(this,arguments)})},{key:"C2C",value:(t=km(Em().mark((function e(t,r,n){var i,o,a,s,c,u,d,l,h,p,_,v,f;return Em().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:Array.isArray(t)&&(t=t[1]),c=null===(i=t)||void 0===i?void 0:i.id,this._rttIds[c]||(null===(o=t)||void 0===o?void 0:o.dir)===ZV.FEEDBACK||LO(null===(a=t)||void 0===a?void 0:a.msg)?delete this._rttIds[c]:nF.print("Signal","<<<<<< p2p response",t),e.t0=t.dir,e.next=e.t0===ZV.SEND?6:e.t0===ZV.FEEDBACK?46:48;break;case 6:if(u=Date.now(),LO(null===(s=t)||void 0===s?void 0:s.msg)){e.next=43;break}if(l=(d=t).binary,h=d.msg,p=d.room,_=d.to,v=d.from,f=""===p?l?AV.USER_BINARY_MESSAGE_RECEIVED_OUTSIDE_ROOM:AV.USER_MESSAGE_RECEIVED_OUTSIDE_ROOM:l?AV.USER_BINARY_MESSAGE_RECEIVED:AV.USER_MESSAGE_RECEIVED,_){e.next=27;break}if(e.t1=this,e.t2=AV.ON_CUSTOM_MESSAGE,e.t3=v,e.t4=l,!l){e.next=21;break}return e.next=18,DO.b64str2ab(h);case 18:e.t5=e.sent,e.next=22;break;case 21:e.t5=h;case 22:e.t6=e.t5,e.t7={clientId:e.t3,binary:e.t4,message:e.t6},e.t1.emit.call(e.t1,e.t2,e.t7),e.next=43;break;case 27:if(e.t8=this,e.t9=f,e.t10=ud,e.t11=ud({},t),e.t12={},!l){e.next=38;break}return e.next=35,DO.b64str2ab(h);case 35:e.t13=e.sent,e.next=39;break;case 38:e.t13=h;case 39:e.t14=e.t13,e.t15={msg:e.t14},e.t16=(0,e.t10)(e.t11,e.t12,e.t15),e.t8.emit.call(e.t8,e.t9,e.t16);case 43:return this._sendP2PMessage(ud(ud({},t),{},{dir:ZV.FEEDBACK,msg:""})),_O.reportP2PMsgRecv(this.id,t,{msg_size:r,recv_msg_ts:n,fwd_msg_ts:u}),e.abrupt("break",49);case 46:return this._handleP2PMsgFeedback(t),e.abrupt("break",49);case 48:return e.abrupt("break",49);case 49:case"end":return e.stop()}}),e,this)}))),function(e,r,n){return t.apply(this,arguments)})},{key:"C2GW",value:function(e,t,r){if(1===e.direction){var n,i=(null===(n=e.id)||void 0===n?void 0:n.join("-"))||"";this._handleAckMessage(i,t[0]||{},r)}else{var o=Qk(t,2),a=o[0],s=o[1],c=void 0===s?{}:s;if("RXMediaMsg"===a){var u,d=c.type,l=c.data;switch(null===(u=this._monitor)||void 0===u||u.report("rtc_signaling",{error_code:0,message:r,signaling_event:"on-".concat(d),signaling_type:"Recv",stream_id:"",stream_user_id:"",direction:"down"}),d){case"RSCP":try{var h=JSON.parse(l);Array.isArray(h)&&this.emit(d,h)}catch(v){}break;case"RTT":try{var p=JSON.parse(l);p.length&&this.emit(d,p[0])}catch(v){}break;case"SSC":try{var _=JSON.parse(l);_.length&&this.emit(d,_[0])}catch(v){}}}}}},{key:"_handleHandler",value:function(){var e=this,t=function(e){nF.print("_handleHandler","dataChannel close",e)},r=function(e){nF.print("_handleHandler","dataChannel error",e)},n=function(t){e._handleMessage(t.data)};return this._dataChannel.addEventListener("close",t),this._dataChannel.addEventListener("error",r),this._dataChannel.addEventListener("message",n),function(){e._dataChannel.removeEventListener("close",t),e._dataChannel.removeEventListener("error",r),e._dataChannel.removeEventListener("message",n)}}},{key:"_genHeader",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return ud({version:2,zip:!1,encrypt:!1,needAck:!0,direction:0,functionType:0,binary:!1},e)}},{key:"_handleAckMessage",value:function(e,t,r){var n,i,o=this._singlingCache.get(e);o&&(this._singlingCache.delete(e),200===t.code?o.success(t):o.error(t),nF.print("Signal",wm(i="<<<<<< [".concat(o.signalingType,"-ack] ")).call(i,e),t));null===(n=this._monitor)||void 0===n||n.report("rtc_signaling",{error_code:0,message:r,signaling_event:null==o?void 0:o.signalingType,signaling_type:"Ack",stream_id:"",stream_user_id:"",direction:"down"})}},{key:"_handleP2PMsgFeedback",value:function(e){var t=this._p2pCache.get(e.id);t&&(this._p2pCache.delete(e.id),e.err===eF.SUCCESS?t.success(e.id,e):t.error(e))}}]),a}(gD.exports.EventEmitter),sF="object"==typeof global&&global&&global.Object===Object&&global,cF="object"==typeof self&&self&&self.Object===Object&&self,uF=sF||cF||Function("return this")(),dF=uF.Symbol,lF=Object.prototype,hF=lF.hasOwnProperty,pF=lF.toString,_F=dF?dF.toStringTag:void 0;var vF=Object.prototype.toString;var fF=dF?dF.toStringTag:void 0;function mF(e){return null==e?void 0===e?"[object Undefined]":"[object Null]":fF&&fF in Object(e)?function(e){var t=hF.call(e,_F),r=e[_F];try{e[_F]=void 0;var n=!0}catch(o){}var i=pF.call(e);return n&&(t?e[_F]=r:delete e[_F]),i}(e):function(e){return vF.call(e)}(e)}function gF(e){return null!=e&&"object"==typeof e}var yF=Array.isArray;function SF(e){var t=typeof e;return null!=e&&("object"==t||"function"==t)}function bF(e){return e}function EF(e){if(!SF(e))return!1;var t=mF(e);return"[object Function]"==t||"[object GeneratorFunction]"==t||"[object AsyncFunction]"==t||"[object Proxy]"==t}var TF,kF=uF["__core-js_shared__"],IF=(TF=/[^.]+$/.exec(kF&&kF.keys&&kF.keys.IE_PROTO||""))?"Symbol(src)_1."+TF:"";var RF=Function.prototype.toString;function AF(e){if(null!=e){try{return RF.call(e)}catch(t){}try{return e+""}catch(t){}}return""}var CF=/^\[object .+?Constructor\]$/,wF=Function.prototype,xF=Object.prototype,OF=wF.toString,PF=xF.hasOwnProperty,DF=RegExp("^"+OF.call(PF).replace(/[\\^$.*+?()[\]{}|]/g,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$");function MF(e){return!(!SF(e)||(t=e,IF&&IF in t))&&(EF(e)?DF:CF).test(AF(e));var t}function NF(e,t){var r=function(e,t){return null==e?void 0:e[t]}(e,t);return MF(r)?r:void 0}var LF=NF(uF,"WeakMap"),UF=Object.create,VF=function(){function e(){}return function(t){if(!SF(t))return{};if(UF)return UF(t);e.prototype=t;var r=new e;return e.prototype=void 0,r}}();function FF(e,t,r){switch(r.length){case 0:return e.call(t);case 1:return e.call(t,r[0]);case 2:return e.call(t,r[0],r[1]);case 3:return e.call(t,r[0],r[1],r[2])}return e.apply(t,r)}var BF=Date.now;var jF,GF,HF,zF=function(){try{var e=NF(Object,"defineProperty");return e({},"",{}),e}catch(t){}}(),KF=zF,XF=KF?function(e,t){return KF(e,"toString",{configurable:!0,enumerable:!1,value:(r=t,function(){return r}),writable:!0});var r}:bF,WF=(jF=XF,GF=0,HF=0,function(){var e=BF(),t=16-(e-HF);if(HF=e,t>0){if(++GF>=800)return arguments[0]}else GF=0;return jF.apply(void 0,arguments)}),qF=WF;var YF=/^(?:0|[1-9]\d*)$/;function JF(e,t){var r=typeof e;return!!(t=null==t?9007199254740991:t)&&("number"==r||"symbol"!=r&&YF.test(e))&&e>-1&&e%1==0&&e<t}function QF(e,t,r){"__proto__"==t&&KF?KF(e,t,{configurable:!0,enumerable:!0,value:r,writable:!0}):e[t]=r}function ZF(e,t){return e===t||e!=e&&t!=t}var $F=Object.prototype.hasOwnProperty;function eB(e,t,r){var n=e[t];$F.call(e,t)&&ZF(n,r)&&(void 0!==r||t in e)||QF(e,t,r)}function tB(e,t,r,n){var i=!r;r||(r={});for(var o=-1,a=t.length;++o<a;){var s=t[o],c=n?n(r[s],e[s],s,r,e):void 0;void 0===c&&(c=e[s]),i?QF(r,s,c):eB(r,s,c)}return r}var rB=Math.max;function nB(e,t){return qF(function(e,t,r){return t=rB(void 0===t?e.length-1:t,0),function(){for(var n=arguments,i=-1,o=rB(n.length-t,0),a=Array(o);++i<o;)a[i]=n[t+i];i=-1;for(var s=Array(t+1);++i<t;)s[i]=n[i];return s[t]=r(a),FF(e,this,s)}}(e,t,bF),e+"")}function iB(e){return"number"==typeof e&&e>-1&&e%1==0&&e<=9007199254740991}function oB(e){return null!=e&&iB(e.length)&&!EF(e)}var aB=Object.prototype;function sB(e){var t=e&&e.constructor;return e===("function"==typeof t&&t.prototype||aB)}function cB(e){return gF(e)&&"[object Arguments]"==mF(e)}var uB=Object.prototype,dB=uB.hasOwnProperty,lB=uB.propertyIsEnumerable,hB=cB(function(){return arguments}())?cB:function(e){return gF(e)&&dB.call(e,"callee")&&!lB.call(e,"callee")},pB=hB;var _B="object"==typeof exports&&exports&&!exports.nodeType&&exports,vB=_B&&"object"==typeof module&&module&&!module.nodeType&&module,fB=vB&&vB.exports===_B?uF.Buffer:void 0,mB=(fB?fB.isBuffer:void 0)||function(){return!1},gB={};function yB(e){return function(t){return e(t)}}gB["[object Float32Array]"]=gB["[object Float64Array]"]=gB["[object Int8Array]"]=gB["[object Int16Array]"]=gB["[object Int32Array]"]=gB["[object Uint8Array]"]=gB["[object Uint8ClampedArray]"]=gB["[object Uint16Array]"]=gB["[object Uint32Array]"]=!0,gB["[object Arguments]"]=gB["[object Array]"]=gB["[object ArrayBuffer]"]=gB["[object Boolean]"]=gB["[object DataView]"]=gB["[object Date]"]=gB["[object Error]"]=gB["[object Function]"]=gB["[object Map]"]=gB["[object Number]"]=gB["[object Object]"]=gB["[object RegExp]"]=gB["[object Set]"]=gB["[object String]"]=gB["[object WeakMap]"]=!1;var SB="object"==typeof exports&&exports&&!exports.nodeType&&exports,bB=SB&&"object"==typeof module&&module&&!module.nodeType&&module,EB=bB&&bB.exports===SB&&sF.process,TB=function(){try{var e=bB&&bB.require&&bB.require("util").types;return e||EB&&EB.binding&&EB.binding("util")}catch(t){}}(),kB=TB&&TB.isTypedArray,IB=kB?yB(kB):function(e){return gF(e)&&iB(e.length)&&!!gB[mF(e)]},RB=Object.prototype.hasOwnProperty;function AB(e,t){var r=yF(e),n=!r&&pB(e),i=!r&&!n&&mB(e),o=!r&&!n&&!i&&IB(e),a=r||n||i||o,s=a?function(e,t){for(var r=-1,n=Array(e);++r<e;)n[r]=t(r);return n}(e.length,String):[],c=s.length;for(var u in e)!t&&!RB.call(e,u)||a&&("length"==u||i&&("offset"==u||"parent"==u)||o&&("buffer"==u||"byteLength"==u||"byteOffset"==u)||JF(u,c))||s.push(u);return s}function CB(e,t){return function(r){return e(t(r))}}var wB=CB(Object.keys,Object),xB=Object.prototype.hasOwnProperty;function OB(e){return oB(e)?AB(e):function(e){if(!sB(e))return wB(e);var t=[];for(var r in Object(e))xB.call(e,r)&&"constructor"!=r&&t.push(r);return t}(e)}var PB=Object.prototype.hasOwnProperty;function DB(e){if(!SF(e))return function(e){var t=[];if(null!=e)for(var r in Object(e))t.push(r);return t}(e);var t=sB(e),r=[];for(var n in e)("constructor"!=n||!t&&PB.call(e,n))&&r.push(n);return r}function MB(e){return oB(e)?AB(e,!0):DB(e)}var NB,LB=(NB=function(e,t){tB(t,MB(t),e)},nB((function(e,t){var r=-1,n=t.length,i=n>1?t[n-1]:void 0,o=n>2?t[2]:void 0;for(i=NB.length>3&&"function"==typeof i?(n--,i):void 0,o&&function(e,t,r){if(!SF(r))return!1;var n=typeof t;return!!("number"==n?oB(r)&&JF(t,r.length):"string"==n&&t in r)&&ZF(r[t],e)}(t[0],t[1],o)&&(i=n<3?void 0:i,n=1),e=Object(e);++r<n;){var a=t[r];a&&NB(e,a,r,i)}return e}))),UB=NF(Object,"create");var VB=Object.prototype.hasOwnProperty;var FB=Object.prototype.hasOwnProperty;function BB(e){var t=-1,r=null==e?0:e.length;for(this.clear();++t<r;){var n=e[t];this.set(n[0],n[1])}}function jB(e,t){for(var r=e.length;r--;)if(ZF(e[r][0],t))return r;return-1}BB.prototype.clear=function(){this.__data__=UB?UB(null):{},this.size=0},BB.prototype.delete=function(e){var t=this.has(e)&&delete this.__data__[e];return this.size-=t?1:0,t},BB.prototype.get=function(e){var t=this.__data__;if(UB){var r=t[e];return"__lodash_hash_undefined__"===r?void 0:r}return VB.call(t,e)?t[e]:void 0},BB.prototype.has=function(e){var t=this.__data__;return UB?void 0!==t[e]:FB.call(t,e)},BB.prototype.set=function(e,t){var r=this.__data__;return this.size+=this.has(e)?0:1,r[e]=UB&&void 0===t?"__lodash_hash_undefined__":t,this};var GB=Array.prototype.splice;function HB(e){var t=-1,r=null==e?0:e.length;for(this.clear();++t<r;){var n=e[t];this.set(n[0],n[1])}}HB.prototype.clear=function(){this.__data__=[],this.size=0},HB.prototype.delete=function(e){var t=this.__data__,r=jB(t,e);return!(r<0)&&(r==t.length-1?t.pop():GB.call(t,r,1),--this.size,!0)},HB.prototype.get=function(e){var t=this.__data__,r=jB(t,e);return r<0?void 0:t[r][1]},HB.prototype.has=function(e){return jB(this.__data__,e)>-1},HB.prototype.set=function(e,t){var r=this.__data__,n=jB(r,e);return n<0?(++this.size,r.push([e,t])):r[n][1]=t,this};var zB=NF(uF,"Map");function KB(e,t){var r,n,i=e.__data__;return("string"==(n=typeof(r=t))||"number"==n||"symbol"==n||"boolean"==n?"__proto__"!==r:null===r)?i["string"==typeof t?"string":"hash"]:i.map}function XB(e){var t=-1,r=null==e?0:e.length;for(this.clear();++t<r;){var n=e[t];this.set(n[0],n[1])}}function WB(e,t){for(var r=-1,n=t.length,i=e.length;++r<n;)e[i+r]=t[r];return e}XB.prototype.clear=function(){this.size=0,this.__data__={hash:new BB,map:new(zB||HB),string:new BB}},XB.prototype.delete=function(e){var t=KB(this,e).delete(e);return this.size-=t?1:0,t},XB.prototype.get=function(e){return KB(this,e).get(e)},XB.prototype.has=function(e){return KB(this,e).has(e)},XB.prototype.set=function(e,t){var r=KB(this,e),n=r.size;return r.set(e,t),this.size+=r.size==n?0:1,this};var qB=CB(Object.getPrototypeOf,Object);function YB(e){var t=this.__data__=new HB(e);this.size=t.size}YB.prototype.clear=function(){this.__data__=new HB,this.size=0},YB.prototype.delete=function(e){var t=this.__data__,r=t.delete(e);return this.size=t.size,r},YB.prototype.get=function(e){return this.__data__.get(e)},YB.prototype.has=function(e){return this.__data__.has(e)},YB.prototype.set=function(e,t){var r=this.__data__;if(r instanceof HB){var n=r.__data__;if(!zB||n.length<199)return n.push([e,t]),this.size=++r.size,this;r=this.__data__=new XB(n)}return r.set(e,t),this.size=r.size,this};var JB="object"==typeof exports&&exports&&!exports.nodeType&&exports,QB=JB&&"object"==typeof module&&module&&!module.nodeType&&module,ZB=QB&&QB.exports===JB?uF.Buffer:void 0,$B=ZB?ZB.allocUnsafe:void 0;function ej(){return[]}var tj=Object.prototype.propertyIsEnumerable,rj=Object.getOwnPropertySymbols,nj=rj?function(e){return null==e?[]:(e=Object(e),function(e,t){for(var r=-1,n=null==e?0:e.length,i=0,o=[];++r<n;){var a=e[r];t(a,r,e)&&(o[i++]=a)}return o}(rj(e),(function(t){return tj.call(e,t)})))}:ej;var ij=Object.getOwnPropertySymbols?function(e){for(var t=[];e;)WB(t,nj(e)),e=qB(e);return t}:ej;function oj(e,t,r){var n=t(e);return yF(e)?n:WB(n,r(e))}function aj(e){return oj(e,OB,nj)}function sj(e){return oj(e,MB,ij)}var cj=NF(uF,"DataView"),uj=NF(uF,"Promise"),dj=NF(uF,"Set"),lj="[object Map]",hj="[object Promise]",pj="[object Set]",_j="[object WeakMap]",vj="[object DataView]",fj=AF(cj),mj=AF(zB),gj=AF(uj),yj=AF(dj),Sj=AF(LF),bj=mF;(cj&&bj(new cj(new ArrayBuffer(1)))!=vj||zB&&bj(new zB)!=lj||uj&&bj(uj.resolve())!=hj||dj&&bj(new dj)!=pj||LF&&bj(new LF)!=_j)&&(bj=function(e){var t=mF(e),r="[object Object]"==t?e.constructor:void 0,n=r?AF(r):"";if(n)switch(n){case fj:return vj;case mj:return lj;case gj:return hj;case yj:return pj;case Sj:return _j}return t});var Ej=bj,Tj=Object.prototype.hasOwnProperty;var kj=uF.Uint8Array;function Ij(e){var t=new e.constructor(e.byteLength);return new kj(t).set(new kj(e)),t}var Rj=/\w*$/;var Aj=dF?dF.prototype:void 0,Cj=Aj?Aj.valueOf:void 0;function wj(e,t,r){var n,i,o,a=e.constructor;switch(t){case"[object ArrayBuffer]":return Ij(e);case"[object Boolean]":case"[object Date]":return new a(+e);case"[object DataView]":return function(e,t){var r=t?Ij(e.buffer):e.buffer;return new e.constructor(r,e.byteOffset,e.byteLength)}(e,r);case"[object Float32Array]":case"[object Float64Array]":case"[object Int8Array]":case"[object Int16Array]":case"[object Int32Array]":case"[object Uint8Array]":case"[object Uint8ClampedArray]":case"[object Uint16Array]":case"[object Uint32Array]":return function(e,t){var r=t?Ij(e.buffer):e.buffer;return new e.constructor(r,e.byteOffset,e.length)}(e,r);case"[object Map]":case"[object Set]":return new a;case"[object Number]":case"[object String]":return new a(e);case"[object RegExp]":return(o=new(i=e).constructor(i.source,Rj.exec(i))).lastIndex=i.lastIndex,o;case"[object Symbol]":return n=e,Cj?Object(Cj.call(n)):{}}}var xj=TB&&TB.isMap,Oj=xj?yB(xj):function(e){return gF(e)&&"[object Map]"==Ej(e)};var Pj=TB&&TB.isSet,Dj=Pj?yB(Pj):function(e){return gF(e)&&"[object Set]"==Ej(e)},Mj="[object Arguments]",Nj="[object Function]",Lj="[object Object]",Uj={};function Vj(e,t,r,n,i,o){var a,s=1&t,c=2&t,u=4&t;if(r&&(a=i?r(e,n,i,o):r(e)),void 0!==a)return a;if(!SF(e))return e;var d=yF(e);if(d){if(a=function(e){var t=e.length,r=new e.constructor(t);return t&&"string"==typeof e[0]&&Tj.call(e,"index")&&(r.index=e.index,r.input=e.input),r}(e),!s)return function(e,t){var r=-1,n=e.length;for(t||(t=Array(n));++r<n;)t[r]=e[r];return t}(e,a)}else{var l=Ej(e),h=l==Nj||"[object GeneratorFunction]"==l;if(mB(e))return function(e,t){if(t)return e.slice();var r=e.length,n=$B?$B(r):new e.constructor(r);return e.copy(n),n}(e,s);if(l==Lj||l==Mj||h&&!i){if(a=c||h?{}:function(e){return"function"!=typeof e.constructor||sB(e)?{}:VF(qB(e))}(e),!s)return c?function(e,t){return tB(e,ij(e),t)}(e,function(e,t){return e&&tB(t,MB(t),e)}(a,e)):function(e,t){return tB(e,nj(e),t)}(e,function(e,t){return e&&tB(t,OB(t),e)}(a,e))}else{if(!Uj[l])return i?e:{};a=wj(e,l,s)}}o||(o=new YB);var p=o.get(e);if(p)return p;o.set(e,a),Dj(e)?e.forEach((function(n){a.add(Vj(n,t,r,n,e,o))})):Oj(e)&&e.forEach((function(n,i){a.set(i,Vj(n,t,r,i,e,o))}));var _=d?void 0:(u?c?sj:aj:c?MB:OB)(e);return function(e,t){for(var r=-1,n=null==e?0:e.length;++r<n&&!1!==t(e[r],r,e););}(_||e,(function(n,i){_&&(n=e[i=n]),eB(a,i,Vj(n,t,r,i,e,o))})),a}Uj[Mj]=Uj["[object Array]"]=Uj["[object ArrayBuffer]"]=Uj["[object DataView]"]=Uj["[object Boolean]"]=Uj["[object Date]"]=Uj["[object Float32Array]"]=Uj["[object Float64Array]"]=Uj["[object Int8Array]"]=Uj["[object Int16Array]"]=Uj["[object Int32Array]"]=Uj["[object Map]"]=Uj["[object Number]"]=Uj[Lj]=Uj["[object RegExp]"]=Uj["[object Set]"]=Uj["[object String]"]=Uj["[object Symbol]"]=Uj["[object Uint8Array]"]=Uj["[object Uint8ClampedArray]"]=Uj["[object Uint16Array]"]=Uj["[object Uint32Array]"]=!0,Uj["[object Error]"]=Uj[Nj]=Uj["[object WeakMap]"]=!1;function Fj(e){return Vj(e,5)}function Bj(e,t){return function(e,t){for(var r=-1,n=null==e?0:e.length,i=Array(n);++r<n;)i[r]=t(e[r],r,e);return i}(t,(function(t){return e[t]}))}function jj(e){return null==e?[]:Bj(e,OB(e))}var Gj=new uO("ConnectionManager",3),Hj=function(e){xI(o,e);var t,r,n,i=WI(o);function o(e){var t;return Yd(this,o),sd(Zk(t=i.call(this)),"id",void 0),sd(Zk(t),"_monitor",void 0),sd(Zk(t),"_getAccessManager",void 0),sd(Zk(t),"_connectionPool",new jS),sd(Zk(t),"_curConnection",void 0),sd(Zk(t),"_hasReportBrowerWarning",!1),sd(Zk(t),"_reconnectTimer",void 0),sd(Zk(t),"_connecting",!1),sd(Zk(t),"_isFirstTimeConnected",!0),sd(Zk(t),"_feedbackNodes",[]),sd(Zk(t),"_preIceStartTime",-1),sd(Zk(t),"_tcpOnlyTimer",void 0),sd(Zk(t),"_destroyed",!1),t._ctx=e,Gj.print("constructor","invoke"),t.id=e.id,t._monitor=EO(t.id),t._getAccessManager=new XV(e),t}return qd(o,[{key:"connect",value:function(){var e=this;Gj.print("connect","invoke"),this._connecting||(this._onConnectStart("init"),Wf.resolve().then((function(){return e.emit("__onGetIceConfigHook")})),this._getAccess())}},{key:"reconnectByNodeChange",value:(n=km(Em().mark((function e(t){var r,n,i,o,a,s;return Em().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:Gj.print("reconnectByNodeChange","invoke %o",t),o=t.nodes,a=t.reason,null===(r=this._monitor)||void 0===r||r.report("rtc_node_change",{error_code:0,message:eT(t),reason:eT(a)}),UP.clearAccessNode(this._ctx.appId),s=(null===(n=this._curConnection)||void 0===n||null===(i=n.node.publicIPs[0])||void 0===i?void 0:i.ip)||"",this._closeCurrentConnection(),this._clearConnectionPool(),this._clearReconnectTimer(),this._onConnectStart("node change"),Array.isArray(o)&&o.length>0?this._startIceConnect(o):this._getAccess([{feedbackIP:s,feedbackReason:{type:"NODE_CHANGED",reason:a}}]);case 10:case"end":return e.stop()}}),e,this)}))),function(e){return n.apply(this,arguments)})},{key:"reconnect",value:(r=km(Em().mark((function e(t){var r,n=arguments;return Em().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:r=n.length>1&&void 0!==n[1]&&n[1],Gj.print("reconnect","invoke. ".concat(r?"ICE over TCP":"")),this._closeCurrentConnection(),this._clearConnectionPool(),this._clearReconnectTimer(),this._onConnectStart(t),this._getAccess(void 0,r);case 7:case"end":return e.stop()}}),e,this)}))),function(e){return r.apply(this,arguments)})},{key:"destroy",value:function(){Gj.print("destroy","invoke"),this._destroyed=!0,this.safeEmit("disconnected",new lA(uA.OPERATION_CANCEL,"destroy")),CI(RI(o.prototype),"removeAllListeners",this).call(this),this._clearReconnectTimer(),this._clearConnectionPool(),this._getAccessManager.destroy(),this._closeCurrentConnection()}},{key:"_getAccess",value:function(e){var t=this,r=arguments.length>1&&void 0!==arguments[1]&&arguments[1];this._getAccessManager.getICENode(e).then((function(e){t.emit("__onGetIceSuccessHook",e),t._startIceConnect(e,r)})).catch((function(e){t.safeEmit("disconnected",e)}))}},{key:"_startIceConnect",value:function(e){var t=this,r=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(!this._destroyed){Gj.print("_startIceConnect","invoke");var n=rC();this._preIceStartTime=OO();var i=this._ctx.joinRoomConfig.useTcpJoin,o=this._ctx.joinRoomConfig.useTcpJoinDelay,a=function(){var e=km(Em().mark((function e(i){var o,a,s,c;return Em().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r&&((i=Fj(i)).iceConfig.tcpOnly=!0),o={node:i},e.prev=2,a=new JV(t._ctx,n),o.pc=a,t._connectionPool.set(a.uuid,o),e.next=8,a.connect(i);case 8:return s=e.sent,c=new aF(t.id,s),o.signaling=c,e.next=13,c.sendPingSignaling();case 13:t._onConnectSuccess({node:i,pc:a,signaling:c,dc:s}),e.next=19;break;case 16:e.prev=16,e.t0=e.catch(2),t._onConnectionFailed(o,e.t0);case 19:case"end":return e.stop()}}),e,null,[[2,16]])})));return function(t){return e.apply(this,arguments)}}();this.emit("__onIceConnectStartHook"),e.forEach(a),i&&!r&&(Gj.print("_startIceConnect","tcp-only will try after ".concat(o,"ms")),this._tcpOnlyTimer=window.setTimeout((function(){t.emit("connectWidthTcp"),e.forEach((function(e){(e=Fj(e)).iceConfig.tcpOnly=!0,a(e)})),delete t._tcpOnlyTimer}),o))}}},{key:"_onConnectSuccess",value:function(e){var t,r,n,i=this;(Gj.print("connect","peer_%s connect success.",e.pc.uuid),this.emit("__onIceConnectSuccessHook",e),this._curConnection)?(e.pc.destroy(),null===(t=e.signaling)||void 0===t||t.destroy(),this._connectionPool.delete(e.pc.uuid)):(this._curConnection=e,this._addConnectionHandler(e.pc,e.dc),null===(r=this._monitor)||void 0===r||r.set({connection_id:e.pc.getConnectionId(),rtc_vid:(null===(n=e.node.iceConfig)||void 0===n?void 0:n._abtest_vid)||""}),this._connectionPool.delete(e.pc.uuid),this._feedbackNodes.forEach((function(e){return i._feedbackBySignaling(e)})),this._feedbackNodes=[],this._onConnectEnded(e))}},{key:"_onConnectionFailed",value:function(e,t){var r,n,i=this;(Gj.print("connect","peer_%s connect failed. %s",(null===(r=e.pc)||void 0===r?void 0:r.uuid)||"",t.message),this.emit("__onIceConnectFailedHook",e),t.code!==qV.DESTROY&&t.code!==uA.OPERATION_CANCEL)&&(this._curConnection?this._feedbackBySignaling(e.node):this._feedbackNodes.push(e.node),Gj.print("connect","remove cache node"),UP.deleteAccessNode(this._ctx.appId,e.node),e.pc&&(this._connectionPool.delete(e.pc.uuid),e.pc.destroy()),null===(n=e.signaling)||void 0===n||n.destroy());0!==this._connectionPool.size||this._curConnection||this._destroyed||(Gj.print("connect","establish peerConnection failed"),this._checkBrowserUA(),OO()-this._preIceStartTime<1e3?(this._clearReconnectTimer(),this._reconnectTimer=window.setTimeout((function(){delete i._reconnectTimer,i._reconnectWithIceFailed(i._feedbackNodes)}),1e3)):this._reconnectWithIceFailed(this._feedbackNodes))}},{key:"_feedbackBySignaling",value:function(e){var t;null===(t=this._curConnection)||void 0===t||t.signaling.sendSignaling("scheduleMessage",{type:"feedback",body:{feedbackIP:e.publicIPs[0].ip,feedbackReason:{type:"ICE_FAILED",reason:{}}}})}},{key:"_reconnectWithIceFailed",value:(t=km(Em().mark((function e(t){return Em().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:this._onConnectStart("ice failed"),Gj.print("reconnect","because of ice failed"),this._getAccess(JE(t).call(t,(function(e){return{feedbackIP:e.publicIPs[0].ip,feedbackReason:{type:"ICE_FAILED",reason:{}}}})));case 3:case"end":return e.stop()}}),e,this)}))),function(e){return t.apply(this,arguments)})},{key:"_checkBrowserUA",value:function(){var e;!this._hasReportBrowerWarning&&this._ctx.joinRoomConfig.isBlackBrower()&&(this._hasReportBrowerWarning=!0,null===(e=this._monitor)||void 0===e||e.report("rtc_error",{error_code:GV.BLACK_BROWSER,message:"failed to establish data-channel, and the current browser is on the browser blacklist."}))}},{key:"_onConnectStart",value:function(e){var t;Gj.print("_onConnectStart","invoke, reason: ".concat(e)),this._connecting=!0,this.safeEmit(this._isFirstTimeConnected?"connecting":"reconnecting");var r,n=rC();(null===(t=this._monitor)||void 0===t||t.set({connect_session_id:n}),this._isFirstTimeConnected)||(null===(r=this._monitor)||void 0===r||r.report("rtc_reconnect",{error_code:1002,message:"peerconnection reconnecting",reconnect_id:n,reconnect_type:"peerconnection"},{reason:e}))}},{key:"_onConnectEnded",value:function(e){var t;(Gj.print("_onConnectEnded","invoke"),this._connecting=!1,this._isFirstTimeConnected=!1,this.safeEmit("connected",e),this._isFirstTimeConnected)||(null===(t=this._monitor)||void 0===t||t.report("rtc_reconnected",{message:"peerconnection reconnected",reconnect_type:"peerconnection"}));e.node.iceConfig.tcpOnly&&(Gj.print("_onConnectEnded","use tcp only"),IO(this._ctx.id,"connected_with_tcp_only",eT(e.node))),this._tcpOnlyTimer&&(window.clearTimeout(this._tcpOnlyTimer),delete this._tcpOnlyTimer),this._clearConnectionPool()}},{key:"_addConnectionHandler",value:function(e,t){var r=this;e.on("disconnect",(function(e){r._closeCurrentConnection(),r._clearReconnectTimer(),navigator.onLine?r.reconnect(e):r._reconnectTimer=window.setTimeout((function(){return r.reconnect(e)}),3e3)}))}},{key:"_closeCurrentConnection",value:function(){var e,t;null===(e=this._curConnection)||void 0===e||e.pc.destroy(),null===(t=this._curConnection)||void 0===t||t.signaling.destroy(),delete this._curConnection}},{key:"_clearConnectionPool",value:function(){var e=this;this._connectionPool.forEach((function(t,r){var n,i;null===(n=t.pc)||void 0===n||n.destroy(),null===(i=t.signaling)||void 0===i||i.destroy(),e._connectionPool.delete(r)}))}},{key:"_clearReconnectTimer",value:function(){this._reconnectTimer&&(window.clearTimeout(this._reconnectTimer),delete this._reconnectTimer)}}]),o}(bD),zj=ad,Kj=tc,Xj=function(e,t,r,n){for(var i,o=n>1?void 0:n?Kj(t,r):t,a=e.length-1;a>=0;a--)(i=e[a])&&(o=(n?i(t,r,o):i(o))||o);return n&&o&&zj(t,r,o),o},Wj=new uO("MediaServerClient",2),qj=6e4,Yj=function(e){return e.DISCONNECTED="disconnected",e.DISCONNECTING="disconnecting",e.CONNECTED="connected",e.CONNECTING="connecting",e}(Yj||{}),Jj=function(e,t){Wj.print(e,"userId: %o, subAudio: %o, subVideo: %o, audioMid: %o, videoMid: %o, sequenceId: %o",t.userId,t.subAudio,t.subVideo,t.audioMid,t.videoMid,t.sequenceId)},Qj=function(e){xI(k,e);var t,r,n,i,o,a,s,c,u,d,l,h,p,_,v,f,m,g,y,S,b,E,T=WI(k);function k(e){var t;return Yd(this,k),sd(Zk(t=T.call(this)),"id",void 0),sd(Zk(t),"_token",void 0),sd(Zk(t),"_roomId",void 0),sd(Zk(t),"_roomAttributes",void 0),sd(Zk(t),"_vendorConfig",{enableMultiVendor:!1,vendorCode:0}),sd(Zk(t),"_clientId",void 0),sd(Zk(t),"_businessId",void 0),sd(Zk(t),"_userInfo",void 0),sd(Zk(t),"_authorization",void 0),sd(Zk(t),"_sessionId",""),sd(Zk(t),"_liveControlMessage",void 0),sd(Zk(t),"isReconnecting",!1),sd(Zk(t),"_ontrackCallbackMap",new jS),sd(Zk(t),"_subResolves",{}),sd(Zk(t),"supportConcurrent",!1),sd(Zk(t),"_handler",void 0),sd(Zk(t),"_pubSubLock",void 0),sd(Zk(t),"_joinLeaveLock",void 0),sd(Zk(t),"_state",void 0),sd(Zk(t),"_dataChannelSignal",void 0),sd(Zk(t),"_joinRoomStartTs",void 0),sd(Zk(t),"_subConfig",{}),sd(Zk(t),"_monitor",void 0),sd(Zk(t),"_roomProfile",Pd.communication),sd(Zk(t),"_context",void 0),sd(Zk(t),"_subStreamQueue",{}),sd(Zk(t),"_connectionManager",void 0),sd(Zk(t),"_joinRoom5xxTimer",void 0),sd(Zk(t),"_joinResolve",void 0),sd(Zk(t),"_joinReject",void 0),Wj.print("constructor","invoke"),t.id=e.id,t._monitor=EO(t.id),t._pubSubLock=new MV("pubSubLock"),t._joinLeaveLock=new MV("joinLeaveLock"),t._state="disconnected",t._roomAttributes={multiChatMode:!1,bigRoomMode:!1},t._context=e,t.on("SUB_END",(function(e){return t._handleSubStreamQueue(e)})),t._connectionManager=new Hj(e),t._addConnectHandler(),t}return qd(k,[{key:"_addSignalEventHandler",value:function(){var e,t,r=this;[AV.ON_ADD_STREAM,AV.ON_ADD_STREAM_LIST,AV.ON_REMOVE_STREAM,AV.ON_REMOVE_STREAM_LIST,AV.USER_CONNECTION,AV.USER_CONNECTION_LIST,AV.USER_DISCONNECTION,AV.USER_DISCONNECTION_LIST,AV.ON_UPDATE_STREAM_ATTRIBUTES,AV.ON_UPDATE_ROOM_ATTRIBUTES,AV.ON_PUSH_TRACK,AV.ON_REMOVE_TRACK,AV.ON_CUSTOM_MESSAGE,AV.USER_MESSAGE_RECEIVED,AV.USER_BINARY_MESSAGE_RECEIVED,AV.POST_PROCESSING_MESSAGE,AV.ON_USER_TOKEN_WILL_EXPIRE,AV.STREAM_CONTROL_MESSAGE,AV.ON_UPDATE_USER_ATTRIBUTES,AV.ON_SPEAKER_CHANGE,CV.RSCP,CV.RTT,AV.ON_STREAM_FAILED,AV.ON_NOTIFY_RECONNECT,CV.SSC,AV.ON_FORWARD_DST_ROOM_USER_KICK].forEach((function(e){var t;null===(t=r._dataChannelSignal)||void 0===t||t.on(e,(function(t){r.safeEmit(e,t)}))})),null===(e=this._dataChannelSignal)||void 0===e||e.on(AV.NODE_CHANGE,(function(e){r._connectionManager.reconnectByNodeChange(e)})),null===(t=this._dataChannelSignal)||void 0===t||t.on(AV.ON_NOTIFY_RECONNECT,(function(){r._connectionManager.reconnect("recv notifyReconnect signaling")}))}},{key:"_removeSignalEventHandler",value:function(){var e,t;null===(e=this._dataChannelSignal)||void 0===e||e.removeAllListeners(),null===(t=this._handler)||void 0===t||t.removeAllListeners()}},{key:"connectionState",get:function(){return this._state},set:function(e){this._state!==e&&(this.safeEmit(wV.ON_CONNECTION_STATE_CHANGE,{prev:this._state,next:e}),this._state=e)}},{key:"businessId",set:function(e){this._businessId=e}},{key:"setLiveControlMessage",value:function(e){this._liveControlMessage=e}},{key:"connect",value:function(){var e=this;return new Wf((function(t,r){e._connectionManager.once("connected",(function(){return t()})),e._connectionManager.once("disconnected",r),e._connectionManager.connect()}))}},{key:"join",value:(E=km(Em().mark((function e(t){var r,n=this;return Em().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return Wj.print("join()","info: %o",t),this._token=t.token,this._roomId=t.roomId,this._clientId=t.userInfo.userId,this._businessId=t.userInfo.businessId,this._userInfo=t.userInfo,this._roomProfile=t.roomProfile,this._reportJoinRoomStart(),e.next=10,new Wf((function(e,t){n._joinResolve=e,n._joinReject=t,(n._handler?Wf.resolve():n.connect()).then((function(){n._callJoinRoom()})).catch((function(e){var t=Array.isArray(e)&&e.length>0?e[0]:e;n._joinRoomFailed(t.message)}))}));case 10:return r=e.sent,e.abrupt("return",r);case 12:case"end":return e.stop()}}),e,this)}))),function(e){return E.apply(this,arguments)})},{key:"_callJoinRoom",value:(b=km(Em().mark((function e(){var t,r,n,i,o,a,s,c,u,d,l,h,p,_,v,f,m=this,g=arguments;return Em().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=g.length>0&&void 0!==g[0]&&g[0],Wj.print("_callJoinRoom","invoke"),e.t0=DO.token2auth(this._context.appId,this._roomId,this._clientId,this._token),e.t1=this._sessionId,e.t2=Date.now(),e.t3=this._liveControlMessage,e.t4={extra_info:this._userInfo.extraInfo,role:this._userInfo.role},e.next=9,null===(t=this._handler)||void 0===t?void 0:t.getDefaultSdp();case 9:return e.t5=e.sent,e.next=12,pN();case 12:return e.t6=e.sent,e.t7=window.navigator.userAgent,e.t8=zP.VERSION,e.t9=UP.getDeviceId(),e.t10=this._context.appId,e.t11=this._roomId,e.t12=this._clientId,e.t13=this._businessId,e.t14=this._context.useCloudProxy,e.t15=FV[this._roomProfile]?FV[this._roomProfile][0]+"":"0",e.t16={supportedCodecs:e.t6,deviceType:"web",userAgent:e.t7,sdkVersion:e.t8,deviceId:e.t9,appId:e.t10,roomId:e.t11,userId:e.t12,businessId:e.t13,enableCloudProxy:e.t14,channelProfile:e.t15},e.t17={supportTokenExpireCallBack:!0,enableSceneConfigV2:!0,enableUnBundleMode:!0,enableAudioMux:!0,enableBigRoomMode:!0,needNegotiateSDP:!0,supportMultiVendor:!0},n={Authorization:e.t0,sessionId:e.t1,timestamp:e.t2,controlMessage:e.t3,userAttributes:e.t4,sdpInfo:e.t5,params:e.t16,options:e.t17},Wf.resolve().then((function(){return m.emit("onSendingJoinMessageHook")})),e.prev=26,o=r?"reconnected":"joinRoom",e.next=30,this._joinRoomWithRetry(o,n);case 30:a=e.sent,Wj.print("join","send join message success"),s=a.config||{},c=s.engine_WEB,this._authorization=n.Authorization,UP.setEngineWebConfig(this._context.appId,this._roomId,c),this._context&&(this._context.serverConfig={videoCodec:(null==c?void 0:c.video_codec)||"H264",audioRed:!(null==c||!c.pub_audio_red),muteReplaceUnsub:!(null===(u=a.config)||void 0===u||!u.mute_replace_unsub),simulcastOnDemand:!(aP||!1===(null===(d=a.config)||void 0===d||null===(l=d.engine_VPM)||void 0===l||null===(h=l.ondemand)||void 0===h?void 0:h.enable)),forceUniHandler:1===(null==a||null===(p=a.config)||void 0===p||null===(_=p.vendor_param)||void 0===_?void 0:_.vendor_stream_sub_mode)},"boolean"==typeof(null==c?void 0:c.av_sync)&&(this._context.avSync=c.av_sync)),this._vendorConfig=a.vendorConfig,nV.audioStallConfig=c,null!=a&&null!==(i=a.relayMessage)&&void 0!==i&&i.sdp&&(null===(v=this._handler)||void 0===v||v.createAVMlineAnswerTpl(a.relayMessage.sdp)),this.emit("joinSuccess",{joinRes:a,reconnect:r}),this._joinRoomSuccess(a),e.next=46;break;case 43:e.prev=43,e.t18=e.catch(26),(null===e.t18||void 0===e.t18?void 0:e.t18.code)>=700&&(null===e.t18||void 0===e.t18?void 0:e.t18.code)<800?this._joinRoomFailed("token_error",uA.INVALID_TOKEN):(null===e.t18||void 0===e.t18?void 0:e.t18.code)===uA.TIME_OUT&&this._context.joinRoomConfig.useTcpAfterJoinTimeout?(f="joinRoom timeout, retry with tcp only",Wj.print("join",f),this.safeEmit(NV.ON_REJOIN_WITH_TCP),this._connectionManager.reconnect(f,!0)):e.t18.code===uA.OPERATION_CANCEL&&"connecting"===this.connectionState||this._joinRoomFailed((null===e.t18||void 0===e.t18?void 0:e.t18.message)||"signaling_error");case 46:case"end":return e.stop()}}),e,this,[[26,43]])}))),function(){return b.apply(this,arguments)})},{key:"publish",value:(S=km(Em().mark((function e(t){var r,n,i,o,a,s,c,u,d,l,h,p,_,v,f,m,g,y,S,b,E,T,k,I,R,A,C,w,x,O,P,D,M=this;return Em().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(Wj.print("publish()","localStream: %o",t),r=t.videoTrack,n=t.audioTrack,i=OO(),o="",a="",s=this._handler,e.prev=7,!this._vendorConfig.enableMultiVendor){e.next=20;break}return T=new JV(this._context,""),t.vendorHandler=new jV(this._context,T),t.pcSessionId&&(t.vendorHandler.peerConnectionId=t.pcSessionId),e.next=14,t.vendorHandler.publish(t);case 14:E=e.sent,(s=t.vendorHandler).on("ice_state",(function(e){M.emit(wV.ON_VENDOR_CONNECTION_STATE_CHANGE,{state:{checking:Ed.CONNECTION_STATE_CONNECTING,connected:Ed.CONNECTION_STATE_CONNECTED,disconnected:Ed.CONNECTION_STATE_RECONNECTING}[e],userId:M._clientId})})),T.once("disconnect",km(Em().mark((function e(){var r,n,i;return Em().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(null===(r=s)||void 0===r||r.removeAllListeners(),"connected"===(null===(n=M._handler)||void 0===n||null===(i=n.pc)||void 0===i?void 0:i.iceConnectionState)){e.next=4;break}return Wj.print("vendor ice failed",t.streamId),e.abrupt("return");case 4:t.clean(),M.unpublish(t),M.publish(t);case 7:case"end":return e.stop()}}),e)})))),e.next=23;break;case 20:return e.next=22,null===(k=this._handler)||void 0===k?void 0:k.publish(t);case 22:E=e.sent;case 23:if(null===(c=t.observer)||void 0===c||c.setHandler(s),E){e.next=26;break}throw new lA(uA.ADD_TRANSCEIVER_FAILED,"add transceiver failed");case 26:if("H264"!==(null===(u=this._context)||void 0===u||null===(d=u.serverConfig)||void 0===d?void 0:d.videoCodec)){e.next=32;break}return e.next=29,SN();case 29:if(e.sent){e.next=32;break}throw new lA(uA.PUBLISH_FAILED,"h264 is not supported");case 32:return o=E.audioMid,a=E.videoMid,t.pubAttributes={localaudio:!!n,localvideo:!!r,videostream:t.pubVideo,audiostream:t.pubAudio,extvideo:!!(r instanceof mU),extaudio:!!(n instanceof gU)},I={attributes:ud({videoDescriptions:E.videoDescriptions},t.pubAttributes),audio:!0,video:!0,screen:t.isScreen,audioMid:o,videoMid:a,sdpInfo:{msid:t.stream.id,type:E.type,sdp:E.partialSdp,semantics:E.semantics},peerConnectionMode:null===(l=E)||void 0===l?void 0:l.peerConnectionMode,supportMultiVendor:!0},(R=!this._vendorConfig.enableMultiVendor&&t.enableSimulcast&&(null===(h=this._context)||void 0===h||null===(p=h.serverConfig)||void 0===p?void 0:p.simulcastOnDemand)&&(null===(_=E.subVideoDescriptions)||void 0===_?void 0:_.length))&&(I.attributes.subVideoDescriptions=E.subVideoDescriptions),null!==(v=E)&&void 0!==v&&v.peerConnectionId&&(I.peerConnectionId=E.peerConnectionId),e.next=41,null===(f=this._dataChannelSignal)||void 0===f?void 0:f.sendSignaling("publish",I);case 41:if(200===(null==(A=e.sent)?void 0:A.code)){e.next=44;break}throw new lA(uA.PUBLISH_FAILED,(null==A?void 0:A.message)||"publish failed");case 44:if(null===(m=this._monitor)||void 0===m||m.report("rtc_recv_answer",{error_code:0,answer_type:null==A?void 0:A.relayMessage.type,sequence_id:(null==A||null===(g=A.relayMessage)||void 0===g?void 0:g.sequenceId)||0,message:null==A||null===(y=A.relayMessage)||void 0===y?void 0:y.sdp,direction:"up",stream_id:"",stream_user_id:"",pc_session_id:(null===(S=s)||void 0===S?void 0:S.peerConnectionId)||""}),C=new Wf((function(e,r){var n,i,c,u,d,l;null===(n=s)||void 0===n||n.handleAck({action:vV.publish,streamId:A.streamId,audioMid:o,videoMid:a,audioTransceiverInit:null===(i=E)||void 0===i?void 0:i.audioTransceiverInit,videoTransceiverInit:null===(c=E)||void 0===c?void 0:c.videoTransceiverInit,signalingAck:{sdp:null==A||null===(u=A.relayMessage)||void 0===u?void 0:u.sdp,sequenceId:null==A||null===(d=A.relayMessage)||void 0===d?void 0:d.sequenceId},sdp:null===(l=E)||void 0===l?void 0:l.sdp,stream:t,onSuccess:function(){Wj.print("publish()","publish success"),e(0)}})})),e.t0=!aP,!e.t0){e.next=50;break}return e.next=50,C;case 50:return R&&this.emit(CV.RSCP,[{StreamIds:[t.stream.id],Metadata:{VideoIndex:0}}]),t.streamId=A.streamId,t.videoMid=a,t.audioMid=o,t.subVideoDescriptions=E.subVideoDescriptions,null===(b=this._monitor)||void 0===b||b.report("rtc_publish_stat",{result:"success",is_screen:"0",start:i,message:"unknown"}),e.abrupt("return");case 59:return e.prev=59,e.t1=e.catch(7),e.t1 instanceof Error?null===(x=this._monitor)||void 0===x||x.report("rtc_publish_stat",{result:"fail",is_screen:"0",start:i,message:wm(O="".concat(e.t1.name,": ")).call(O,e.t1.message)}):e.t1 instanceof lA&&(null===(P=this._monitor)||void 0===P||P.report("rtc_publish_stat",{result:"fail",is_screen:"0",start:i,message:wm(D="".concat(e.t1.code,": ")).call(D,e.t1.message)})),e.next=64,null===(w=s)||void 0===w?void 0:w.rollback(t.stream.id,t);case 64:throw e.t1;case 65:case"end":return e.stop()}}),e,this,[[7,59]])}))),function(e){return S.apply(this,arguments)})},{key:"updatePubTrack",value:(y=km(Em().mark((function e(t){var r,n,i,o,a,s,c,u,d,l,h,p,_,v,f,m,g,y,S,b,E,T,k,I,R,A,C,w,x,O;return Em().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:Wj.print("updatePubTrack()","localStream: %o",t),n=t.videoTrack,i=t.audioTrack,o=t.pubAudio,a=t.pubVideo,s=t.vendorHandler||this.handler,c=null==i?void 0:i.getTrack("preprocessing"),u=null==n?void 0:n.getTrack("preprocessing"),a&&u?null===(d=t.videoTransceiver)||void 0===d||d.sender.replaceTrack(u):null===(l=t.videoTransceiver)||void 0===l||l.sender.replaceTrack(null),null==s||s.updateMaxBitrate(t),o&&c?(p=i.mixType,(_=i.mixedAudioTrack)&&p!==Hd.PLAYOUT&&!0===c.enabled&&(c=_),null===(h=t.audioTransceiver)||void 0===h||h.sender.replaceTrack(c)):(null===(v=t.audioTransceiver)||void 0===v||v.sender.replaceTrack(null),IO(this.id,"MediaClient.updatePubTrack(audio)","null"));try{IO(this.id,"MediaClient.updatePubTrack",eT({audioStreamTrack:ZO(c),videoStreamTrack:ZO(u)}))}catch(HX){}for(m={},g=0,y=SA(f={localaudio:!!i,localvideo:!!n,videostream:a,audiostream:o,extvideo:!!(n instanceof mU),extaudio:!!(i instanceof gU)});g<y.length;g++)S=Qk(y[g],2),b=S[0],(E=S[1])!==sI(t.pubAttributes,b)&&xD(m,b,E);if(an(m).length){e.next=14;break}return e.abrupt("return");case 14:return t.observer&&(T=t.observer,k=m.audiostream,I=m.videostream,R=m.localaudio,A=m.localvideo,C=m.extaudio,w=m.extvideo,void 0!==A?void 0!==w?T.setPushVideo(w):T.setEnableVideo(A):void 0!==I&&T.setUnmuteVideo(I),void 0!==R?void 0!==C?T.setPushAudio(C):T.setEnableAudio(R):void 0!==k&&T.setUnmuteAudio(k)),t.pubAttributes=f,x={roomId:this._roomId,streamId:t.streamId,attributes:m},e.next=19,null===(r=this._dataChannelSignal)||void 0===r?void 0:r.sendSignaling("updateStreamAttributes",x);case 19:if(200===(null==(O=e.sent)?void 0:O.code)){e.next=22;break}throw new lA(uA.UPDATE_TRACK_FAILED,(null==O?void 0:O.message)||"update track failed");case 22:if(!aP){e.next=25;break}return e.next=25,null==s?void 0:s.setCurrentDescription();case 25:case"end":return e.stop()}}),e,this)}))),function(e){return y.apply(this,arguments)})},{key:"updateToken",value:(g=km(Em().mark((function e(t){var r,n,i,o,a;return Em().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(Wj.print("updateToken()","newToken: %o",t),this._token=t,this._context.appId&&null!==(r=this._userInfo)&&void 0!==r&&r.userId&&this._roomId){e.next=4;break}return e.abrupt("return");case 4:return i={roomId:this._roomId,userId:null===(n=this._userInfo)||void 0===n?void 0:n.userId,appId:this._context.appId,token:"Bearer ".concat(t)},e.prev=5,e.next=8,null===(o=this._dataChannelSignal)||void 0===o?void 0:o.sendSignaling("updateToken",i);case 8:if(200===(null==(a=e.sent)?void 0:a.code)){e.next=11;break}throw new lA(uA.UPDATE_TOKEN_WITH_INVALID_TOKEN,"invoke updateToken with an invalid token");case 11:e.next=16;break;case 13:throw e.prev=13,e.t0=e.catch(5),new lA(uA.UPDATE_TOKEN_WITH_INVALID_TOKEN,"invoke updateToken with an invalid token");case 16:case"end":return e.stop()}}),e,this,[[5,13]])}))),function(e){return g.apply(this,arguments)})},{key:"unpublish",value:(m=km(Em().mark((function e(t){var r,n,i;return Em().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return Wj.print("unpublish()","localStream: %o",t),n={roomId:this._roomId,initStreamId:t.initStreamId,streamId:t.streamId},null===(r=this._dataChannelSignal)||void 0===r||r.sendSignaling("unpublish",n),i=t.vendorHandler||this._handler,e.next=6,null==i?void 0:i.handleAck({action:vV.unpublish,audioMid:t.audioMid,videoMid:t.videoMid,stream:t,streamId:t.streamId});case 6:case"end":return e.stop()}}),e,this)}))),function(e){return m.apply(this,arguments)})},{key:"subscribe",value:(f=km(Em().mark((function e(t,r,n){var i=this;return Em().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",new Wf(function(){var e=km(Em().mark((function e(o,a){var s,c,u,d,l,h,p,_,v,f,m,g,y,S,b,E,T,k,I,R,A,C,w,x,O,P,D,M,N,L,U,V,F,B,j,G,H,z,K,X,W,q,Y,J,Q,Z,$;return Em().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t.streamState!==dV.SUB_ED){e.next=2;break}return e.abrupt("return",i._updateSubTrack(t,r,VV.SUB).then(o,a));case 2:if(t.streamState!==dV.SUB_ING){e.next=7;break}return i._subStreamQueue[t.streamId]||(i._subStreamQueue[t.streamId]=[]),Wj.print("_subStreamQueue","streamId: %o, enqueue",t.streamId),i._subStreamQueue[t.streamId].push({fn:i.subscribe,args:[t,r,n],resolve:o,reject:a}),e.abrupt("return");case 7:if(Wj.print("subscribe()","mediaType: %o",r),Jj("subscribe()",t),t.streamState=dV.SUB_ING,c=!1,u=!1,qO(r)&&(u=!0),YO(r)&&(c=!0),c||!i.multiChatMode()){e.next=17;break}return t.streamState=dV.INIT,i.emit("SUB_END",t.streamId),e.abrupt("return",o(null));case 17:if(d=OO(),l=t.subVideo,h=[],p=!i.multiChatMode(),i._subResolves[t.streamId]||(i._subResolves[t.streamId]=[]),h.push(new Wf((function(e,r){i._subResolves[t.streamId].push(e);var n=setTimeout((function(){return r(new lA(uA.TIME_OUT,"wait video timeout for userId: ".concat(t.userId)))}),qj);t.on("ontrack",(function r(i){"video"===i.mediaType&&(Wj.print("remoteStream ".concat(t.userId," received video track")),t.off("ontrack",r),clearTimeout(n),e(0))}))}))),p&&h.push(new Wf((function(e,r){i._subResolves[t.streamId].push(e);var n=setTimeout((function(){return r(new lA(uA.TIME_OUT,"wait audio timeout for userId: ".concat(t.userId)))}),qj);t.on("ontrack",(function r(i){"audio"===i.mediaType&&(Wj.print("remoteStream ".concat(t.userId," received audio track")),t.off("ontrack",r),clearTimeout(n),e(0))}))}))),_=function(e){t.ontrack(e)},null===(s=i._handler)||void 0===s||s.on("ontrack",_),i._ontrackCallbackMap.set(t,_),v=i._handler,e.prev=28,null!==(f=i._context.serverConfig)&&void 0!==f&&f.forceUniHandler||!t.enableVendorMode){e.next=42;break}return V=new JV(i._context,""),t.vendorHandler=new jV(i._context,V),t.pcSessionId&&(t.vendorHandler.peerConnectionId=t.pcSessionId),(v=t.vendorHandler).on("ontrack",_),e.next=37,t.vendorHandler.subscribe(t);case 37:U=e.sent,v.on("ice_state",(function(e){i.emit(wV.ON_VENDOR_CONNECTION_STATE_CHANGE,{state:{checking:Ed.CONNECTION_STATE_CONNECTING,connected:Ed.CONNECTION_STATE_CONNECTED,disconnected:Ed.CONNECTION_STATE_RECONNECTING}[e],userId:t.userId})})),V.once("disconnect",km(Em().mark((function e(){var r,n,o;return Em().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(null===(r=v)||void 0===r||r.removeAllListeners(),"connected"===(null===(n=i._handler)||void 0===n||null===(o=n.pc)||void 0===o?void 0:o.iceConnectionState)){e.next=4;break}return Wj.print("vendor ice failed",t.streamId),e.abrupt("return");case 4:return t.resetHasSubscribed(),i.unsubscribe(t,Sd.AUDIO_AND_VIDEO,!0),e.next=8,i.subscribe(t,t.subMediaType);case 8:i.emit(NV.RESUBSCRIBE,{stream:t});case 9:case"end":return e.stop()}}),e)})))),e.next=45;break;case 42:return e.next=44,null===(F=i._handler)||void 0===F?void 0:F.subscribe(t,{multiChatMode:i.multiChatMode()});case 44:U=e.sent;case 45:if(null===(m=t.observer)||void 0===m||m.setHandler(v),U){e.next=48;break}throw new lA(uA.ADD_TRANSCEIVER_FAILED,"add transceiver failed");case 48:return B=U.audioMid,j=U.videoMid,t.subVideo=c,G={spatialLayer:(null==n?void 0:n.spatialLayer)||0,temporalLayer:0,spatialSubLayer:(null==n?void 0:n.spatialSubLayer)||-1},H={audio:!i.multiChatMode(),video:!0,data:!0,screen:t.isScreen,browser:"chrome-stable",videoMid:j,audioMid:B,sdpInfo:{sdp:null===(g=U)||void 0===g?void 0:g.partialSdp,semantics:null===(y=U)||void 0===y?void 0:y.semantics,type:null===(S=U)||void 0===S?void 0:S.type},streamUserId:t.userId,streamId:t.streamId,config:{enableMediaType:{audio:!!i.multiChatMode()||u,video:c},qualityLayer:G},extra:{enableSendRTT:!0},peerConnectionMode:null===(b=U)||void 0===b?void 0:b.peerConnectionMode,supportMultiVendor:!0},null!==(E=U)&&void 0!==E&&E.peerConnectionId&&(H.peerConnectionId=U.peerConnectionId),z=i._context||{},K=z.subscribeFallbackOption,X=z.userPriority,"number"==typeof K&&(H.config.fallbackOption=K),X.has(t.userId)&&(H.config.priority=X.get(t.userId)),null!==(T=U)&&void 0!==T&&T.allSsrc&&(H.extra.subscribeSSRC=U.allSsrc),e.next=60,null===(k=i._dataChannelSignal)||void 0===k?void 0:k.sendSignaling("subscribe",H);case 60:if(200===(null==(W=e.sent)?void 0:W.code)){e.next=63;break}throw new lA(uA.SUBSCRIBE_FAILED,(null==W?void 0:W.message)||"subscribe failed");case 63:return q=null==W?void 0:W.relayMessage,Y=q.audioMid,J=q.videoMid,sd(I={},B,Y),sd(I,j,J),Q=I,Wj.print("sub midmap",t.userId,Q),t.videoMid=j,t.audioMid=B,t.subMediaType=r,t.streamState=dV.SUB_ED,t.subLayer=G,null===(R=i._monitor)||void 0===R||R.report("rtc_recv_answer",{error_code:0,answer_type:null==W||null===(A=W.relayMessage)||void 0===A?void 0:A.type,sequence_id:(null==W||null===(C=W.relayMessage)||void 0===C?void 0:C.sequenceId)||0,message:null==W||null===(w=W.relayMessage)||void 0===w?void 0:w.sdp,direction:"down",stream_id:t.streamId,stream_user_id:t.userId,pc_session_id:(null===(x=v)||void 0===x?void 0:x.peerConnectionId)||""}),e.next=74,null===(O=v)||void 0===O?void 0:O.handleAck({action:vV.subscribe,streamId:t.streamId,audioMid:B,videoMid:j,audioTransceiverInit:null===(P=U)||void 0===P?void 0:P.audioTransceiverInit,videoTransceiverInit:null===(D=U)||void 0===D?void 0:D.videoTransceiverInit,signalingAck:{sdp:null==W||null===(M=W.relayMessage)||void 0===M?void 0:M.sdp,sequenceId:null==W||null===(N=W.relayMessage)||void 0===N?void 0:N.sequenceId},stream:t,sdp:U.sdp,generatorSsrc:!!U.allSsrc});case 74:return e.next=76,Wf.all(h);case 76:i.multiChatMode()||(t.subAudio=u),null===(L=i._monitor)||void 0===L||L.report("rtc_subscribe_stat",{result:"success",start:d,message:"unknown",stream_user_id:t.userId}),i._context&&t.statsReport.setRemoteStreamStatsEvtInterval((function(e){return i.emit("onRemoteStreamStats",e)}),v),o(null),i.emit("SUB_END",t.streamId),e.next=92;break;case 83:return e.prev=83,e.t0=e.catch(28),e.t0 instanceof Error&&(null===($=i._monitor)||void 0===$||$.report("rtc_subscribe_stat",{result:"fail",start:d,message:e.t0.message,stream_user_id:t.userId})),t.subVideo=l,t.streamState=dV.INIT,e.next=90,null===(Z=v)||void 0===Z?void 0:Z.rollback(t.streamId,t);case 90:a(e.t0),i.emit("SUB_END",t.streamId);case 92:case"end":return e.stop()}}),e,null,[[28,83]])})));return function(t,r){return e.apply(this,arguments)}}()));case 1:case"end":return e.stop()}}),e)}))),function(e,t,r){return f.apply(this,arguments)})},{key:"_handleSubStreamQueue",value:function(e){var t,r=this;if(null!==(t=this._subStreamQueue[e])&&void 0!==t&&t.length){Wj.print("_subStreamQueue","streamId: %o, exec",e);var n=this._subStreamQueue[e].shift(),i=n.fn,o=n.args,a=n.resolve,s=n.reject;i.apply(this,o).then(a,s).finally((function(){return r._handleSubStreamQueue(e)}))}else Wj.print("_subStreamQueue","streamId: %o, END",e)}},{key:"controlMessage",value:(v=km(Em().mark((function e(t){var r,n;return Em().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return Wj.print("controlMessage()","params: %o",t),n=t,"transcode"===t.type&&(n.roomId=this._roomId),e.next=5,null===(r=this._dataChannelSignal)||void 0===r?void 0:r.sendSignaling("controlMessage",n);case 5:case"end":return e.stop()}}),e,this)}))),function(e){return v.apply(this,arguments)})},{key:"updateUserAttributes",value:(_=km(Em().mark((function e(t){var r;return Em().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return Wj.print("updateUserAttributes()","attributes: %o",t),e.next=3,null===(r=this._dataChannelSignal)||void 0===r?void 0:r.sendSignaling("updateUserAttributes",{roomId:this._roomId,sessionId:this._sessionId,attributes:t});case 3:case"end":return e.stop()}}),e,this)}))),function(e){return _.apply(this,arguments)})},{key:"updateSubTrack",value:(p=km(Em().mark((function e(t,r,n){return Em().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",this._updateSubTrack(t,r,n));case 1:case"end":return e.stop()}}),e,this)}))),function(e,t,r){return p.apply(this,arguments)})},{key:"updateSubTrackLayer",value:(h=km(Em().mark((function e(t,r){var n,i,o;return Em().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(Wj.print("updateSubTrack()","subLayer: %o",r),t.subLayer.spatialLayer!==r.spatialLayer||t.subLayer.spatialSubLayer!==r.spatialSubLayer){e.next=4;break}return Wj.print("updateSubTrack()","subLayer no change"),e.abrupt("return");case 4:return i={roomId:this._roomId,streamList:[t.streamId],streamId:t.streamId,streamUserId:t.userId,config:{qualityLayer:r}},e.next=7,null===(n=this._dataChannelSignal)||void 0===n?void 0:n.sendSignaling("updateSubscribe",i);case 7:if(200===(null==(o=e.sent)?void 0:o.code)){e.next=10;break}throw new lA(uA.UPDATE_TRACK_FAILED,(null==o?void 0:o.message)||"update track failed");case 10:return t.subLayer=r,e.abrupt("return",t);case 12:case"end":return e.stop()}}),e,this)}))),function(e,t){return h.apply(this,arguments)})},{key:"updateSubPriority",value:(l=km(Em().mark((function e(t,r){var n,i,o;return Em().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(Wj.print("updateSubPriority()","priority: %o",r),t.priority!==r){e.next=4;break}return Wj.print("updateSubPriority()","priority no change"),e.abrupt("return",t);case 4:return i={roomId:this._roomId,streamList:[t.streamId],streamId:t.streamId,streamUserId:t.userId,config:{priority:r}},e.next=7,null===(n=this._dataChannelSignal)||void 0===n?void 0:n.sendSignaling("updateSubscribe",i);case 7:if(200===(null==(o=e.sent)?void 0:o.code)){e.next=10;break}throw new lA(uA.UPDATE_TRACK_FAILED,(null==o?void 0:o.message)||"update track failed");case 10:return t.priority=r,e.abrupt("return",t);case 12:case"end":return e.stop()}}),e,this)}))),function(e,t){return l.apply(this,arguments)})},{key:"_updateSubTrack",value:(d=km(Em().mark((function e(t,r,n){var i,o,a,s,c,u,d,l;return Em().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(Wj.print("updateSubTrack()","mediaType: %o",r),Jj("updateSubTrack()",t),!this.multiChatMode()||r!==Sd.AUDIO){e.next=5;break}return Wj.print("updateSubTrack","multiChatMode mediaType only audio"),e.abrupt("return",t);case 5:return a=0,a=n===VV.SUB?t.subMediaType|r:t.subMediaType-(t.subMediaType&r),Wj.print("updateSubTrack","prev: %o, direction: %o, mediaType: %o, newMediaType: %o",t.subMediaType,n,r,a),t.subMediaType===a&&Wj.print("updateSubTrack","mediaType no change"),s=!1,c=!1,qO(a)&&(c=!0),YO(a)&&(s=!0),u={roomId:this._roomId,streamList:[t.streamId],config:{enableMediaType:{video:s,audio:!!this.multiChatMode()||c}}},e.next=15,null===(i=this._dataChannelSignal)||void 0===i?void 0:i.sendSignaling("updateSubscribe",u);case 15:if(200===(null==(d=e.sent)?void 0:d.code)){e.next=18;break}throw new lA(uA.UPDATE_TRACK_FAILED,(null==d?void 0:d.message)||"update track failed");case 18:return this.multiChatMode()||(null===(l=t.observer)||void 0===l||l.setUnmuteAudio(c),t.subAudio=c),null===(o=t.observer)||void 0===o||o.setUnmuteVideo(s),t.subVideo=s,t.subMediaType=a,e.abrupt("return",t);case 23:case"end":return e.stop()}}),e,this)}))),function(e,t,r){return d.apply(this,arguments)})},{key:"subscribe4pushTrack",value:(u=km(Em().mark((function e(t,r){var n,i,o,a,s,c,u,d,l=this;return Em().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return Wj.print("subscribe4pushTrack()","streamInfo: %o",r),Jj("subscribe4pushTrack()",t),t.subAudio=!0,e.next=5,null===(n=this._handler)||void 0===n?void 0:n.subscribe(t,{multiChatMode:this.multiChatMode()});case 5:if(a=e.sent){e.next=8;break}throw new lA(uA.ADD_TRANSCEIVER_FAILED,"add transceiver failed");case 8:return s=a.audioMid,c=a.videoMid,(u=[]).push(new Wf((function(e,r){var n=setTimeout((function(){return r(new lA(uA.TIME_OUT,"wait audio timeout for userId: ".concat(t.userId)))}),qj);t.on("ontrack",(function r(i){"audio"===i.mediaType&&(Wj.print("remoteStream ".concat(t.userId," received audio track")),t.off("ontrack",r),clearTimeout(n),e(0))}))}))),d=function(e){t.ontrack(e)},null===(i=this._handler)||void 0===i||i.on("ontrack",d),this._ontrackCallbackMap.set(t,d),e.next=17,null===(o=this._handler)||void 0===o?void 0:o.handleAck({action:vV.pushtrack,streamId:t.streamId,audioMid:s,videoMid:c,stream:t,audioTransceiverInit:null==a?void 0:a.audioTransceiverInit,videoTransceiverInit:null==a?void 0:a.videoTransceiverInit,signalingAck:null==r?void 0:r.message,sdp:a.sdp});case 17:return e.next=19,Wf.all(u);case 19:this._context&&t.statsReport.setRemoteStreamStatsEvtInterval((function(e){return l.emit("onRemoteStreamStats",e)}),this._handler);case 20:case"end":return e.stop()}}),e,this)}))),function(e,t){return u.apply(this,arguments)})},{key:"unsubscribe4removeTrack",value:(c=km(Em().mark((function e(t,r,n){var i,o,a,s,c,u,d;return Em().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(Jj("unsubscribe4removeTrack()",t),Wj.print("unsubscribe4removeTrack()","sequenceId: ",r.sequenceId,"trackType: ",n),!(r.sequenceId<t.sequenceId)){e.next=5;break}return Wj.print("unsubscribe4removeTrack()","sequenceId return"),e.abrupt("return");case 5:return u=!!((c=n+1)&Sd.AUDIO),d=!!(c&Sd.VIDEO),e.next=10,null===(i=this._handler)||void 0===i?void 0:i.handleAck({action:vV.removetrack,streamId:t.streamId,audioMid:t.audioMid,videoMid:t.videoMid,stream:t});case 10:null===(o=t.observer)||void 0===o||o.setPushTrack(!1),null===(a=t.observer)||void 0===a||a.setUnmuteAudio(!u),t.subAudio=!u,null===(s=t.observer)||void 0===s||s.setUnmuteVideo(!d),t.subVideo=!d,t.subMediaType=t.subMediaType-(t.subMediaType&c),t.virtual&&(t.clean(),t.resetHasSubscribed(),t.statsReport.unsubscribe());case 17:case"end":return e.stop()}}),e,this)}))),function(e,t,r){return c.apply(this,arguments)})},{key:"unsubscribe",value:(s=km(Em().mark((function e(t,r){var n,i,o=arguments;return Em().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(n=o.length>2&&void 0!==o[2]&&o[2],Jj("unsubscribe()",t),!n){e.next=4;break}return e.abrupt("return",this._unsubscribe(t,r));case 4:if(!this.multiChatMode()||!YO(r)){e.next=6;break}return e.abrupt("return",this._unsubscribe(t,r));case 6:if(i=t.subMediaType-(t.subMediaType&r),this.multiChatMode()||i!==zU.NONE){e.next=9;break}return e.abrupt("return",this._unsubscribe(t,r));case 9:return e.abrupt("return",this._updateSubTrack(t,r,VV.UNSUB));case 10:case"end":return e.stop()}}),e,this)}))),function(e,t){return s.apply(this,arguments)})},{key:"_unsubscribe",value:(a=km(Em().mark((function e(t,r){var n,i,o,a,s,c;return Em().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!this._subConfig.muteReplaceUnsub){e.next=2;break}return e.abrupt("return",this._updateSubTrack(t,r,VV.UNSUB));case 2:return a={roomId:this._roomId,streamId:t.streamId,userId:t.userId},s=t.vendorHandler||this.handler,null===(n=this._dataChannelSignal)||void 0===n||n.sendSignaling("unsubscribe",a).catch((function(){})),t.streamState=dV.INIT,this._subStreamQueue[t.streamId]&&(this._subStreamQueue[t.streamId].forEach((function(e){return(0,e.resolve)(null)})),delete this._subStreamQueue[t.streamId]),t.subVideo=!1,null===(i=t.observer)||void 0===i||i.setSubscribeVideo(!1),!this.multiChatMode()&&(null===(o=t.observer)||void 0===o||o.setSubscribeAudio(!1)),e.next=12,null==s?void 0:s.handleAck({action:vV.unsubscribe,streamId:t.streamId,audioMid:t.audioMid,videoMid:t.videoMid,stream:t});case 12:c=e.sent,this._subResolves[c]&&this._subResolves[c].forEach((function(e){return e(0)})),Wj.print("unsubscribe","clean unsub ".concat(t.userId)),t.clean(),this.removeOnTrackListener(t),t.statsReport.unsubscribe();case 18:case"end":return e.stop()}}),e,this)}))),function(e,t){return a.apply(this,arguments)})},{key:"removeOnTrackListener",value:function(e){var t=this._ontrackCallbackMap.get(e);if(t){var r=e.vendorHandler||this._handler;null==r||r.off("ontrack",t),this._ontrackCallbackMap.delete(e)}}},{key:"handleRemoveStream",value:(o=km(Em().mark((function e(t,r){return Em().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(Jj("handleRemoveStream()",t),t.subVideo=!1,t.streamState!==dV.INIT){e.next=4;break}return e.abrupt("return");case 4:this.unsubscribe(t,Sd.AUDIO_AND_VIDEO,!0);case 5:case"end":return e.stop()}}),e,this)}))),function(e,t){return o.apply(this,arguments)})},{key:"leave",value:(i=km(Em().mark((function e(){var t,r,n;return Em().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(Wj.print("leave()"),this._stopJoinRoom5xxRetry(),this._joinRoomFailed("leave_room"),"connected"!==this.connectionState){e.next=20;break}return t={Authorization:this._authorization,roomId:this._roomId,sessionId:this._sessionId},e.next=7,this._joinLeaveLock.lock();case 7:return r=e.sent,e.prev=8,e.next=11,null===(n=this._dataChannelSignal)||void 0===n?void 0:n.sendSignaling("leaveRoom",t);case 11:r(),e.next=18;break;case 14:throw e.prev=14,e.t0=e.catch(8),r(),e.t0;case 18:e.next=21;break;case 20:return e.abrupt("return",Wf.reject(new lA(uA.NOT_CONNECTED_YET,"server not connected")));case 21:case"end":return e.stop()}}),e,this,[[8,14]])}))),function(){return i.apply(this,arguments)})},{key:"subscribePublicStream",value:(n=km(Em().mark((function e(t){var r,n,i,o,a,s,c,u,d,l,h,p,_,v,f,m,g=this;return Em().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,null===(r=this._handler)||void 0===r?void 0:r.subscribe(t,{multiChatMode:!1});case 2:if(s=e.sent){e.next=5;break}throw new lA(uA.ADD_TRANSCEIVER_FAILED,"add transceiver failed");case 5:return c=OO(),u=s.audioMid,d=s.videoMid,e.t0=this._context.appId,e.t1=t.streamId,e.t2=u,e.t3=d,e.t4={sdp:null==s?void 0:s.partialSdp,semantics:null==s?void 0:s.semantics,type:null==s?void 0:s.type},e.next=15,pN();case 15:return e.t5=e.sent,e.t6=window.navigator.userAgent,e.t7=zP.VERSION,e.t8=UP.getDeviceId(),e.t9=this._context.appId,e.t10=this._businessId,e.t11=this._context.useCloudProxy,e.t12={supportedCodecs:e.t5,deviceType:"web",userAgent:e.t6,sdkVersion:e.t7,deviceId:e.t8,appId:e.t9,businessId:e.t10,enableCloudProxy:e.t11},e.t13={enableMediaType:{audio:!0,video:!0},qualityLayer:{spatialLayer:0,temporalLayer:0}},l={appId:e.t0,streamId:e.t1,audio:!0,video:!0,data:!0,audioMid:e.t2,videoMid:e.t3,sdpInfo:e.t4,params:e.t12,config:e.t13},e.next=27,null===(n=this._dataChannelSignal)||void 0===n?void 0:n.sendSignaling("startPullStream",l);case 27:return h=e.sent,p=[],this._subResolves[t.streamId]=[],p.push(new Wf((function(e,r){g._subResolves[t.streamId].push(e);var n=setTimeout((function(){return r(new lA(uA.TIME_OUT,"wait video timeout for streamId: ".concat(t.streamId)))}),qj);t.on("ontrack",(function r(i){"video"===i.mediaType&&(Wj.print("remoteStream ".concat(t.userId," received video track")),t.off("ontrack",r),clearTimeout(n),e(0))}))}))),p.push(new Wf((function(e,r){g._subResolves[t.streamId].push(e);var n=setTimeout((function(){return r(new lA(uA.TIME_OUT,"wait audio timeout for streamId: ".concat(t.streamId)))}),qj);t.on("ontrack",(function r(i){"audio"===i.mediaType&&(Wj.print("remoteStream ".concat(t.userId," received audio track")),t.off("ontrack",r),clearTimeout(n),e(0))}))}))),_=function(e){t.ontrack(e)},null===(i=this._handler)||void 0===i||i.on("ontrack",_),this._ontrackCallbackMap.set(t,_),v=null==h?void 0:h.relayMessage,f=v.sequenceId,m=v.sdp,t.videoMid=d,t.audioMid=u,t.sequenceId=f,t.streamState=dV.SUB_ED,t.subAudio=!0,t.subVideo=!0,e.next=44,null===(o=this._handler)||void 0===o?void 0:o.handleAck({action:vV.subscribe,streamId:t.streamId,audioMid:u,videoMid:d,audioTransceiverInit:null==s?void 0:s.audioTransceiverInit,videoTransceiverInit:null==s?void 0:s.videoTransceiverInit,signalingAck:{sdp:m,sequenceId:f},stream:t});case 44:return e.next=46,Wf.all(p);case 46:null===(a=this._monitor)||void 0===a||a.report("rtc_subscribe_stat",{result:"success",start:c,message:"unknown",stream_user_id:t.userId}),this._context&&t.statsReport.setRemoteStreamStatsEvtInterval((function(e){return g.emit("onRemoteStreamStats",e)}),this._handler);case 48:case"end":return e.stop()}}),e,this)}))),function(e){return n.apply(this,arguments)})},{key:"unsubscribePublicStream",value:(r=km(Em().mark((function e(t){var r,n,i;return Em().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return Jj("unsubscribePublicStream()",t),n={appId:this._context.appId,streamId:t.streamId},e.prev=2,e.next=5,null===(i=this._dataChannelSignal)||void 0===i?void 0:i.sendSignaling("stopPullStream",n);case 5:e.next=9;break;case 7:e.prev=7,e.t0=e.catch(2);case 9:return t.streamState=dV.INIT,t.subVideo=!1,t.subAudio=!1,e.next=14,null===(r=this._handler)||void 0===r?void 0:r.handleAck({action:vV.unsubscribe,streamId:t.streamId,audioMid:t.audioMid,videoMid:t.videoMid,stream:t});case 14:t.clean(),this.removeOnTrackListener(t),t.statsReport.unsubscribe();case 17:case"end":return e.stop()}}),e,this,[[2,7]])}))),function(e){return r.apply(this,arguments)})},{key:"destroy",value:function(){var e,t,r;Wj.print("destroy()"),this._joinRoomFailed("leave_room"),this._token=void 0,this._roomId=void 0,this._clientId=void 0,this._authorization=void 0,this._sessionId="",this._stopJoinRoom5xxRetry(),null===(e=this._handler)||void 0===e||e.destroy(),this._handler=void 0,null===(t=this._dataChannelSignal)||void 0===t||t.destroy(),this._dataChannelSignal=void 0,this._connectionManager.destroy(),null===(r=this._monitor)||void 0===r||r.set({connection_id:""}),this._removeSignalEventHandler(),this.removeAllListeners(),this.connectionState="disconnected"}},{key:"sendUserMessage",value:function(e,t){var r;return null===(r=this._dataChannelSignal)||void 0===r?void 0:r.sendP2PMessage({to:e,from:this._userInfo.userId,room:this._roomId,app:this._context.appId,msg:t})}},{key:"sendRoomMessage",value:function(e){var t;return null===(t=this._dataChannelSignal)||void 0===t?void 0:t.sendSignaling("customMessage",e)}},{key:"_joinRoomWithRetry",value:function(e,t,r){var n=this;return new Wf((function(i,o){n._dataChannelSignal.sendSignaling(e,t,void 0,1e4).then((function(e){n.emit("onJoinRoomAck",e),i(e)})).catch((function(a){if(r=r||new zV,a.code>=500&&a.code<600&&OO()-r.initTs<6e4){var s,c=r.getRetryDelay();return Wj.print("_joinRoomWithRetry",wm(s="joinRoom failed(code: ".concat(a.code,"), will retry after ")).call(s,c,"ms")),void(n._joinRoom5xxTimer=window.setTimeout((function(){delete n._joinRoom5xxTimer,n._joinRoomWithRetry(e,t,r).then(i).catch(o)}),c))}o(a)}))}))}},{key:"_stopJoinRoom5xxRetry",value:function(){this._joinRoom5xxTimer&&(clearTimeout(this._joinRoom5xxTimer),delete this._joinRoom5xxTimer)}},{key:"_addConnectHandler",value:function(){var e=this;this._connectionManager.on("connected",(function(t){var r,n,i;e.connectionState="connected",Wj.print("connectStateChange","connected"),null===(r=e._dataChannelSignal)||void 0===r||r.destroy(),null===(n=e._handler)||void 0===n||n.destroy(),e._handler=kV(e._context,t.pc),e._dataChannelSignal=t.signaling,e.supportConcurrent="chrome"===(null===(i=e._handler)||void 0===i?void 0:i.name),e._addSignalEventHandler(),e.isReconnecting&&(e._reportJoinRoomStart(),e._callJoinRoom(!0))})),this._connectionManager.on("disconnected",(function(t){e.connectionState="disconnected",Wj.print("connectStateChange","disconnected. %o",t),e.isReconnecting&&e.safeEmit(NV.RECONNECT_FAILED)})),this._connectionManager.on("connecting",(function(){var t;e.isReconnecting=!1,null===(t=e._handler)||void 0===t||t.destroy(),delete e._handler,e.connectionState="connecting",Wj.print("connectStateChange","connecting")})),this._connectionManager.on("reconnecting",(function(){var t;e.connectionState="disconnected",e.isReconnecting=!0,null===(t=e._handler)||void 0===t||t.destroy(),delete e._handler,e.connectionState="connecting",Wj.print("connectStateChange","reconnecting"),e.safeEmit("reconnecting")})),this._connectionManager.on("connectWidthTcp",(function(){e.safeEmit(NV.ON_ICE_CONNECT_WITH_TCP)})),["__onGetIceConfigHook","__onIceConnectSuccessHook"].forEach((function(t){e._connectionManager.on(t,(function(){return e.emit(t)}))}))}},{key:"_reportJoinRoomStart",value:function(){var e;this._joinRoomStartTs=OO(),this.emit("__joinRoomStartReport"),null===(e=this._monitor)||void 0===e||e.report("join_room",{type:"begin",start:this._joinRoomStartTs,result:!1,reason:""},{enable_cloud_proxy:this._context.useCloudProxy,expectedIDC:this._context.expectedIDC})}},{key:"_joinRoomSuccess",value:function(e){var t,r;(this._joinReject&&this._joinResolve&&(this._joinResolve(e),delete this._joinReject,delete this._joinResolve),this._joinRoomStartTs)&&(this.emit("__joinRoomSuccessReport"),null===(t=this._monitor)||void 0===t||t.report("join_room",{type:"end",start:this._joinRoomStartTs,result:!0,reason:""},{enable_cloud_proxy:this._context.useCloudProxy,expectedIDC:this._context.expectedIDC}),null===(r=this._monitor)||void 0===r||r.report("rtc_join_room",{error_code:0,deviceModel:"web",deviceManufacturer:"web",elapse:OO()-this._joinRoomStartTs}),delete this._joinRoomStartTs)}},{key:"_joinRoomFailed",value:function(e,t){var r;(this._joinReject&&this._joinResolve&&(this._joinReject(new lA(t||uA.JOIN_ROOM_FAILED,e)),delete this._joinReject,delete this._joinResolve),this._joinRoomStartTs)&&(this.emit("__joinRoomFailedReport"),null===(r=this._monitor)||void 0===r||r.report("join_room",{type:"end",start:this._joinRoomStartTs,result:!1,reason:e},{enable_cloud_proxy:this._context.useCloudProxy,expectedIDC:this._context.expectedIDC}),delete this._joinRoomStartTs)}},{key:"multiChatMode",value:function(){var e;return null===(e=this._roomAttributes)||void 0===e?void 0:e.multiChatMode}},{key:"sendForwardStreamSignal",value:(t=km(Em().mark((function e(t,r,n){var i,o,a=this;return Em().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return o={forwardStreamType:t,roomId:r},("start"===t||"update"===t)&&(o.dstRoomInfos=null==n?void 0:JE(n).call(n,(function(e){return{dstRoomId:e.roomId,dstToken:DO.token2auth(a._context.appId,e.roomId,a._clientId,e.token)}}))),e.abrupt("return",null===(i=this._dataChannelSignal)||void 0===i?void 0:i.sendSignaling("forwardStream",o));case 4:case"end":return e.stop()}}),e,this)}))),function(e,r,n){return t.apply(this,arguments)})},{key:"handler",get:function(){return this._handler}},{key:"roomAttributes",get:function(){return this._roomAttributes},set:function(e){this._roomAttributes=e}},{key:"vendorConfig",get:function(){return this._vendorConfig}}]),k}(bD);function Zj(e,t,r){var n=r.value;return r.value=km(Em().mark((function e(){var r,i,o,a=arguments;return Em().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!this._handler||"connected"!==this._state){e.next=6;break}for(r=a.length,i=new Array(r),o=0;o<r;o++)i[o]=a[o];return e.next=4,n.apply(this,i);case 4:e.next=7;break;case 6:throw new lA(uA.NOT_CONNECTED_YET,"error in ".concat(t,": try again after joined"));case 7:case"end":return e.stop()}}),e,this)}))),r}function $j(e,t,r){var n=r.value;return r.value=km(Em().mark((function e(){var t,r,i,o,a=arguments;return Em().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this._pubSubLock.lock();case 2:for(t=e.sent,this.supportConcurrent&&t(),e.prev=4,r=a.length,i=new Array(r),o=0;o<r;o++)i[o]=a[o];return e.next=8,n.apply(this,i);case 8:return e.abrupt("return",e.sent);case 9:return e.prev=9,this.supportConcurrent||t(),e.finish(9);case 12:case"end":return e.stop()}}),e,this,[[4,,9,12]])}))),r}Xj([function(e,t,r){var n=r.value;return r.value=km(Em().mark((function e(){var t,r,i,o,a=this,s=arguments;return Em().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:for(t=s.length,r=new Array(t),i=0;i<t;i++)r[i]=s[i];return o=!1,e.abrupt("return",new Wf(function(){var e=km(Em().mark((function e(t,i){var s;return Em().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return a.on("INTERRUPT",(function(){o=!0,i(new lA(uA.OPERATION_CANCEL,"operation not finish when leave"))})),e.prev=1,e.next=4,n.apply(a,r);case 4:s=e.sent,t(s),e.next=11;break;case 8:e.prev=8,e.t0=e.catch(1),o||i(e.t0);case 11:case"end":return e.stop()}}),e,null,[[1,8]])})));return function(t,r){return e.apply(this,arguments)}}()));case 3:case"end":return e.stop()}}),e)}))),r}],Qj.prototype,"join",1),Xj([$j,Zj],Qj.prototype,"publish",1),Xj([$j,Zj],Qj.prototype,"updatePubTrack",1),Xj([$j,Zj],Qj.prototype,"unpublish",1),Xj([$j,Zj],Qj.prototype,"subscribe",1),Xj([Zj],Qj.prototype,"controlMessage",1),Xj([Zj],Qj.prototype,"updateUserAttributes",1),Xj([Zj],Qj.prototype,"updateSubTrack",1),Xj([Zj],Qj.prototype,"updateSubTrackLayer",1),Xj([Zj],Qj.prototype,"updateSubPriority",1),Xj([$j,Zj],Qj.prototype,"subscribe4pushTrack",1),Xj([$j,Zj],Qj.prototype,"unsubscribe4removeTrack",1),Xj([$j,Zj],Qj.prototype,"unsubscribe",1),Xj([Zj],Qj.prototype,"handleRemoveStream",1),Xj([$j],Qj.prototype,"subscribePublicStream",1),Xj([$j],Qj.prototype,"unsubscribePublicStream",1);var eG,tG=function(){var e=km(Em().mark((function e(t,r,n,i){var o,a,s,c,u,d,l,h,p,_,v,f,m;return Em().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(e.prev=0,u="",d=-1,l="video"===t?null==n||null===(o=n.videoTrack)||void 0===o?void 0:o.getTrack():null==n||null===(a=n.audioTrack)||void 0===a?void 0:a.getTrack(),h="video"===t?null==n||null===(s=n.videoTransceiver)||void 0===s?void 0:s.receiver:null==n||null===(c=n.audioTransceiver)||void 0===c?void 0:c.receiver,e.prev=5,e.t0=null==r?void 0:r.pc,!e.t0){e.next=11;break}return e.next=10,xN(null==r?void 0:r.pc,l);case 10:e.t0=e.sent;case 11:return _=e.t0,v=sE(p=_||[]).call(p,(function(e){return"inbound-rtp"===e.type})),e.next=15,null==h?void 0:h.getStats();case 15:f=e.sent,m=[],null==f||f.forEach((function(e){return m.push(e.type)})),u=eT({reports:JE(_).call(_,(function(e){return e.type})),reports2:m,pc:(null==r?void 0:r.pc)||null,track:(null==l?void 0:l.id)||null,framesReceived:null==v?void 0:v.framesReceived,packetsReceived:null==v?void 0:v.packetsReceived}),e.next=25;break;case 21:e.prev=21,e.t1=e.catch(5),d=-999,u=e.t1.mseeage||eT(e.t1);case 25:null==i||i.report("rtc_invoke_status",{sdk_api_name:"first_frame_recv_timeout",error_code:d,message:u,stream_id:(null==n?void 0:n.streamId)||"",stream_user_id:null==n?void 0:n.userId,elapse:0}),e.next=30;break;case 28:e.prev=28,e.t2=e.catch(0);case 30:case"end":return e.stop()}}),e,null,[[0,28],[5,21]])})));return function(t,r,n,i){return e.apply(this,arguments)}}(),rG=function(){var e=km(Em().mark((function e(t,r,n,i){var o,a,s,c,u,d,l,h,p,_,v,f,m;return Em().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(e.prev=0,u="",d=-1,l="video"===t?null==n||null===(o=n.videoTrack)||void 0===o?void 0:o.getTrack("preprocessing"):null==n||null===(a=n.audioTrack)||void 0===a?void 0:a.getTrack("preprocessing"),h="video"===t?null==n||null===(s=n.videoTransceiver)||void 0===s?void 0:s.sender:null==n||null===(c=n.audioTransceiver)||void 0===c?void 0:c.sender,e.prev=5,e.t0=null==r?void 0:r.pc,!e.t0){e.next=11;break}return e.next=10,xN(null==r?void 0:r.pc,l);case 10:e.t0=e.sent;case 11:return _=e.t0,v=sE(p=_||[]).call(p,(function(e){return"outbound-rtp"===e.type})),e.next=15,null==h?void 0:h.getStats();case 15:f=e.sent,m=[],null==f||f.forEach((function(e){return m.push(e.type)})),u=eT({reports:JE(_).call(_,(function(e){return e.type})),reports2:m,pc:(null==r?void 0:r.pc)||null,track:(null==l?void 0:l.id)||null,framesReceived:null==v?void 0:v.framesReceived,packetsReceived:null==v?void 0:v.packetsReceived}),e.next=25;break;case 21:e.prev=21,e.t1=e.catch(5),d=-999,u=e.t1.mseeage||eT(e.t1);case 25:null==i||i.report("rtc_invoke_status",{sdk_api_name:"first_frame_recv_timeout",error_code:d,message:u,stream_id:(null==n?void 0:n.streamId)||"",stream_user_id:null==n?void 0:n.userId,elapse:0}),e.next=30;break;case 28:e.prev=28,e.t2=e.catch(0);case 30:case"end":return e.stop()}}),e,null,[[0,28],[5,21]])})));return function(t,r,n,i){return e.apply(this,arguments)}}(),nG=new uO("RecvFrameObserver",0),iG=function(e){xI(a,e);var t,r,n,i,o=WI(a);function a(e,t){var r;return Yd(this,a),sd(Zk(r=o.call(this)),"_audioEventSessionId",NO()),sd(Zk(r),"_videoEventSessionId",NO()),sd(Zk(r),"_handler",void 0),sd(Zk(r),"_stream",void 0),sd(Zk(r),"_firstAudioFrameTimer",void 0),sd(Zk(r),"_firstVideoFrameTimer",void 0),sd(Zk(r),"_transportDelayInterval",void 0),sd(Zk(r),"_transportDelay",void 0),sd(Zk(r),"_firstVideoFrameInterval",void 0),sd(Zk(r),"_firstAudioFrameInterval",void 0),sd(Zk(r),"_isScreen",!1),sd(Zk(r),"_audioFirstFrameState",0),sd(Zk(r),"_videoFirstFrameState",0),sd(Zk(r),"_timeout",1e4),sd(Zk(r),"_currentAudioRecv",{startTime:0,eventSessionId:0,type:"login"}),sd(Zk(r),"_currentVideoRecv",{startTime:0,eventSessionId:0,type:"login"}),sd(Zk(r),"_login",!1),sd(Zk(r),"_unMuteAudio",!1),sd(Zk(r),"_enableAudio",!1),sd(Zk(r),"_unMuteVideo",!1),sd(Zk(r),"_enableVideo",!1),sd(Zk(r),"_remoteUnmuteAudio",!1),sd(Zk(r),"_remoteUnmuteVideo",!1),sd(Zk(r),"_audioExternal",!1),sd(Zk(r),"_pushAudio",!1),sd(Zk(r),"_videoExternal",!1),sd(Zk(r),"_pushVideo",!1),sd(Zk(r),"_autoSubscribeVideo",!1),sd(Zk(r),"_autoSubscribeAudio",!1),sd(Zk(r),"_autoSubscribe",!1),sd(Zk(r),"_publishVideo",!1),sd(Zk(r),"_publishAudio",!1),sd(Zk(r),"_subscribeAudio",!1),sd(Zk(r),"_subscribeVideo",!1),sd(Zk(r),"_subscribe",!1),sd(Zk(r),"_pushTrack",!1),sd(Zk(r),"_multiChatMode",!1),sd(Zk(r),"_monitor",void 0),r._stream=e,r._handler=t,r.getTransportDelay(),r._monitor=EO(e.engineId),r}return qd(a,[{key:"beginRecvFrame",value:(i=km(Em().mark((function e(t,r){var n,i,o,a,s,c,u,d,l,h,p,_,v,f,m,g,y,S,b,E=this;return Em().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.getTransportDelay();case 2:i=this._transportDelay,o=!0,gE(n=["login","unmute","subscribe","push_track"]).call(n,r)>=0&&(i=0,o=!1),"audio"===t?(o||this._audioEventSessionId++,this._currentAudioRecv={startTime:Date.now(),eventSessionId:this._audioEventSessionId,type:r},p={media_type:t,event_type:"begin_recv",type:r,is_screen:!(null===(a=this._stream)||void 0===a||!a.isScreen),start:null===(s=this._currentAudioRecv)||void 0===s?void 0:s.startTime,event_session_id:this._audioEventSessionId,stream_user_id:null===(c=this._stream)||void 0===c?void 0:c.userId,transport_delay:i,vendor_mode:(null===(u=this._stream)||void 0===u?void 0:u.vendorCode)||0,pc_session_id:(null===(d=this._stream)||void 0===d?void 0:d.pcSessionId)||(null===(l=this._handler)||void 0===l?void 0:l.peerConnectionId)},this._firstAudioFrameTimer&&window.clearTimeout(this._firstAudioFrameTimer),this._firstAudioFrameTimer=window.setTimeout((function(){tG("audio",E._handler,E._stream,E._monitor),E.stopRecvFrame("audio","timeout"),E._firstAudioFrameInterval&&window.clearInterval(E._firstAudioFrameInterval)}),this._timeout),nG.print("rtcFirstFrameRecv",eT(p)),null===(h=this._monitor)||void 0===h||h.report("rtc_first_frame",p),this._watchForFirstAudioFrameRecv(),this._audioFirstFrameState=1,this._login=!0,this._unMuteAudio=!0,this._enableAudio=!0,this._remoteUnmuteAudio=!0):"video"===t&&(o||this._videoEventSessionId++,this._currentVideoRecv={startTime:Date.now(),eventSessionId:this._videoEventSessionId,type:r},b={media_type:t,event_type:"begin_recv",type:r,is_screen:!(null===(_=this._stream)||void 0===_||!_.isScreen),start:null===(v=this._currentVideoRecv)||void 0===v?void 0:v.startTime,event_session_id:this._videoEventSessionId,stream_user_id:null===(f=this._stream)||void 0===f?void 0:f.userId,transport_delay:i,vendor_mode:(null===(m=this._stream)||void 0===m?void 0:m.vendorCode)||0,pc_session_id:(null===(g=this._stream)||void 0===g?void 0:g.pcSessionId)||(null===(y=this._handler)||void 0===y?void 0:y.peerConnectionId)},this._firstVideoFrameTimer&&window.clearTimeout(this._firstVideoFrameTimer),this._firstVideoFrameTimer=window.setTimeout((function(){tG("video",E._handler,E._stream,E._monitor),E.stopRecvFrame("video","timeout"),E._firstVideoFrameInterval&&window.clearInterval(E._firstVideoFrameInterval)}),this._timeout),this._watchForFirstVideoFrameRecv(),nG.print("rtcFirstFrameRecv",eT(b)),null===(S=this._monitor)||void 0===S||S.report("rtc_first_frame",b),this._videoFirstFrameState=1,this._login=!0,this._unMuteVideo=!0,this._enableVideo=!0,this._remoteUnmuteVideo=!0);case 6:case"end":return e.stop()}}),e,this)}))),function(e,t){return i.apply(this,arguments)})},{key:"stopRecvFrame",value:function(e,t){if("audio"===e){var r,n,i,o,a,s,c,u;if(1!==this._audioFirstFrameState)return;var d={event_type:"recv_end",media_type:e,is_screen:!(null===(r=this._stream)||void 0===r||!r.isScreen),start:null===(n=this._currentAudioRecv)||void 0===n?void 0:n.startTime,reason:t,result:!1,stream_user_id:null===(i=this._stream)||void 0===i?void 0:i.userId,event_session_id:this._audioEventSessionId,type:null===(o=this._currentAudioRecv)||void 0===o?void 0:o.type,vendor_mode:(null===(a=this._stream)||void 0===a?void 0:a.vendorCode)||0,pc_session_id:(null===(s=this._stream)||void 0===s?void 0:s.pcSessionId)||(null===(c=this._handler)||void 0===c?void 0:c.peerConnectionId)};this._firstAudioFrameTimer&&window.clearTimeout(this._firstAudioFrameTimer),delete this._currentAudioRecv,nG.print("rtcFirstFrameRecv",eT(d)),null===(u=this._monitor)||void 0===u||u.report("rtc_first_frame",d),this._audioFirstFrameState=2}else if("video"===e){var l,h,p,_,v,f,m,g;if(1!==this._videoFirstFrameState)return;var y={event_type:"recv_end",media_type:e,is_screen:!(null===(l=this._stream)||void 0===l||!l.isScreen),start:null===(h=this._currentVideoRecv)||void 0===h?void 0:h.startTime,reason:t,result:!1,stream_user_id:null===(p=this._stream)||void 0===p?void 0:p.userId,event_session_id:this._videoEventSessionId,type:null===(_=this._currentVideoRecv)||void 0===_?void 0:_.type,vendor_mode:(null===(v=this._stream)||void 0===v?void 0:v.vendorCode)||0,pc_session_id:(null===(f=this._stream)||void 0===f?void 0:f.pcSessionId)||(null===(m=this._handler)||void 0===m?void 0:m.peerConnectionId)};this._firstVideoFrameTimer&&window.clearTimeout(this._firstVideoFrameTimer),delete this._currentVideoRecv,nG.print("rtcFirstFrameRecv",eT(y)),null===(g=this._monitor)||void 0===g||g.report("rtc_first_frame",y),this._videoFirstFrameState=2}}},{key:"recvFrameFinish",value:(n=km(Em().mark((function e(t){var r,n,i,o,a,s,c,u,d,l,h,p,_,v,f,m,g,y,S,b,E,T,k;return Em().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.getTransportDelay();case 2:if(r=this._transportDelay,"audio"!==t){e.next=19;break}if(1===this._audioFirstFrameState){e.next=6;break}return e.abrupt("return");case 6:if(this._currentAudioRecv){e.next=8;break}return e.abrupt("return");case 8:d=this._currentAudioRecv,l=d.type,h=d.startTime,gE(n=["login","unmute","subscribe","push_track"]).call(n,l)>=0&&(r=0),p={event_type:"recv_end",media_type:t,start:h,result:!0,is_screen:!(null===(i=this._stream)||void 0===i||!i.isScreen),stream_user_id:null===(o=this._stream)||void 0===o?void 0:o.userId,event_session_id:this._audioEventSessionId,type:l,transport_delay:r,vendor_mode:(null===(a=this._stream)||void 0===a?void 0:a.vendorCode)||0,pc_session_id:(null===(s=this._stream)||void 0===s?void 0:s.pcSessionId)||(null===(c=this._handler)||void 0===c?void 0:c.peerConnectionId)},delete this._currentAudioRecv,this._firstAudioFrameTimer&&window.clearTimeout(this._firstAudioFrameTimer),nG.print("rtcFirstFrameRecv",eT(p)),null===(u=this._monitor)||void 0===u||u.report("rtc_first_frame",p),this.emit("recvAudioFirstFrame"),this._audioFirstFrameState=3,e.next=33;break;case 19:if("video"!==t){e.next=33;break}if(1===this._videoFirstFrameState){e.next=22;break}return e.abrupt("return");case 22:if(this._currentVideoRecv){e.next=24;break}return e.abrupt("return");case 24:b=this._currentVideoRecv,E=b.type,T=b.startTime,gE(_=["login","unmute","subscribe","push_track"]).call(_,E)>=0&&(r=0),k={event_type:"recv_end",media_type:t,is_screen:!(null===(v=this._stream)||void 0===v||!v.isScreen),start:T,result:!0,stream_user_id:null===(f=this._stream)||void 0===f?void 0:f.userId,event_session_id:this._videoEventSessionId,type:E,transport_delay:r,vendor_mode:(null===(m=this._stream)||void 0===m?void 0:m.vendorCode)||0,pc_session_id:(null===(g=this._stream)||void 0===g?void 0:g.pcSessionId)||(null===(y=this._handler)||void 0===y?void 0:y.peerConnectionId)},delete this._currentVideoRecv,this._firstVideoFrameTimer&&window.clearTimeout(this._firstVideoFrameTimer),nG.print("rtcFirstFrameRecv",eT(k)),null===(S=this._monitor)||void 0===S||S.report("rtc_first_frame",k),this.emit("recvVideoFirstFrame"),this._videoFirstFrameState=3;case 33:case"end":return e.stop()}}),e,this)}))),function(e){return n.apply(this,arguments)})},{key:"setLogin",value:function(e){var t,r,n,i,o=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{audio:!0,video:!0};this._login!==e&&(this._login=e,e&&null!==(t=this._stream)&&void 0!==t&&t.hasAudio&&o.audio&&this.beginRecvFrame("audio","login"),e&&null!==(r=this._stream)&&void 0!==r&&r.hasVideo&&o.video&&this.beginRecvFrame("video","login"),!e&&null!==(n=this._stream)&&void 0!==n&&n.hasAudio&&this.stopRecvFrame("audio","leave_room"),!e&&null!==(i=this._stream)&&void 0!==i&&i.hasVideo&&this.stopRecvFrame("video","leave_room"))}},{key:"setUnmuteAudio",value:function(e){var t,r,n;if(this._unMuteAudio!==e){this._unMuteAudio=e;var i=!(null===(t=this._stream)||void 0===t||!t.hasAudio);null!==(r=this._stream)&&void 0!==r&&r.audioHasCapture&&null!==(n=this._stream)&&void 0!==n&&n.audioHasPublish&&(this._unMuteAudio&&i?this.beginRecvFrame("audio","unmute"):i&&this.stopRecvFrame("audio","mute"))}}},{key:"setRemoteUnmuteAudio",value:function(e){this._remoteUnmuteAudio!==e&&(this._remoteUnmuteAudio=e,this._remoteUnmuteAudio?this.beginRecvFrame("audio","remote_unmute"):this.stopRecvFrame("audio","remote_mute"))}},{key:"setEnableAudio",value:function(e){var t;this._enableAudio!==e&&(this._enableAudio=e,this._enableAudio?this.beginRecvFrame("audio","enable"):null!==(t=this._stream)&&void 0!==t&&t.hasAudio&&this.stopRecvFrame("audio","disable"))}},{key:"setUnmuteVideo",value:function(e){var t,r,n;if(this._unMuteVideo!==e){this._unMuteVideo=e;var i=!(null===(t=this._stream)||void 0===t||!t.hasVideo);null!==(r=this._stream)&&void 0!==r&&r.videoHasCapture&&null!==(n=this._stream)&&void 0!==n&&n.videoHasPublish&&(this._unMuteVideo&&i?this.beginRecvFrame("video","unmute"):i&&this.stopRecvFrame("video","mute"))}}},{key:"setHandler",value:function(e){this._handler=e}},{key:"setRemoteUnmuteVideo",value:function(e){this._remoteUnmuteVideo!==e&&(this._remoteUnmuteVideo=e,this._remoteUnmuteVideo?this.beginRecvFrame("video","remote_unmute"):this.stopRecvFrame("video","remote_mute"))}},{key:"setEnableVideo",value:function(e){this._enableVideo!==e&&(this._enableVideo=e,this._enableVideo?this.beginRecvFrame("video","enable"):this.stopRecvFrame("video","disable"))}},{key:"setExternalAudioSource",value:function(e){this._audioExternal=e}},{key:"setPushAudio",value:function(e){var t;this._audioExternal&&this._pushAudio!==e&&(this._pushAudio=e),this._pushAudio&&this.beginRecvFrame("audio","push"),!e&&null!==(t=this._stream)&&void 0!==t&&t.hasAudio&&this.beginRecvFrame("audio","push")}},{key:"setExternalVideoSource",value:function(e){this._videoExternal=e}},{key:"setPushVideo",value:function(e){var t;this._videoExternal&&this._pushVideo!==e&&(this._pushVideo=e),this._pushVideo&&this.beginRecvFrame("video","push"),!e&&null!==(t=this._stream)&&void 0!==t&&t.hasVideo&&this.beginRecvFrame("video","push")}},{key:"setPublishVideo",value:function(e){var t;this._publishVideo!==e&&(this._publishVideo=e),this._publishVideo&&this.beginRecvFrame("video","publish"),!e&&null!==(t=this._stream)&&void 0!==t&&t.hasVideo&&this.stopRecvFrame("video","unpublish")}},{key:"setPublishAudio",value:function(e){var t;this._publishAudio!==e&&(this._publishAudio=e),this._publishAudio&&this.beginRecvFrame("audio","publish"),!e&&null!==(t=this._stream)&&void 0!==t&&t.hasAudio&&this.stopRecvFrame("audio","unpublish")}},{key:"setAutoSubscribe",value:function(e){this._autoSubscribe=e}},{key:"setAutoSubscribeVideo",value:function(e){this._autoSubscribeVideo=e}},{key:"setAutoSubscribeAudio",value:function(e){this._autoSubscribeAudio=e}},{key:"setSubscribeAudio",value:function(e){var t,r;this._autoSubscribeAudio||this._subscribeAudio===e||(this._subscribe=e,e&&null!==(r=this._stream)&&void 0!==r&&r.hasAudio&&this.beginRecvFrame("audio","subscribe"));!e&&null!==(t=this._stream)&&void 0!==t&&t.hasAudio&&this.stopRecvFrame("audio","unsubscribe")}},{key:"setSubscribeVideo",value:function(e){var t,r;this._autoSubscribeVideo||this._subscribeVideo===e||(this._subscribeVideo=e,e&&null!==(r=this._stream)&&void 0!==r&&r.hasVideo&&this.beginRecvFrame("video","subscribe"));!e&&null!==(t=this._stream)&&void 0!==t&&t.hasVideo&&this.stopRecvFrame("video","unsubscribe")}},{key:"setPushTrack",value:function(e){var t;this._pushTrack!==e&&(e&&!this._isScreen&&this.beginRecvFrame("audio","push_track"),!e&&null!==(t=this._stream)&&void 0!==t&&t.hasAudio&&this.stopRecvFrame("audio","remove_track"))}},{key:"setMultiChatMode",value:function(e){this._multiChatMode=e}},{key:"setTimeout",value:function(e){this._timeout=e}},{key:"_watchForFirstVideoFrameRecv",value:function(){var e=this,t=-1,r=-1;this._firstVideoFrameInterval&&window.clearInterval(this._firstVideoFrameInterval),this._firstVideoFrameInterval=window.setInterval(km(Em().mark((function n(){var i,o,a,s,c,u,d,l;return Em().wrap((function(n){for(;;)switch(n.prev=n.next){case 0:if(null===(i=e._handler)||void 0===i||!i.pc||null===(o=e._stream)||void 0===o||null===(a=o.videoTrack)||void 0===a||!a.getTrack()){n.next=12;break}return n.next=3,xN(null===(s=e._handler)||void 0===s?void 0:s.pc,null===(c=e._stream)||void 0===c||null===(u=c.videoTrack)||void 0===u?void 0:u.getTrack());case 3:if(d=n.sent,!(l=sE(d).call(d,(function(e){return"inbound-rtp"===e.type})))||!(l.framesReceived>t||l.packetsReceived>r)){n.next=12;break}if(-1!==t||-1!==r){n.next=10;break}return t=l.framesReceived,r=l.packetsReceived,n.abrupt("return");case 10:e.recvFrameFinish("video"),window.clearInterval(e._firstVideoFrameInterval);case 12:case"end":return n.stop()}}),n)}))),200)}},{key:"_watchForFirstAudioFrameRecv",value:function(){var e=this,t=-1,r=-1;this._firstAudioFrameInterval&&window.clearInterval(this._firstAudioFrameInterval),this._firstAudioFrameInterval=window.setInterval(km(Em().mark((function n(){var i,o,a,s,c,u,d,l;return Em().wrap((function(n){for(;;)switch(n.prev=n.next){case 0:if(null===(i=e._handler)||void 0===i||!i.pc||null===(o=e._stream)||void 0===o||null===(a=o.audioTrack)||void 0===a||!a.getOrgTrack()){n.next=12;break}return n.next=3,xN(null===(s=e._handler)||void 0===s?void 0:s.pc,null===(c=e._stream)||void 0===c||null===(u=c.audioTrack)||void 0===u?void 0:u.getOrgTrack());case 3:if(d=n.sent,!(l=sE(d).call(d,(function(e){return"inbound-rtp"===e.type})))||!(l.totalSamplesReceived>t||l.packetsReceived>r)){n.next=12;break}if(-1!==t||-1!==r){n.next=10;break}return t=l.totalSamplesReceived,r=l.packetsReceived,n.abrupt("return");case 10:e.recvFrameFinish("audio"),window.clearInterval(e._firstAudioFrameInterval);case 12:case"end":return n.stop()}}),n)}))),200)}},{key:"getTransportDelay",value:(r=km(Em().mark((function e(){var t=this;return Em().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.getTransportDelayIntl();case 2:window.clearInterval(this._transportDelayInterval),this._transportDelayInterval=window.setInterval(km(Em().mark((function e(){return Em().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,t.getTransportDelayIntl();case 2:case"end":return e.stop()}}),e)}))),2e3);case 4:case"end":return e.stop()}}),e,this)}))),function(){return r.apply(this,arguments)})},{key:"getTransportDelayIntl",value:(t=km(Em().mark((function e(){var t,r,n,i,o;return Em().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(null===(t=this._handler)||void 0===t||!t.pc){e.next=7;break}return e.next=3,xN(null===(r=this._handler)||void 0===r?void 0:r.pc);case 3:n=e.sent,i=sE(n).call(n,(function(e){return"transport"===e.type&&"connected"===e.dtlsState})),(o=sE(n).call(n,(function(e){return"candidate-pair"===e.type&&"succeeded"===e.state&&e.id===(null==i?void 0:i.selectedCandidatePairId)})))&&(this._transportDelay=Math.round(1e3*o.currentRoundTripTime/2));case 7:case"end":return e.stop()}}),e,this)}))),function(){return t.apply(this,arguments)})},{key:"reset",value:function(){this._currentAudioRecv={startTime:0,eventSessionId:0,type:"login"},this._currentVideoRecv={startTime:0,eventSessionId:0,type:"login"},this._login=!1,this._unMuteAudio=!1,this._enableAudio=!1,this._unMuteVideo=!1,this._remoteUnmuteAudio=!1,this._remoteUnmuteVideo=!1,this._enableVideo=!1,this._audioExternal=!1,this._pushAudio=!1,this._videoExternal=!1,this._pushVideo=!1,this._autoSubscribeVideo=!1,this._autoSubscribeAudio=!1,this._autoSubscribe=!1,this._subscribeAudio=!1,this._subscribeVideo=!1,this._subscribe=!1,this._pushTrack=!1,this._multiChatMode=!1,this._firstAudioFrameTimer&&window.clearTimeout(this._firstAudioFrameTimer),this._firstVideoFrameTimer&&window.clearTimeout(this._firstVideoFrameTimer),this._firstAudioFrameInterval&&window.clearInterval(this._firstAudioFrameInterval),this._firstVideoFrameInterval&&window.clearInterval(this._firstVideoFrameInterval),this._transportDelayInterval&&window.clearInterval(this._transportDelayInterval)}},{key:"audioFirstFrameReceived",get:function(){return 3===this._audioFirstFrameState}},{key:"FirstFrameReceived",get:function(){return 3===this._audioFirstFrameState}}]),a}(gD.exports.EventEmitter),oG=new uO("SendFrameObserver",0),aG=function(){function e(t,r){Yd(this,e),sd(this,"_audioEventSessionId",NO()),sd(this,"_videoEventSessionId",NO()),sd(this,"_pcSessionId",void 0),sd(this,"_handler",void 0),sd(this,"_firstAudioFrameTimer",void 0),sd(this,"_firstVideoFrameTimer",void 0),sd(this,"_stream",void 0),sd(this,"_firstVideoFrameInterval",void 0),sd(this,"_firstAudioFrameInterval",void 0),sd(this,"_currentAudioSend",{startTime:0,eventSessionId:0,type:"login"}),sd(this,"_currentVideoSend",{startTime:0,eventSessionId:0,type:"login"}),sd(this,"_login",!1),sd(this,"_publisher",!1),sd(this,"_unMuteAudio",!1),sd(this,"_enableAudio",!1),sd(this,"_unMuteVideo",!1),sd(this,"_enableVideo",!1),sd(this,"_audioExternal",!1),sd(this,"_pushAudio",!1),sd(this,"_videoExternal",!1),sd(this,"_pushVideo",!1),sd(this,"_autoPublish",!1),sd(this,"_publish",!1),sd(this,"_timeout",1e4),sd(this,"_audioFirstFrameState",0),sd(this,"_videoFirstFrameState",0),sd(this,"_monitor",void 0),this._stream=t,this._handler=r,this._monitor=EO(t.engineId)}var t,r;return qd(e,[{key:"beginSendFrame",value:function(e,t){var r=this;if("audio"===e){var n,i,o,a,s,c;this._audioEventSessionId++,this._currentAudioSend={startTime:Date.now(),eventSessionId:this._audioEventSessionId,type:t};var u={event_type:"begin_send",media_type:e,is_screen:!(null===(n=this._stream)||void 0===n||!n.isScreen),type:t,start:null===(i=this._currentAudioSend)||void 0===i?void 0:i.startTime,event_session_id:this._audioEventSessionId,vendor_mode:(null===(o=this._stream)||void 0===o?void 0:o.vendorCode)||0,pc_session_id:(null===(a=this._stream)||void 0===a?void 0:a.pcSessionId)||(null===(s=this._handler)||void 0===s?void 0:s.peerConnectionId)};this._firstAudioFrameTimer&&window.clearTimeout(this._firstAudioFrameTimer),this._firstAudioFrameTimer=window.setTimeout((function(){rG("audio",r._handler,r._stream,r._monitor),r.stopSendFrame("audio","timeout"),r._firstAudioFrameInterval&&window.clearInterval(r._firstAudioFrameInterval)}),this._timeout),oG.print("rtcFirstFrameSend",eT(u)),null===(c=this._monitor)||void 0===c||c.report("rtc_first_frame",u),this._watchForFirstAudioFrameSend(),this._audioFirstFrameState=1,this._login=!0,this._publisher=!0,this._publish=!0,this._unMuteAudio=!0,this._pushAudio||(this._enableAudio=!0)}else if("video"===e){var d,l,h,p,_,v;this._videoEventSessionId++,this._currentVideoSend={startTime:Date.now(),eventSessionId:this._videoEventSessionId,type:t};var f={event_type:"begin_send",media_type:e,is_screen:!(null===(d=this._stream)||void 0===d||!d.isScreen),type:t,start:null===(l=this._currentVideoSend)||void 0===l?void 0:l.startTime,event_session_id:this._videoEventSessionId,vendor_mode:(null===(h=this._stream)||void 0===h?void 0:h.vendorCode)||0,pc_session_id:(null===(p=this._stream)||void 0===p?void 0:p.pcSessionId)||(null===(_=this._handler)||void 0===_?void 0:_.peerConnectionId)};this._firstVideoFrameTimer&&window.clearTimeout(this._firstVideoFrameTimer),this._firstVideoFrameTimer=window.setTimeout((function(){rG("video",r._handler,r._stream,r._monitor),r.stopSendFrame("video","timeout"),r._firstVideoFrameInterval&&window.clearInterval(r._firstVideoFrameInterval)}),this._timeout),this._watchForFirstVideoFrameSend(),oG.print("rtcFirstFrameSend",eT(f)),null===(v=this._monitor)||void 0===v||v.report("rtc_first_frame",f),this._videoFirstFrameState=1,this._login=!0,this._publisher=!0,this._publish=!0,this._unMuteVideo=!0,this._pushVideo||(this._enableVideo=!0)}}},{key:"stopSendFrame",value:function(e,t){if("audio"===e){var r,n,i,o,a,s,c;if(1!==this._audioFirstFrameState)return;var u={event_type:"sent_end",media_type:e,is_screen:!(null===(r=this._stream)||void 0===r||!r.isScreen),start:null===(n=this._currentAudioSend)||void 0===n?void 0:n.startTime,reason:t,result:!1,event_session_id:this._audioEventSessionId,type:null===(i=this._currentAudioSend)||void 0===i?void 0:i.type,vendor_mode:(null===(o=this._stream)||void 0===o?void 0:o.vendorCode)||0,pc_session_id:(null===(a=this._stream)||void 0===a?void 0:a.pcSessionId)||(null===(s=this._handler)||void 0===s?void 0:s.peerConnectionId)};this._firstAudioFrameTimer&&window.clearTimeout(this._firstAudioFrameTimer),delete this._currentAudioSend,oG.print("rtcFirstFrameSend",eT(u)),null===(c=this._monitor)||void 0===c||c.report("rtc_first_frame",u),this._audioFirstFrameState=2}else if("video"===e){var d,l,h,p,_,v,f;if(1!==this._videoFirstFrameState)return;var m={event_type:"sent_end",media_type:e,start:null===(d=this._currentVideoSend)||void 0===d?void 0:d.startTime,is_screen:!(null===(l=this._stream)||void 0===l||!l.isScreen),reason:t,result:!1,event_session_id:this._videoEventSessionId,type:null===(h=this._currentVideoSend)||void 0===h?void 0:h.type,vendor_mode:(null===(p=this._stream)||void 0===p?void 0:p.vendorCode)||0,pc_session_id:(null===(_=this._stream)||void 0===_?void 0:_.pcSessionId)||(null===(v=this._handler)||void 0===v?void 0:v.peerConnectionId)};this._firstVideoFrameTimer&&window.clearTimeout(this._firstVideoFrameTimer),delete this._currentVideoSend,oG.print("rtcFirstFrameSend",eT(m)),null===(f=this._monitor)||void 0===f||f.report("rtc_first_frame",m),this._videoFirstFrameState=2}}},{key:"sendFrameFinish",value:function(e){if("audio"===e){var t,r,n,i,o;if(1!==this._audioFirstFrameState)return;if(!this._currentAudioSend)return;var a=this._currentAudioSend,s=a.type,c=a.startTime,u={event_type:"sent_end",media_type:e,is_screen:!(null===(t=this._stream)||void 0===t||!t.isScreen),start:c,result:!0,event_session_id:this._audioEventSessionId,type:s,vendor_mode:(null===(r=this._stream)||void 0===r?void 0:r.vendorCode)||0,pc_session_id:(null===(n=this._stream)||void 0===n?void 0:n.pcSessionId)||(null===(i=this._handler)||void 0===i?void 0:i.peerConnectionId)};delete this._currentAudioSend,this._firstAudioFrameTimer&&window.clearTimeout(this._firstAudioFrameTimer),oG.print("rtcFirstFrameSend",eT(u)),null===(o=this._monitor)||void 0===o||o.report("rtc_first_frame",u),this._audioFirstFrameState=3}else if("video"===e){var d,l,h,p,_;if(1!==this._videoFirstFrameState)return;if(!this._currentVideoSend)return;var v=this._currentVideoSend,f=v.type,m=v.startTime,g={event_type:"sent_end",media_type:e,is_screen:!(null===(d=this._stream)||void 0===d||!d.isScreen),start:m,result:!0,event_session_id:this._videoEventSessionId,type:f,vendor_mode:(null===(l=this._stream)||void 0===l?void 0:l.vendorCode)||0,pc_session_id:(null===(h=this._stream)||void 0===h?void 0:h.pcSessionId)||(null===(p=this._handler)||void 0===p?void 0:p.peerConnectionId)};delete this._currentVideoSend,this._firstVideoFrameTimer&&window.clearTimeout(this._firstVideoFrameTimer),oG.print("rtcFirstFrameSend",eT(g)),null===(_=this._monitor)||void 0===_||_.report("rtc_first_frame",g),this._videoFirstFrameState=3}}},{key:"setLogin",value:function(e){if(this._login!==e){var t,r;if(this._login=e,e)null!==(t=this._stream)&&void 0!==t&&t.videoTrack&&this.beginSendFrame("video","login"),null!==(r=this._stream)&&void 0!==r&&r.audioTrack&&this.beginSendFrame("audio","login");!e&&this._audioSending&&this.stopSendFrame("audio","leave_room"),!e&&this._videoSending&&this.stopSendFrame("video","leave_room")}}},{key:"setPublish",value:function(e){if(this._publish!==e){var t,r,n,i;if(this._publish=e,e)(null===(t=this._stream)||void 0===t?void 0:t.videoTrack)&&(null===(r=this._stream)||void 0===r?void 0:r.pubVideo)&&this.beginSendFrame("video","publish"),(null===(n=this._stream)||void 0===n?void 0:n.audioTrack)&&(null===(i=this._stream)||void 0===i?void 0:i.pubAudio)&&this.beginSendFrame("audio","publish");!e&&this._audioSending&&this.stopSendFrame("audio","unpublish"),!e&&this._videoSending&&this.stopSendFrame("video","unpublish")}}},{key:"setUnmuteAudio",value:function(e){var t;this._unMuteAudio!==e&&(this._unMuteAudio=e,null!==(t=this._stream)&&void 0!==t&&t.audioHasCapture&&(e&&this.beginSendFrame("audio","unmute"),!e&&this._audioSending&&this.stopSendFrame("audio","mute")))}},{key:"setEnableAudio",value:function(e){var t;this._enableAudio!==e&&null!==(t=this._stream)&&void 0!==t&&t.pubAudio&&(this._enableAudio=e,e&&this.beginSendFrame("audio","enable"),!e&&this._audioSending&&this.stopSendFrame("audio","disable"))}},{key:"setUnmuteVideo",value:function(e){var t;this._unMuteVideo!==e&&(this._unMuteVideo=e,null!==(t=this._stream)&&void 0!==t&&t.videoHasCapture&&(e&&this.beginSendFrame("video","unmute"),!e&&this._videoSending&&this.stopSendFrame("video","mute")))}},{key:"setEnableVideo",value:function(e){var t;this._enableVideo!==e&&null!==(t=this._stream)&&void 0!==t&&t.pubVideo&&(this._enableVideo=e,e&&this.beginSendFrame("video","enable"),!e&&this._videoSending&&this.stopSendFrame("video","disable"))}},{key:"setExternalAudioSource",value:function(e){this._audioExternal!==e&&(this._audioExternal=e,e&&(this._audioSending&&this.stopSendFrame("audio","disable"),this._enableAudio=!1),e||(this._audioSending&&this.stopSendFrame("audio","stop_push"),this._pushAudio=!1))}},{key:"setPushAudio",value:function(e){this._pushAudio!==e&&(this._pushAudio=e,e&&this.beginSendFrame("audio","push"),!e&&this._audioSending&&this.stopSendFrame("audio","stop_push"))}},{key:"setExternalVideoSource",value:function(e){this._videoExternal!==e&&(this._videoExternal=e,e&&(this._videoSending&&this.stopSendFrame("video","disable"),this._enableVideo=!1),e||(this._videoSending&&this.stopSendFrame("video","stop_push"),this._pushVideo=!1))}},{key:"setPushVideo",value:function(e){this._pushVideo!==e&&(this._pushVideo=e,e&&this.beginSendFrame("video","push"),!e&&this._videoSending&&this.stopSendFrame("video","stop_push"))}},{key:"setAutoPublish",value:function(e){this._autoPublish=e}},{key:"setPublisher",value:function(e){this._publisher!==e&&(this._publisher=e,!e&&this._audioSending&&this.stopSendFrame("audio","audience"),!e&&this._videoSending&&this.stopSendFrame("video","audience"))}},{key:"setTimeout",value:function(e){this._timeout=e}},{key:"setPCSessionId",value:function(e){this._pcSessionId=e}},{key:"setHandler",value:function(e){this._handler=e}},{key:"_getFirstVideoFrameStats",value:(r=km(Em().mark((function e(){var t,r,n,i,o,a,s,c;return Em().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(null===(t=this._handler)||void 0===t||!t.pc||null===(r=this._stream)||void 0===r||null===(n=r.videoTrack)||void 0===n||!n.getTrack("preprocessing")){e.next=6;break}return e.next=3,xN(null===(i=this._handler)||void 0===i?void 0:i.pc,null===(o=this._stream)||void 0===o||null===(a=o.videoTrack)||void 0===a?void 0:a.getTrack("preprocessing"));case 3:return s=e.sent,c=Gs(s).call(s,(function(e){return"outbound-rtp"===e.type})),e.abrupt("return",c);case 6:case"end":return e.stop()}}),e,this)}))),function(){return r.apply(this,arguments)})},{key:"_getFirstAudioFrameStats",value:(t=km(Em().mark((function e(){var t,r,n,i,o,a,s;return Em().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(null===(t=this._handler)||void 0===t||!t.pc||null===(r=this._stream)||void 0===r||null===(n=r.audioTrack)||void 0===n||!n.getTrack("preprocessing")){e.next=5;break}return e.next=3,xN(null===(i=this._handler)||void 0===i?void 0:i.pc,null===(o=this._stream)||void 0===o||null===(a=o.audioTrack)||void 0===a?void 0:a.getTrack("preprocessing"));case 3:return s=e.sent,e.abrupt("return",sE(s).call(s,(function(e){return"outbound-rtp"===e.type})));case 5:case"end":return e.stop()}}),e,this)}))),function(){return t.apply(this,arguments)})},{key:"_watchForFirstVideoFrameSend",value:function(){var e=this,t=-1,r=-1;this._firstVideoFrameInterval&&window.clearInterval(this._firstVideoFrameInterval),this._firstVideoFrameInterval=window.setInterval(km(Em().mark((function n(){var i,o,a;return Em().wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return n.next=2,e._getFirstVideoFrameStats();case 2:if(i=n.sent,o=0,a=0,null==i||JE(i).call(i,(function(e){o+=e.framesSent,a+=e.packetsSent})),!(i&&i.length>0&&(o>t||a>r))){n.next=12;break}if(-1!==t||-1!==r){n.next=10;break}return t=o,r=a,n.abrupt("return");case 10:e.sendFrameFinish("video"),window.clearInterval(e._firstVideoFrameInterval);case 12:case"end":return n.stop()}}),n)}))),100)}},{key:"_watchForFirstAudioFrameSend",value:function(){var e=this,t=-1;this._firstAudioFrameInterval&&window.clearInterval(this._firstAudioFrameInterval),this._firstAudioFrameInterval=window.setInterval(km(Em().mark((function r(){var n;return Em().wrap((function(r){for(;;)switch(r.prev=r.next){case 0:return r.next=2,e._getFirstAudioFrameStats();case 2:if(!((n=r.sent)&&n.packetsSent>t)){r.next=9;break}if(-1!==t){r.next=7;break}return t=n.packetsSent,r.abrupt("return");case 7:e.sendFrameFinish("audio"),window.clearInterval(e._firstAudioFrameInterval);case 9:case"end":return r.stop()}}),r)}))),100)}},{key:"reset",value:function(){this._login=!1,this._publisher=!1,this._unMuteAudio=!1,this._enableAudio=!1,this._unMuteVideo=!1,this._enableVideo=!1,this._audioExternal=!1,this._pushAudio=!1,this._videoExternal=!1,this._pushVideo=!1,this._autoPublish=!1,this._publish=!1,this._audioFirstFrameState=0,this._videoFirstFrameState=0,this._currentAudioSend={startTime:0,eventSessionId:0,type:"login"},this._currentVideoSend={startTime:0,eventSessionId:0,type:"login"},window.clearTimeout(this._firstAudioFrameTimer),window.clearTimeout(this._firstVideoFrameTimer),window.clearInterval(this._firstAudioFrameInterval),window.clearInterval(this._firstVideoFrameInterval)}},{key:"destroy",value:function(){this.reset(),delete this._stream,delete this._handler}},{key:"_audioSending",get:function(){return 1===this._audioFirstFrameState}},{key:"_videoSending",get:function(){return 1===this._videoFirstFrameState}}]),e}(),sG=(sd(eG={},"audio",{delay:1200,stallRadio:.3}),sd(eG,"video",{delay:1200,stallRadio:.6}),sd(eG,"screen_audio",{delay:1600,stallRadio:.8}),sd(eG,"screen_video",{delay:1600,stallRadio:.8}),eG),cG=function(){function e(){Yd(this,e),sd(this,"_preUplinkStats",new jS),sd(this,"_preDownlinkStats",new jS),sd(this,"_timer",void 0),sd(this,"_delayTimer",void 0),sd(this,"_connectionState",Yj.CONNECTED),sd(this,"reportor",void 0)}return qd(e,[{key:"updateUplinkStats",value:function(e){var t=e.audioStats,r=e.videoStats,n=e.isScreen;if(t.sendKBitrate>0&&t.rtt){var i,o,a=n?"screen_audio":"audio",s=t.rtt,c=t._fractionLost,u=t._retransmittedRate,d=this._getQosLevel(s,c||0,u||0),l=this._preUplinkStats.get(a)||[d];this._preUplinkStats.set(a,bm(i=wm(o=[]).call(o,qT(l),[d])).call(i,-2))}if(r.sentKBitrate>0&&r.rtt){var h,p,_=n?"screen_video":"video",v=r._fractionLost,f=r.rtt,m=r._sendBandWidth,g=r._retransmittedRate;0===m&&(v=Math.max(.65,v));var y=this._getQosLevel(f,v||0,g||0),S=this._preUplinkStats.get(_)||[y];this._preUplinkStats.set(_,bm(h=wm(p=[]).call(p,qT(S),[y])).call(h,-2))}this._startNetworkQualityReport()}},{key:"updateDownlinkStats",value:function(e,t){if(t){var r,n,i=this._getStreamActiveState(t),o=i.audioActive,a=i.videoActive,s=e.audioStats,c=e.videoStats,u=e.isScreen,d=e.userId;if(o)if(0===s.receivedKBitrate)r=xd.VBAD;else{var l=s.rtt,h=s.audioLossRate,p=s.stallDuration,_=s.statsInterval,v=s.e2eDelay,f=p/_,m=u?"screen_audio":"audio",g=this._getQosLevel(l,h||0,c._retransmittedRate||0),y=this._getDownlinkQoE(m,f,v);r=this._getNetworkQuality(g,y)}if(a)if(0===c.receivedKBitrate||0===c.rtt)n=xd.VBAD;else{var S=c.rtt,b=c.videoLossRate,E=c.stallDuration,T=c.statsInterval,k=c.e2eDelay,I=c._retransmittedRate,R=E/T,A=u?"screen_video":"video",C=this._getQosLevel(S,b||0,I||0),w=this._getDownlinkQoE(A,R,k);n=this._getNetworkQuality(C,w)}var x=r&&n?Math.ceil((r+n)/2):r||n;if(x){var O,P,D,M=wm(O="".concat(d)).call(O,u?"_screen":""),N=this._preDownlinkStats.get(M)||[x];this._preDownlinkStats.set(M,bm(P=wm(D=[]).call(D,qT(N),[x])).call(P,-2)),this._startNetworkQualityReport()}}}},{key:"setConnectionState",value:function(e){this._connectionState=e}},{key:"destroy",value:function(){this._timer&&(window.clearInterval(this._timer),delete this._timer),this._delayTimer&&(window.clearTimeout(this._delayTimer),delete this._delayTimer),this._preUplinkStats.clear(),this._preDownlinkStats.clear()}},{key:"_startNetworkQualityReport",value:function(){var e=this;this._delayTimer||this._timer||(this._preUplinkStats.size>0||this._preDownlinkStats.size>0)&&(this._delayTimer=window.setTimeout((function(){delete e._delayTimer,e._reportNetworkQuality(),e._timer=window.setInterval((function(){e._reportNetworkQuality()}),2e3)}),300))}},{key:"_reportNetworkQuality",value:function(){var e,t,r=this;if(this._connectionState!==Yj.CONNECTED)e=t=xd.VBAD;else{var n,i,o,a=this._getBetterQualityAndRemoveOldest("audio","up"),s=this._getBetterQualityAndRemoveOldest("video","up");e=a&&s?Math.ceil((a+s)/2):a||s||this._getBetterQualityAndRemoveOldest("screen_video","up")||this._getBetterQualityAndRemoveOldest("screen_audio","up")||xd.EXCELLENT;var c=Gs(n=JE(i=XT(tO(o=this._preDownlinkStats).call(o))).call(i,(function(e){return r._getBetterQualityAndRemoveOldest(e,"down")}))).call(n,(function(e){return e}));t=Math.ceil(tb(c).call(c,(function(e,t){return t+e}),0)/c.length)||xd.UNKNOWN}"function"==typeof this.reportor&&this.reportor(e,t)}},{key:"_getNetworkQuality",value:function(e,t){return 1===t?Math.max(e-2,1):2===t?e:Math.min(e+1,5)}},{key:"_getQosLevel",value:function(e,t,r){var n;return n=(!e||e<=250)&&t<=.15?1:(!e||e<=500)&&t<=.3?2:(!e||e<=750)&&t<=.45?3:(!e||e<=1e3)&&t<=.6?4:5,r>.5?n=Math.max(n,4):r>.35?n=Math.max(n,3):r>.15&&(n=Math.max(n,2)),n}},{key:"_getUplinkQoE",value:function(e,t){var r=0;switch(e){case"audio":case"video":r=t<.05?1:t<.1?2:3;break;case"screen_video":case"screen_audio":r=t<.04?1:t<.08?2:3}return r}},{key:"_getDownlinkQoE",value:function(e,t,r){var n=sG[e];return t>n.stallRadio||r>n.delay||t>n.stallRadio/2&&r>n.delay/2?3:(t>n.stallRadio/2||n.delay,2)}},{key:"_getBetterQualityAndRemoveOldest",value:function(e,t){var r=xd.UNKNOWN,n="up"===t?this._preUplinkStats:this._preDownlinkStats,i=n.get(e);if(i){var o=Gs(i).call(i,(function(e){return e}));o.length>0&&(r=Math.min.apply(Math,qT(o))),i.shift(),0===i.length&&n.delete(e)}return r}},{key:"_getStreamActiveState",value:function(e){var t=e.subMediaType,r=e._attributes,n=e.subVideo;return{audioActive:e.subAudio&&qO(t)&&r.localaudio&&r.audiostream,videoActive:n&&YO(t)&&r.localvideo&&r.videostream}}}]),e}(),uG=function(){function e(t){Yd(this,e),sd(this,"_timer",void 0),sd(this,"_remoteVideoSizeCache",{}),sd(this,"_remoteScreenSizeCache",{}),sd(this,"onchange",void 0),this._room=t,this._start()}return qd(e,[{key:"destroy",value:function(){this._timer&&(window.clearInterval(this._timer),delete this._timer),this._remoteVideoSizeCache={},this._remoteScreenSizeCache={}}},{key:"_start",value:function(){var e=this;this._timer||(this._timer=window.setInterval((function(){var t={},r={};e._room.remoteStreams.forEach((function(n,i){n.forEach((function(n){var o,a=null===(o=n.videoTrack)||void 0===o?void 0:o.getTrack();if(a){var s=n.isScreen?e._remoteScreenSizeCache:e._remoteVideoSizeCache,c=s[i]||{},u=c.width,d=void 0===u?0:u,l=c.height,h=void 0===l?0:l,p=a.getSettings(),_=p.width,v=void 0===_?0:_,f=p.height,m=void 0===f?0:f;h===m&&d===v||"function"==typeof e.onchange&&e.onchange(i,n.isScreen,v,m),delete s[i],(n.isScreen?r:t)[i]={width:v,height:m}}}))})),an(e._remoteVideoSizeCache).forEach((function(t){"function"==typeof e.onchange&&e.onchange(t,!1,0,0)})),an(e._remoteScreenSizeCache).forEach((function(t){"function"==typeof e.onchange&&e.onchange(t,!0,0,0)})),e._remoteVideoSizeCache=t,e._remoteScreenSizeCache=r}),1e3))}}]),e}(),dG=XT((new TextEncoder).encode("subt")),lG={1:uA.SUBTITLE_ERR_POSTPROCESS,2:uA.SUBTITLE_ERR_CONNECTION_ERROR,3:uA.SUBTITLE_ERR_PROCESS_ERROR},hG=new uO("SubtitleTool",1),pG=function(e){if(e.extraInfo)try{var t,r=JSON.parse(e.extraInfo);r.source_language&&gE(t=["zh","en","ja"]).call(t,r.source_language)}catch(a){}else{var n,i,o=(null===(n=navigator.language)||void 0===n?void 0:n.substring(0,2))||"";gE(i=["zh","en","ja"]).call(i,o)>-1&&(e.extraInfo=eT({source_language:o}))}},_G=function(){function e(t){var r,n,i;Yd(this,e),sd(this,"_taskId",void 0),sd(this,"_appId",void 0),sd(this,"_roomId",void 0),sd(this,"_userId",void 0),sd(this,"onEvent",void 0),sd(this,"onMessage",void 0),sd(this,"_preConfig",void 0),sd(this,"_timer",void 0),this._room=t,this._appId=null===(r=this._room._roomInfo)||void 0===r?void 0:r.appId,this._roomId=null===(n=this._room._roomInfo)||void 0===n?void 0:n.roomId,this._userId=null===(i=this._room._roomInfo)||void 0===i?void 0:i.userInfo.userId}var t,r,n;return qd(e,[{key:"start",value:(n=km(Em().mark((function e(t){var r=this;return Em().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(hG.print("start","Invoke config: %o",t),$P(t.mode,"mode",[Ud.ASR_ONLY,Ud.ASR_AND_TRANSLATION]),t.mode!==Ud.ASR_AND_TRANSLATION||-1!==gE(fG).call(fG,t.targetLanguage||"")){e.next=4;break}throw new lA(uA.INVALID_PARAMS,"Invalid targetLanguage.");case 4:if(!this._taskId){e.next=6;break}throw new lA(uA.SUBTITLE_ALREADY_ON,"Already turned on subtitle");case 6:return this._preConfig=t,this._taskId=(Date.now().toString()+this._roomId+this._userId).substring(0,20),e.next=10,this._room.subtitleControlMessage(this._genSubtitleSignaling("started",t,this._taskId));case 10:this._preConfig=t,this._timer=self.setTimeout((function(){var e;null===(e=r.onEvent)||void 0===e||e.call(r,{event:Vd.ERROR,errorCode:uA.TIME_OUT,errorMessage:"start subtitle timeout."}),delete r._timer,r.stop()}),3e4);case 12:case"end":return e.stop()}}),e,this)}))),function(e){return n.apply(this,arguments)})},{key:"update",value:(r=km(Em().mark((function e(t){var r;return Em().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if($P(t.mode,"mode",[Ud.ASR_ONLY,Ud.ASR_AND_TRANSLATION]),t.mode!==Ud.ASR_AND_TRANSLATION||-1!==gE(fG).call(fG,t.targetLanguage||"")){e.next=3;break}throw new lA(uA.INVALID_PARAMS,"Invalid targetLanguage.");case 3:if(!this._taskId){e.next=5;break}throw new lA(uA.SUBTITLE_ALREADY_ON,"Already started subtitle");case 5:if(this._taskId){e.next=7;break}throw new lA(uA.SUBTITLE_NOT_TURNED_ON,"Start subtitle first.");case 7:if((null===(r=this._preConfig)||void 0===r?void 0:r.mode)===t.mode&&this._preConfig.targetLanguage===t.targetLanguage){e.next=11;break}return this._preConfig=t,e.next=11,this._room.subtitleControlMessage(this._genSubtitleSignaling("update",t,this._taskId));case 11:case"end":return e.stop()}}),e,this)}))),function(e){return r.apply(this,arguments)})},{key:"stop",value:function(){var e=this;hG.print("stop","Invoke"),this._taskId&&this._room.subtitleControlMessage({type:"subtitle",action:"stopped",appId:this._appId,roomId:this._roomId,userId:this._userId,taskId:this._taskId}).finally((function(){var t;delete e._taskId,null===(t=e.onEvent)||void 0===t||t.call(e,{event:Vd.STOPPED}),e._clearTimer()}))}},{key:"reconnect",value:(t=km(Em().mark((function e(){return Em().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!this._taskId||!this._preConfig){e.next=5;break}return e.next=3,this._room.subtitleControlMessage({type:"subtitle",action:"stopped",appId:this._appId,roomId:this._roomId,userId:this._userId,taskId:this._taskId});case 3:delete this._taskId,this.start(this._preConfig);case 5:case"end":return e.stop()}}),e,this)}))),function(){return t.apply(this,arguments)})},{key:"getConfig",value:function(){return this._preConfig}},{key:"destroy",value:function(){hG.print("destroy","Invoke"),this.stop(),delete this._preConfig,delete this._taskId}},{key:"onResult",value:function(e){var t=e.body,r=t.error,n=t.errorMessage,i=t.eventType;if(0!==r){var o,a=new lA(lG[r]||uA.SUBTITLE_ERR_UNKNOWN,n||"");null===(o=this.onEvent)||void 0===o||o.call(this,{event:Vd.ERROR,errorCode:a.code,errorMessage:a.message}),this._clearTimer()}else if("SubtitleStarted"===i){var s;null===(s=this.onEvent)||void 0===s||s.call(this,{event:Vd.STARTED}),this._clearTimer()}}},{key:"onMessageRecv",value:function(e){if(this._taskId&&this._preConfig){var t=vG(e);if(t&&t.length>0){var r,n,i=this._preConfig,o=i.mode,a=i.targetLanguage,s=JE(r=Gs(t).call(t,(function(e){return o===Ud.ASR_ONLY?e.mode===o:o===Ud.ASR_AND_TRANSLATION&&e.language===a}))).call(r,(function(e){return{userId:e.userId,text:e.text,definite:e.definite,sequence:e.sequence}}));if(s.length>0)null===(n=this.onMessage)||void 0===n||n.call(this,s)}return!!t}return!1}},{key:"_genSubtitleSignaling",value:function(e,t,r){return{taskId:r,type:"subtitle",action:e,roomId:this._roomId,appId:this._appId,userId:this._userId,subtitleMeta:{subtitleConfig:{mode:t.mode,usersConfig:[{userId:this._userId,targetLanguages:[t.targetLanguage||""]}]},vendorConfig:{type:0}}}}},{key:"_clearTimer",value:function(){this._timer&&(self.clearTimeout(this._timer),delete this._timer)}}]),e}(),vG=function(e){var t=e.message;if(t instanceof ArrayBuffer&&t.byteLength>8)try{var r=new DataView(t,0),n=0;if(dG.every((function(e){return r.getUint8(n++)===e}))){var i=r.getUint32(n);if(n+=4,i===r.byteLength-8){var o=DO.ab2str(bm(t).call(t,8)),a=JSON.parse(o),s=a.data;if("subtitle"===a.type)return s}}}catch(c){}return!1},fG=["zh","zh-Hant","tn","vi","iu","it","id","hi","en","ho","he","es","el","uk","ur","tk","tr","ti","ty","tl","to","th","ta","te","sl","sk","ss","eo","sm","sg","st","sv","ja","tw","qu","pt","pa","no","nb","nr","my","bn","mn","mh","mk","ml","mr","ms","lu","ro","lt","lv","lo","kj","hr","kn","ki","cs","ca","nl","ko","ht","gu","ka","kl","km","lg","kg","fi","fj","fr","ru","ng","de","tt","da","ts","cv","fa","bs","pl","bi","nd","ba","bg","az","ar","af","sq","ab","os","ee","et","ay","lzh","am","ckb","cy","gl","ha","hy","ig","kmr","ln","nso","ny","om","sn","so","sr","sw","xh","yo","zu"],mG=ad,gG=tc,yG=function(e,t,r,n){for(var i,o=n>1?void 0:n?gG(t,r):t,a=e.length-1;a>=0;a--)(i=e[a])&&(o=(n?i(t,r,o):i(o))||o);return n&&o&&mG(t,r,o),o},SG=function(){function e(t){Yd(this,e),sd(this,"_forwardDstRooms",new jS),sd(this,"forwardStreamState","stopped"),sd(this,"_monitor",void 0),this._room=t,this._monitor=EO(this._room.id)}var t,r,n,i,o,a;return qd(e,[{key:"startForwardStream2Rooms",value:(a=km(Em().mark((function e(t){var r,n;return Em().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if("running"!==this.forwardStreamState&&"paused"!==this.forwardStreamState){e.next=2;break}throw new lA(uA.UNEXPECTED_INVOKE_FORWARD_STREAM,"should not invoke startForwardStreamToRooms in state: ".concat(this.forwardStreamState));case 2:return e.next=4,this._sendForwardStreamSignaling("start",this._room.roomInfo.roomId,t);case 4:return r=e.sent,this._updateDstRooms(t,r),n=this._transformForwardStreamResult(r),this.forwardStreamState="running",e.abrupt("return",n);case 9:case"end":return e.stop()}}),e,this)}))),function(e){return a.apply(this,arguments)})},{key:"updateForwardStream2Rooms",value:(o=km(Em().mark((function e(t){var r,n;return Em().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if("stopped"!==this.forwardStreamState){e.next=2;break}throw new lA(uA.UNEXPECTED_INVOKE_FORWARD_STREAM,"should not invoke updateForwardStreamToRooms in state: ".concat(this.forwardStreamState));case 2:if(r=this._mockForwardStreamResult(t),"running"!==this.forwardStreamState){e.next=7;break}return e.next=6,this._sendForwardStreamSignaling("update",this._room._roomInfo.roomId,t);case 6:r=e.sent;case 7:return this._updateDstRooms(t,r),n=this._transformForwardStreamResult(r),e.abrupt("return",n);case 10:case"end":return e.stop()}}),e,this)}))),function(e){return o.apply(this,arguments)})},{key:"stopForwardStream2Rooms",value:(i=km(Em().mark((function e(){var t,r,n;return Em().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if("stopped"!==this.forwardStreamState){e.next=2;break}throw new lA(uA.UNEXPECTED_INVOKE_FORWARD_STREAM,"should not invoke stopForwardStreamToRooms in state: ".concat(this.forwardStreamState));case 2:if(r=this._mockForwardStreamResult([]),"running"!==this.forwardStreamState){e.next=7;break}return e.next=6,this._sendForwardStreamSignaling("stop",this._room._roomInfo.roomId);case 6:r=e.sent;case 7:if(this._updateDstRooms([],r),!(qT(tO(t=this._forwardDstRooms).call(t)).length>0)){e.next=10;break}throw new lA(uA.UNEXPECTED_ERROR,"stopforwardstream failed: ".concat(eT(r)));case 10:return n=this._transformForwardStreamResult(r),this.forwardStreamState="stopped",e.abrupt("return",n);case 13:case"end":return e.stop()}}),e,this)}))),function(){return i.apply(this,arguments)})},{key:"pauseForwardStream2AllRooms",value:(n=km(Em().mark((function e(){var t,r;return Em().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if("paused"!==this.forwardStreamState&&"stopped"!==this.forwardStreamState){e.next=2;break}throw new lA(uA.UNEXPECTED_INVOKE_FORWARD_STREAM,"should not invoke pauseForwardStreamToAllRooms in state: ".concat(this.forwardStreamState));case 2:return e.next=4,this._sendForwardStreamSignaling("stop",this._room._roomInfo.roomId);case 4:return t=e.sent,r=this._transformForwardStreamResult(t),this.forwardStreamState="paused",e.abrupt("return",r);case 8:case"end":return e.stop()}}),e,this)}))),function(){return n.apply(this,arguments)})},{key:"resumeForwardStream2AllRooms",value:(r=km(Em().mark((function e(){var t,r,n,i,o=arguments;return Em().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(o.length>0&&void 0!==o[0]&&o[0]||!vT(t=["running","stopped"]).call(t,this.forwardStreamState)){e.next=3;break}throw new lA(uA.UNEXPECTED_INVOKE_FORWARD_STREAM,"should not invoke resumeForwardStreamToAllRooms in state: ".concat(this.forwardStreamState));case 3:return r=this._getDstRooms(),e.next=6,this._sendForwardStreamSignaling("start",this._room._roomInfo.roomId,r);case 6:return n=e.sent,this._updateDstRooms(r,n),i=this._transformForwardStreamResult(n),this.forwardStreamState="running",e.abrupt("return",i);case 11:case"end":return e.stop()}}),e,this)}))),function(){return r.apply(this,arguments)})},{key:"resumeFromReconnect",value:function(){var e=this;"running"===this.forwardStreamState&&this.resumeForwardStream2AllRooms(!0).then((function(t){t.forEach((function(t){t.state===Fd.FORWARD_STREAM_STATE_FAILURE&&e._room.safeEmit(NV.ON_FORWARD_STREAM_ERROR,t)}))}))}},{key:"onForwardDstRoomUserKick",value:function(e){var t=[{dstRoomId:e.dstRoomId,code:200,forwardStreamType:"stop"}];this._updateDstRooms([],t),this._room.safeEmit(NV.ON_FORWARD_STREAM_ERROR,{roomId:e.dstRoomId,state:Fd.FORWARD_STREAM_STATE_FAILURE,error:Bd.FORWARD_STREAM_ERROR_REMOTE_KICKED})}},{key:"clear",value:function(){this._forwardDstRooms.clear(),this.forwardStreamState="stopped"}},{key:"_mockForwardStreamResult",value:function(e){var t=this,r=[];return this._forwardDstRooms.forEach((function(e,t){r.push({dstRoomId:t,forwardStreamType:"stop",code:200})})),e.forEach((function(e){var n,i=WR(r).call(r,(function(t){return t.dstRoomId===e.roomId}));-1===i?r.push({dstRoomId:e.roomId,forwardStreamType:"start",code:e.roomId===(null===(n=t._room.roomInfo)||void 0===n?void 0:n.roomId)?400:200}):r[i].forwardStreamType="update"})),r}},{key:"_transformForwardStreamResult",value:function(e){e||(e=[]);var t,r=[],n=Jk(e);try{for(n.s();!(t=n.n()).done;){var i=t.value,o=i.dstRoomId,a=i.code,s={roomId:o,state:Fd.FORWARD_STREAM_STATE_SUCCESS,error:Bd.FORWARD_STREAM_ERROR_OK};200===a||(400===a?(s.state=Fd.FORWARD_STREAM_STATE_FAILURE,s.error=Bd.FORWARD_STREAM_ERROR_REMOTE_KICKED):a>=700&&a<800?(s.state=Fd.FORWARD_STREAM_STATE_FAILURE,s.error=Bd.FORWARD_STREAM_ERROR_INVALID_TOKEN):(s.state=Fd.FORWARD_STREAM_STATE_FAILURE,s.error=Bd.FORWARD_STREAM_ERROR_RESPONSE)),r.push(s)}}catch(c){n.e(c)}finally{n.f()}return r}},{key:"_updateDstRooms",value:function(e){var t=this,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[];0===(null==r?void 0:r.length)&&this._forwardDstRooms.clear(),r.forEach((function(r){var n=r.dstRoomId,i=r.code,o=r.forwardStreamType;if(200===i)if("stop"===o)t._forwardDstRooms.delete(n);else{var a,s=sE(e).call(e,(function(e){return e.roomId===n}));if(!s&&!t._forwardDstRooms.has(n))throw new lA(uA.UNEXPECTED_ERROR,"unknow roomid ".concat(n," in signaling return"));var c=null!==(a=t._forwardDstRooms.get(n))&&void 0!==a?a:{token:void 0};c=fb(c,s),t._forwardDstRooms.set(n,c)}else t._forwardDstRooms.has(n)&&t._forwardDstRooms.delete(n)}))}},{key:"_getDstRooms",value:function(){var e=[];return this._forwardDstRooms.forEach((function(t,r){e.push({roomId:r,token:t.token})})),e}},{key:"_sendForwardStreamSignaling",value:(t=km(Em().mark((function e(t,r,n){var i,o,a,s,c,u,d,l,h;return Em().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return i="".concat(NO()),"stop"!==t&&(a=JE(n).call(n,(function(e){return e.roomId})),null===(o=this._monitor)||void 0===o||o.report("rtc_forward_stream",{type:"begin",dst_rooms:"{ ".concat(JE(a).call(a,(function(e){return'"'.concat(e,'"')})).join(",")," }"),event_session_id:i})),e.next=4,this._room._mediaServerClient.sendForwardStreamSignal(t,r,n);case 4:if(s=e.sent,c=[],200===(null==s?void 0:s.code)){e.next=9;break}throw"stop"!==t&&(null==n||n.forEach((function(e){c.push({dst_room_id:e.roomId,result:"server error ".concat(null==s?void 0:s.code)})})),null===(u=this._monitor)||void 0===u||u.report("rtc_forward_stream",{type:"end",dst_rooms:eT(c),event_session_id:i})),new lA(uA.UNEXPECTED_ERROR,"server side internal error, error code: ".concat(s));case 9:return"stop"!==t&&(null===(d=s.forwardStreamResults)||void 0===d||d.forEach((function(e){c.push({dst_room_id:e.dstRoomId,result:"dst room lost"})})),null===(l=s.forwardStreamResults)||void 0===l||l.forEach((function(e){var t=sE(c).call(c,(function(t){return t.dst_room_id===e.dstRoomId}));t&&(200===e.code?"update"===e.forwardStreamType?t.result="update":t.result="success":t.result="server error ".concat(e.code))})),null===(h=this._monitor)||void 0===h||h.report("rtc_forward_stream",{type:"end",dst_rooms:eT(c),event_session_id:i})),e.abrupt("return",s.forwardStreamResults);case 11:case"end":return e.stop()}}),e,this)}))),function(e,r,n){return t.apply(this,arguments)})}]),e}();function bG(e,t,r){var n=r.value;return r.value=km(Em().mark((function e(){var r,i,o,a,s=arguments;return Em().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(null===(r=this._room._roomInfo)||void 0===r||!r.roomId){e.next=7;break}for(i=s.length,o=new Array(i),a=0;a<i;a++)o[a]=s[a];return e.next=4,n.apply(this,o);case 4:return e.abrupt("return",e.sent);case 7:throw new lA(uA.NOT_CONNECTED_YET,"error in ".concat(t,": try again after joined"));case 8:case"end":return e.stop()}}),e,this)}))),r}yG([bG],SG.prototype,"startForwardStream2Rooms",1),yG([bG],SG.prototype,"updateForwardStream2Rooms",1),yG([bG],SG.prototype,"stopForwardStream2Rooms",1),yG([bG],SG.prototype,"pauseForwardStream2AllRooms",1),yG([bG],SG.prototype,"resumeForwardStream2AllRooms",1);var EG=new uO("Room",1),TG={audiostream:!0,extaudio:!1,extvideo:!1,localaudio:!0,localvideo:!1,videoDescriptions:[],videostream:!1,publishTime:0},kG=function(e){xI(x,e);var t,r,n,i,o,a,s,c,u,d,l,h,p,_,v,f,m,g,y,S,b,E,T,k,I,R,A,C,w=WI(x);function x(e,t){var r;return Yd(this,x),sd(Zk(r=w.call(this)),"id",void 0),sd(Zk(r),"_mediaServerClient",void 0),sd(Zk(r),"_localStream",void 0),sd(Zk(r),"_localScreenStream",void 0),sd(Zk(r),"_remoteUsers",new jS),sd(Zk(r),"_remoteStreams",new jS),sd(Zk(r),"_remoteStreamStreamIdUserIdMap",{}),sd(Zk(r),"_virtualStreams",[]),sd(Zk(r),"_context",void 0),sd(Zk(r),"_sessionId",void 0),sd(Zk(r),"_connectionLostTimer",void 0),sd(Zk(r),"_serverConfig",void 0),sd(Zk(r),"_roomConfig",void 0),sd(Zk(r),"_roomInfo",void 0),sd(Zk(r),"_userDuplicateLoginTimerMap",new jS),sd(Zk(r),"_networkQualityManager",void 0),sd(Zk(r),"_videoSizeObserver",void 0),sd(Zk(r),"_hasPublished",!1),sd(Zk(r),"_subtitleTool",void 0),sd(Zk(r),"_csrcUserIdMap",void 0),sd(Zk(r),"_publishOnDemandItem",void 0),sd(Zk(r),"_publishOnDemandBusy",!1),sd(Zk(r),"_monitor",void 0),sd(Zk(r),"_forwardStreamManager",void 0),EG.print("constructor","invoke"),r.id=t.id,r._roomConfig=e,r._mediaServerClient=new Qj(t),r._networkQualityManager=new cG,r._networkQualityManager.reportor=r._reportNetworkQuality.bind(Zk(r)),r._videoSizeObserver=new uG(Zk(r)),r._videoSizeObserver.onchange=r._emitVideoSizeChange.bind(Zk(r)),r._context=t,r._csrcUserIdMap={},r._monitor=EO(r.id),r._forwardStreamManager=new SG(Zk(r)),r._addHandlerEventHandler(),r}return qd(x,[{key:"hasScreenPublished",get:function(){var e;return null===(e=this._localScreenStream)||void 0===e?void 0:e.hasPublished}},{key:"hasPublished",get:function(){var e;return null===(e=this._localStream)||void 0===e?void 0:e.hasPublished}},{key:"connectionState",get:function(){return this._mediaServerClient.connectionState}},{key:"remoteUsers",get:function(){return this._remoteUsers}},{key:"remoteStreams",get:function(){return this._remoteStreams}},{key:"localStream",get:function(){return this._localStream}},{key:"localScreenStream",get:function(){return this._localScreenStream}},{key:"roomInfo",get:function(){return this._roomInfo}},{key:"roomConfig",set:function(e){this._roomConfig=e}},{key:"_addHandlerEventHandler",value:function(){var e,t,r,n,i,o,a,s,c,u,d,l,h,p,_,v,f,m,g,y,S,b,E,T,k,I,R,A,C,w,x,O,P,D=this;null===(e=this._mediaServerClient)||void 0===e||e.on(AV.ON_ADD_STREAM,this._onAddStream.bind(this)),null===(t=this._mediaServerClient)||void 0===t||t.on(AV.ON_ADD_STREAM_LIST,(function(e){Array.isArray(null==e?void 0:e.streamList)&&e.streamList.forEach((function(e){return D._onAddStream(e)}))})),null===(r=this._mediaServerClient)||void 0===r||r.on(AV.ON_REMOVE_STREAM,this._onRemoveStream.bind(this)),null===(n=this._mediaServerClient)||void 0===n||n.on(AV.ON_REMOVE_STREAM_LIST,(function(e){Array.isArray(null==e?void 0:e.streamList)&&e.streamList.forEach((function(e){return D._onRemoveStream(e)}))})),null===(i=this._mediaServerClient)||void 0===i||i.on(AV.USER_CONNECTION,this._onUserConnection.bind(this)),null===(o=this._mediaServerClient)||void 0===o||o.on(AV.USER_CONNECTION_LIST,(function(e){Array.isArray(null==e?void 0:e.userList)&&e.userList.forEach((function(e){return D._onUserConnection(e)}))})),null===(a=this._mediaServerClient)||void 0===a||a.on(AV.USER_DISCONNECTION,this._onUserDisconnection.bind(this)),null===(s=this._mediaServerClient)||void 0===s||s.on(AV.USER_DISCONNECTION_LIST,(function(e){Array.isArray(null==e?void 0:e.userList)&&e.userList.forEach((function(e){return D._onUserDisconnection(e)}))})),null===(c=this._mediaServerClient)||void 0===c||c.on(AV.ON_UPDATE_ROOM_ATTRIBUTES,this._onUpdateRoomAttributes.bind(this)),null===(u=this._mediaServerClient)||void 0===u||u.on(AV.ON_UPDATE_USER_ATTRIBUTES,this._onUpdateUserAttributes.bind(this)),null===(d=this._mediaServerClient)||void 0===d||d.on(AV.ON_UPDATE_STREAM_ATTRIBUTES,this._onUpdateStreamAttributes.bind(this)),null===(l=this._mediaServerClient)||void 0===l||l.on(AV.ON_PUSH_TRACK,this._onPushTrack.bind(this)),null===(h=this._mediaServerClient)||void 0===h||h.on(AV.ON_REMOVE_TRACK,this._onRemoveTrack.bind(this)),null===(p=this._mediaServerClient)||void 0===p||p.on(AV.ON_CUSTOM_MESSAGE,this._onCustomMessage.bind(this)),null===(_=this._mediaServerClient)||void 0===_||_.on(AV.USER_MESSAGE_RECEIVED,this._onUserMessageReceived.bind(this)),null===(v=this._mediaServerClient)||void 0===v||v.on(AV.USER_BINARY_MESSAGE_RECEIVED,this._onUserBinaryMessageReceived.bind(this)),null===(f=this._mediaServerClient)||void 0===f||f.on(AV.POST_PROCESSING_MESSAGE,this._onPostProcessingMessage.bind(this)),null===(m=this._mediaServerClient)||void 0===m||m.on(AV.ON_USER_TOKEN_WILL_EXPIRE,this._onUserTokenWillExpire.bind(this)),null===(g=this._mediaServerClient)||void 0===g||g.on(AV.STREAM_CONTROL_MESSAGE,this._onStreamControlMessage.bind(this)),null===(y=this._mediaServerClient)||void 0===y||y.on(AV.ON_STREAM_FAILED,this._onStreamFailed.bind(this)),null===(S=this._mediaServerClient)||void 0===S||S.on(CV.RSCP,(function(e){!!sE(e).call(e,(function(e){var t,r,n;return null==e||null===(t=e.StreamIds)||void 0===t?void 0:vT(t).call(t,null===(r=D._localStream)||void 0===r||null===(n=r.stream)||void 0===n?void 0:n.id)}))&&(D._publishOnDemandItem=e,D._onPublishOnDemand())})),null===(b=this._mediaServerClient)||void 0===b||b.on(CV.RTT,this._onRTT.bind(this)),null===(E=this._mediaServerClient)||void 0===E||E.on(CV.SSC,this._onSSC.bind(this)),null===(T=this._mediaServerClient)||void 0===T||T.on(wV.ON_CONNECTION_STATE_CHANGE,this._onConnectionStateChange.bind(this)),null===(k=this._mediaServerClient)||void 0===k||k.on(wV.ON_VENDOR_CONNECTION_STATE_CHANGE,(function(e){return D.emit(wV.ON_VENDOR_CONNECTION_STATE_CHANGE,e)})),null===(I=this._mediaServerClient)||void 0===I||I.on(AV.ON_SPEAKER_CHANGE,this._onMeetingSpeakerChange.bind(this)),null===(R=this._mediaServerClient)||void 0===R||R.on("onRemoteStreamStats",(function(e){D._networkQualityManager.updateDownlinkStats(e,D._findRemoteStreamByScreen(e.userId,e.isScreen)),D.emit(NV.ON_REMOTE_STREAM_STATS,JO(e))})),null===(A=this._mediaServerClient)||void 0===A||A.on(NV.RESUBSCRIBE,(function(e){D.emit(NV.RESUBSCRIBE,e)})),null===(C=this._mediaServerClient)||void 0===C||C.on(NV.RECONNECT_FAILED,(function(){D.emit(NV.RECONNECT_FAILED)})),null===(w=this._mediaServerClient)||void 0===w||w.on("joinSuccess",this._onJoinSucc.bind(this)),null===(x=this._mediaServerClient)||void 0===x||x.on(AV.ON_FORWARD_DST_ROOM_USER_KICK,this._forwardStreamManager.onForwardDstRoomUserKick.bind(this._forwardStreamManager)),null===(O=this._mediaServerClient)||void 0===O||O.on(NV.ON_REJOIN_WITH_TCP,(function(){D.emit(NV.ON_REJOIN_WITH_TCP)})),null===(P=this._mediaServerClient)||void 0===P||P.on(NV.ON_ICE_CONNECT_WITH_TCP,(function(){D.emit(NV.ON_ICE_CONNECT_WITH_TCP)}))}},{key:"_onLocalStreamStats",value:function(e){this._networkQualityManager.updateUplinkStats(e),this.emit(NV.ON_LOCAL_STREAM_STATS,JO(e))}},{key:"_removeHandlerEventHandler",value:function(){var e;null===(e=this._mediaServerClient)||void 0===e||e.removeAllListeners()}},{key:"connect",value:(C=km(Em().mark((function e(t){return Em().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this._mediaServerClient.connect();case 2:case"end":return e.stop()}}),e,this)}))),function(e){return C.apply(this,arguments)})},{key:"join",value:(A=km(Em().mark((function e(t,r,n,i,o){var a,s,c;return Em().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return null===(a=this._monitor)||void 0===a||a.set({rtc_app_id:t,room_id:r,user_id:i.userId}),EG.print("join()"),this._mediaServerClient.setLiveControlMessage(o),this._roomInfo={appId:t,roomId:r,token:n,userInfo:i,roomProfile:this._roomConfig.roomProfileType},this.setSessionId(),e.prev=5,e.next=8,this._mediaServerClient.join(this._roomInfo);case 8:return c=e.sent,null!==(s=c.roomAttributes)&&void 0!==s&&s.multiChatMode&&this._handleFFAudioTrack(),this._initSubtitleTool(),e.abrupt("return",{users:c.clients,streams:c.streams});case 14:if(e.prev=14,e.t0=e.catch(5),e.t0.code===uA.OPERATION_CANCEL){e.next=18;break}throw e.t0;case 18:case"end":return e.stop()}}),e,this,[[5,14]])}))),function(e,t,r,n,i){return A.apply(this,arguments)})},{key:"publishScreen",value:(R=km(Em().mark((function e(t,r,n,i,o){var a,s,c,u,d,l,h,p,_,v,f,m;return Em().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(EG.print("publishScreen()"),this._localScreenStream||(this._localScreenStream=new lV(this._context),null!==(a=this._mediaServerClient)&&void 0!==a&&null!==(s=a.vendorConfig)&&void 0!==s&&s.enableMultiVendor&&(this._localScreenStream.pcSessionId=rC()),this._localScreenStream.isScreen=!0,this._mediaServerClient.handler&&(this._localScreenStream.observer=new aG(this._localScreenStream,this._mediaServerClient.handler))),c=!1,u=!1,d=!1,l=!1,!this._localScreenStream.videoTrack&&r?(r instanceof mU&&(u=!0),c=!0):this._localScreenStream.videoTrack&&!r&&(c=!1),!this._localScreenStream.audioTrack&&n?(n instanceof gU&&(l=!0),d=!0):this._localScreenStream.audioTrack&&!n&&(d=!1),this._localScreenStream.videoTrack=r,this._localScreenStream.audioTrack=n,this._localScreenStream.videoEncodeConfig=t,i&&(qO(i)&&(this._localScreenStream.pubAudio=o===UV.PUB),YO(i)&&(this._localScreenStream.pubVideo=o===UV.PUB),EG.print("publishScreen mediaType","pubAudio: %o, pubVideo: %o",this._localScreenStream.pubAudio,this._localScreenStream.pubVideo)),this._localScreenStream.pubAudio||this._localScreenStream.pubVideo){e.next=18;break}if(null===(h=this._localScreenStream)||void 0===h||!h.hasPublished){e.next=17;break}return e.abrupt("return",this.unpublishScreen());case 17:return e.abrupt("return");case 18:if(this._localScreenStream.hasPublished){e.next=24;break}return null===(p=this._localScreenStream.observer)||void 0===p||p.setPublish(!0),e.next=22,this._mediaServerClient.publish(this._localScreenStream);case 22:e.next=28;break;case 24:return u?null===(_=this._localScreenStream.observer)||void 0===_||_.setPushVideo(c):null===(v=this._localScreenStream.observer)||void 0===v||v.setEnableVideo(c),l?null===(f=this._localScreenStream.observer)||void 0===f||f.setPushAudio(d):null===(m=this._localScreenStream.observer)||void 0===m||m.setEnableAudio(d),e.next=28,this.updatePubScreenTrack();case 28:this._localScreenStream.pubAudio||this._localScreenStream.pubVideo?this._localScreenStream.startReport(this._onLocalStreamStats.bind(this),this._mediaServerClient.handler):this._localScreenStream.stopReport("unpublish screen");case 29:case"end":return e.stop()}}),e,this)}))),function(e,t,r,n,i){return R.apply(this,arguments)})},{key:"updatePubScreenTrack",value:(I=km(Em().mark((function e(){return Em().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(EG.print("updatePubScreenTrack","Invoke updatePubScreenTrack"),!this._localScreenStream){e.next=4;break}return e.next=4,this._mediaServerClient.updatePubTrack(this._localScreenStream);case 4:case"end":return e.stop()}}),e,this)}))),function(){return I.apply(this,arguments)})},{key:"unpublishScreen",value:(k=km(Em().mark((function e(){var t;return Em().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(EG.print("unpublish","Invoke unpublishScreen"),!this._localScreenStream){e.next=8;break}return null===(t=this._localScreenStream.observer)||void 0===t||t.setPublish(!1),e.next=5,this._mediaServerClient.unpublish(this._localScreenStream);case 5:this._localScreenStream.stopReport("unpublish screen"),this._localScreenStream.clean(),this._localScreenStream=void 0;case 8:case"end":return e.stop()}}),e,this)}))),function(){return k.apply(this,arguments)})},{key:"liveControlMessage",value:(T=km(Em().mark((function e(t){var r,n=this;return Em().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return EG.print("controlMessage","Invoke controlMessage"),null===(r=t.transcodeMeta)||void 0===r||r.layout.regions.forEach((function(e){n.roomInfo&&(e.roomID=n.roomInfo.roomId)})),e.next=4,this._mediaServerClient.controlMessage(t);case 4:this._mediaServerClient.setLiveControlMessage("stopped"===t.action?void 0:t);case 5:case"end":return e.stop()}}),e,this)}))),function(e){return T.apply(this,arguments)})},{key:"publicStreamControlMessage",value:(E=km(Em().mark((function e(t){return Em().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return"stopped"===t.action&&delete t.publicStreamMeta,e.next=3,this._mediaServerClient.controlMessage(t);case 3:case"end":return e.stop()}}),e,this)}))),function(e){return E.apply(this,arguments)})},{key:"subtitleControlMessage",value:(b=km(Em().mark((function e(t){return Em().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this._mediaServerClient.controlMessage(t);case 2:case"end":return e.stop()}}),e,this)}))),function(e){return b.apply(this,arguments)})},{key:"updateUserAttributes",value:(S=km(Em().mark((function e(t){return Em().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return EG.print("updateUserAttributes","Invoke updateUserAttributes"),t.role&&this._roomInfo&&(this._roomInfo.userInfo.role=t.role),e.next=4,this._mediaServerClient.updateUserAttributes(t);case 4:case"end":return e.stop()}}),e,this)}))),function(e){return S.apply(this,arguments)})},{key:"publish",value:(y=km(Em().mark((function e(t,r,n,i,o,a){var s,c,u,d,l,h,p,_,v,f,m,g,y,S,b,E=arguments;return Em().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(s=E.length>6&&void 0!==E[6]&&E[6],EG.print("publish","Invoke publish"),c=!1,this._localStream||(this._localStream=new lV(this._context),null!==(u=this._mediaServerClient)&&void 0!==u&&null!==(d=u.vendorConfig)&&void 0!==d&&d.enableMultiVendor&&(this._localStream.pcSessionId=rC()),this._mediaServerClient.handler&&(this._localStream.observer=new aG(this._localStream,this._mediaServerClient.handler)),c=!0,this._localStream.vendorCode=(null===(l=this._mediaServerClient.vendorConfig)||void 0===l?void 0:l.vendorCode)||0),this._localStream.videoTrack=n,this._localStream.audioTrack=i,this._localStream.videoEncodeConfig=t,this._localStream.enableSimulcast=r,o&&(qO(o)&&(this._localStream.pubAudio=a===UV.PUB),YO(o)&&(this._localStream.pubVideo=a===UV.PUB),EG.print("publish mediaType","pubAudio: %o, pubVideo: %o",this._localStream.pubAudio,this._localStream.pubVideo)),this._localStream.hasPublished){e.next=26;break}if(this._localStream.pubAudio||this._localStream.pubVideo){e.next=12;break}return e.abrupt("return");case 12:return e.prev=12,s?null===(h=this._localStream.observer)||void 0===h||h.setLogin(!0):c&&(p=!!this._localStream.videoTrack,_=!!this._localStream.audioTrack,v=this._localStream.videoTrack instanceof mU,f=this._localStream.audioTrack instanceof gU,this._roomConfig.isAutoPublish&&!this._hasPublished?(p&&(v?null===(m=this._localStream.observer)||void 0===m||m.setPushVideo(!0):null===(g=this._localStream.observer)||void 0===g||g.setEnableVideo(!0)),_&&(f?null===(y=this._localStream.observer)||void 0===y||y.setPushAudio(!0):null===(S=this._localStream.observer)||void 0===S||S.setEnableAudio(!0))):null===(b=this._localStream.observer)||void 0===b||b.setPublish(!0)),e.next=16,this._mediaServerClient.publish(this._localStream);case 16:this._hasPublished=!0,this.emit(NV.ON_PUBLISH_RESULT,{isScreen:!1,state:fd.PUBLISH_SUCC}),e.next=24;break;case 20:throw e.prev=20,e.t0=e.catch(12),this.emit(NV.ON_PUBLISH_RESULT,{isScreen:!1,state:fd.PUBLISH_FAIL}),e.t0;case 24:e.next=28;break;case 26:return e.next=28,this.updatePubTrack();case 28:this._localStream.pubAudio||this._localStream.pubVideo?this._localStream.startReport(this._onLocalStreamStats.bind(this),this._mediaServerClient.handler):this._localStream.stopReport("unpublish");case 29:case"end":return e.stop()}}),e,this,[[12,20]])}))),function(e,t,r,n,i,o){return y.apply(this,arguments)})},{key:"updatePubTrack",value:(g=km(Em().mark((function e(){return Em().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(EG.print("updatePubTrack","Invoke updatePubTrack"),!this._localStream){e.next=4;break}return e.next=4,this._mediaServerClient.updatePubTrack(this._localStream);case 4:case"end":return e.stop()}}),e,this)}))),function(){return g.apply(this,arguments)})},{key:"unpublish",value:(m=km(Em().mark((function e(){return Em().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(EG.print("unpublish","Invoke unpublish"),!this._localStream){e.next=7;break}return e.next=4,this._mediaServerClient.unpublish(this._localStream);case 4:this._localStream.stopReport("unpublish"),this._localStream.clean(),this._localStream=void 0;case 7:case"end":return e.stop()}}),e,this)}))),function(){return m.apply(this,arguments)})},{key:"subscribe",value:(f=km(Em().mark((function e(t,r,n){var i;return Em().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return EG.print("subscribe","remoteStream %o",t),i=void 0,n&&(i=this._getSubLayer(n,t)),e.next=5,this._mediaServerClient.subscribe(t,r,i);case 5:case"end":return e.stop()}}),e,this)}))),function(e,t,r){return f.apply(this,arguments)})},{key:"updateSubTrack",value:(v=km(Em().mark((function e(t,r,n,i){var o,a;return Em().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(EG.print("updateSubTrack","Invoke updateSubTrack"),!i){e.next=4;break}return e.next=4,null===(a=this._mediaServerClient)||void 0===a?void 0:a.updateSubTrackLayer(t,i);case 4:return e.abrupt("return",null===(o=this._mediaServerClient)||void 0===o?void 0:o.updateSubTrack(t,r,n));case 5:case"end":return e.stop()}}),e,this)}))),function(e,t,r,n){return v.apply(this,arguments)})},{key:"updateSubVideoConfig",value:(_=km(Em().mark((function e(t,r){var n,i,o,a,s;return Em().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if((a=this._findRemoteStreamByScreen(t,!1))&&a.hasSubscribed&&!((null==a||null===(n=a.attributes)||void 0===n||null===(i=n.videoDescriptions)||void 0===i?void 0:i.length)<=1)){e.next=3;break}return e.abrupt("return");case 3:return s=this._getSubLayer(r,a),a.originalStreamIndex=s.spatialLayer,e.abrupt("return",null===(o=this._mediaServerClient)||void 0===o?void 0:o.updateSubTrackLayer(a,s));case 6:case"end":return e.stop()}}),e,this)}))),function(e,t){return _.apply(this,arguments)})},{key:"_getSubLayer",value:function(e,t){for(var r,n,i,o,a,s=null==t?void 0:t.attributes,c=s.videoDescriptions,u=s.subVideoDescriptions,d=Array.isArray(u)?u:c,l=-1,h=e.width*e.height,p=0;p<(null==d?void 0:d.length);p++){var _,v;if(h>=(null===(_=d[p])||void 0===_?void 0:_.width)*(null===(v=d[p])||void 0===v?void 0:v.height)){l=p;break}}var f=d[0];if(-1===l)f=d[l=d.length-1];else if(0!==l){var m=d[l-1].width*d[l-1].height,g=(m-h)/(m-d[l].width*d[l].height);f=g<.1?d[l-1]:d[l],l=g<.1?l-1:l}return a=null!==(r=null===(n=f)||void 0===n?void 0:n.sub_index)&&void 0!==r?r:-1,{spatialLayer:null!==(i=null===(o=f)||void 0===o?void 0:o.video_index)&&void 0!==i?i:l,spatialSubLayer:a}}},{key:"unsubscribe",value:(p=km(Em().mark((function e(t,r){return Em().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return EG.print("unsubscribe","Invoke unsubscribe"),e.next=3,this._mediaServerClient.unsubscribe(t,r);case 3:case"end":return e.stop()}}),e,this)}))),function(e,t){return p.apply(this,arguments)})},{key:"startSubtitle",value:(h=km(Em().mark((function e(t){return Em().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!this._subtitleTool){e.next=5;break}return e.next=3,this._subtitleTool.start(t);case 3:e.next=6;break;case 5:throw new lA(uA.INVOKED_BEFORE_JOIN_ROOM,"join first");case 6:case"end":return e.stop()}}),e,this)}))),function(e){return h.apply(this,arguments)})},{key:"stopSubtitle",value:(l=km(Em().mark((function e(){var t;return Em().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:null===(t=this._subtitleTool)||void 0===t||t.stop();case 1:case"end":return e.stop()}}),e,this)}))),function(){return l.apply(this,arguments)})},{key:"startForwardStream2Rooms",value:(d=km(Em().mark((function e(t){return Em().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",this._forwardStreamManager.startForwardStream2Rooms(t));case 1:case"end":return e.stop()}}),e,this)}))),function(e){return d.apply(this,arguments)})},{key:"updateForwardStream2Rooms",value:(u=km(Em().mark((function e(t){return Em().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",this._forwardStreamManager.updateForwardStream2Rooms(t));case 1:case"end":return e.stop()}}),e,this)}))),function(e){return u.apply(this,arguments)})},{key:"stopForwardStream2Rooms",value:(c=km(Em().mark((function e(){return Em().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",this._forwardStreamManager.stopForwardStream2Rooms());case 1:case"end":return e.stop()}}),e,this)}))),function(){return c.apply(this,arguments)})},{key:"pauseForwardStream2AllRooms",value:(s=km(Em().mark((function e(){return Em().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",this._forwardStreamManager.pauseForwardStream2AllRooms());case 1:case"end":return e.stop()}}),e,this)}))),function(){return s.apply(this,arguments)})},{key:"resumeForwardStream2AllRooms",value:(a=km(Em().mark((function e(){return Em().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",this._forwardStreamManager.resumeForwardStream2AllRooms());case 1:case"end":return e.stop()}}),e,this)}))),function(){return a.apply(this,arguments)})},{key:"leave",value:(o=km(Em().mark((function e(){var t,r,n,i,o,a,s,c,u,d,l,h=arguments;return Em().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:r=h.length>0&&void 0!==h[0]&&h[0],EG.print("leave","Invoke leave"),n=OO(),null===(t=this._subtitleTool)||void 0===t||t.destroy(),delete this._subtitleTool,e.prev=5,s=Jk(tR(a=this._remoteStreams).call(a));try{for(s.s();!(c=s.n()).done;)u=c.value,Array.isArray(u)&&u.forEach((function(e){var t;null===(t=e.observer)||void 0===t||t.setLogin(!1)}))}catch(p){s.e(p)}finally{s.f()}return this._localStream&&(null===(d=this._localStream.observer)||void 0===d||d.setLogin(!1)),e.next=11,this._mediaServerClient.leave().catch((function(){}));case 11:this.destroy(),null===(i=this._monitor)||void 0===i||i.report("rtc_leave_room",{error_code:0,message:"",elapse:OO()-n}),null===(o=this._monitor)||void 0===o||o.set({room_id:"",user_id:"",rtc_session_id:"",rtc_vid:""}),e.next=24;break;case 16:if(e.prev=16,e.t0=e.catch(5),!r){e.next=22;break}throw e.t0;case 22:this.destroy();case 23:e.t0 instanceof Error&&(null===(l=this._monitor)||void 0===l||l.report("rtc_leave_room",{error_code:-1,message:e.t0.message,elapse:OO()-n}));case 24:case"end":return e.stop()}}),e,this,[[5,16]])}))),function(){return o.apply(this,arguments)})},{key:"updateRemoteUserPriority",value:function(e){var t,r=this;null===(t=this.remoteStreams.get(e))||void 0===t||t.forEach((function(t){var n=(r._context||{}).userPriority;t.hasSubscribed&&n.has(e)&&r._mediaServerClient.updateSubPriority(t,n.get(e))}))}},{key:"destroy",value:function(){var e;EG.print("destroy","Invoke destroy"),IO(this.id,"room_destroy","".concat((new Error).stack)),null===(e=this._subtitleTool)||void 0===e||e.destroy(),delete this._subtitleTool,this._mediaServerClient.destroy(),this._removeHandlerEventHandler(),this._roomInfo=void 0,this._remoteUsers=new jS;var t,r,n,i=Jk(this._remoteStreams);try{for(i.s();!(t=i.n()).done;){var o=Qk(t.value,2)[1];Array.isArray(o)&&o.forEach((function(e){e&&e.destroy()}))}}catch(a){i.e(a)}finally{i.f()}(this._virtualStreams.forEach((function(e){null==e||e.clean()})),this._remoteStreams=new jS,this._localStream)&&(null===(r=this._localStream)||void 0===r||r.clean(),this._localStream=void 0);this._localScreenStream&&(null===(n=this._localScreenStream)||void 0===n||n.clean(),this._localScreenStream=void 0);this._removeHandlerEventHandler(),clearTimeout(this._connectionLostTimer),this._userDuplicateLoginTimerMap.forEach((function(e){clearTimeout(e)})),this._userDuplicateLoginTimerMap.clear(),this._networkQualityManager.destroy(),this._videoSizeObserver.destroy(),this._csrcUserIdMap={},this._virtualStreams=[],this._remoteStreamStreamIdUserIdMap={},this._forwardStreamManager.clear()}},{key:"updateToken",value:(i=km(Em().mark((function e(t){return Em().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return EG.print("updateToken","Invoke updateToken"),this._roomInfo&&(this._roomInfo.token=t),e.prev=2,e.next=5,this._mediaServerClient.updateToken(t);case 5:e.next=11;break;case 7:throw e.prev=7,e.t0=e.catch(2),this.safeEmit(NV.ON_ROOM_ERROR,{errorCode:uA.UPDATE_TOKEN_WITH_INVALID_TOKEN}),e.t0;case 11:case"end":return e.stop()}}),e,this,[[2,7]])}))),function(e){return i.apply(this,arguments)})},{key:"sendUserMessage",value:function(e,t){var r;return null===(r=this._mediaServerClient)||void 0===r?void 0:r.sendUserMessage(e,t)}},{key:"setSessionId",value:function(){var e;this._sessionId=eC(),this._mediaServerClient._sessionId=this._sessionId,null===(e=this._monitor)||void 0===e||e.set({rtc_session_id:this._sessionId})}},{key:"sendRoomMessage",value:(n=km(Em().mark((function e(t){var r,n,i,o,a,s=arguments;return Em().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(o=s.length>1&&void 0!==s[1]&&s[1],a={clientId:null===(r=this._roomInfo)||void 0===r?void 0:r.userInfo.userId,binary:o,message:"",roomId:null===(n=this._roomInfo)||void 0===n?void 0:n.roomId},!o){e.next=8;break}return e.next=5,DO.ab2b64str(t);case 5:a.message=e.sent,e.next=9;break;case 8:a.message=t;case 9:return e.abrupt("return",null===(i=this._mediaServerClient)||void 0===i?void 0:i.sendRoomMessage(a));case 10:case"end":return e.stop()}}),e,this)}))),function(e){return n.apply(this,arguments)})},{key:"_onJoinSucc",value:function(e){var t,r,n,i=this,o=e.joinRes,a=e.reconnect;EG.print("_onJoinSucc()","invoke. ".concat(a?"[reconnect]":"")),this._serverConfig=o.config,this._mediaServerClient.roomAttributes=o.roomAttributes;var s=[],c=[],u=[],d=[],l=[];null===(t=o.clientsDetail)||void 0===t||t.forEach((function(e){if(e.attributes&&(e.attributes.serverMuteVideo&&i.safeEmit(NV.ON_VIDEO_STREAM_BANNED,{uid:e.clientId,banned:1===e.attributes.serverMuteVideo}),e.attributes.serverMuteAudio&&i.safeEmit(NV.ON_AUDIO_STREAM_BANNED,{uid:e.clientId,banned:1===e.attributes.serverMuteAudio})),e.clientId!==o.clientId){var t=i._remoteUsers.get(e.clientId);t?t._stillExist=!0:s.push(e)}}));var h,p=Jk(tR(r=this._remoteUsers).call(r));try{for(p.s();!(h=p.n()).done;){var _=h.value;_._stillExist||c.push({clientId:_.userId}),delete _._stillExist}}catch(g){p.e(g)}finally{p.f()}o.streams.forEach((function(e){var t=i._findRemoteStreamByScreen(e.clientId,e.screen);t?(t.stillExist=!0,t.streamId=e.streamId,l.push(e)):d.push(e)}));var v,f=Jk(tR(n=this._remoteStreams).call(n));try{for(f.s();!(v=f.n()).done;){var m=v.value;Array.isArray(m)&&m.forEach((function(e){e.stillExist?delete e.stillExist:u.push({clientId:e.userId,streamId:e.streamId,message:IV.clientDisconnected})}))}}catch(g){f.e(g)}finally{f.f()}c.forEach((function(e){return i._onUserDisconnection(e)})),s.forEach((function(e){return i._onUserConnection(e)})),u.forEach((function(e){return i._onRemoveStream(e)})),d.forEach((function(e){return i._onAddStream(e,{fromSignal:!1})})),l.forEach((function(e){return i._onUpdateStreamAttributes(e)})),a&&this._handleSendOrRecvStreamAfterReconnect()}},{key:"_handleSendOrRecvStreamAfterReconnect",value:function(){var e,t,r,n,i,o=this;this._localStream&&(this._localStream.clean(),this._localStream.vendorCode=(null===(r=this._mediaServerClient.vendorConfig)||void 0===r?void 0:r.vendorCode)||0,null===(n=this._localStream.observer)||void 0===n||n.setLogin(!0),this._mediaServerClient.publish(this._localStream).catch((function(e){})));this._localScreenStream&&(this._localScreenStream.clean(),null===(i=this._localScreenStream.observer)||void 0===i||i.setLogin(!0),this._mediaServerClient.publish(this._localScreenStream).catch((function(e){})));var a,s=Jk(tR(t=this._remoteStreams).call(t));try{for(s.s();!(a=s.n()).done;){var c=a.value;Array.isArray(c)&&c.forEach(function(){var e=km(Em().mark((function e(t){var r,n,i,a;return Em().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!t.hasSubscribed){e.next=15;break}return t.resetHasSubscribed(),e.prev=2,EG.print(wm(r="start resubscribe ".concat(t.userId," with ")).call(r,t.subMediaType)),e.next=6,o._mediaServerClient.subscribe(t,t.subMediaType);case 6:EG.print(wm(n="success resubscribe ".concat(t.userId," with ")).call(n,t.subMediaType)),o.safeEmit(NV.RESUBSCRIBE,{stream:t}),e.next=15;break;case 10:e.prev=10,e.t0=e.catch(2),EG.print(wm(i=wm(a="failed resubscribe ".concat(t.userId," with ")).call(a,t.subMediaType,", error:")).call(i,e.t0)),t.clean(),null==t||t.resetHasSubscribed();case 15:case"end":return e.stop()}}),e,null,[[2,10]])})));return function(t){return e.apply(this,arguments)}}())}}catch(u){s.e(u)}finally{s.f()}null===(e=this._subtitleTool)||void 0===e||e.reconnect(),this._forwardStreamManager.resumeFromReconnect()}},{key:"_handleFFAudioTrack",value:function(){var e,t,r,n,i=null===(e=this._mediaServerClient)||void 0===e||null===(t=e.handler)||void 0===t?void 0:t.audioTrack4ff,o=null===(r=this._mediaServerClient)||void 0===r||null===(n=r.handler)||void 0===n?void 0:n.getTransceivers();if(i&&Array.isArray(o)){var a=sE(o).call(o,(function(e){var t;return(null==e||null===(t=e.receiver)||void 0===t?void 0:t.track)===i}));if(a){var s=new hV(this._context,"ff-stream","ff-stream",!1,!1,TG);s.virtual=!0,s.audioTransceiver=a,s.audioMid="0",s.audioTrack=DU(i),this._virtualStreams.push(s),this.safeEmit(NV.SUBSCRIBE_PUSH_TRACK,{stream:s})}}}},{key:"_findRemoteStream",value:function(e,t){var r=this._remoteStreams.get(e);return Array.isArray(r)?sE(r).call(r,(function(e){return e.streamId===t})):null}},{key:"_findRemoteStreamByScreen",value:function(e,t){var r=this._remoteStreams.get(e);return Array.isArray(r)?sE(r).call(r,(function(e){return e.isScreen===t})):null}},{key:"_onAddStream",value:function(e){var t,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=r.needEmit,i=void 0===n||n,o=r.fromSignal,a=void 0===o||o,s=r.virtual,c=void 0!==s&&s;if(e.clientId!==(null===(t=this._roomInfo)||void 0===t?void 0:t.userInfo.userId)){var u=this._roomConfig,d=u.isAutoSubscribeAudio,l=u.isAutoSubscribeVideo,h=this._findRemoteStreamByScreen(e.clientId,e.screen);if(h&&h.streamId!==e.streamId){var p,_=null===(p=this._remoteStreams.get(e.clientId))||void 0===p?void 0:Gs(p).call(p,(function(e){return e.streamId!==h.streamId}));h.clean(),this._remoteStreams.set(e.clientId,_||[])}var v=this._findRemoteStream(e.clientId,e.streamId);if(this._remoteStreamStreamIdUserIdMap[e.streamId]=e.clientId,v)v.attributes=e.attributes;else if((v=new hV(this._context,e.clientId,e.streamId,e.screen,!1,e.attributes)).virtual=c,this._initStreamListeners(v),!c){var f=this._remoteStreams.get(e.clientId);f?f.push(v):this._remoteStreams.set(e.clientId,[v])}if(this._mediaServerClient.handler&&(v.observer=new iG(v,this._mediaServerClient.handler)),!v.isScreen&&l){var m,g,y,S,b,E,T,k;if(a&&v.hasVideo)if(v.attributes.extvideo)null===(m=v.observer)||void 0===m||m.setExternalVideoSource(!0),null===(g=v.observer)||void 0===g||g.setPushVideo(!0);else null===(y=v.observer)||void 0===y||y.setExternalVideoSource(!1),null===(S=v.observer)||void 0===S||S.setPublishVideo(!0);if(a&&v.hasAudio&&d&&!this._mediaServerClient.roomAttributes.multiChatMode)if(v.attributes.extaudio)null===(b=v.observer)||void 0===b||b.setExternalAudioSource(!0),null===(E=v.observer)||void 0===E||E.setPushAudio(!0);else null===(T=v.observer)||void 0===T||T.setExternalAudioSource(!1),null===(k=v.observer)||void 0===k||k.setPublishAudio(!0);if(!0===i&&!1===a){var I,R=this._roomConfig,A=R.isAutoSubscribeAudio,C=R.isAutoSubscribeVideo;null===(I=v.observer)||void 0===I||I.setLogin(!0,{audio:!!A&&!this.multiChatMode,video:!!C})}}return i&&this.safeEmit(AV.ON_ADD_STREAM,{stream:v}),v}}},{key:"_onUserConnection",value:function(e){var t;if(e.clientId!==(null===(t=this._roomInfo)||void 0===t?void 0:t.userInfo.userId)){var r=this._userDuplicateLoginTimerMap.get(e.clientId);if("number"==typeof r)return this._userDuplicateLoginTimerMap.delete(e.clientId),void self.clearTimeout(r);var n={userId:e.clientId,extraInfo:e.attributes.extra_info};this._remoteUsers.set(e.clientId,ud({},n)),this.safeEmit(AV.USER_CONNECTION,{userInfo:n}),e.attributes&&(e.attributes.serverMuteVideo&&this.safeEmit(NV.ON_VIDEO_STREAM_BANNED,{uid:e.clientId,banned:1===e.attributes.serverMuteVideo}),e.attributes.serverMuteAudio&&this.safeEmit(NV.ON_AUDIO_STREAM_BANNED,{uid:e.clientId,banned:1===e.attributes.serverMuteAudio}))}}},{key:"_onUserDisconnection",value:function(e){var t,r=this,n=e.clientId,i=e.tag,o=e.code;if(n)if(n===(null===(t=this.roomInfo)||void 0===t?void 0:t.userInfo.userId)){var a=null;i===xV.kickedByAdmin?a=uA.KICKED_OUT:i===xV.onUserTokenDidExpire?a=uA.TOKEN_EXPIRED:i===xV.userDuplicateLogin&&(a=uA.DUPLICATE_LOGIN),o===OV.roomDismissByAdmin&&(a=uA.ROOM_DISMISS),a&&this.safeEmit(NV.ON_ROOM_ERROR,{errorCode:a})}else{var s=hd.DROPPED;i===xV.userLeave?s=hd.QUIT:i===xV.kickedByAdmin?s=hd.KICKED_BY_ADMIN:i===xV.roleChanged&&(s=hd.SWITCH_TO_INVISIBLE);var c=function(){var e;r._remoteUsers.delete(n),null===(e=r._remoteStreams.get(n))||void 0===e||e.forEach((function(e){e.destroy(),r._onRemoveStream({clientId:e.userId,streamId:e.streamId,message:IV.clientDisconnected})})),r._remoteStreams.delete(n),r.safeEmit(NV.ON_USER_LEAVE,{userInfo:{userId:n},reason:s})};if(i===xV.userDuplicateLogin){var u=this._userDuplicateLoginTimerMap.get(n);u&&self.clearTimeout(u);var d=self.setTimeout(c,5e3);this._userDuplicateLoginTimerMap.set(n,d)}else c()}}},{key:"_onRemoveStream",value:function(e){var t,r=this;if(e.clientId!==(null===(t=this._roomInfo)||void 0===t?void 0:t.userInfo.userId)){var n=this._remoteStreams.get(e.clientId);if(n){var i=sE(n).call(n,(function(t){return t.streamId===e.streamId}));if(i){var o,a,s;if(null===(o=this._mediaServerClient)||void 0===o||o.handleRemoveStream(i,e).then((function(){var t=r._remoteStreams.get(e.clientId);t&&(t=Gs(t).call(t,(function(t){return t.streamId!==e.streamId||(t.clean(),!1)})),r._remoteStreams.set(e.clientId,t))})).finally((function(){r.safeEmit(AV.ON_REMOVE_STREAM,{stream:i,reason:e.message}),i.destroy()})),i.hasVideo)null===(a=i.observer)||void 0===a||a.setPublishVideo(!1);if(i.hasAudio&&!this._mediaServerClient.roomAttributes.multiChatMode)null===(s=i.observer)||void 0===s||s.setPublishAudio(!1)}}}}},{key:"_onUpdateUserAttributes",value:function(e){e.attributes&&(e.attributes.serverMuteVideo&&this.safeEmit(NV.ON_VIDEO_STREAM_BANNED,{uid:e.clientId,banned:1===e.attributes.serverMuteVideo}),e.attributes.serverMuteAudio&&this.safeEmit(NV.ON_AUDIO_STREAM_BANNED,{uid:e.clientId,banned:1===e.attributes.serverMuteAudio}))}},{key:"_onUpdateRoomAttributes",value:function(e){var t;e.roomAttributes&&(this._mediaServerClient.roomAttributes=ud(ud({},this._mediaServerClient.roomAttributes),e.roomAttributes)),null!==(t=e.roomAttributes)&&void 0!==t&&t.multiChatMode&&this._handleFFAudioTrack()}},{key:"_onUpdateStreamAttributes",value:function(e){var t=this._roomConfig,r=t.isAutoSubscribeAudio,n=t.isAutoSubscribeVideo,i=e.clientId,o=e.streamId,a=e.attributes,s=this._findRemoteStream(i,o);if(s){var c,u,d=s.attributes,l=ud(ud({},d),a),h=!1,p=l.localaudio!==d.localaudio,_=!1,v=!1,f=l.localvideo!==d.localvideo,m=!1,g=zU.NONE,y=zU.NONE;if(l.audiostream!==d.audiostream&&(h=l.localaudio,_=!!l.audiostream,l.audiostream?g|=Sd.AUDIO:y|=Sd.AUDIO),l.videostream!==d.videostream&&(v=l.localvideo,m=!!l.videostream,l.videostream?g|=Sd.VIDEO:y|=Sd.VIDEO),g&&this.safeEmit(NV.ON_USER_PUBLISH_STATE_CHANGE,{userId:i,mediaType:g,isScreen:s.isScreen,pubState:UV.PUB,remoteStream:s}),y&&this.safeEmit(NV.ON_USER_PUBLISH_STATE_CHANGE,{userId:i,mediaType:y,isScreen:s.isScreen,pubState:UV.UNPUB,remoteStream:s}),s.attributes=l,l.localaudio!==d.localaudio)if(l.localaudio){var S,b,E,T;if(r&&l.audiostream)if(l.extaudio)null===(S=s.observer)||void 0===S||S.setExternalAudioSource(!0),null===(b=s.observer)||void 0===b||b.setPushAudio(!0);else null===(E=s.observer)||void 0===E||E.setExternalAudioSource(!1),null===(T=s.observer)||void 0===T||T.setEnableAudio(!0);this.safeEmit(NV.ON_USER_START_AUDIO_CAPTURE,{userId:i},s)}else{var k,I,R,A;if(l.extaudio)null===(k=s.observer)||void 0===k||k.setExternalAudioSource(!0),null===(I=s.observer)||void 0===I||I.setPushAudio(!1);else null===(R=s.observer)||void 0===R||R.setExternalAudioSource(!1),null===(A=s.observer)||void 0===A||A.setEnableAudio(!1);!s.isScreen&&this.safeEmit(NV.ON_USER_STOP_AUDIO_CAPTURE,{userId:i})}if(l.localvideo!==d.localvideo)if(l.localvideo){var C,w,x,O;if(n&&l.videostream)if(l.extvideo)null===(C=s.observer)||void 0===C||C.setExternalVideoSource(!0),null===(w=s.observer)||void 0===w||w.setPushVideo(!0);else null===(x=s.observer)||void 0===x||x.setExternalVideoSource(!1),null===(O=s.observer)||void 0===O||O.setEnableVideo(!0);this.safeEmit(NV.ON_USER_START_VIDEO_CAPTURE,{userId:i})}else{var P,D,M,N;if(l.extvideo)null===(P=s.observer)||void 0===P||P.setExternalVideoSource(!0),null===(D=s.observer)||void 0===D||D.setPushVideo(!1);else null===(M=s.observer)||void 0===M||M.setExternalVideoSource(!1),null===(N=s.observer)||void 0===N||N.setEnableVideo(!1);!s.isScreen&&this.safeEmit(NV.ON_USER_STOP_VIDEO_CAPTURE,{userId:i})}if(h&&!p)null===(c=s.observer)||void 0===c||c.setRemoteUnmuteAudio(_);if(v&&!f)null===(u=s.observer)||void 0===u||u.setRemoteUnmuteVideo(m)}}},{key:"_onPushTrack",value:function(e){var t,r=this;if(null!==(t=e.streamId)&&void 0!==t&&cA(t).call(t,"audio_mux")){var n=this._onAddStream(ud(ud({},e),{},{attributes:TG}),{needEmit:!1,fromSignal:!1,virtual:!0});n&&this._mediaServerClient.subscribe4pushTrack(n,e).then((function(){r.safeEmit(NV.SUBSCRIBE_PUSH_TRACK,{stream:n}),r._virtualStreams.push(n)})).catch((function(e){EG.print("subscribe","push track failed %o",e)}))}else{var i,o;null===(i=this._monitor)||void 0===i||i.report("rtc_error",{message:wm(o="onPushTrack, userId: ".concat(e.clientId,", ")).call(o,e.streamId),error_code:GV.TRACK_ERROR})}}},{key:"_onRemoveTrack",value:function(e){var t,r=e.clientId,n=e.streamId,i=e.message,o=e.trackType;EG.print("_onRemoveTrack","remove track: %o",r);var a=this._findRemoteStream(r,n);a&&(null===(t=this._mediaServerClient)||void 0===t||t.unsubscribe4removeTrack(a,i,o),this.emit(NV.REMOVE_PUSH_TRACK,{stream:a,mediaType:o+1}))}},{key:"_onMeetingSpeakerChange",value:function(e){if(Array.isArray(null==e?void 0:e.speakerCsrcInfo)){var t={};null==e||e.speakerCsrcInfo.forEach((function(e){var r=e.csrc,n=e.userId;e.isScreen||(t[r]=n)})),this._csrcUserIdMap=t}Array.isArray(e.muxStreamInUse)&&this._virtualStreams.forEach((function(t){var r;null!==(r=e.muxStreamInUse)&&void 0!==r&&vT(r).call(r,t.streamId)?t.virtualOccupy=!0:t.virtualOccupy=!1}))}},{key:"getActiveSpeakerInMultiChatMode",value:function(){var e=this,t=[];return this._virtualStreams.forEach((function(r){var n,i=null===(n=r.audioTransceiver)||void 0===n?void 0:n.receiver;if(i){var o=Qk(i.getContributingSources()||[],1)[0];if(o){var a=o.audioLevel,s=o.source;e._csrcUserIdMap[s]&&t.push({userId:e._csrcUserIdMap[s],audioLevel:a})}}})),t.length&&VR(t).call(t,(function(e,t){return e.audioLevel-t.audioLevel})),t}},{key:"_onReconnecting",value:function(){var e,t,r,n,i=this,o=Jk(tR(r=this._remoteStreams).call(r));try{for(o.s();!(n=o.n()).done;){var a=n.value;Array.isArray(a)&&a.forEach((function(e){return e.clean()}))}}catch(s){o.e(s)}finally{o.f()}this._virtualStreams.forEach((function(e){i.emit(NV.REMOVE_PUSH_TRACK,{stream:e,mediaType:Sd.AUDIO}),e.clean()})),this._virtualStreams=[],null===(e=this.localStream)||void 0===e||e.clean(),null===(t=this.localScreenStream)||void 0===t||t.clean()}},{key:"_onConnectionStateChange",value:function(e){var t,r=this;if(e.next===Yj.DISCONNECTED)t=Ed.CONNECTION_STATE_DISCONNECTED;else if(e.next===Yj.CONNECTED)clearTimeout(this._connectionLostTimer),t=this._mediaServerClient.isReconnecting?Ed.CONNECTION_STATE_RECONNECTED:Ed.CONNECTION_STATE_CONNECTED;else{if(e.next!==Yj.CONNECTING)return;this._mediaServerClient.isReconnecting?(t=Ed.CONNECTION_STATE_RECONNECTING,this._onReconnecting()):t=Ed.CONNECTION_STATE_CONNECTING}e.prev===Yj.CONNECTED&&e.next===Yj.DISCONNECTED&&(this._connectionLostTimer=window.setTimeout((function(){r.safeEmit(wV.ON_CONNECTION_STATE_CHANGE,{state:Ed.CONNECTION_STATE_LOST})}),1e4)),this._networkQualityManager.setConnectionState(e.next),this.safeEmit(wV.ON_CONNECTION_STATE_CHANGE,{state:t})}},{key:"_initStreamListeners",value:function(e){var t=this;e.on("ontrack",(function(e){e.track})),e.on("onSEIMessage",(function(r){var n;t.emit(NV.ON_SEI_MESSAGED_RECEIVED,{sei:r,remoteStreamKey:{userId:e.userId,roomId:null===(n=t._roomInfo)||void 0===n?void 0:n.roomId,streamIndex:e.isScreen?yd.STREAM_INDEX_SCREEN:yd.STREAM_INDEX_MAIN}})}))}},{key:"_onCustomMessage",value:function(e){this.safeEmit(AV.ON_CUSTOM_MESSAGE,e)}},{key:"_onUserMessageReceived",value:function(e){this.safeEmit(AV.USER_MESSAGE_RECEIVED,{userId:e.from,message:e.msg})}},{key:"_onUserBinaryMessageReceived",value:function(e){var t,r={userId:e.from,message:e.msg};null!==(t=this._subtitleTool)&&void 0!==t&&t.onMessageRecv(r)||this.safeEmit(AV.USER_BINARY_MESSAGE_RECEIVED,r)}},{key:"_initSubtitleTool",value:function(){var e=this;this._subtitleTool=new _G(this),this._subtitleTool.onEvent=function(t){e.emit(NV.ON_SUBTITLE_STATE_CHANGED,t)},this._subtitleTool.onMessage=function(t){e.emit(NV.ON_SUBTITLE_MESSAGE_RECEIVED,t)}}},{key:"_onPostProcessingMessage",value:function(e){if(e.body)if("subtitleCallback"!==e.type){var t=e.body,r=t.error||0,n=LV.START,i=["success","parameter error","subscription timeout","ffmpeg error","cdn error","publish error"];if("2.0"===t.protocol){switch(t.eventType){case"TranscodeStarted":0!==t.error&&(n=LV.START_FAILED);break;case"TranscodeStateChanged":n=0!==t.error?LV.START_FAILED:LV.START_SUCCESS;break;case"TranscodeStopped":n=0!==t.error?LV.STOP_FAILED:LV.STOP_SUCCESS;break;case"TranscodeUpdated":n=0!==t.error?LV.UPDATE_FAILED:LV.UPDATE_SUCCESS}this.safeEmit(AV.POST_PROCESSING_MESSAGE,{code:r,protocol:t.protocol,error:t.error,eventType:n,message:i[r]})}this.safeEmit(AV.POST_PROCESSING_MESSAGE,{code:r,message:i[r],type:e.type})}else{var o;null===(o=this._subtitleTool)||void 0===o||o.onResult(e)}}},{key:"_onUserTokenWillExpire",value:function(){this.safeEmit(AV.ON_USER_TOKEN_WILL_EXPIRE,null)}},{key:"_onStreamFailed",value:(r=km(Em().mark((function e(t){var r,n,i,o,a,s,c,u,d,l;return Em().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if("publish"!==t.type){e.next=11;break}if(s=void 0,(null===(r=this.localStream)||void 0===r?void 0:r.streamId)===t.streamId?s=this.localStream:(null===(n=this.localScreenStream)||void 0===n?void 0:n.streamId)===t.streamId&&(s=this.localScreenStream),s){e.next=5;break}return e.abrupt("return");case 5:return null===(i=s)||void 0===i||i.clean(),e.next=8,null===(o=this._mediaServerClient)||void 0===o?void 0:o.unpublish(s).catch((function(){}));case 8:null===(a=this._mediaServerClient)||void 0===a||a.publish(s).catch((function(){})),e.next=20;break;case 11:if("subscribe"!==t.type){e.next=20;break}if(c=this._remoteStreamStreamIdUserIdMap[t.streamId],!(u=this._findRemoteStream(c,t.streamId))){e.next=20;break}return e.next=17,null===(d=this._mediaServerClient)||void 0===d?void 0:d.unsubscribe(u,Sd.AUDIO_AND_VIDEO);case 17:return e.next=19,null===(l=this._mediaServerClient)||void 0===l?void 0:l.subscribe(u,u.subMediaType,u.subLayer);case 19:this.safeEmit(NV.RESUBSCRIBE,{stream:u});case 20:case"end":return e.stop()}}),e,this)}))),function(e){return r.apply(this,arguments)})},{key:"_onStreamControlMessage",value:function(e){var t,r;e.type===RV.PushLimitWarn&&(null!==(t=this._localStream)&&void 0!==t&&t.pubAudio||null!==(r=this._localStream)&&void 0!==r&&r.pubVideo||this.unpublish())}},{key:"_onPublishOnDemand",value:(t=km(Em().mark((function e(){var t,r,n,i,o,a,s,c,u,d,l,h,p,_;return Em().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!this._publishOnDemandBusy&&!1!==(null===(t=this._serverConfig)||void 0===t||null===(r=t.engine_VPM)||void 0===r||null===(n=r.ondemand)||void 0===n?void 0:n.enable)){e.next=2;break}return e.abrupt("return");case 2:if(a=this._publishOnDemandItem,this._publishOnDemandItem=void 0,a){e.next=6;break}return e.abrupt("return");case 6:if(null===(i=this._localStream)||void 0===i||!i.enableSimulcast||null===(o=this._localStream)||void 0===o||!o.videoTransceiver){e.next=16;break}return u=[],this._publishOnDemandBusy=!0,d=null===(s=this._localStream)||void 0===s?void 0:s.stream.id,l=null===(c=this._localStream)||void 0===c?void 0:c.videoTransceiver.sender,h=l.getParameters(),Array.isArray(h.encodings)&&Array.isArray(a)&&(_={},EG.print("_onPublishOnDemand exec","usedDescriptions: %o",a),a.forEach((function(e){var t;if(null!=e&&null!==(t=e.StreamIds)&&void 0!==t&&vT(t).call(t,d)){var r=null==e?void 0:e.Metadata.VideoIndex;_[r]=!0}})),h.encodings=JE(p=h.encodings).call(p,(function(e){if(e.rid){_[e.rid]?e.active=!0:e.active=!1;var t=+e.rid;u[t]=e.active}return e})),this._context&&(this._context.activeSimStreams=u)),e.next=15,l.setParameters(h);case 15:this._publishOnDemandBusy=!1;case 16:this._onPublishOnDemand();case 17:case"end":return e.stop()}}),e,this)}))),function(){return t.apply(this,arguments)})},{key:"_onRTT",value:function(e){var t=e.StreamIds,r=e.Metadata;if(t.length&&r){var n,i=t[0];null!==(n=this._context)&&void 0!==n&&n.streamRTT&&(this._context.streamRTT[i]={audio:r.audio_rtt,video:r.video_rtt})}}},{key:"_onSSC",value:function(e){var t=e.StreamIds,r=e.Metadata,n=t[0],i=this._remoteStreamStreamIdUserIdMap[n],o=this._findRemoteStream(i,n),a={userId:i,isScreen:!!o&&o.isScreen,beforeVideoIndex:r.ssc_items[0].prev_layer_id,afterVideoIndex:r.ssc_items[0].cur_layer_id,beforeEnable:0!==r.ssc_items[0].prev_video_open,afterEnable:0!==r.ssc_items[0].cur_video_open,reason:r.ssc_items[0].change_reason};this.emit(NV.ON_SIMULCAST_SUBSCRIBE_FALLBACK,a)}},{key:"_reportNetworkQuality",value:function(e,t){this.emit(NV.ON_NETWORK_QUALITY,e,t)}},{key:"_emitVideoSizeChange",value:function(e,t,r,n){var i;this.emit(NV.ON_REMOTE_VIDEO_SIZE_CHANGED,{roomId:null===(i=this.roomInfo)||void 0===i?void 0:i.roomId,userId:e,streamIndex:t?yd.STREAM_INDEX_SCREEN:yd.STREAM_INDEX_MAIN},{width:r,height:n})}},{key:"multiChatMode",get:function(){var e;return null===(e=this._mediaServerClient)||void 0===e?void 0:e.multiChatMode()}}]),x}(bD),IG=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},r=document.createElement(e);return t.id&&(r.id=t.id),t.classList&&t.classList.forEach((function(e){r.classList.add(e)})),t.style&&fb(r.style,t.style),t.attributes&&SA(t.attributes).forEach((function(e){var t=Qk(e,2),n=t[0],i=t[1];"muted"===n?r.muted=!0:r.setAttribute(n,i)})),r},RG=new uO("Player",0),AG=["play","playing","pause","ended","error","seeking","seeked","waiting","canplay","canplaythrough","durationchange","volumechange","loadedmetadata","loadeddata","loadstart","timeupdate"],CG={playsinline:"","webkit-playsinline":""},wG={playsinline:"","webkit-playsinline":"","x5-playsinline":"","x5-video-player-type":"h5","x-webkit-airplay":"allow",preload:"",muted:""},xG=function(e){xI(n,e);var t,r=WI(n);function n(e,t){var i;Yd(this,n),sd(Zk(i=r.call(this)),"_containerDom",void 0),sd(Zk(i),"_videoDom",void 0),sd(Zk(i),"__cumulativeTime",void 0),sd(Zk(i),"userId",void 0),sd(Zk(i),"renderMode",void 0),sd(Zk(i),"mirrorType",Td.MIRROR_TYPE_NONE),sd(Zk(i),"isScreen",void 0),sd(Zk(i),"isLocal",void 0),sd(Zk(i),"played",!1),sd(Zk(i),"_needLoad",!1),sd(Zk(i),"_emitPlayFailed",!1),sd(Zk(i),"_videoContainer",void 0),sd(Zk(i),"_safari15VideoTimer",void 0),sd(Zk(i),"_monitor",void 0),sd(Zk(i),"_onLocalTrackMute",void 0),sd(Zk(i),"_onInterruptionEnd",void 0),sd(Zk(i),"_needResume",!1),sd(Zk(i),"emitVideoEvent",(function(e){var t,r,n={type:"video",rawEvent:e,readyState:(null===(t=i._videoDom)||void 0===t?void 0:t.readyState)||0,userId:i.userId,eventName:e.type,currentTime:(null===(r=i._videoDom)||void 0===r?void 0:r.currentTime)||0,isScreen:i.isScreen};switch(i.emit("playback_event",n),e.type){case"canplay":case"loadeddata":i._internalPlay();break;case"playing":RG.print("VideoPlayerPlaying","[userId-".concat(i.userId,"] video element playing"));break;case"pause":RG.print("VideoPlayerPause","[userId-".concat(i.userId,"] video element pause")),i._needResume&&(RG.print("VideoPlayerPause","[userId-".concat(i.userId,"] video element resume")),i._internalPlay(),i._needResume=!1)}})),sd(Zk(i),"_internalPlay",(function(){var e;if(null!==(e=i._videoDom)&&void 0!==e&&e.paused){var t=i._videoDom.play();null!=t&&t.then&&t.then((function(){var e;i.isLocal&&uP&&!i._needLoad&&(null===(e=i._videoDom)||void 0===e||e.load(),i._needLoad=!0)})).catch((function(e){var t,r,n,o,a,s;i._emitPlayFailed||("AbortError"!==e.name?(i._emitPlayFailed=!0,null===(t=i._monitor)||void 0===t||t.report("rtc_error",{message:wm(r="video autoplay failed, userId: ".concat(i.userId,", ")).call(r,e.name),error_code:GV.AUTOPLAY_FAILED}),i.emit("playback_event",{type:"video",rawEvent:e,readyState:(null===(n=i._videoDom)||void 0===n?void 0:n.readyState)||0,userId:i.userId,eventName:"autoplay-error",currentTime:(null===(o=i._videoDom)||void 0===o?void 0:o.currentTime)||0,isScreen:i.isScreen})):null===(a=i._monitor)||void 0===a||a.report("rtc_error",{message:wm(s="video autoplay failed, userId: ".concat(i.userId,", ")).call(s,e.name),error_code:GV.AUTOPLAY_FAILED}))}))}})),i.engineId=e;var o=t.renderDom;i._monitor=EO(e);var a=t.userId,s=t.isScreen?gd.RENDER_MODE_FIT:gd.RENDER_MODE_HIDDEN;i.renderMode=void 0!==t.renderMode?t.renderMode:s;var c="string"==typeof o?document.getElementById(o):o;if(!c)throw new lA(uA.CANT_FIND_DOM,"can't find dom");return i._videoContainer=document.createElement("div"),i._videoContainer.style.width="100%",i._videoContainer.style.height="100%",i._videoContainer.style.position="relative",i._videoContainer.style.overflow="hidden",i._containerDom=c,i.userId=a,i.isLocal=!!t.isLocal,i.isScreen=!!t.isScreen,i._initVideo(),i}return qd(n,[{key:"_initVideo",value:function(){var e,t=this;this._videoDom||(this._videoDom=IG("video",{style:{width:"100%",height:"100%"},attributes:wG}),this._videoDom.id=wm(e="".concat(this.userId,"_")).call(e,xO()),this.setRenderMode(this.renderMode),this.mirror(this.mirrorType===Td.MIRROR_TYPE_RENDER));this._videoContainer.appendChild(this._videoDom),this._containerDom.appendChild(this._videoContainer),this._initListeners(),this._onLocalTrackMute=function(){t._needResume=!0},this._onInterruptionEnd=function(){RG.print("resume player after iOS interruption"),t._internalPlay()},ZL.on(JL.ON_IOS_LOCAL_TRACK_MUTE,this._onLocalTrackMute),ZL.on(JL.ON_IOS_LOCAL_TRACK_UNMUTE,this._onInterruptionEnd),ZL.on(JL.ON_IOS_INTERRUPTION_END,this._onInterruptionEnd)}},{key:"_initListeners",value:function(){var e=this;this._videoDom&&AG.forEach((function(t){var r;null===(r=e._videoDom)||void 0===r||r.addEventListener(t,e.emitVideoEvent)}))}},{key:"_removeListeners",value:function(){var e=this;this._videoDom&&AG.forEach((function(t){var r;null===(r=e._videoDom)||void 0===r||r.removeEventListener(t,e.emitVideoEvent)}))}},{key:"_recordFrame",value:function(e){var t=this,r=e.isScreen?1.5:.55;if(sP){var n;if(null===(n=this._videoDom)||void 0===n||!n.requestVideoFrameCallback)return;this._videoDom.requestVideoFrameCallback((function n(i,o){var a=o.presentationTime;if(e.recordedVideoFrames||(e.recordedVideoFrames=[]),t.__cumulativeTime){var s,c=(a-t.__cumulativeTime)%2e3,u=c>1e3*r;null===(s=e.recordedVideoFrames)||void 0===s||s.push({playTime:a,isStall:u,stallCount:u?1:0,stallDuration:c})}t.__cumulativeTime=a,t._videoDom.requestVideoFrameCallback(n)}))}else this.on("playback_event",(function(n){var i;if("timeupdate"===n.eventName){if(0===(null===(i=t._videoDom)||void 0===i?void 0:i.currentTime))return;if(void 0===t.__cumulativeTime)return void(t.__cumulativeTime=t._videoDom.currentTime);if(e.recordedVideoFrames||(e.recordedVideoFrames=[]),t._videoDom.currentTime>t.__cumulativeTime){var o=Math.floor(1e3*(t._videoDom.currentTime-t.__cumulativeTime)),a=t._videoDom.currentTime-t.__cumulativeTime>r;e.recordedVideoFrames.push({playTime:t._videoDom.currentTime,isStall:a,stallCount:a?1:0,stallDuration:o%2e3})}t.__cumulativeTime=t._videoDom.currentTime}}))}},{key:"_recordPause",value:function(e){var t=this;void 0===e.statsReport.isPaused&&this.on("playback_event",(function(r){if("pause"===r.eventName)e.statsReport.isPaused=!0,e.statsReport.pauseStart=OO();else if("timeupdate"===r.eventName){var n;if((null===(n=t._videoDom)||void 0===n||!n.paused)&&e.statsReport.isPaused){e.statsReport.isPaused=!1;var i=OO()-(e.statsReport.pauseStart||0);i>500&&(e.statsReport.pauseDuration+=i)}}}))}},{key:"setRenderMode",value:function(e){this.renderMode=e,this._videoDom&&(this.renderMode===gd.RENDER_MODE_FIT?this._videoDom.style.objectFit="contain":this.renderMode===gd.RENDER_MODE_FILL?this._videoDom.style.objectFit="fill":this._videoDom.style.objectFit="cover")}},{key:"playVideo",value:(t=km(Em().mark((function e(t,r){var n,i,o,a,s=this;return Em().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(o=this._videoDom,RG.print("playVideo","play video track: ".concat(this.userId)),!(o&&o.srcObject instanceof MediaStream&&o.srcObject.getTrackById(null===(n=t.getTrack())||void 0===n?void 0:n.id))){e.next=5;break}try{IO(this.engineId,"playVideo","play video repeatedly",0,this.userId)}catch(HX){}return e.abrupt("return");case 5:o||(this._initVideo(),o=this._videoDom),RG.print("playVideo","play video by dom: ".concat(null===(i=o)||void 0===i?void 0:i.id)),(a=new MediaStream).addTrack(t.getTrack("preprocessing")),o.srcObject=a,o&&!this._containerDom.contains(this._videoContainer)&&this._containerDom.appendChild(this._videoContainer),o&&!this._videoContainer.contains(o)&&this._videoContainer.appendChild(o),setTimeout((function(){return s._internalPlay()})),r&&zP.VIDEO_STALL&&(this._recordFrame(r),this._recordPause(r),r.statsReport.player=this),this.played=!0;case 15:case"end":return e.stop()}}),e,this)}))),function(e,r){return t.apply(this,arguments)})},{key:"updateSrcObject",value:function(e){var t=e.getTrack();if(t&&this._videoDom){var r=new MediaStream;r.addTrack(t),this._videoDom.srcObject=r}}},{key:"removeTrack",value:function(){var e,t=null===(e=this._videoDom)||void 0===e?void 0:e.srcObject;if(t){var r=t.getVideoTracks();null!=r&&r.length&&r.forEach((function(e){t.removeTrack(e)}))}}},{key:"manuallyPlay",value:function(){if(RG.print("Invoke VideoPlayer.manuallyPlay",this.userId,this.isScreen),this._emitPlayFailed=!1,!this._videoDom)throw new lA(uA.INVALID_PARAMS,"Player not found");return 0!==this._videoDom.readyState||fP?this._videoDom.play():Wf.resolve()}},{key:"mirror",value:function(e){var t;RG.print("mirror",wm(t="".concat(this.userId," set mirror: ")).call(t,e)),this.mirrorType=e?Td.MIRROR_TYPE_RENDER:Td.MIRROR_TYPE_NONE,this._videoDom&&(this._videoDom.style.transform=e?"rotateY(180deg)":"")}},{key:"stop",value:function(){var e,t=arguments.length>0&&void 0!==arguments[0]&&arguments[0],r=this._containerDom;(RG.print("stop","stop video track: ".concat(this.userId)),this._videoDom)&&(t||(this._videoDom.srcObject=null),null!=r&&r.contains(this._videoContainer)&&r.removeChild(this._videoContainer),null!==(e=this._videoContainer)&&void 0!==e&&e.contains(this._videoDom)&&this._videoContainer.removeChild(this._videoDom));this.__cumulativeTime=void 0,this.played=!1}},{key:"destroy",value:function(){var e=arguments.length>0&&void 0!==arguments[0]&&arguments[0];RG.print("destroy","video player: ".concat(this.userId)),this.stop(e),CI(RI(n.prototype),"removeAllListeners",this).call(this),this._removeListeners(),ZL.off(JL.ON_IOS_LOCAL_TRACK_MUTE,this._onLocalTrackMute),ZL.off(JL.ON_IOS_LOCAL_TRACK_UNMUTE,this._onInterruptionEnd),ZL.off(JL.ON_IOS_INTERRUPTION_END,this._onInterruptionEnd),this._videoDom&&delete this._videoDom,this._safari15VideoTimer&&(window.clearInterval(this._safari15VideoTimer),this._safari15VideoTimer=void 0)}},{key:"domElement",get:function(){return this._videoDom}}]),n}(gD.exports.EventEmitter),OG=function(e){xI(i,e);var t,r,n=WI(i);function i(e,t){var r,o=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{divId:void 0,muted:!1,isScreen:!1},a=o.divId,s=o.muted,c=o.isScreen;if(Yd(this,i),sd(Zk(r=n.call(this)),"_containerDom",void 0),sd(Zk(r),"_audioDom",void 0),sd(Zk(r),"_fakeAudioDom",void 0),sd(Zk(r),"userId",void 0),sd(Zk(r),"muted",!1),sd(Zk(r),"_emitPlayFailed",!1),sd(Zk(r),"played",!1),sd(Zk(r),"isScreen",void 0),sd(Zk(r),"_wechatTimer",void 0),sd(Zk(r),"_edgeTimer",void 0),sd(Zk(r),"_monitor",void 0),sd(Zk(r),"_pasued",!0),sd(Zk(r),"emitAudioEvent",(function(e){var t,n,i={type:"audio",rawEvent:e,readyState:(null===(t=r._audioDom)||void 0===t?void 0:t.readyState)||0,userId:r.userId,eventName:e.type,currentTime:(null===(n=r._audioDom)||void 0===n?void 0:n.currentTime)||0};"playing"===e.type&&RG.print("AudioPlayerPlaying","[userId-".concat(r.userId,"] audio element playing")),"pause"===e.type&&(RG.print("AudioPlayerPause","[userId-".concat(r.userId,"] audio element pause")),r._pasued||r._internalPlay()),yP&&fP&&("canplay"===e.type?(clearTimeout(r._wechatTimer),r._wechatTimer=window.setTimeout((function(){r._autoPlayError("wechat")}),500)):"playing"===e.type&&clearTimeout(r._wechatTimer)),mP&&pP&&"error"===e.type&&(clearTimeout(r._edgeTimer),r._edgeTimer=window.setTimeout((function(){var e;0===(null===(e=r._audioDom)||void 0===e?void 0:e.currentTime)&&r._autoPlayError("edge")}),500)),r.emit("playback_event",i)})),sd(Zk(r),"_internalPlay",(function(){var e,t;if(IO(r.engineId,"_internalPlay",{paused:null===(e=r._audioDom)||void 0===e?void 0:e.paused}),null!==(t=r._audioDom)&&void 0!==t&&t.paused)try{var n,i=r._audioDom.play(),o=rU.getAudioContextInstance();if("suspended"===o.state){var a=o.resume(),s=setTimeout((function(){var e;"suspended"===o.state&&(r._autoPlayError("AudioContext cannot resume"),null===(e=r._monitor)||void 0===e||e.report("rtc_error",{message:"audio autoplay failed, userId: ".concat(r.userId,": Cannot resume the AudioContext"),error_code:GV.AUTOPLAY_FAILED}));clearTimeout(s)}));a.then((function(){clearTimeout(s)}))}null!==(n=i)&&void 0!==n&&n.then&&(yP&&mP&&(i=i.then((function(){return new Wf((function(e){setTimeout(km(Em().mark((function t(){var n;return Em().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return null===(n=r._audioDom)||void 0===n||n.pause(),r._audioDom.volume=1,t.next=4,r._audioDom.play();case 4:e();case 5:case"end":return t.stop()}}),t)}))),500)}))}))),i.then((function(){IO(r.engineId,"_internalPlay successfully",{userId:r.userId}),r._pasued=!1})).catch((function(e){var t,n,i;r._autoPlayError(e),null===(t=r._monitor)||void 0===t||t.report("rtc_error",{message:wm(n=wm(i="audio autoplay failed, userId: ".concat(r.userId,": ")).call(i,e.message," ")).call(n,e.name),error_code:GV.AUTOPLAY_FAILED})})))}catch(l){var c,u,d;r._autoPlayError(l),null===(c=r._monitor)||void 0===c||c.report("rtc_error",{message:wm(u=wm(d="audio autoplay failed, userId: ".concat(r.userId,": ")).call(d,l.message," ")).call(u,l.name),error_code:GV.AUTOPLAY_FAILED})}})),r.engineId=e,a){var u=document.getElementById(a);if(!u)throw new lA(uA.CANT_FIND_DOM,"can't find dom");r._containerDom=u}else r._containerDom=document.body;return r.userId=t,r.muted=s,r.isScreen=c,r._monitor=EO(e),r._initAudio(),r}return qd(i,[{key:"_initAudio",value:function(){var e;this._audioDom||(this._audioDom=IG("audio",{style:{display:"none"},attributes:CG}),this._audioDom.volume=this.muted?0:1,this._audioDom.muted=this.muted,this._audioDom.id=wm(e="".concat(this.userId,"_")).call(e,xO()),this._containerDom.appendChild(this._audioDom));this._initListeners()}},{key:"_initListeners",value:function(){var e=this;this._audioDom&&AG.forEach((function(t){var r;null===(r=e._audioDom)||void 0===r||r.addEventListener(t,e.emitAudioEvent)}))}},{key:"_removeListeners",value:function(){var e=this;this._audioDom&&(AG.forEach((function(t){var r;null===(r=e._audioDom)||void 0===r||r.removeEventListener(t,e.emitAudioEvent)})),this._audioDom.removeEventListener("canplay",this._internalPlay),this._audioDom.removeEventListener("loadeddata",this._internalPlay))}},{key:"playAudio",value:(r=km(Em().mark((function e(t){var r,n,i,o,a,s=this;return Em().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(RG.print("playAudio","play audio track: ".concat(this.userId)),!((o=this._audioDom)&&o.srcObject instanceof MediaStream&&o.srcObject.getTrackById(null===(r=t.getTrack())||void 0===r?void 0:r.id))){e.next=4;break}return e.abrupt("return");case 4:o||(this._initAudio(),o=this._audioDom),a=new MediaStream,t instanceof HU?(this._fakeAudioDom=new Audio,this._fakeAudioDom.muted=!0,this._fakeAudioDom.srcObject=new MediaStream([t.getOrgTrack()]),a.addTrack(t.getTrack())):a.addTrack(t.getTrack("preprocessing")),yP&&mP&&(this._audioDom.volume=0),o.srcObject=a,null===(n=o)||void 0===n||n.addEventListener("canplay",this._internalPlay),null===(i=o)||void 0===i||i.addEventListener("loadeddata",this._internalPlay),setTimeout((function(){return s._internalPlay()})),this.played=!0;case 13:case"end":return e.stop()}}),e,this)}))),function(e){return r.apply(this,arguments)})},{key:"_autoPlayError",value:function(e){var t,r;this._emitPlayFailed||(this._emitPlayFailed=!0,this.emit("playback_event",{type:"audio",rawEvent:e,readyState:(null===(t=this._audioDom)||void 0===t?void 0:t.readyState)||0,userId:this.userId,eventName:"autoplay-error",currentTime:(null===(r=this._audioDom)||void 0===r?void 0:r.currentTime)||0}))}},{key:"pause",value:function(){if(!this._audioDom)throw new lA(uA.INVALID_PARAMS,"Player not found");this._pasued=!0,this._audioDom.pause()}},{key:"manuallyPlay",value:function(){var e,t=this;if(RG.print("Invoke AudioPlayer.manuallyPlay"),this._emitPlayFailed=!1,!this._audioDom)throw new lA(uA.INVALID_PARAMS,"Player not found");if(!this.played)return Wf.resolve();this._audioDom.volume=1,this._audioDom.muted=!1,null===(e=this._fakeAudioDom)||void 0===e||e.play();var r=[],n=this._audioDom.play();null!=n&&n.then&&r.push(n);var i=rU.getAudioContextInstance();if("suspended"===i.state){var o=i.resume();null!=o&&o.then&&r.push(o)}(r.length>0?Wf.all(r):Wf.resolve(n)).then((function(){t._pasued=!1}))}},{key:"setPlaybackDevice",value:(t=km(Em().mark((function e(t){var r,n;return Em().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return RG.print("setPlaybackDevice","setPlaybackDevice: ".concat(t)),e.next=3,qL.enumerateAudioPlaybackDevices();case 3:if(r=e.sent,n=JE(r).call(r,(function(e){return e.deviceId})),vT(n).call(n,t)&&this._audioDom&&this._audioDom.setSinkId){e.next=7;break}return e.abrupt("return");case 7:return e.next=9,this._audioDom.setSinkId(t);case 9:case"end":return e.stop()}}),e,this)}))),function(e){return t.apply(this,arguments)})},{key:"stop",value:function(){var e=this._containerDom;RG.print("stopAudio","stop audio track: ".concat(this.userId)),this._audioDom&&(this._audioDom.srcObject=null,null!=e&&e.contains(this._audioDom)&&e.removeChild(this._audioDom)),this._fakeAudioDom&&(this._fakeAudioDom.srcObject=null,this._fakeAudioDom=void 0),this.played=!1}},{key:"domElement",get:function(){return this._audioDom}},{key:"destroy",value:function(){RG.print("destroy","audio player: ".concat(this.userId)),this.stop(),CI(RI(i.prototype),"removeAllListeners",this).call(this),this._removeListeners(),this._audioDom&&(this._audioDom.srcObject=null,delete this._audioDom),this._edgeTimer&&clearTimeout(this._edgeTimer)}}]),i}(gD.exports.EventEmitter);function PG(e,t,r,n){var i=function(){var e=km(Em().mark((function e(t,i){var o,a;return Em().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(o=null==n?void 0:n.get(i),Array.isArray(o)&&(o=null===(a=o)||void 0===a?void 0:sE(a).call(a,(function(e){return e.isScreen===r}))),!t){e.next=9;break}if(!t.played){e.next=8;break}return e.next=6,t.manuallyPlay();case 6:e.next=9;break;case 8:o&&(t instanceof xG&&o.videoTrack&&t.playVideo(o.videoTrack,o),t instanceof OG&&o.audioTrack&&t.playAudio(o.audioTrack));case 9:case"end":return e.stop()}}),e)})));return function(t,r){return e.apply(this,arguments)}}();if(t)return i(e.get(t),t);var o=[];return e.forEach((function(e,t){return o.push(i(e,t))})),Wf.all(o)}var DG=i,MG=lt("iterator"),NG=!DG((function(){var e=new URL("b?a=1&b=2&c=3","http://a"),t=e.searchParams,r="";return e.pathname="c%20d",t.forEach((function(e,n){t.delete("b"),r+=n+e})),!e.toJSON||!t.sort||"http://a/c%20d?a=1&c=3"!==e.href||"3"!==t.get("c")||"a=1"!==String(new URLSearchParams("?a=1"))||!t[MG]||"a"!==new URL("https://a@b").username||"b"!==new URLSearchParams(new URLSearchParams("a=b")).get("a")||"xn--e1aybc"!==new URL("http://ÑÐµÑÑ").host||"#%D0%B1"!==new URL("http://a#Ð±").hash||"a1c3"!==r||"x"!==new URL("http://x",void 0).host})),LG=Jt,UG=E,VG=2147483647,FG=/[^\0-\u007E]/,BG=/[.\u3002\uFF0E\uFF61]/g,jG="Overflow: input needs wider integers to process",GG=RangeError,HG=UG(BG.exec),zG=Math.floor,KG=String.fromCharCode,XG=UG("".charCodeAt),WG=UG([].join),qG=UG([].push),YG=UG("".replace),JG=UG("".split),QG=UG("".toLowerCase),ZG=function(e){return e+22+75*(e<26)},$G=function(e,t,r){var n=0;for(e=r?zG(e/700):e>>1,e+=zG(e/t);e>455;)e=zG(e/35),n+=36;return zG(n+36*e/(e+38))},eH=function(e){var t=[];e=function(e){for(var t=[],r=0,n=e.length;r<n;){var i=XG(e,r++);if(i>=55296&&i<=56319&&r<n){var o=XG(e,r++);56320==(64512&o)?qG(t,((1023&i)<<10)+(1023&o)+65536):(qG(t,i),r--)}else qG(t,i)}return t}(e);var r,n,i=e.length,o=128,a=0,s=72;for(r=0;r<e.length;r++)(n=e[r])<128&&qG(t,KG(n));var c=t.length,u=c;for(c&&qG(t,"-");u<i;){var d=VG;for(r=0;r<e.length;r++)(n=e[r])>=o&&n<d&&(d=n);var l=u+1;if(d-o>zG((VG-a)/l))throw GG(jG);for(a+=(d-o)*l,o=d,r=0;r<e.length;r++){if((n=e[r])<o&&++a>VG)throw GG(jG);if(n==o){for(var h=a,p=36;;){var _=p<=s?1:p>=s+26?26:p-s;if(h<_)break;var v=h-_,f=36-_;qG(t,KG(ZG(_+v%f))),h=zG(v/f),p+=36}qG(t,KG(ZG(h))),s=$G(a,l,u==c),a=0,u++}}a++,o++}return WG(t,"")},tH=Ar,rH=n,nH=O,iH=E,oH=C,aH=NG,sH=li,cH=Fg,uH=Ni,dH=Mc,lH=Zi,hH=vp,pH=R,_H=Ye,vH=Yt,fH=vn,mH=tr,gH=$,yH=gn,SH=Hn,bH=V,EH=mh,TH=dh,kH=Rp,IH=sR,RH=lt("iterator"),AH="URLSearchParams",CH="URLSearchParamsIterator",wH=lH.set,xH=lH.getterFor(AH),OH=lH.getterFor(CH),PH=Object.getOwnPropertyDescriptor,DH=function(e){if(!oH)return rH[e];var t=PH(rH,e);return t&&t.value},MH=DH("fetch"),NH=DH("Request"),LH=DH("Headers"),UH=NH&&NH.prototype,VH=LH&&LH.prototype,FH=rH.RegExp,BH=rH.TypeError,jH=rH.decodeURIComponent,GH=rH.encodeURIComponent,HH=iH("".charAt),zH=iH([].join),KH=iH([].push),XH=iH("".replace),WH=iH([].shift),qH=iH([].splice),YH=iH("".split),JH=iH("".slice),QH=/\+/g,ZH=Array(4),$H=function(e){return ZH[e-1]||(ZH[e-1]=FH("((?:%[\\da-f]{2}){"+e+"})","gi"))},ez=function(e){try{return jH(e)}catch(HX){return e}},tz=function(e){var t=XH(e,QH," "),r=4;try{return jH(t)}catch(HX){for(;r;)t=XH(t,$H(r--),ez);return t}},rz=/[!'()~]|%20/g,nz={"!":"%21","'":"%27","(":"%28",")":"%29","~":"%7E","%20":"+"},iz=function(e){return nz[e]},oz=function(e){return XH(GH(e),rz,iz)},az=dH((function(e,t){wH(this,{type:CH,iterator:EH(xH(e).entries),kind:t})}),"Iterator",(function(){var e=OH(this),t=e.kind,r=e.iterator.next(),n=r.value;return r.done||(r.value="keys"===t?n.key:"values"===t?n.value:[n.key,n.value]),r}),!0),sz=function(e){this.entries=[],this.url=null,void 0!==e&&(gH(e)?this.parseObject(e):this.parseQuery("string"==typeof e?"?"===HH(e,0)?JH(e,1):e:yH(e)))};sz.prototype={type:AH,bindURL:function(e){this.url=e,this.update()},parseObject:function(e){var t,r,n,i,o,a,s,c=TH(e);if(c)for(r=(t=EH(e,c)).next;!(n=nH(r,t)).done;){if(o=(i=EH(mH(n.value))).next,(a=nH(o,i)).done||(s=nH(o,i)).done||!nH(o,i).done)throw BH("Expected sequence with length 2");KH(this.entries,{key:yH(a.value),value:yH(s.value)})}else for(var u in e)_H(e,u)&&KH(this.entries,{key:u,value:yH(e[u])})},parseQuery:function(e){if(e)for(var t,r,n=YH(e,"&"),i=0;i<n.length;)(t=n[i++]).length&&(r=YH(t,"="),KH(this.entries,{key:tz(WH(r)),value:tz(zH(r,"="))}))},serialize:function(){for(var e,t=this.entries,r=[],n=0;n<t.length;)e=t[n++],KH(r,oz(e.key)+"="+oz(e.value));return zH(r,"&")},update:function(){this.entries.length=0,this.parseQuery(this.url.query)},updateURL:function(){this.url&&this.url.update()}};var cz=function(){hH(this,uz);var e=arguments.length>0?arguments[0]:void 0;wH(this,new sz(e))},uz=cz.prototype;if(cH(uz,{append:function(e,t){kH(arguments.length,2);var r=xH(this);KH(r.entries,{key:yH(e),value:yH(t)}),r.updateURL()},delete:function(e){kH(arguments.length,1);for(var t=xH(this),r=t.entries,n=yH(e),i=0;i<r.length;)r[i].key===n?qH(r,i,1):i++;t.updateURL()},get:function(e){kH(arguments.length,1);for(var t=xH(this).entries,r=yH(e),n=0;n<t.length;n++)if(t[n].key===r)return t[n].value;return null},getAll:function(e){kH(arguments.length,1);for(var t=xH(this).entries,r=yH(e),n=[],i=0;i<t.length;i++)t[i].key===r&&KH(n,t[i].value);return n},has:function(e){kH(arguments.length,1);for(var t=xH(this).entries,r=yH(e),n=0;n<t.length;)if(t[n++].key===r)return!0;return!1},set:function(e,t){kH(arguments.length,1);for(var r,n=xH(this),i=n.entries,o=!1,a=yH(e),s=yH(t),c=0;c<i.length;c++)(r=i[c]).key===a&&(o?qH(i,c--,1):(o=!0,r.value=s));o||KH(i,{key:a,value:s}),n.updateURL()},sort:function(){var e=xH(this);IH(e.entries,(function(e,t){return e.key>t.key?1:-1})),e.updateURL()},forEach:function(e){for(var t,r=xH(this).entries,n=vH(e,arguments.length>1?arguments[1]:void 0),i=0;i<r.length;)n((t=r[i++]).value,t.key,this)},keys:function(){return new az(this,"keys")},values:function(){return new az(this,"values")},entries:function(){return new az(this,"entries")}},{enumerable:!0}),sH(uz,RH,uz.entries,{name:"entries"}),sH(uz,"toString",(function(){return xH(this).serialize()}),{enumerable:!0}),uH(cz,AH),tH({global:!0,constructor:!0,forced:!aH},{URLSearchParams:cz}),!aH&&pH(LH)){var dz=iH(VH.has),lz=iH(VH.set),hz=function(e){if(gH(e)){var t,r=e.body;if(fH(r)===AH)return t=e.headers?new LH(e.headers):new LH,dz(t,"content-type")||lz(t,"content-type","application/x-www-form-urlencoded;charset=UTF-8"),SH(e,{body:bH(0,yH(r)),headers:bH(0,t)})}return e};if(pH(MH)&&tH({global:!0,enumerable:!0,dontCallGetSet:!0,forced:!0},{fetch:function(e){return MH(e,arguments.length>1?hz(arguments[1]):{})}}),pH(NH)){var pz=function(e){return hH(this,UH),new NH(e,arguments.length>1?hz(arguments[1]):{})};UH.constructor=pz,pz.prototype=UH,tH({global:!0,constructor:!0,dontCallGetSet:!0,forced:!0},{Request:pz})}}var _z,vz=Ar,fz=C,mz=NG,gz=n,yz=Yt,Sz=E,bz=li,Ez=function(e,t,r){return LG.f(e,t,r)},Tz=vp,kz=Ye,Iz=_b,Rz=zT,Az=ni,Cz=Rl.codeAt,wz=function(e){var t,r,n=[],i=JG(YG(QG(e),BG,"."),".");for(t=0;t<i.length;t++)r=i[t],qG(n,HG(FG,r)?"xn--"+eH(r):r);return WG(n,".")},xz=gn,Oz=Ni,Pz=Rp,Dz={URLSearchParams:cz,getState:xH},Mz=Zi,Nz=Mz.set,Lz=Mz.getterFor("URL"),Uz=Dz.URLSearchParams,Vz=Dz.getState,Fz=gz.URL,Bz=gz.TypeError,jz=gz.parseInt,Gz=Math.floor,Hz=Math.pow,zz=Sz("".charAt),Kz=Sz(/./.exec),Xz=Sz([].join),Wz=Sz(1..toString),qz=Sz([].pop),Yz=Sz([].push),Jz=Sz("".replace),Qz=Sz([].shift),Zz=Sz("".split),$z=Sz("".slice),eK=Sz("".toLowerCase),tK=Sz([].unshift),rK="Invalid scheme",nK="Invalid host",iK="Invalid port",oK=/[a-z]/i,aK=/[\d+-.a-z]/i,sK=/\d/,cK=/^0x/i,uK=/^[0-7]+$/,dK=/^\d+$/,lK=/^[\da-f]+$/i,hK=/[\0\t\n\r #%/:<>?@[\\\]^|]/,pK=/[\0\t\n\r #/:<>?@[\\\]^|]/,_K=/^[\u0000-\u0020]+|[\u0000-\u0020]+$/g,vK=/[\t\n\r]/g,fK=function(e){var t,r,n,i;if("number"==typeof e){for(t=[],r=0;r<4;r++)tK(t,e%256),e=Gz(e/256);return Xz(t,".")}if("object"==typeof e){for(t="",n=function(e){for(var t=null,r=1,n=null,i=0,o=0;o<8;o++)0!==e[o]?(i>r&&(t=n,r=i),n=null,i=0):(null===n&&(n=o),++i);return i>r&&(t=n,r=i),t}(e),r=0;r<8;r++)i&&0===e[r]||(i&&(i=!1),n===r?(t+=r?":":"::",i=!0):(t+=Wz(e[r],16),r<7&&(t+=":")));return"["+t+"]"}return e},mK={},gK=Iz({},mK,{" ":1,'"':1,"<":1,">":1,"`":1}),yK=Iz({},gK,{"#":1,"?":1,"{":1,"}":1}),SK=Iz({},yK,{"/":1,":":1,";":1,"=":1,"@":1,"[":1,"\\":1,"]":1,"^":1,"|":1}),bK=function(e,t){var r=Cz(e,0);return r>32&&r<127&&!kz(t,e)?e:encodeURIComponent(e)},EK={ftp:21,file:null,http:80,https:443,ws:80,wss:443},TK=function(e,t){var r;return 2==e.length&&Kz(oK,zz(e,0))&&(":"==(r=zz(e,1))||!t&&"|"==r)},kK=function(e){var t;return e.length>1&&TK($z(e,0,2))&&(2==e.length||"/"===(t=zz(e,2))||"\\"===t||"?"===t||"#"===t)},IK=function(e){return"."===e||"%2e"===eK(e)},RK={},AK={},CK={},wK={},xK={},OK={},PK={},DK={},MK={},NK={},LK={},UK={},VK={},FK={},BK={},jK={},GK={},HK={},zK={},KK={},XK={},WK=function(e,t,r){var n,i,o,a=xz(e);if(t){if(i=this.parse(a))throw Bz(i);this.searchParams=null}else{if(void 0!==r&&(n=new WK(r,!0)),i=this.parse(a,null,n))throw Bz(i);(o=Vz(new Uz)).bindURL(this),this.searchParams=o}};WK.prototype={type:"URL",parse:function(e,t,r){var n,i,o,a,s,c=this,u=t||RK,d=0,l="",h=!1,p=!1,_=!1;for(e=xz(e),t||(c.scheme="",c.username="",c.password="",c.host=null,c.port=null,c.path=[],c.query=null,c.fragment=null,c.cannotBeABaseURL=!1,e=Jz(e,_K,"")),e=Jz(e,vK,""),n=Rz(e);d<=n.length;){switch(i=n[d],u){case RK:if(!i||!Kz(oK,i)){if(t)return rK;u=CK;continue}l+=eK(i),u=AK;break;case AK:if(i&&(Kz(aK,i)||"+"==i||"-"==i||"."==i))l+=eK(i);else{if(":"!=i){if(t)return rK;l="",u=CK,d=0;continue}if(t&&(c.isSpecial()!=kz(EK,l)||"file"==l&&(c.includesCredentials()||null!==c.port)||"file"==c.scheme&&!c.host))return;if(c.scheme=l,t)return void(c.isSpecial()&&EK[c.scheme]==c.port&&(c.port=null));l="","file"==c.scheme?u=FK:c.isSpecial()&&r&&r.scheme==c.scheme?u=wK:c.isSpecial()?u=DK:"/"==n[d+1]?(u=xK,d++):(c.cannotBeABaseURL=!0,Yz(c.path,""),u=zK)}break;case CK:if(!r||r.cannotBeABaseURL&&"#"!=i)return rK;if(r.cannotBeABaseURL&&"#"==i){c.scheme=r.scheme,c.path=Az(r.path),c.query=r.query,c.fragment="",c.cannotBeABaseURL=!0,u=XK;break}u="file"==r.scheme?FK:OK;continue;case wK:if("/"!=i||"/"!=n[d+1]){u=OK;continue}u=MK,d++;break;case xK:if("/"==i){u=NK;break}u=HK;continue;case OK:if(c.scheme=r.scheme,i==_z)c.username=r.username,c.password=r.password,c.host=r.host,c.port=r.port,c.path=Az(r.path),c.query=r.query;else if("/"==i||"\\"==i&&c.isSpecial())u=PK;else if("?"==i)c.username=r.username,c.password=r.password,c.host=r.host,c.port=r.port,c.path=Az(r.path),c.query="",u=KK;else{if("#"!=i){c.username=r.username,c.password=r.password,c.host=r.host,c.port=r.port,c.path=Az(r.path),c.path.length--,u=HK;continue}c.username=r.username,c.password=r.password,c.host=r.host,c.port=r.port,c.path=Az(r.path),c.query=r.query,c.fragment="",u=XK}break;case PK:if(!c.isSpecial()||"/"!=i&&"\\"!=i){if("/"!=i){c.username=r.username,c.password=r.password,c.host=r.host,c.port=r.port,u=HK;continue}u=NK}else u=MK;break;case DK:if(u=MK,"/"!=i||"/"!=zz(l,d+1))continue;d++;break;case MK:if("/"!=i&&"\\"!=i){u=NK;continue}break;case NK:if("@"==i){h&&(l="%40"+l),h=!0,o=Rz(l);for(var v=0;v<o.length;v++){var f=o[v];if(":"!=f||_){var m=bK(f,SK);_?c.password+=m:c.username+=m}else _=!0}l=""}else if(i==_z||"/"==i||"?"==i||"#"==i||"\\"==i&&c.isSpecial()){if(h&&""==l)return"Invalid authority";d-=Rz(l).length+1,l="",u=LK}else l+=i;break;case LK:case UK:if(t&&"file"==c.scheme){u=jK;continue}if(":"!=i||p){if(i==_z||"/"==i||"?"==i||"#"==i||"\\"==i&&c.isSpecial()){if(c.isSpecial()&&""==l)return nK;if(t&&""==l&&(c.includesCredentials()||null!==c.port))return;if(a=c.parseHost(l))return a;if(l="",u=GK,t)return;continue}"["==i?p=!0:"]"==i&&(p=!1),l+=i}else{if(""==l)return nK;if(a=c.parseHost(l))return a;if(l="",u=VK,t==UK)return}break;case VK:if(!Kz(sK,i)){if(i==_z||"/"==i||"?"==i||"#"==i||"\\"==i&&c.isSpecial()||t){if(""!=l){var g=jz(l,10);if(g>65535)return iK;c.port=c.isSpecial()&&g===EK[c.scheme]?null:g,l=""}if(t)return;u=GK;continue}return iK}l+=i;break;case FK:if(c.scheme="file","/"==i||"\\"==i)u=BK;else{if(!r||"file"!=r.scheme){u=HK;continue}if(i==_z)c.host=r.host,c.path=Az(r.path),c.query=r.query;else if("?"==i)c.host=r.host,c.path=Az(r.path),c.query="",u=KK;else{if("#"!=i){kK(Xz(Az(n,d),""))||(c.host=r.host,c.path=Az(r.path),c.shortenPath()),u=HK;continue}c.host=r.host,c.path=Az(r.path),c.query=r.query,c.fragment="",u=XK}}break;case BK:if("/"==i||"\\"==i){u=jK;break}r&&"file"==r.scheme&&!kK(Xz(Az(n,d),""))&&(TK(r.path[0],!0)?Yz(c.path,r.path[0]):c.host=r.host),u=HK;continue;case jK:if(i==_z||"/"==i||"\\"==i||"?"==i||"#"==i){if(!t&&TK(l))u=HK;else if(""==l){if(c.host="",t)return;u=GK}else{if(a=c.parseHost(l))return a;if("localhost"==c.host&&(c.host=""),t)return;l="",u=GK}continue}l+=i;break;case GK:if(c.isSpecial()){if(u=HK,"/"!=i&&"\\"!=i)continue}else if(t||"?"!=i)if(t||"#"!=i){if(i!=_z&&(u=HK,"/"!=i))continue}else c.fragment="",u=XK;else c.query="",u=KK;break;case HK:if(i==_z||"/"==i||"\\"==i&&c.isSpecial()||!t&&("?"==i||"#"==i)){if(".."===(s=eK(s=l))||"%2e."===s||".%2e"===s||"%2e%2e"===s?(c.shortenPath(),"/"==i||"\\"==i&&c.isSpecial()||Yz(c.path,"")):IK(l)?"/"==i||"\\"==i&&c.isSpecial()||Yz(c.path,""):("file"==c.scheme&&!c.path.length&&TK(l)&&(c.host&&(c.host=""),l=zz(l,0)+":"),Yz(c.path,l)),l="","file"==c.scheme&&(i==_z||"?"==i||"#"==i))for(;c.path.length>1&&""===c.path[0];)Qz(c.path);"?"==i?(c.query="",u=KK):"#"==i&&(c.fragment="",u=XK)}else l+=bK(i,yK);break;case zK:"?"==i?(c.query="",u=KK):"#"==i?(c.fragment="",u=XK):i!=_z&&(c.path[0]+=bK(i,mK));break;case KK:t||"#"!=i?i!=_z&&("'"==i&&c.isSpecial()?c.query+="%27":c.query+="#"==i?"%23":bK(i,mK)):(c.fragment="",u=XK);break;case XK:i!=_z&&(c.fragment+=bK(i,gK))}d++}},parseHost:function(e){var t,r,n;if("["==zz(e,0)){if("]"!=zz(e,e.length-1))return nK;if(t=function(e){var t,r,n,i,o,a,s,c=[0,0,0,0,0,0,0,0],u=0,d=null,l=0,h=function(){return zz(e,l)};if(":"==h()){if(":"!=zz(e,1))return;l+=2,d=++u}for(;h();){if(8==u)return;if(":"!=h()){for(t=r=0;r<4&&Kz(lK,h());)t=16*t+jz(h(),16),l++,r++;if("."==h()){if(0==r)return;if(l-=r,u>6)return;for(n=0;h();){if(i=null,n>0){if(!("."==h()&&n<4))return;l++}if(!Kz(sK,h()))return;for(;Kz(sK,h());){if(o=jz(h(),10),null===i)i=o;else{if(0==i)return;i=10*i+o}if(i>255)return;l++}c[u]=256*c[u]+i,2!=++n&&4!=n||u++}if(4!=n)return;break}if(":"==h()){if(l++,!h())return}else if(h())return;c[u++]=t}else{if(null!==d)return;l++,d=++u}}if(null!==d)for(a=u-d,u=7;0!=u&&a>0;)s=c[u],c[u--]=c[d+a-1],c[d+--a]=s;else if(8!=u)return;return c}($z(e,1,-1)),!t)return nK;this.host=t}else if(this.isSpecial()){if(e=wz(e),Kz(hK,e))return nK;if(t=function(e){var t,r,n,i,o,a,s,c=Zz(e,".");if(c.length&&""==c[c.length-1]&&c.length--,(t=c.length)>4)return e;for(r=[],n=0;n<t;n++){if(""==(i=c[n]))return e;if(o=10,i.length>1&&"0"==zz(i,0)&&(o=Kz(cK,i)?16:8,i=$z(i,8==o?1:2)),""===i)a=0;else{if(!Kz(10==o?dK:8==o?uK:lK,i))return e;a=jz(i,o)}Yz(r,a)}for(n=0;n<t;n++)if(a=r[n],n==t-1){if(a>=Hz(256,5-t))return null}else if(a>255)return null;for(s=qz(r),n=0;n<r.length;n++)s+=r[n]*Hz(256,3-n);return s}(e),null===t)return nK;this.host=t}else{if(Kz(pK,e))return nK;for(t="",r=Rz(e),n=0;n<r.length;n++)t+=bK(r[n],mK);this.host=t}},cannotHaveUsernamePasswordPort:function(){return!this.host||this.cannotBeABaseURL||"file"==this.scheme},includesCredentials:function(){return""!=this.username||""!=this.password},isSpecial:function(){return kz(EK,this.scheme)},shortenPath:function(){var e=this.path,t=e.length;!t||"file"==this.scheme&&1==t&&TK(e[0],!0)||e.length--},serialize:function(){var e=this,t=e.scheme,r=e.username,n=e.password,i=e.host,o=e.port,a=e.path,s=e.query,c=e.fragment,u=t+":";return null!==i?(u+="//",e.includesCredentials()&&(u+=r+(n?":"+n:"")+"@"),u+=fK(i),null!==o&&(u+=":"+o)):"file"==t&&(u+="//"),u+=e.cannotBeABaseURL?a[0]:a.length?"/"+Xz(a,"/"):"",null!==s&&(u+="?"+s),null!==c&&(u+="#"+c),u},setHref:function(e){var t=this.parse(e);if(t)throw Bz(t);this.searchParams.update()},getOrigin:function(){var e=this.scheme,t=this.port;if("blob"==e)try{return new qK(e.path[0]).origin}catch(HX){return"null"}return"file"!=e&&this.isSpecial()?e+"://"+fK(this.host)+(null!==t?":"+t:""):"null"},getProtocol:function(){return this.scheme+":"},setProtocol:function(e){this.parse(xz(e)+":",RK)},getUsername:function(){return this.username},setUsername:function(e){var t=Rz(xz(e));if(!this.cannotHaveUsernamePasswordPort()){this.username="";for(var r=0;r<t.length;r++)this.username+=bK(t[r],SK)}},getPassword:function(){return this.password},setPassword:function(e){var t=Rz(xz(e));if(!this.cannotHaveUsernamePasswordPort()){this.password="";for(var r=0;r<t.length;r++)this.password+=bK(t[r],SK)}},getHost:function(){var e=this.host,t=this.port;return null===e?"":null===t?fK(e):fK(e)+":"+t},setHost:function(e){this.cannotBeABaseURL||this.parse(e,LK)},getHostname:function(){var e=this.host;return null===e?"":fK(e)},setHostname:function(e){this.cannotBeABaseURL||this.parse(e,UK)},getPort:function(){var e=this.port;return null===e?"":xz(e)},setPort:function(e){this.cannotHaveUsernamePasswordPort()||(""==(e=xz(e))?this.port=null:this.parse(e,VK))},getPathname:function(){var e=this.path;return this.cannotBeABaseURL?e[0]:e.length?"/"+Xz(e,"/"):""},setPathname:function(e){this.cannotBeABaseURL||(this.path=[],this.parse(e,GK))},getSearch:function(){var e=this.query;return e?"?"+e:""},setSearch:function(e){""==(e=xz(e))?this.query=null:("?"==zz(e,0)&&(e=$z(e,1)),this.query="",this.parse(e,KK)),this.searchParams.update()},getSearchParams:function(){return this.searchParams.facade},getHash:function(){var e=this.fragment;return e?"#"+e:""},setHash:function(e){""!=(e=xz(e))?("#"==zz(e,0)&&(e=$z(e,1)),this.fragment="",this.parse(e,XK)):this.fragment=null},update:function(){this.query=this.searchParams.serialize()||null}};var qK=function(e){var t=Tz(this,YK),r=Pz(arguments.length,1)>1?arguments[1]:void 0,n=Nz(t,new WK(e,!1,r));fz||(t.href=n.serialize(),t.origin=n.getOrigin(),t.protocol=n.getProtocol(),t.username=n.getUsername(),t.password=n.getPassword(),t.host=n.getHost(),t.hostname=n.getHostname(),t.port=n.getPort(),t.pathname=n.getPathname(),t.search=n.getSearch(),t.searchParams=n.getSearchParams(),t.hash=n.getHash())},YK=qK.prototype,JK=function(e,t){return{get:function(){return Lz(this)[e]()},set:t&&function(e){return Lz(this)[t](e)},configurable:!0,enumerable:!0}};if(fz&&(Ez(YK,"href",JK("serialize","setHref")),Ez(YK,"origin",JK("getOrigin")),Ez(YK,"protocol",JK("getProtocol","setProtocol")),Ez(YK,"username",JK("getUsername","setUsername")),Ez(YK,"password",JK("getPassword","setPassword")),Ez(YK,"host",JK("getHost","setHost")),Ez(YK,"hostname",JK("getHostname","setHostname")),Ez(YK,"port",JK("getPort","setPort")),Ez(YK,"pathname",JK("getPathname","setPathname")),Ez(YK,"search",JK("getSearch","setSearch")),Ez(YK,"searchParams",JK("getSearchParams")),Ez(YK,"hash",JK("getHash","setHash"))),bz(YK,"toJSON",(function(){return Lz(this).serialize()}),{enumerable:!0}),bz(YK,"toString",(function(){return Lz(this).serialize()}),{enumerable:!0}),Fz){var QK=Fz.createObjectURL,ZK=Fz.revokeObjectURL;QK&&bz(qK,"createObjectURL",yz(QK,Fz)),ZK&&bz(qK,"revokeObjectURL",yz(ZK,Fz))}Oz(qK,"URL"),vz({global:!0,constructor:!0,forced:!mz,sham:!fz},{URL:qK});var $K=ee.URL,eX=function(){var e=km(Em().mark((function e(t,r){var n;return Em().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=new Audio($K.createObjectURL(new Blob([t],r))),e.prev=1,n.muted=!0,e.next=5,n.play();case 5:return n.pause(),e.abrupt("return",!0);case 9:return e.prev=9,e.t0=e.catch(1),e.abrupt("return",!1);case 12:case"end":return e.stop()}}),e,null,[[1,9]])})));return function(t,r){return e.apply(this,arguments)}}(),tX=ad,rX=tc,nX=function(e,t,r,n){for(var i,o=n>1?void 0:n?rX(t,r):t,a=e.length-1;a>=0;a--)(i=e[a])&&(o=(n?i(t,r,o):i(o))||o);return n&&o&&tX(t,r,o),o},iX=function(){function e(t,r){Yd(this,e),sd(this,"_sharedAudioContext",new AudioContext),sd(this,"_audioDestination",this._sharedAudioContext.createMediaStreamDestination()),sd(this,"_localGainNode",this._sharedAudioContext.createGain()),sd(this,"_bufferGainNode",this._sharedAudioContext.createGain()),sd(this,"_audioBufferSource",void 0),sd(this,"_localSource",void 0),sd(this,"_context",void 0),sd(this,"_failedAudioList",[]),sd(this,"_startingIds",new jS),sd(this,"_revokeURLs",new lN),sd(this,"mixingMap",new jS),sd(this,"resourcesCache",new jS),sd(this,"volumeConfig",new jS),sd(this,"cachedBuffer",[]),sd(this,"id","AudioMixingManager"),this.engineId=r,this._context=t,this._localGainNode.gain.value=1}var t,r,n;return qd(e,[{key:"mixMediaStream",value:function(e){this._localSource&&this._localSource.disconnect(this._localGainNode),this._localSource=this._sharedAudioContext.createMediaStreamSource(e),this._localSource.connect(this._localGainNode).connect(this._audioDestination)}},{key:"startAudioMixing",value:(n=km(Em().mark((function e(t,r,n){var i,o,a,s,c,u,d,l,h,p,_,v,f,m=this;return Em().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(void 0===this._startingIds.get(t)){e.next=3;break}return console.warn("AudioMixing task id: ".concat(t," is starting")),e.abrupt("return");case 3:if(this._startingIds.set(t,t),i=n.playCount,$P(o=n.type,"mixingType",jj(Hd)),a=this._context.getLocalAudioTrack()){e.next=9;break}return e.abrupt("return");case 9:if((s=a.getTrack("preprocessing"))&&this.mixMediaStream(new MediaStream([s])),null!=(c=this.mixingMap.get(t))&&c.audioNode){c.audioNode.pause(),this._context.emitMessage({mixId:t,state:zd.AUDIO_MIXING_STATE_STOPPED,error:dA.AUDIO_MIXING_ERROR_OK});try{c.gainNode.disconnect(this._audioDestination),c.audioSource.disconnect(c.gainNode)}catch(g){}}if(!(d=this.resourcesCache.get(t))||d.filePath!==r){e.next=18;break}u=d.getAudioNode(),e.next=31;break;case 18:return e.next=20,fetch(r,{mode:"cors",credentials:"include"}).then((function(e){if(e.ok)return e.arrayBuffer();throw m._context.emitMessage({mixId:t,state:zd.AUDIO_MIXING_STATE_FAILED,error:dA.AUDIO_MIXING_ERROR_START_FAILED}),new lA(uA.LOAD_RESOURCES_FAILED,e.statusText)}));case 20:return l=e.sent,Fb(r).call(r,"mp3")?h={type:"audio/mpeg"}:Fb(r).call(r,"aac")&&(h={type:"audio/aac"}),e.next=24,eX(l,h);case 24:if(e.sent){e.next=28;break}throw this._context.emitMessage({mixId:t,state:zd.AUDIO_MIXING_STATE_FAILED,error:dA.AUDIO_MIXING_ERROR_START_FAILED}),new lA(uA.LOAD_RESOURCES_FAILED,"invalid audio resource");case 28:(u=new Audio).crossOrigin="anonymous",u.src=$K.createObjectURL(new Blob([l],h));case 31:return i<=0?u.loop=!0:i>0&&(p=i,u.onended=function(){--p>0?u.play():(m.mixingMap.delete(t),m._context.emitMessage({mixId:t,state:zd.AUDIO_MIXING_STATE_FINISHED,error:dA.AUDIO_MIXING_ERROR_OK}))}),e.prev=32,e.next=35,u.play();case 35:e.next=42;break;case 37:e.prev=37,e.t0=e.catch(32),console.error(e.t0),this._failedAudioList.push(u),this._context.onAutoPlayFailed({userId:this.id,kind:"audio",streamIndex:yd.STREAM_INDEX_MAIN,mediaType:Sd.AUDIO});case 42:if(this._startingIds.delete(t),_=this._sharedAudioContext.createMediaElementSource(u),v=this._sharedAudioContext.createGain(),f=this.volumeConfig.get(t),v.gain.value=f?f/100:1,_.connect(v).connect(this._audioDestination),this.mixingMap.set(t,{audioSource:_,audioNode:u,gainNode:v,type:"file"}),o===Hd.PUBLISH)try{v.disconnect(this._sharedAudioContext.destination)}catch(g){}else v.connect(this._sharedAudioContext.destination);this._context.updateLocalAudioTrack(this._audioDestination.stream.getAudioTracks()[0],n.type),this._context.emitMessage({mixId:t,state:zd.AUDIO_MIXING_STATE_PLAYING,error:dA.AUDIO_MIXING_ERROR_OK});case 52:case"end":return e.stop()}}),e,this,[[32,37]])}))),function(e,t,r){return n.apply(this,arguments)})},{key:"stopAudioMixing",value:function(e){var t=this.mixingMap.get(e);t&&"file"===t.type&&(this.mixingMap.delete(e),t.audioNode.pause(),t.audioSource.disconnect(t.gainNode),t.gainNode.disconnect(this._audioDestination),this._context.emitMessage({mixId:e,state:zd.AUDIO_MIXING_STATE_STOPPED,error:dA.AUDIO_MIXING_ERROR_OK}))}},{key:"pauseAudioMixing",value:function(e){var t=this.mixingMap.get(e);t&&(this._context.emitMessage({mixId:e,state:zd.AUDIO_MIXING_STATE_PAUSED,error:dA.AUDIO_MIXING_ERROR_OK}),t.audioNode.pause())}},{key:"resumeAudioMixing",value:function(e){var t=this.mixingMap.get(e);t&&(this._context.emitMessage({mixId:e,state:zd.AUDIO_MIXING_STATE_PLAYING,error:dA.AUDIO_MIXING_ERROR_OK}),t.audioNode.play())}},{key:"preloadAudioMixing",value:(r=km(Em().mark((function e(t,r){var n,i,o=this;return Em().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return this.stopAudioMixing(t),e.next=3,fetch(r,{mode:"cors",credentials:"include"}).then((function(e){if(e.ok)return e.arrayBuffer();throw new lA(uA.LOAD_RESOURCES_FAILED,e.statusText)})).catch((function(e){if(o._context.emitMessage({mixId:t,state:zd.AUDIO_MIXING_STATE_FAILED,error:dA.AUDIO_MIXING_ERROR_PRELOAD_FAILED}),e instanceof lA)throw e;throw new lA(uA.LOAD_RESOURCES_FAILED,"Load resources failed",e)}));case 3:return n=e.sent,Fb(r).call(r,"mp3")?i={type:"audio/mpeg"}:Fb(r).call(r,"aac")&&(i={type:"audio/aac"}),e.next=7,eX(n,i);case 7:if(e.sent){e.next=11;break}throw this._context.emitMessage({mixId:t,state:zd.AUDIO_MIXING_STATE_FAILED,error:dA.AUDIO_MIXING_ERROR_PRELOAD_FAILED}),new lA(uA.LOAD_RESOURCES_FAILED,"Load resources failed");case 11:return this._context.emitMessage({mixId:t,state:zd.AUDIO_MIXING_STATE_PRELOADED,error:dA.AUDIO_MIXING_ERROR_OK}),this.resourcesCache.set(t,{getAudioNode:function(){var e=$K.createObjectURL(new Blob([n],i));return o._revokeURLs.add(e),new Audio(e)},filePath:r,duration:0}),e.next=15,new Wf((function(e){var r=$K.createObjectURL(new Blob([n],i)),a=new Audio(r);a.addEventListener("durationchange",(function(){var n=o.resourcesCache.get(t);n&&(n.duration=a.duration,o.resourcesCache.set(t,n)),$K.revokeObjectURL(r),e(null)}))}));case 15:case"end":return e.stop()}}),e,this)}))),function(e,t){return r.apply(this,arguments)})},{key:"unloadAudioMixing",value:function(e){this.resourcesCache.has(e)&&this.resourcesCache.delete(e)}},{key:"getAudioMixingVolume",value:function(e){var t=this.mixingMap.get(e);return t?100*t.gainNode.gain.value:0}},{key:"setAudioMixingVolume",value:function(e,t){t<0?t=0:t>400&&(t=400),this.volumeConfig.set(e,t);var r=this.mixingMap.get(e);r&&(r.gainNode.gain.value=Number(t)/100)}},{key:"getAudioMixingDuration",value:function(e){var t=this.mixingMap.get(e),r=this.resourcesCache.get(e);return t||r?t?1e3*t.audioNode.duration:r?1e3*r.duration:0:0}},{key:"getAudioMixingCurrentPosition",value:function(e){var t=this.mixingMap.get(e);return t?1e3*t.audioNode.currentTime:0}},{key:"setAudioMixingPosition",value:function(e,t){var r=this.mixingMap.get(e);r&&(r.audioNode.currentTime=t/1e3,r.audioNode.play())}},{key:"enableAudioMixingBuffer",value:function(e){$P(e,"type",jj(Hd));var t=this._context.getLocalAudioTrack();if(t){var r=t.getTrack("preprocessing");if(r&&this.mixMediaStream(new MediaStream([r])),e===Hd.PUBLISH)try{this._bufferGainNode.disconnect(this._sharedAudioContext.destination)}catch(n){}else this._bufferGainNode.connect(this._sharedAudioContext.destination);this._context.updateLocalAudioTrack(this._audioDestination.stream.getAudioTracks()[0],e),this._bufferGainNode.connect(this._audioDestination),this._context.emitMessage({mixId:-1,state:zd.AUDIO_MIXING_STATE_PCM_ENABLED,error:dA.AUDIO_MIXING_ERROR_OK})}}},{key:"disableAudioMixingBuffer",value:function(){if(this.cachedBuffer=[],this._audioBufferSource){try{this._audioBufferSource.disconnect(this._bufferGainNode),this._bufferGainNode.disconnect(this._audioDestination),this._bufferGainNode.disconnect(this._sharedAudioContext.destination)}catch(e){}finally{this._audioBufferSource=void 0}this._context.updateLocalAudioTrack(),this._context.emitMessage({mixId:-1,state:zd.AUDIO_MIXING_STATE_PCM_DISABLED,error:dA.AUDIO_MIXING_ERROR_OK})}}},{key:"pushAudioMixingBuffer",value:function(e){var t=this;if(!(this._audioBufferSource&&(this.cachedBuffer.push(e),this.cachedBuffer.length>0))){this._audioBufferSource=this._sharedAudioContext.createBufferSource(),this._audioBufferSource.buffer=e,this._audioBufferSource.connect(this._bufferGainNode);try{this._audioBufferSource.start()}catch(r){this._failedAudioList.push(this._audioBufferSource)}this._audioBufferSource.onended=function(){var e;if(null===(e=t._audioBufferSource)||void 0===e||e.disconnect(t._bufferGainNode),t._audioBufferSource=void 0,t.cachedBuffer.length){var r=t.cachedBuffer.shift();r&&t.pushAudioMixingBuffer(r)}}}}},{key:"stopAll",value:function(){var e=this;if(this._localSource)try{this._localSource.disconnect(this._localGainNode),delete this._localSource}catch(t){}this.mixingMap.forEach((function(t,r){e.stopAudioMixing(r)}))}},{key:"mixTrack",get:function(){return this._audioDestination.stream.getAudioTracks()[0]}},{key:"sharedAudioContext",get:function(){return this._sharedAudioContext}},{key:"resumeLocalPlay",value:(t=km(Em().mark((function e(){var t,r,n,i;return Em().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:t=[],r=Jk(this._failedAudioList),e.prev=2,r.s();case 4:if((n=r.n()).done){e.next=24;break}if(i=n.value,e.prev=6,!(i instanceof HTMLAudioElement)){e.next=13;break}return i.muted=!1,e.next=11,i.play();case 11:e.next=14;break;case 13:i.start();case 14:e.next=22;break;case 16:return e.prev=16,e.t0=e.catch(6),t.push(i),console.error(e.t0),this._context.onAutoPlayFailed({userId:this.id,kind:"audio",streamIndex:yd.STREAM_INDEX_MAIN,mediaType:Sd.AUDIO}),e.abrupt("break",24);case 22:e.next=4;break;case 24:e.next=29;break;case 26:e.prev=26,e.t1=e.catch(2),r.e(e.t1);case 29:return e.prev=29,r.f(),e.finish(29);case 32:this._failedAudioList=t;case 33:case"end":return e.stop()}}),e,this,[[2,26,29,32],[6,16]])}))),function(){return t.apply(this,arguments)})},{key:"destroy",value:function(){var e=this._sharedAudioContext;"closed"!==e.state&&"function"==typeof e.close&&e.close(),this.cachedBuffer=[],this.mixingMap.clear(),this.resourcesCache.clear(),this.volumeConfig.clear(),this._startingIds=new jS,this._revokeURLs.forEach((function(e){$K.revokeObjectURL(e)}))}}]),e}();nX([TO("id","filePath","options")],iX.prototype,"startAudioMixing",1),nX([TO("id")],iX.prototype,"stopAudioMixing",1),nX([TO("id")],iX.prototype,"pauseAudioMixing",1),nX([TO("id")],iX.prototype,"resumeAudioMixing",1),nX([TO("id")],iX.prototype,"preloadAudioMixing",1),nX([TO("id")],iX.prototype,"unloadAudioMixing",1),nX([TO("id")],iX.prototype,"getAudioMixingVolume",1),nX([TO("id","volume")],iX.prototype,"setAudioMixingVolume",1),nX([TO("id")],iX.prototype,"getAudioMixingDuration",1),nX([TO("id")],iX.prototype,"getAudioMixingCurrentPosition",1),nX([TO("id","position")],iX.prototype,"setAudioMixingPosition",1),nX([TO("type")],iX.prototype,"enableAudioMixingBuffer",1),nX([TO()],iX.prototype,"disableAudioMixingBuffer",1),nX([TO("buffer")],iX.prototype,"pushAudioMixingBuffer",1);var oX=function(e){return e.NORMAL_USER="normalUser",e.SILENT_USER="silentUser",e}(oX||{}),aX=new uO("RTMClient",1),sX=function(e){xI(c,e);var t,r,n,i,o,a,s=WI(c);function c(e){var t;return Yd(this,c),sd(Zk(t=s.call(this)),"_dataChannelSignal",void 0),sd(Zk(t),"_handler",void 0),sd(Zk(t),"_dataChannelSignalState",Yj.DISCONNECTED),sd(Zk(t),"_loginSessionId",null),sd(Zk(t),"_userId",null),sd(Zk(t),"_token",null),sd(Zk(t),"_loginResolveCallback",void 0),sd(Zk(t),"_loginRejectCallback",void 0),sd(Zk(t),"_wait_login_token",!1),sd(Zk(t),"_serverParamsCache",void 0),sd(Zk(t),"id",void 0),sd(Zk(t),"_connectionManager",void 0),sd(Zk(t),"isReconnecting",!1),t._ctx=e,t.id=e.id,t._connectionManager=new Hj(e),t._addConnectHandler(),t}return qd(c,[{key:"login",value:function(e,t){var r=this;return new Wf((function(n,i){var o;if(aX.print("login","invoke login, token: %o, userId: %o",e,t),r._loginSessionId)throw new lA(uA.ALREADY_LOGIN,"Already logined");if(r._loginResolveCallback)throw new lA(uA.LOGIN_FAILED,"Is logging in, please try again later.");r._userId=t,r._token=e,null===(o=EO(r.id))||void 0===o||o.set({rtm_user_id:t}),r._loginResolveCallback=n,r._loginRejectCallback=i,r._dataChannelSignal?r._login():r.connect().then((function(){r._login()}))}))}},{key:"logout",value:(a=km(Em().mark((function e(){var t;return Em().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this._loginSessionId&&this._userId){e.next=2;break}throw new lA(uA.NOT_LOGIN,"login first");case 2:return e.next=4,null===(t=this._dataChannelSignal)||void 0===t?void 0:t.sendSignaling("logout",{loginSessionId:this._loginSessionId,userId:this._userId,appId:this._ctx.appId},{functionType:oF.C2RTM}).catch((function(){}));case 4:this._clearState();case 5:case"end":return e.stop()}}),e,this)}))),function(){return a.apply(this,arguments)})},{key:"updateLoginToken",value:(o=km(Em().mark((function e(t){var r=this;return Em().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return this._token=t,e.abrupt("return",new Wf((function(e,t){r._wait_login_token?(r._loginResolveCallback=e,r._loginRejectCallback=t,r._login()):e()})));case 2:case"end":return e.stop()}}),e,this)}))),function(e){return o.apply(this,arguments)})},{key:"getPeerOnlineStatus",value:(i=km(Em().mark((function e(t){var r;return Em().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this._loginSessionId&&this._userId){e.next=2;break}throw new lA(uA.NOT_LOGIN,"login first");case 2:return this._checkDataChannelSignal(),e.next=5,this._dataChannelSignal.sendSignaling("getPeerOnlineStatus",{loginSessionId:this._loginSessionId,userId:this._userId,appId:this._ctx.appId,peerUserId:t},{functionType:oF.C2RTM});case 5:return r=e.sent,e.abrupt("return",null==r?void 0:r.status);case 7:case"end":return e.stop()}}),e,this)}))),function(e){return i.apply(this,arguments)})},{key:"sendUserMessageOutsideRoom",value:(n=km(Em().mark((function e(t,r){return Em().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this._loginSessionId&&this._userId){e.next=2;break}throw new lA(uA.NOT_LOGIN,"login first");case 2:return this._checkDataChannelSignal(),e.abrupt("return",this._dataChannelSignal.sendP2PMessage({from:this._userId,app:this._ctx.appId,to:t,room:"",msg:r}));case 4:case"end":return e.stop()}}),e,this)}))),function(e,t){return n.apply(this,arguments)})},{key:"setServerParams",value:(r=km(Em().mark((function e(t,r){return Em().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(e.prev=0,ZP(t,"signature"),ZP(r,"url"),this._loginSessionId&&this._userId){e.next=5;break}throw new lA(uA.NOT_LOGIN,"login first");case 5:return this._checkDataChannelSignal(),e.next=8,this._dataChannelSignal.sendSignaling("setServerParams",{loginSessionId:this._loginSessionId,userId:this._userId,appId:this._ctx.appId,signature:t,url:r},{functionType:oF.C2RTM}).catch((function(e){throw new lA(uA.UNEXPECTED_ERROR,e.msg)}));case 8:this._serverParamsCache={signature:t,url:r},this.emit("onServerParamsSetResult"),e.next=16;break;case 12:throw e.prev=12,e.t0=e.catch(0),this.emit("onServerParamsSetResult",e.t0),e.t0;case 16:case"end":return e.stop()}}),e,this,[[0,12]])}))),function(e,t){return r.apply(this,arguments)})},{key:"sendServerMessage",value:(t=km(Em().mark((function e(t){return Em().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this._loginSessionId&&this._userId){e.next=2;break}throw new lA(uA.NOT_LOGIN,"login first");case 2:return this._checkDataChannelSignal(),e.abrupt("return",this._dataChannelSignal.sendP2PMessage({from:this._userId,app:this._ctx.appId,to:"",room:"",type:$V.BUSINESS_SERVER,msg:t}));case 4:case"end":return e.stop()}}),e,this)}))),function(e){return t.apply(this,arguments)})},{key:"destroy",value:function(){var e;aX.print("destroy","invoke."),CI(RI(c.prototype),"removeAllListeners",this).call(this),this._loginResolveCallback&&this._loginRejectCallback&&(this._loginRejectCallback(new lA(uA.LOGIN_FAILED,"logout")),delete this._loginResolveCallback,delete this._loginRejectCallback),null===(e=this._dataChannelSignal)||void 0===e||e.destroy(),delete this._dataChannelSignal,this._clearState(),this._connectionManager.destroy(),delete this._serverParamsCache}},{key:"_login",value:function(){var e=this;if(this._userId){var t=xO();this._checkDataChannelSignal(),this._dataChannelSignal.sendSignaling("login",{Token:DO.token2auth(this._ctx.appId,null,this._userId,this._token),timestamp:Date.now(),loginSessionId:t,params:{deviceType:"web",userAgent:window.navigator.userAgent,sdkVersion:zP.VERSION,deviceId:UP.getDeviceId(),appId:this._ctx.appId,userId:this._userId}},{functionType:oF.C2RTM}).then((function(){"function"==typeof e._loginResolveCallback&&e._loginResolveCallback(),e._loginSessionId=t,_O.setRtsSessionId(e.id,t),e._wait_login_token=!1,e._serverParamsCache&&e.setServerParams(e._serverParamsCache.signature,e._serverParamsCache.url)})).catch((function(t){var r,n,i=t||{},o=i.code,a=i.message;e._wait_login_token=!1,o>=700&&o<800?708===o?(r=uA.INVALID_PARAMS,n="Invalid userId"):(r=uA.INVALID_TOKEN,n="Invalid token",e._wait_login_token=!0,e._loginRejectCallback||e.emit("onRTMTokenError")):(r=uA.LOGIN_FAILED,n="login failed"),"function"==typeof e._loginRejectCallback&&e._loginRejectCallback(new lA(r,a||n))})).finally((function(){delete e._loginResolveCallback,delete e._loginRejectCallback}))}}},{key:"connect",value:function(){var e=this;return new Wf((function(t,r){e._connectionManager.once("connected",(function(){return t()})),e._connectionManager.once("disconnected",r),e._connectionManager.connect()}))}},{key:"_checkDataChannelSignal",value:function(){if(!this._dataChannelSignal||this._dataChannelSignalState!==Yj.CONNECTED)throw new lA(uA.NOT_CONNECTED_YET,"datachannel not connect")}},{key:"_addConnectHandler",value:function(){var e=this;this._connectionManager.on("connected",(function(t){var r,n;e._dataChannelSignalState=Yj.CONNECTED,aX.print("connectStateChange","connected"),null===(r=e._handler)||void 0===r||r.destroy(),null===(n=e._dataChannelSignal)||void 0===n||n.destroy(),e._handler=kV(e._ctx,t.pc),e._dataChannelSignal=t.signaling,e._addSignalEventHandler(),e.isReconnecting&&e._login()})),this._connectionManager.on("disconnected",(function(t){e._dataChannelSignalState=Yj.DISCONNECTED,aX.print("connectStateChange","disconnected. %o",t),e.isReconnecting&&(e.emit("onUserDisconnection"),e._clearState())})),this._connectionManager.on("connecting",(function(){var t;e.isReconnecting=!1,null===(t=e._handler)||void 0===t||t.destroy(),delete e._handler,e._dataChannelSignalState=Yj.CONNECTING,aX.print("connectStateChange","connecting")})),this._connectionManager.on("reconnecting",(function(){var t;e.isReconnecting=!0,null===(t=e._handler)||void 0===t||t.destroy(),delete e._handler,e._dataChannelSignalState=Yj.CONNECTING,aX.print("connectStateChange","reconnecting")}))}},{key:"_addSignalEventHandler",value:function(){var e,t,r,n=this;null===(e=this._dataChannelSignal)||void 0===e||e.on(AV.USER_MESSAGE_RECEIVED_OUTSIDE_ROOM,(function(e){n.emit("onUserMessageReceivedOutsideRoom",{userId:e.from,message:e.msg})})),null===(t=this._dataChannelSignal)||void 0===t||t.on(AV.USER_BINARY_MESSAGE_RECEIVED_OUTSIDE_ROOM,(function(e){n.emit("onUserBinaryMessageReceivedOutsideRoom",{userId:e.from,message:e.msg})})),null===(r=this._dataChannelSignal)||void 0===r||r.on(AV.USER_DISCONNECTION,(function(){n.emit("onUserDisconnection"),n._clearState()}))}},{key:"_clearState",value:function(){this._userId=null,this._token=null,this._loginSessionId=null,_O.setRtsSessionId(this.id,"")}}]),c}(gD.exports.EventEmitter),cX=function(){function e(t){Yd(this,e),sd(this,"_roomId",void 0),sd(this,"_constraints",{}),sd(this,"_profile",void 0),this._appId=t}return qd(e,[{key:"setRoomId",value:function(e){this._roomId=e}},{key:"setAudioProfile",value:function(e){this._profile=e}},{key:"getOpusConfigStr",value:function(){var e,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"",r=UP.getEngineWebConfig(this._appId,this._roomId||""),n=r.audio_encode,i=this.getConstraints(),o=i.sampleRate,a=i.channelCount,s="number"==typeof o?o:null==o?void 0:o.exact,c="number"==typeof a?a:null==a?void 0:a.exact,u={};t.split(";").forEach((function(e){var t=Qk(e.split("="),2),r=t[0],n=t[1];r&&n&&(u[r]=n)}));var d=(null==n?void 0:n.bitrate)||this._getConfigByAudioProfile().bitrate;d&&(u.maxaveragebitrate=d);var l=(null==n?void 0:n.enc_sample_rate)||s;l&&(u["sprop-maxcapturerate"]=l);var h=(null==n?void 0:n.playback_rate)||s;return h&&(u.maxplaybackrate=h),(c&&c>1||null!=n&&n.stereo)&&(u["sprop-stereo"]=1,u.stereo=1),null!=n&&n.dtx&&(u.usedtx=1),JE(e=an(u)).call(e,(function(e){var t;return wm(t="".concat(e,"=")).call(t,u[e])})).join(";")}},{key:"updateConstraints",value:function(e){this._constraints=ud(ud({},this._constraints),e)}},{key:"getConstraints",value:function(){var e=ud({},this._constraints),t=UP.getEngineWebConfig(this._appId,this._roomId||"").audio_capture;$O(null==t?void 0:t.sample_rate)||(e.sampleRate=t.sample_rate),$O(null==t?void 0:t.channel)||(e.channelCount=t.channel),$O(null==t?void 0:t.agc)||(e.autoGainControl=t.agc),$O(null==t?void 0:t.ans)||(e.noiseSuppression=t.ans),$O(null==t?void 0:t.aec)||(e.echoCancellation=t.aec);var r=this._getConfigByAudioProfile(),n=r.sampleRate,i=r.channel;return $O(e.sampleRate)&&!$O(n)&&(e.sampleRate=n),$O(e.channelCount)&&!$O(i)&&(e.channelCount=i),e}},{key:"_getConfigByAudioProfile",value:function(){var e={};switch(this._profile){case Dd.fluent:e.sampleRate=16e3,e.bitrate=24e3;break;case Dd.standard:e.sampleRate=48e3,e.bitrate=48e3;break;case Dd.hd:e.sampleRate=48e3,e.bitrate=128e3,e.channel=2;break;case Dd.standardStereo:e.sampleRate=48e3,e.bitrate=8e4,e.channel=2;break;case Dd.hdMono:e.sampleRate=48e3,e.bitrate=128e3}return e}}]),e}(),uX=function(e){xI(o,e);var t,r,n,i=WI(o);function o(e,t,r){var n,a=r.businessId;return Yd(this,o),sd(Zk(n=i.call(this)),"_mediaServerClient",void 0),sd(Zk(n),"_appId",void 0),sd(Zk(n),"remoteStreams",void 0),sd(Zk(n),"_businessId",void 0),sd(Zk(n),"_ctx",void 0),n.id=e,n._appId=t,n.remoteStreams=new jS,n._businessId=a,n._ctx={id:n.id,appId:n._appId,avSync:!0,audioProfileManager:new cX(n._appId),useCloudProxy:!1,userPriority:new jS,joinRoomConfig:new FP(n.id)},n}return qd(o,[{key:"connect",value:(n=km(Em().mark((function e(){return Em().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return this._mediaServerClient=new Qj(this._ctx),this._businessId&&(this._mediaServerClient.businessId=this._businessId),this._bindEvents(),e.next=5,this._mediaServerClient.connect();case 5:case"end":return e.stop()}}),e,this)}))),function(){return n.apply(this,arguments)})},{key:"startPlayPublicStream",value:(r=km(Em().mark((function e(t){var r,n=this;return Em().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!this.remoteStreams.get(t)){e.next=2;break}throw new lA(uA.REPEAT_PLAY,"repeat play public media stream");case 2:return(r=new hV(this._ctx,t,t,!1,!0,{audiostream:!0,localaudio:!0,videostream:!0,localvideo:!0,extaudio:!1,extvideo:!1,videoDescriptions:[]})).on("onSEIMessage",(function(e){if(e instanceof Uint8Array)for(var t=QO(e),i=0;i<t.seiCount;i++)n.emit(NV.ON_SEI_MESSAGED_RECEIVED,{sei:t.seis[i],publicStreamId:r.streamId})})),e.next=6,this._mediaServerClient.subscribePublicStream(r);case 6:return this.remoteStreams.set(t,r),e.abrupt("return",r);case 8:case"end":return e.stop()}}),e,this)}))),function(e){return r.apply(this,arguments)})},{key:"stopPlayPublicStream",value:function(e){var t=this.remoteStreams.get(e);if(t)return this.remoteStreams.delete(e),this._mediaServerClient.unsubscribePublicStream(t)}},{key:"destroy",value:function(){var e;this.remoteStreams.forEach((function(e){e.clean()})),this.remoteStreams=new jS,null===(e=this._mediaServerClient)||void 0===e||e.destroy(),this.removeAllListeners()}},{key:"_handleReconnected",value:(t=km(Em().mark((function e(){var t,r,n,i=this;return Em().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:t=Jk(this.remoteStreams);try{for(n=function(){var e=Qk(r.value,1)[0];i.remoteStreams.delete(e),i.startPlayPublicStream(e).then((function(){var t=i.remoteStreams.get(e);i.safeEmit(NV.RESUBSCRIBE,{stream:t})}))},t.s();!(r=t.n()).done;)n()}catch(o){t.e(o)}finally{t.f()}case 2:case"end":return e.stop()}}),e,this)}))),function(){return t.apply(this,arguments)})},{key:"_bindEvents",value:function(){var e,t,r=this;null===(e=this._mediaServerClient)||void 0===e||e.on("joinSuccess",(function(e){e.reconnect&&r._handleReconnected()})),null===(t=this._mediaServerClient)||void 0===t||t.on("onRemoteStreamStats",(function(e){r.emit("onRemoteStreamStats",e)}))}}]),o}(bD),dX=new uO("AudioDeviceManager",1),lX=function(e){xI(c,e);var t,r,n,i,o,a,s=WI(c);function c(e){var t;return Yd(this,c),sd(Zk(t=s.call(this)),"_audioLevelFetcher",void 0),sd(Zk(t),"_playbackDeviceTestTimer",void 0),sd(Zk(t),"_audioElement",void 0),sd(Zk(t),"_audioTrack",void 0),sd(Zk(t),"_mediaRecorder",void 0),sd(Zk(t),"_recoderTimer",void 0),sd(Zk(t),"_isAudioPlaybackDeviceTesting",!1),sd(Zk(t),"_isAudioDeviceRecordTesting",!1),sd(Zk(t),"_audioCaptureAndRecoderResolve",void 0),sd(Zk(t),"_onAutoplayFailed",void 0),sd(Zk(t),"_audioPlaybackDeviceId",void 0),t._extensionManager=e,t}return qd(c,[{key:"audioTrack",get:function(){return this._audioTrack}},{key:"startAudioPlaybackDeviceTest",value:(a=km(Em().mark((function e(t,r){return Em().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!this._isAudioPlaybackDeviceTesting&&!this._isAudioDeviceRecordTesting){e.next=2;break}throw new lA(uA.REPEAT_DEVICE_TEST,"device test cannot be called repeatedly at the same time.");case 2:return this._isAudioPlaybackDeviceTesting=!0,dX.print("startAudioPlaybackDeviceTest()","Invoke"),e.prev=4,e.next=7,this._playAudioFile(t,{loop:!0});case 7:e.next=14;break;case 9:throw e.prev=9,e.t0=e.catch(4),dX.print("startAudioPlaybackDeviceTest()","error",e.t0),this.stopAudioPlaybackDeviceTest(),e.t0;case 14:this._startEmitAudioPlaybackDeviceTestVolume(r);case 15:case"end":return e.stop()}}),e,this,[[4,9]])}))),function(e,t){return a.apply(this,arguments)})},{key:"stopAudioPlaybackDeviceTest",value:function(){this._isAudioPlaybackDeviceTesting&&(dX.print("stopAudioPlaybackDeviceTest()","Invoke"),this._isAudioPlaybackDeviceTesting=!1,this._stopEmitAudioPlaybackDeviceTestVolume(),this._destroyAudioElement())}},{key:"startAudioDeviceRecordTest",value:(o=km(Em().mark((function e(t,r,n){var i,o=this,a=arguments;return Em().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(i=a.length>3&&void 0!==a[3]?a[3]:3e4,window.MediaRecorder){e.next=3;break}throw new lA(uA.NOT_SUPPORTED,"Your browser does not support MediaRecorder.");case 3:if(!this._isAudioDeviceRecordTesting&&!this._isAudioPlaybackDeviceTesting){e.next=5;break}throw new lA(uA.REPEAT_DEVICE_TEST,"device test cannot be called repeatedly at the same time.");case 5:return this._isAudioDeviceRecordTesting=!0,dX.print("startAudioDeviceRecordTest()","Invoke"),this._recoderTimer=window.setTimeout((function(){dX.print("startAudioDeviceRecordTest()","".concat(i,'ms automatic call method "stopAudioDeviceRecordAndPlayTest"')),o._stopAudioCaptureAndRecoder()}),i),e.prev=8,this._onAutoplayFailed=r,e.next=12,this._startAudioCaptureAndRecoder(t,null!=n?n:100);case 12:e.next=19;break;case 14:throw e.prev=14,e.t0=e.catch(8),this._isAudioDeviceRecordTesting=!1,delete this._onAutoplayFailed,e.t0;case 19:delete this._audioCaptureAndRecoderResolve;case 20:case"end":return e.stop()}}),e,this,[[8,14]])}))),function(e,t,r){return o.apply(this,arguments)})},{key:"stopAudioDeviceRecordAndPlayTest",value:function(){dX.print("stopAudioDeviceRecordAndPlayTest()","Invoke"),void 0!==this._recoderTimer&&(clearTimeout(this._recoderTimer),delete this._recoderTimer),this._stopAudioCaptureAndRecoder()}},{key:"stopAudioDevicePlayTest",value:function(){this._isAudioDeviceRecordTesting&&(dX.print("stopAudioDevicePlayTest()","Invoke"),this._isAudioDeviceRecordTesting=!1,this.stopAudioDeviceRecordAndPlayTest(),this._stopEmitAudioPlaybackDeviceTestVolume(),this._destroyAudioElement()),delete this._onAutoplayFailed}},{key:"getRecordTrack",value:function(){return this._audioTrack}},{key:"setSinkId",value:(i=km(Em().mark((function e(t){var r;return Em().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(dX.print("setSinkId()","Invoke"),void 0!==HTMLAudioElement.prototype.setSinkId){e.next=3;break}throw new lA(uA.NOT_SUPPORTED,"setSinkId not supported by current browser");case 3:return e.next=5,qL.getDeviceById(t);case 5:if(r=e.sent){e.next=8;break}throw new lA(uA.INVALID_DEVICE_ID,"audio playback device id ".concat(t," is invalid"));case 8:return this._audioPlaybackDeviceId=t,this._setAudioCtxSinkId(),e.abrupt("return",r);case 11:case"end":return e.stop()}}),e,this)}))),function(e){return i.apply(this,arguments)})},{key:"getSinkId",value:function(){return this._audioPlaybackDeviceId}},{key:"destroy",value:function(){dX.print("destroy()","Invoke"),CI(RI(c.prototype),"removeAllListeners",this).call(this),this.stopAudioPlaybackDeviceTest(),this.stopAudioDevicePlayTest()}},{key:"_playAudioFile",value:(n=km(Em().mark((function e(t,r){var n,i=this;return Em().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return dX.print("_playAudioFile()",wm(n="Invoke url=".concat(t,"; loop=")).call(n,r.loop)),e.abrupt("return",new Wf((function(e,n){var o=IG("audio",{attributes:{src:t,crossOrigin:"anonymous"}});i._audioElement=o,o.loop=r.loop,i._audioLevelFetcher=new tU(o),o.onplaying=function(){o.onplaying=null,dX.print("_playAudioFile()","onplaying"),e()},o.onerror=function(){var e=km(Em().mark((function e(t){var r,i;return Em().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:dX.print("_playAudioFile()","onerror",t),i=t.message||(null==o||null===(r=o.error)||void 0===r?void 0:r.message),n(new lA(uA.LOAD_RESOURCES_FAILED,"Failed to play recorded audio"+(i?", reason: ".concat(i):".")));case 3:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),i._setAudioCtxSinkId().then((function(){var e,t;return null===(e=o.play())||void 0===e||null===(t=e.catch)||void 0===t?void 0:t.call(e,(function(e){var t;dX.print("_playAudioFile()","autoplay error",e);var r=wm(t="Failed to play recorded audio, ".concat(e.name,": ")).call(t,e.message);"NotAllowedError"===e.name&&i._onAutoplayFailed?i._onAutoplayFailed((function(){var e;return Wf.all([null===(e=i._audioLevelFetcher)||void 0===e?void 0:e.resume(),o.play()])})):n(new lA(uA.LOAD_RESOURCES_FAILED,r))}))}))})));case 2:case"end":return e.stop()}}),e)}))),function(e,t){return n.apply(this,arguments)})},{key:"_destroyAudioElement",value:function(){this._audioElement&&(dX.print("_destroyAudioElement()","Invoke"),this._audioElement.onplaying=null,this._audioElement.onerror=null,this._audioElement.src="",delete this._audioElement,"function"==typeof this._audioCaptureAndRecoderResolve&&this._audioCaptureAndRecoderResolve())}},{key:"_startEmitAudioPlaybackDeviceTestVolume",value:function(e){var t=this;e=Math.max(e,100),this._audioElement&&(dX.print("_startEmitAudioPlaybackDeviceTestVolume()","start timer(".concat(e,"ms)")),this._playbackDeviceTestTimer=self.setInterval((function(){t._audioLevelFetcher&&t.emit("onAudioPlaybackDeviceTestVolume",t._audioLevelFetcher.getAudioLevel())}),e))}},{key:"_stopEmitAudioPlaybackDeviceTestVolume",value:function(){var e;void 0!==this._playbackDeviceTestTimer&&(dX.print("_stopEmitAudioPlaybackDeviceTestVolume()","stop timer"),self.clearInterval(this._playbackDeviceTestTimer),delete this._playbackDeviceTestTimer),null===(e=this._audioLevelFetcher)||void 0===e||e.destroy(),delete this._audioLevelFetcher}},{key:"_startAudioCaptureAndRecoder",value:(r=km(Em().mark((function e(t,r){var n,i=this;return Em().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,wU({},this._extensionManager);case 2:return this._audioTrack=e.sent,this._audioTrack.setVolume(r),n=new MediaStream([this._audioTrack.getTrack("preprocessing")]),dX.print("startAudioDeviceRecordTest()","create microphone track success!"),e.abrupt("return",new Wf((function(e,r){var o,a;"function"==typeof MediaRecorder.isTypeSupported&&(o=sE(a=["audio/webm","audio/mp4"]).call(a,(function(e){return MediaRecorder.isTypeSupported(e)})),dX.print("startAudioDeviceRecordTest()","use mimeType: ".concat(o))),i._mediaRecorder=new MediaRecorder(n,o?{mimeType:o}:void 0);var s=i._mediaRecorder.mimeType;i._mediaRecorder.ondataavailable=function(){var n=km(Em().mark((function n(o){var a,c;return Em().wrap((function(n){for(;;)switch(n.prev=n.next){case 0:if(!i._isAudioDeviceRecordTesting){n.next=16;break}return dX.print("startAudioDeviceRecordTest()","get recorded file(mimeType: ".concat(s,").")),c=new Blob([o.data],{type:s}),n.prev=3,n.next=6,i._playAudioFile($K.createObjectURL(c),{loop:!1});case 6:n.next=11;break;case 8:return n.prev=8,n.t0=n.catch(3),n.abrupt("return",r(n.t0));case 11:i._startEmitAudioPlaybackDeviceTestVolume(t),null===(a=i._audioElement)||void 0===a||a.addEventListener("ended",(function(){i.stopAudioDevicePlayTest(),e()})),i._audioCaptureAndRecoderResolve=e,n.next=17;break;case 16:e();case 17:case"end":return n.stop()}}),n,null,[[3,8]])})));return function(e){return n.apply(this,arguments)}}(),i._mediaRecorder.onerror=function(e){r(new lA(uA.AUDIO_DEVICE_TEST_FAILED,e.message||"mediaRecorder error"))},i._audioCaptureAndRecoderResolve=e,i._mediaRecorder.start()})));case 7:case"end":return e.stop()}}),e,this)}))),function(e,t){return r.apply(this,arguments)})},{key:"_stopAudioCaptureAndRecoder",value:function(){var e;this._mediaRecorder&&("recording"===this._mediaRecorder.state&&this._mediaRecorder.stop(),delete this._mediaRecorder),null===(e=this._audioTrack)||void 0===e||e.close(),delete this._audioTrack}},{key:"_setAudioCtxSinkId",value:(t=km(Em().mark((function e(){var t,r,n,i;return Em().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t=this._audioPlaybackDeviceId){"default"===t&&(t="");try{null===(r=rU.getAudioContextInstance())||void 0===r||null===(n=r.setSinkId)||void 0===n||n.call(r,t),dX.print("setSinkId","ctx.sinkId=".concat(t))}catch(o){dX.print("setSinkId",wm(i="failed, ".concat(o.name," - ")).call(i,o.message))}}case 2:case"end":return e.stop()}}),e,this)}))),function(){return t.apply(this,arguments)})}]),c}(gD.exports.EventEmitter),hX=new uO("VideoSnapshot",1),pX=function(e){var t=null==e?void 0:e.domElement;if(t&&!t.paused&&4===t.readyState)return t},_X=function(){var e=km(Em().mark((function e(t,r,n){var i,o,a,s,c,u,d,l;return Em().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(i=document.createElement("canvas"),o=i.getContext("2d")){e.next=4;break}throw new Error("canvas.getContext error");case 4:if(a=function(e,t,n){return t=t||e.width,n=n||e.height,i.width=t,i.height=n,r?o.setTransform(-1,0,0,1,t,0):o.setTransform(1,0,0,1,0,0),o.drawImage(e,0,0,t,n),o.getImageData(0,0,t,n)},s=Date.now(),!(c=pX(n))){e.next=16;break}return hX.print("takeSnapshot","VideoPlayer already set."),e.next=11,a(c,c.videoWidth,c.videoHeight);case 11:return u=e.sent,hX.print("takeSnapshot","success, cost ".concat(Date.now()-s,"ms")),e.abrupt("return",u);case 16:if(!window.ImageCapture){e.next=29;break}if("live"!==(d=new window.ImageCapture(t)).track.readyState||!d.track.enabled||d.track.muted){e.next=29;break}return hX.print("takeSnapshot","use ImageCapture"),e.t0=a,e.next=23,d.grabFrame();case 23:return e.t1=e.sent,e.next=26,(0,e.t0)(e.t1);case 26:return l=e.sent,hX.print("takeSnapshot","success, cost ".concat(Date.now()-s,"ms")),e.abrupt("return",l);case 29:return hX.print("takeSnapshot","use temp video"),e.abrupt("return",new Wf((function(e,r){var n=new MediaStream([t]),i=document.createElement("video");i.setAttribute("playsinline",""),i.muted=!0,document.body.appendChild(i),i.onplaying=function(){var r=a(i,i.videoWidth,i.videoHeight);hX.print("takeSnapshot","success, cost ".concat(Date.now()-s,"ms")),e(r),n.removeTrack(t),i.srcObject=null,i.load()},i.onerror=r,i.srcObject=n,i.play()})));case 31:case"end":return e.stop()}}),e)})));return function(t,r,n){return e.apply(this,arguments)}}(),vX=function(){return{url:"",video:{codec:Ld.H264,width:640,height:360,fps:15,gop:2,kBitRate:fX(640,360,15)},audio:{codec:"AAC",kBitRate:64,sampleRate:48e3,channels:2,AACProfile:Nd.LC},layout:{regions:[],appData:"",backgroundColor:"#000000"}}};function fX(e,t,r){return e*t<=288e3?r<=15?800:1200:e*t<=864e3?r<=15?1200:1800:e*t<=1152e3?r<=15?1600:2400:e*t<=2592e3?r<=15?2500:3750:r<=15?3300:5e3}function mX(e){if("string"!=typeof e||!/^rtmps?:\/\//.test(e))throw new lA(uA.INVALID_PARAMS,"Invalid rtmp address")}function gX(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[];if(null==e||!e.length)throw new lA(uA.INVALID_PARAMS,"regions should not be empty.");var t,r=Jk(e);try{for(r.s();!(t=r.n()).done;){var n=t.value;if("string"!=typeof n.userId)throw new lA(uA.INVALID_PARAMS,"region.userId(".concat(n.userId,") should be a string."));if("boolean"!=typeof n.isScreenStream)throw new lA(uA.INVALID_PARAMS,"region.isScreenStream(".concat(n.isScreenStream,") should be a boolean."))}}catch(i){r.e(i)}finally{r.f()}}function yX(e,t){var r,n,i,o=function(e,r){var n=tb(e).call(e,(function(e,t){return null==e?void 0:e[t]}),t),i=tb(e).call(e,(function(e,t){return null==e?void 0:e[t]}),vX());return n&&r(n)?n:i},a=function(e){return e%2==0?e:e+1},s=a(o(["video","width"],(function(e){return e>=2&&e<=1920}))),c=a(o(["video","height"],(function(e){return e>=2&&e<=1920}))),u=o(["video","fps"],(function(e){return e>=1&&e<=60})),d=(null===(r=t.video)||void 0===r?void 0:r.kBitRate)||0,l=o(["audio","sampleRate"],(function(e){var t;return!!sE(t=[32e3,44100,48e3]).call(t,(function(t){return t===e||t/1e3===e}))}));return{type:"transcode",action:e,transcodeMeta:{transcode:{url:t.url},control:{protocol:"2.0"},audio:{codec:o(["audio","codec"],(function(e){return"AAC"===e})),bitRate:1e3*o(["audio","kBitRate"],(function(e){return e>=32&&e<=192})),sampleRate:l<100?1e3*l:l,channels:o(["audio","channels"],(function(e){var t;return vT(t=[1,2]).call(t,e)})),profile:o(["audio","AACProfile"],(function(e){var t;return vT(t=[Nd.LC,Nd.HEv1,Nd.HEv2]).call(t,e)}))},video:{codec:o(["video","codec"],(function(e){var t;return vT(t=["H264","H265"]).call(t,e)})),fps:u,gop:o(["video","gop"],(function(e){return e>=1&&e<=5}))*u,bitRate:1e3*(d>=16&&d<=1e4?d:fX(s,c,u)),width:s,height:c},layout:{canvas:{bgnd:o(["layout","backgroundColor"],(function(e){return/^#([0-9a-fA-F]{6}|[0-9a-fA-F]{3})$/.test(e)}))},regions:(null===(n=t.layout)||void 0===n||null===(i=n.regions)||void 0===i?void 0:JE(i).call(i,(function(e){var t,r;return{alpha:!e.alpha||+e.alpha>1||+e.alpha<=0?1:+e.alpha,uid:e.userId,zorder:!e.zorder||+e.zorder<0||+e.zorder>100?0:+e.zorder,x:!e.x||+e.x>=1||+e.x<0?0:+e.x,y:!e.y||+e.y>=1||+e.y<0?0:+e.y,w:!e.w||+e.w>1||+e.w<=0?1:+e.w,h:!e.h||+e.h>1||+e.h<=0?1:+e.h,renderMode:e.renderMode&&vT(t=[1,2,3]).call(t,e.renderMode)?e.renderMode:1,contentControl:e.contentControl&&vT(r=[0,1,2]).call(r,e.contentControl)?e.contentControl:0,screen:!!e.isScreenStream}})))||[],app_data:o(["layout","appData"],(function(e){return"string"==typeof e}))}}}}var SX,bX={getDefaultValue:vX,checkStartParams:function(e){var t;mX(e.url),gX(null===(t=e.layout)||void 0===t?void 0:t.regions)},checckUpdateParams:function(e){var t;e.url&&mX(e.url),gX(null===(t=e.layout)||void 0===t?void 0:t.regions)},getStartParams:function(e){return yX("started",e)},getUpdateParams:function(e){return yX("layoutChanged",e)}},EX=ad,TX=tc,kX=function(e,t,r,n){for(var i,o=n>1?void 0:n?TX(t,r):t,a=e.length-1;a>=0;a--)(i=e[a])&&(o=(n?i(t,r,o):i(o))||o);return n&&o&&EX(t,r,o),o},IX=new uO("Engine",0),RX=function(e){xI(Ee,e);var t,r,n,i,o,a,s,c,u,d,l,h,p,_,v,f,m,g,y,S,b,E,T,k,I,R,A,C,w,x,O,P,D,M,N,L,U,V,F,B,j,G,H,z,K,X,W,q,Y,J,Q,Z,$,ee,te,re,ne,ie,oe,ae,se,ce,ue,de,le,he,pe,_e,ve,fe,me,ge,ye,Se,be=WI(Ee);function Ee(e,t,r){var n;return Yd(this,Ee),sd(Zk(n=be.call(this)),"monitor",void 0),sd(Zk(n),"_room",void 0),sd(Zk(n),"_publicStreamManager",void 0),sd(Zk(n),"_appId",void 0),sd(Zk(n),"_businessId",void 0),sd(Zk(n),"_visibility",!0),sd(Zk(n),"_localVideoTrack",void 0),sd(Zk(n),"_localAudioTrack",void 0),sd(Zk(n),"_localImgVideoTrack",void 0),sd(Zk(n),"_localImgScreenTrack",void 0),sd(Zk(n),"_localScreenVideoTrack",void 0),sd(Zk(n),"_localScreenAudioTrack",void 0),sd(Zk(n),"_tempMixingAudioTrack",void 0),sd(Zk(n),"_localAudioVolume",100),sd(Zk(n),"_localScreenAudioVolume",100),sd(Zk(n),"_remoteAudioVolume",new jS),sd(Zk(n),"_remoteScreenAudioVolume",new jS),sd(Zk(n),"_publicAudioVolume",new jS),sd(Zk(n),"_videoPlayer",void 0),sd(Zk(n),"_screenPlayer",void 0),sd(Zk(n),"_remoteVideoPlayer",new jS),sd(Zk(n),"_remoteScreenPlayer",new jS),sd(Zk(n),"_remoteAudioPlayer",new jS),sd(Zk(n),"_remoteScreenAudioPlayer",new jS),sd(Zk(n),"_publicStreamAudioPlayer",new jS),sd(Zk(n),"_publicStreamVideoPlayer",new jS),sd(Zk(n),"_publicStreamIds",new jS),sd(Zk(n),"_roomConfig",void 0),sd(Zk(n),"_videoStreamConstraints",qP),sd(Zk(n),"_audioStreamConstraints",{}),sd(Zk(n),"_enableSimulcast",!1),sd(Zk(n),"_videoStreamEncodeConfig",[qP]),sd(Zk(n),"_screenStreamEncodeConfig",[YP]),sd(Zk(n),"_dummyMainImage",void 0),sd(Zk(n),"_dummyScreenImage",void 0),sd(Zk(n),"_trackSourceType",void 0),sd(Zk(n),"_liveTranscodeConfig",void 0),sd(Zk(n),"_startCloudProxyTimestamp",void 0),sd(Zk(n),"_localVideoDeviceId",void 0),sd(Zk(n),"_localAudioDeviceId",void 0),sd(Zk(n),"_pauseAllSubscribeState",{audio:void 0,video:void 0,resumeStreamIds:{}}),sd(Zk(n),"_audioVolumeIndicationTimer",void 0),sd(Zk(n),"_dummyMainTimer",void 0),sd(Zk(n),"_dummyScreenTimer",void 0),sd(Zk(n),"_audioPropertiesReportTimer",null),sd(Zk(n),"_mirrorType",Td.MIRROR_TYPE_RENDER),sd(Zk(n),"_audioMixingManager",void 0),sd(Zk(n),"_pubLock",void 0),sd(Zk(n),"_rtmClient",void 0),sd(Zk(n),"_messageStatisticsObserver",void 0),sd(Zk(n),"_tempRoomInfo",void 0),sd(Zk(n),"_originIceConfigRequestUrls",void 0),sd(Zk(n),"_originConfigServerUrls",void 0),sd(Zk(n),"_originLogServerUrl",void 0),sd(Zk(n),"_extensionManager",void 0),sd(Zk(n),"_audioDeviceManager",void 0),sd(Zk(n),"_remoteVideoConfig",new jS),sd(Zk(n),"_cameraCapturing",!1),sd(Zk(n),"_interruptCameraCapture",!1),sd(Zk(n),"_micCapturing",!1),sd(Zk(n),"_interruptMicCapture",!1),sd(Zk(n),"_config",void 0),sd(Zk(n),"_needClosePreTrack",!1),sd(Zk(n),"_ctx",void 0),sd(Zk(n),"_updateMixAudioTrack",function(){var e=km(Em().mark((function e(t){var r,i,o=arguments;return Em().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(i=o.length>1&&void 0!==o[1]?o[1]:Hd.PLAYOUT_AND_PUBLISH,IX.print("_updateMixAudioTrack()"),n._localAudioTrack){e.next=5;break}return t&&(n._tempMixingAudioTrack={track:t,type:i}),e.abrupt("return");case 5:if(t?(n._localAudioTrack.mixType=i,n._localAudioTrack.mixedAudioTrack=t):(delete n._localAudioTrack.mixType,delete n._localAudioTrack.mixedAudioTrack),null===(r=n._room)||void 0===r||!r.hasPublished){e.next=9;break}return e.next=9,n._updatePublish();case 9:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()),sd(Zk(n),"_onAudioMixingMessage",(function(e){n.safeEmit(Xd.onAudioMixingStateChanged,e)})),sd(Zk(n),"_onAudioMixingAutoplayFailed",(function(e){n.safeEmit(Xd.onAutoplayFailed,e)})),n.id=t,n._appId=e,n._pubLock=new MV("pubLock"),n._addDeviceEventHandler(),n._extensionManager=new iU(t),n._audioDeviceManager=new lX(n._extensionManager),n._audioMixingManager=new iX({getLocalAudioTrack:function(){return n._localAudioTrack},updateLocalAudioTrack:n._updateMixAudioTrack,emitMessage:n._onAudioMixingMessage,onAutoPlayFailed:n._onAudioMixingAutoplayFailed},t),n._ctx={id:t,appId:e,avSync:!0,streamRTT:{},useCloudProxy:!1,audioProfileManager:new cX(e),userPriority:new jS,expectedIDC:null==r?void 0:r.expectedIDC,joinRoomConfig:new FP(t)},window.__rtc_engine__=Zk(n),window["__rtc_engine__".concat(Math.floor(100*Math.random()+1))]=Zk(n),n._trackSourceType={video:dd.VIDEO_SOURCE_TYPE_INTERNAL,screenVideo:dd.VIDEO_SOURCE_TYPE_INTERNAL,audio:ld.AUDIO_SOURCE_TYPE_INTERNAL,screenAudio:ld.AUDIO_SOURCE_TYPE_INTERNAL},n._config=r,n._rtmClient=new sX(n._ctx),n._handleRTMClient(n._rtmClient),n._handleAudioDeviceManager(),n._messageStatisticsObserver=new vO(t),n.monitor=EO(t),_O.createRTSMsgReportor(n.id),n._getServerConfig(),n}return qd(Ee,[{key:"appId",get:function(){return this._appId},set:function(e){this._appId=e}},{key:"updateToken",value:(Se=km(Em().mark((function e(t){var r,n,i,o,a;return Em().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(IX.print("updateToken()","token: %s",t),ZP(t,"token"),!this.waitForNewToken||!this._tempRoomInfo){e.next=8;break}return n=this._tempRoomInfo,i=n.config,o=n.userInfo,a=n.roomId,delete this._tempRoomInfo,e.next=7,this.joinRoom(t,a,o,i);case 7:return e.abrupt("return",e.sent);case 8:if(this._room){e.next=10;break}throw new lA(uA.UPDATE_TOKEN_BEFORE_JOIN,"update token before join room");case 10:return e.next=12,null===(r=this._room)||void 0===r?void 0:r.updateToken(t);case 12:case"end":return e.stop()}}),e,this)}))),function(e){return Se.apply(this,arguments)})},{key:"setVideoCaptureDevice",value:(ye=km(Em().mark((function e(t){var r,n,i,o=this;return Em().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(IX.print("setVideoCaptureDevice()","deviceId: %s",t),ZP(t,"deviceId"),this._localVideoDeviceId=t,this._localVideoTrack){e.next=5;break}return e.abrupt("return");case 5:return r=LB({},this._videoStreamConstraints),"user"===t||"environment"===t||"left"===t||"right"===t?(delete r.deviceId,r.facingMode=t):r.deviceId={exact:t},yP&&cP&&wP>=85&&wP<=91&&(null===(n=this._videoPlayer)||void 0===n||n.removeTrack()),this._needClosePreTrack=this._needClosePreTrack||yP&&cP,this._needClosePreTrack&&(this._removeLocalTrackEvents(this._localVideoTrack),this._localVideoTrack.close(),delete this._localVideoTrack),IX.print("setVideoCaptureDevice()","start createCameraVideoTrack..."),e.next=13,AU(r,this._extensionManager).catch((function(e){if(o._localVideoTrack&&!o._localVideoTrack.dummy)return IX.print("setVideoCaptureDevice()","createCameraVideoTrack failed, stop pre VideoTrack."),o._removeLocalTrackEvents(o._localVideoTrack),o._localVideoTrack.close(),delete o._localVideoTrack,AU(r,o._extensionManager).then((function(e){return o._needClosePreTrack=!0,e})).catch(km(Em().mark((function t(){var r;return Em().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return IX.print("setVideoCaptureDevice()","createCameraVideoTrack failed, rollback."),t.next=3,AU(o._videoStreamConstraints,o._extensionManager);case 3:throw r=t.sent,o._switchTrack(r),e;case 6:case"end":return t.stop()}}),t)}))));throw e}));case 13:return i=e.sent,IX.print("setVideoCaptureDevice()","createCameraVideoTrack success."),this._videoStreamConstraints=r,this._localVideoTrack&&(this._removeLocalTrackEvents(this._localVideoTrack),this._localVideoTrack.close()),e.next=19,this._switchTrack(i);case 19:case"end":return e.stop()}}),e,this)}))),function(e){return ye.apply(this,arguments)})},{key:"setAudioCaptureDevice",value:(ge=km(Em().mark((function e(t){var r,n,i;return Em().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(IX.print("setAudioCaptureDevice()","deviceId: %s",t),ZP(t,"deviceId"),this._localAudioDeviceId=t,this._localAudioTrack){e.next=5;break}return e.abrupt("return");case 5:return this._ctx.audioProfileManager.updateConstraints({deviceId:{exact:t}}),this._localAudioTrack.close(),this._removeLocalTrackEvents(this._localAudioTrack),e.prev=8,this._micCapturing=!0,e.next=12,wU(this._ctx.audioProfileManager.getConstraints(),this._extensionManager);case 12:if(i=e.sent,!this._interruptMicCapture){e.next=17;break}return this._interruptMicCapture=!1,i.close(),e.abrupt("return");case 17:if(this._initLocalTrackEvents(i),this._localAudioTrack=i,this._localAudioTrack.setVolume(this._localAudioVolume),this._room){e.next=22;break}return e.abrupt("return");case 22:if(null===(r=this._room)||void 0===r||null===(n=r.localStream)||void 0===n||!n.pubAudio){e.next=25;break}return e.next=25,this._updatePublish();case 25:return e.prev=25,this._micCapturing=!1,e.finish(25);case 28:case"end":return e.stop()}}),e,this,[[8,,25,28]])}))),function(e){return ge.apply(this,arguments)})},{key:"_addDeviceEventHandler",value:function(){qL.on(Xd.onVideoDeviceStateChanged,this._onVideoDeviceStateChange.bind(this)),qL.on(Xd.onAudioDeviceStateChanged,this._onAudioDeviceStateChange.bind(this))}},{key:"_addHandlerEventHandler",value:function(){var e,t,r,n,i,o,a,s,c,u,d,l,h,p,_,v,f,m,g,y,S,b,E,T,k,I,R,A,C,w,x,O,P,D,M,N=this;null===(e=this._room)||void 0===e||e.on(AV.ON_ADD_STREAM,this._onAddStream.bind(this)),null===(t=this._room)||void 0===t||t.on(AV.ON_REMOVE_STREAM,this._onRemoveStream.bind(this)),null===(r=this._room)||void 0===r||r.on(AV.USER_CONNECTION,this._onUserConnection.bind(this)),null===(n=this._room)||void 0===n||n.on(NV.ON_USER_LEAVE,this._onUserLeave.bind(this)),null===(i=this._room)||void 0===i||i.on(NV.ON_ROOM_ERROR,this._onRoomError.bind(this)),null===(o=this._room)||void 0===o||o.on(NV.ON_NETWORK_QUALITY,this._onNetworkQuality.bind(this)),null===(a=this._room)||void 0===a||a.on(AV.ON_CUSTOM_MESSAGE,this._onCustomMessage.bind(this)),null===(s=this._room)||void 0===s||s.on(AV.USER_MESSAGE_RECEIVED,this._onUserMessageReceived.bind(this)),null===(c=this._room)||void 0===c||c.on(AV.USER_BINARY_MESSAGE_RECEIVED,this._onUserBinaryMessageReceived.bind(this)),null===(u=this._room)||void 0===u||u.on(AV.ON_USER_TOKEN_WILL_EXPIRE,this._onUserTokenWillExpire.bind(this)),null===(d=this._room)||void 0===d||d.on(AV.POST_PROCESSING_MESSAGE,(function(e){"2.0"===e.protocol?N._onStreamMixingEvent({error:e.error,event:e.eventType,message:e.message}):"publicStreamCallback"===e.type?N._onPushPublicStreamResult(e):"transcodeStatusCallback"===e.type&&N._onLiveTranscodingResult(e)})),null===(l=this._room)||void 0===l||l.on(wV.ON_CONNECTION_STATE_CHANGE,this._onConnectionStateChange.bind(this)),null===(h=this._room)||void 0===h||h.on(wV.ON_VENDOR_CONNECTION_STATE_CHANGE,(function(e){return N.safeEmit(Xd.onVendorConnectionStateChanged,e)})),null===(p=this._room)||void 0===p||p.on(NV.RESUBSCRIBE,this._onResubscribe.bind(this)),null===(_=this._room)||void 0===_||_.on(NV.SUBSCRIBE_PUSH_TRACK,this._onSubscribePushTrack.bind(this)),null===(v=this._room)||void 0===v||v.on(NV.REMOVE_PUSH_TRACK,this._onRemovePushTrack.bind(this)),null===(f=this._room)||void 0===f||f.on(NV.ON_PUBLISH_RESULT,(function(e){var t;null!==(t=N._room)&&void 0!==t&&t._roomConfig.isAutoPublish&&N.safeEmit(Xd.onAutoPublishResult,e)})),null===(m=this._room)||void 0===m||m.on(NV.ON_REMOTE_STREAM_STATS,(function(e){N.safeEmit(Xd.onRemoteStreamStats,e)})),null===(g=this._room)||void 0===g||g.on(NV.ON_LOCAL_STREAM_STATS,(function(e){N.safeEmit(Xd.onLocalStreamStats,e)})),null===(y=this._room)||void 0===y||y.on(NV.ON_SUBTITLE_STATE_CHANGED,(function(e){N.safeEmit(Xd.onSubtitleStateChanged,e)})),null===(S=this._room)||void 0===S||S.on(NV.ON_SUBTITLE_MESSAGE_RECEIVED,(function(e){N.safeEmit(Xd.onSubtitleMessageReceived,e)})),null===(b=this._room)||void 0===b||b.on(NV.ON_USER_PUBLISH_STATE_CHANGE,this._onUserPublishStateChange.bind(this)),null===(E=this._room)||void 0===E||E.on(NV.ON_USER_START_AUDIO_CAPTURE,(function(e,t){var r=e.userId;N._updateAudioPlayerState(t),N.safeEmit(Xd.onUserStartAudioCapture,{userId:r})})),null===(T=this._room)||void 0===T||T.on(NV.ON_USER_STOP_AUDIO_CAPTURE,(function(e){var t=e.userId;N.safeEmit(Xd.onUserStopAudioCapture,{userId:t})})),null===(k=this._room)||void 0===k||k.on(NV.ON_USER_START_VIDEO_CAPTURE,(function(e){var t=e.userId;N.safeEmit(Xd.onUserStartVideoCapture,{userId:t})})),null===(I=this._room)||void 0===I||I.on(NV.ON_USER_STOP_VIDEO_CAPTURE,(function(e){var t=e.userId;N.safeEmit(Xd.onUserStopVideoCapture,{userId:t})})),null===(R=this._room)||void 0===R||R.on(NV.ON_SEI_MESSAGED_RECEIVED,(function(e){N.safeEmit(Xd.onSEIMessageReceived,e)})),null===(A=this._room)||void 0===A||A.on(NV.ON_REMOTE_VIDEO_SIZE_CHANGED,(function(e,t){N.safeEmit(Xd.onRemoteVideoSizeChanged,e,t)})),null===(C=this._room)||void 0===C||C.on(NV.ON_SIMULCAST_SUBSCRIBE_FALLBACK,(function(e){return N.safeEmit(Xd.onSimulcastSubscribeFallback,e)})),null===(w=this._room)||void 0===w||w.on(NV.RECONNECT_FAILED,(function(){N.safeEmit(Xd.onError,{errorCode:uA.RECONNECT_FAILED})})),null===(x=this._room)||void 0===x||x.on(NV.ON_VIDEO_STREAM_BANNED,(function(e){N.safeEmit(Xd.onVideoStreamBanned,{uid:e.uid,banned:e.banned})})),null===(O=this._room)||void 0===O||O.on(NV.ON_AUDIO_STREAM_BANNED,(function(e){N.safeEmit(Xd.onAudioStreamBanned,{uid:e.uid,banned:e.banned})})),null===(P=this._room)||void 0===P||P.on(NV.ON_FORWARD_STREAM_ERROR,(function(e){N.safeEmit(Xd.onForwardStreamError,e)})),null===(D=this._room)||void 0===D||D.on(NV.ON_REJOIN_WITH_TCP,(function(){N.safeEmit(Xd.onRejoinWithTcp)})),null===(M=this._room)||void 0===M||M.on(NV.ON_ICE_CONNECT_WITH_TCP,(function(){N.safeEmit(Xd.onIceConnectWithTcp)}))}},{key:"safeEmit",value:function(e){for(var t,r,n=arguments.length,i=new Array(n>1?n-1:0),o=1;o<n;o++)i[o-1]=arguments[o];return pD(e)&&kO(this.id,e,i),(t=CI(RI(Ee.prototype),"safeEmit",this)).call.apply(t,wm(r=[this,e]).call(r,i))}},{key:"_removeHandlerEventHandler",value:function(){var e;null===(e=this._room)||void 0===e||e.removeAllListeners()}},{key:"connect",value:(me=km(Em().mark((function e(){return Em().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!this._room){e.next=2;break}return e.abrupt("return",!1);case 2:return this._room=new kG({isAutoPublish:!0,isAutoSubscribeAudio:!0,isAutoSubscribeVideo:!0,roomProfileType:Pd.communication},this._ctx),this._addHandlerEventHandler(),e.next=6,this._room.connect(this._appId);case 6:case"end":return e.stop()}}),e,this)}))),function(){return me.apply(this,arguments)})},{key:"joinRoom",value:(fe=km(Em().mark((function e(t,r,n,i){var o,a,s,c,u,d;return Em().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(IX.print("joinRoom()","token: %o roomId: %o, userInfo: %o, roomConfig: %o",t,r,n,i),oD(t)||ZP(t,"token"),aD(r),uD(n),dD(i=LB({isAutoPublish:!0,isAutoSubscribeAudio:!0,isAutoSubscribeVideo:!0,roomProfileType:Pd.communication},i)),(null===(o=this._room)||void 0===o?void 0:o.connectionState)!==Yj.CONNECTED){e.next=8;break}throw new lA(uA.REPEAT_JOIN,"Already joined");case 8:return this._room||(this._room=new kG(i,this._ctx),this._addHandlerEventHandler()),this._room.roomConfig=i,a=this._liveTranscodeConfig&&bX.getStartParams(this._liveTranscodeConfig),s=ud(ud({},n),{},{businessId:this._businessId,role:this._visibility?oX.NORMAL_USER:oX.SILENT_USER}),e.prev=12,this._ctx.useCloudProxy&&(this._startCloudProxyTimestamp=Date.now()),pG(s),e.next=17,this._room.join(this._appId,r,t,s,a);case 17:return u=e.sent,this._roomConfig=i,this._ctx.audioProfileManager.setRoomId(r),this._tempRoomInfo&&delete this._tempRoomInfo,null!==(c=i)&&void 0!==c&&c.isAutoPublish&&(this._visibility?this._updatePublish({invokeByJoinRoom:!0,mediaType:Sd.AUDIO_AND_VIDEO}):this.safeEmit(Xd.onAutoPublishResult,{isScreen:!1,state:fd.PUBLISH_FAIL})),_O.setRoomId(this.id,r),_O.setUserId(this.id,n.userId),e.abrupt("return",u);case 27:throw e.prev=27,e.t0=e.catch(12),e.t0.code===uA.INVALID_TOKEN&&(this._tempRoomInfo={config:i,roomId:r,userInfo:s}),null===(d=this._room)||void 0===d||d.destroy(),delete this._room,e.t0;case 33:case"end":return e.stop()}}),e,this,[[12,27]])}))),function(e,t,r,n){return fe.apply(this,arguments)})},{key:"leaveRoom",value:(ve=km(Em().mark((function e(){var t,r,n,i=arguments;return Em().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t=i.length>0&&void 0!==i[0]&&i[0],IX.print("leaveRoom()"),!t){e.next=7;break}return e.next=5,null===(r=this._room)||void 0===r?void 0:r.leave(t);case 5:e.next=8;break;case 7:null===(n=this._room)||void 0===n||n.leave(t).catch();case 8:this._removeHandlerEventHandler(),this._ctx.audioProfileManager.setRoomId(),this._liveTranscodeConfig&&this.stopLiveTranscoding(),this._room=void 0,this._remoteAudioPlayer.forEach((function(e){return e.destroy()})),this._remoteAudioPlayer=new jS,this._remoteScreenAudioPlayer.forEach((function(e){return e.destroy()})),this._remoteScreenAudioPlayer=new jS,this._remoteScreenPlayer.forEach((function(e){return e.destroy()})),this._remoteScreenPlayer=new jS,this._remoteVideoPlayer.forEach((function(e){return e.destroy()})),this._remoteVideoPlayer=new jS,this._roomConfig=void 0,this._publicStreamIds=new jS,_O.setRoomId(this.id,""),_O.setUserId(this.id,"");case 24:case"end":return e.stop()}}),e,this)}))),function(){return ve.apply(this,arguments)})},{key:"destroy",value:function(){var e,t,r;IX.print("destroy()"),this.removeAllListeners(),this._removeHandlerEventHandler(),null===(e=this._room)||void 0===e||e.destroy(),this._room=void 0,null===(t=this._videoPlayer)||void 0===t||t.destroy(),this._videoPlayer=void 0,this._screenPlayer=void 0,this._videoStreamConstraints={},this._videoStreamEncodeConfig=[qP],this._screenStreamEncodeConfig=[YP],this._pauseAllSubscribeState={audio:void 0,video:void 0,resumeStreamIds:{}},this._messageStatisticsObserver.destroy(),this.monitor.destroy(),_O.destroyRTSMsgReportor(this.id),clearInterval(this._audioVolumeIndicationTimer),clearInterval(this._dummyMainTimer),clearInterval(this._dummyScreenTimer),this._audioVolumeIndicationTimer=void 0,this._stopAudioPropertiesReport(),this._localAudioTrack&&(this._removeLocalTrackEvents(this._localAudioTrack),this._localAudioTrack.close(),this._localAudioTrack=void 0),this._localVideoTrack&&(this._removeLocalTrackEvents(this._localVideoTrack),this._localVideoTrack.close(),this._localVideoTrack=void 0),this._localScreenAudioTrack&&(this._removeLocalTrackEvents(this._localScreenAudioTrack),this._localScreenAudioTrack.close(),this._localScreenAudioTrack=void 0),this._localScreenVideoTrack&&(this._removeLocalTrackEvents(this._localScreenVideoTrack),this._localScreenVideoTrack.close(),this._localScreenVideoTrack=void 0),this._localImgVideoTrack&&(this._localImgVideoTrack.stop(),this._localImgVideoTrack=void 0),this._localImgScreenTrack&&(this._localImgScreenTrack.stop(),this._localImgScreenTrack=void 0),this._remoteAudioPlayer.forEach((function(e){return e.destroy()})),this._remoteAudioPlayer=new jS,this._remoteScreenAudioPlayer.forEach((function(e){return e.destroy()})),this._remoteScreenAudioPlayer=new jS,this._remoteScreenPlayer.forEach((function(e){return e.destroy()})),this._remoteScreenPlayer=new jS,this._remoteVideoPlayer.forEach((function(e){return e.destroy()})),this._remoteVideoPlayer=new jS,this._publicStreamAudioPlayer.forEach((function(e){return e.destroy()})),this._publicStreamAudioPlayer=new jS,this._publicStreamVideoPlayer.forEach((function(e){return e.destroy()})),this._publicStreamVideoPlayer=new jS,this._roomConfig=void 0,this._audioMixingManager.destroy(),this._rtmClient.destroy(),null===(r=this._publicStreamManager)||void 0===r||r.destroy(),this._publicStreamIds=new jS,this._audioDeviceManager.destroy(),this._remoteVideoConfig=new jS,this._ctx.userPriority.clear(),this._extensionManager.destroy(),this._cameraCapturing=!1,this._micCapturing=!1,this._interruptCameraCapture=!1,this._interruptMicCapture=!1,this._ctx.avSync=!0,this._localAudioVolume=100,this._localScreenAudioVolume=100,this._remoteAudioVolume.clear(),this._remoteScreenAudioVolume.clear(),this._publicAudioVolume.clear()}},{key:"publishStream",value:(_e=km(Em().mark((function e(t){return Em().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(IX.print("publishStream()","mediaType: %o",t),this._checkMediaType(t),this._assertNotInRoom(),!YO(t)||this._localVideoTrack||!this._localImgVideoTrack){e.next=7;break}return e.next=6,TU(this._localImgVideoTrack,this._extensionManager);case 6:this._localVideoTrack=e.sent;case 7:return e.next=9,this._updatePublish({mediaType:t});case 9:case"end":return e.stop()}}),e,this)}))),function(e){return _e.apply(this,arguments)})},{key:"unpublishStream",value:(pe=km(Em().mark((function e(t,r){var n;return Em().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(IX.print("unpublishStream()","mediaType: %o",t),this._checkMediaType(t),this._assertNotInRoom(),!r){e.next=5;break}return e.abrupt("return",null===(n=this._room)||void 0===n?void 0:n.unpublish());case 5:return e.next=7,this._updatePublish({mediaType:t,pubState:UV.UNPUB});case 7:case"end":return e.stop()}}),e,this)}))),function(e,t){return pe.apply(this,arguments)})},{key:"publishScreen",value:(he=km(Em().mark((function e(t){return Em().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(IX.print("publishScreen()","mediaType: %o",t),this._checkMediaType(t),this._assertNotInRoom(),e.prev=3,!YO(t)||this._localScreenVideoTrack||!this._localImgScreenTrack){e.next=8;break}return e.next=7,IU(this._localImgScreenTrack,this._extensionManager);case 7:this._localScreenVideoTrack=e.sent;case 8:return e.next=10,this._updateScreenPublish({mediaType:t,pubState:UV.PUB});case 10:e.next=19;break;case 12:if(e.prev=12,e.t0=e.catch(3),!(e.t0 instanceof lA)){e.next=18;break}throw e.t0;case 18:throw new lA(uA.UNEXPECTED_ERROR,"unexpected error",e.t0);case 19:case"end":return e.stop()}}),e,this,[[3,12]])}))),function(e){return he.apply(this,arguments)})},{key:"unpublishScreen",value:(le=km(Em().mark((function e(t){return Em().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return IX.print("unpublishScreen()","mediaType: %o",t),this._checkMediaType(t),this._assertNotInRoom(),e.next=5,this._updateScreenPublish({mediaType:t,pubState:UV.UNPUB});case 5:case"end":return e.stop()}}),e,this)}))),function(e){return le.apply(this,arguments)})},{key:"subscribeStream",value:(de=km(Em().mark((function e(t,r){return Em().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return IX.print("subscribeStream()","userId: %o, mediaType: %o",t,r),e.abrupt("return",this._subscribe(!1,t,r));case 2:case"end":return e.stop()}}),e,this)}))),function(e,t){return de.apply(this,arguments)})},{key:"_subscribe",value:(ue=km(Em().mark((function e(t,r,n){var i,o,a,s,c,u,d,l,h,p,_,v,f,m,g,y;return Em().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this._checkMediaType(n),this._assertNotInRoom(),n!==Sd.AUDIO||null===(i=this._room)||void 0===i||!i.multiChatMode){e.next=5;break}return IX.print("subscribeStream()","due to multiChatMode return"),e.abrupt("return");case 5:if(u=this._room.remoteStreams.get(r),d=null==u?void 0:sE(u).call(u,(function(e){return e.isScreen===t}))){e.next=9;break}throw new lA(uA.STREAM_NOT_EXIST,"stream not exist");case 9:return l=this._pauseAllSubscribeState.audio,h=this._pauseAllSubscribeState.video,this._pauseAllSubscribeState.audio&&(n-=n&Sd.AUDIO),this._pauseAllSubscribeState.video&&(n-=n&Sd.VIDEO),IX.print("subscribeStream()","due to pauseAll mediaType: %o",n),p=d.hasSubscribed,_=this._remoteVideoConfig.get(r)||(null===(o=this._roomConfig)||void 0===o?void 0:o.remoteVideoConfig),d.originalMediaType=n,e.next=19,this._room.subscribe(d,n,_);case 19:qO(n)&&this._updateAudioPlayerState(d),YO(n)&&this._updateVideoPlayerState(d),v=0,f=0,l!==this._pauseAllSubscribeState.audio&&(this._pauseAllSubscribeState.audio?v|=Sd.AUDIO:f|=Sd.AUDIO),h!==this._pauseAllSubscribeState.video&&(this._pauseAllSubscribeState.video?v|=Sd.VIDEO:f|=Sd.VIDEO),v&&this.pauseAllSubscribedStream(v),f&&this.resumeAllSubscribedStream(f),this._pauseAllSubscribeState.resumeStreamIds[d.streamId]=d.streamId,!t&&(null!==(a=this._roomConfig)&&void 0!==a&&a.isAutoSubscribeAudio||null!==(s=this._roomConfig)&&void 0!==s&&s.isAutoSubscribeVideo)&&(d.audioTrack||d.videoTrack)&&(m={userId:r,isScreen:!1,state:vd.SUBSCRIBE_SUCC},this.safeEmit(Xd.onAutoSubscribeResult,m)),null!==(c=this._room)&&void 0!==c&&c.multiChatMode||p||!qO(n)||!d.hasAudio||null===(g=d.observer)||void 0===g||g.setSubscribeAudio(!0),!p&&YO(n)&&d.hasVideo&&(null===(y=d.observer)||void 0===y||y.setSubscribeVideo(!0));case 31:case"end":return e.stop()}}),e,this)}))),function(e,t,r){return ue.apply(this,arguments)})},{key:"unsubscribeStream",value:(ce=km(Em().mark((function e(t,r){return Em().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:IX.print("unsubscribeStream()","userId: %o, mediaType: %o",t,r),this._unsubscribe(!1,t,r);case 2:case"end":return e.stop()}}),e,this)}))),function(e,t){return ce.apply(this,arguments)})},{key:"subscribeScreen",value:(se=km(Em().mark((function e(t,r){return Em().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return IX.print("subscribeScreen() userId: %o, mediaType: %o",t,r),e.abrupt("return",this._subscribe(!0,t,r));case 2:case"end":return e.stop()}}),e,this)}))),function(e,t){return se.apply(this,arguments)})},{key:"unsubscribeScreen",value:(ae=km(Em().mark((function e(t,r){return Em().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:IX.print("unsubscribeScreen() userId: %o, mediaType: %o",t,r),this._unsubscribe(!0,t,r);case 2:case"end":return e.stop()}}),e,this)}))),function(e,t){return ae.apply(this,arguments)})},{key:"_unsubscribe",value:function(e,t,r,n){var i,o=this;if(this._checkMediaType(r),this._assertNotInRoom(),r!==Sd.AUDIO||null===(i=this._room)||void 0===i||!i.multiChatMode){var a,s=this._room.remoteStreams.get(t),c=null==s?void 0:sE(s).call(s,(function(t){return t.isScreen===e}));if(null==c||!c.hasSubscribed)throw new lA(uA.STREAM_NOT_EXIST,"stream not exist");if(yP&&wP&&wP>=85&&wP<=91&&r!==Sd.AUDIO)null===(a=e?this._remoteScreenPlayer.get(t):this._remoteVideoPlayer.get(t))||void 0===a||a.stop();return this._room.unsubscribe(c,r).then((function(){n||delete o._pauseAllSubscribeState.resumeStreamIds[c.streamId]}))}IX.print("subscribeStream()","due to multiChatMode return")}},{key:"setRemoteVideoConfig",value:(oe=km(Em().mark((function e(t,r){var n;return Em().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return IX.print("setRemoteVideoConfig() userId: %o, remoteVideoConfig: %o",t,r),sD(t),_D(r),this._remoteVideoConfig.set(t,r),e.abrupt("return",null===(n=this._room)||void 0===n?void 0:n.updateSubVideoConfig(t,r).then((function(){})));case 5:case"end":return e.stop()}}),e,this)}))),function(e,t){return oe.apply(this,arguments)})},{key:"startVideoCapture",value:(ie=km(Em().mark((function e(t){var r,n,i,o,a,s,c,u,d,l,h,p=this;return Em().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(IX.print("startVideoCapture()","deviceId: %s",t),oD(t)||ZP(t,"deviceId"),t=t||this._localVideoDeviceId,this._localVideoDeviceId=t,this._trackSourceType.video!==dd.VIDEO_SOURCE_TYPE_EXTERNAL){e.next=6;break}throw new lA(uA.STREAM_TYPE_NOT_MATCH,"setVideoSourceType as internal first");case 6:if(!(this._cameraCapturing||this._localVideoTrack&&!this._localVideoTrack.dummy)){e.next=8;break}throw new lA(uA.REPEAT_CAPTURE,"Has already capture");case 8:return a=this._videoStreamConstraints,t&&("user"===t||"environment"===t||"left"===t||"right"===t?a.facingMode=t:a.deviceId={exact:t},this._videoStreamConstraints=a),s={},e.prev=11,this._cameraCapturing=!0,e.next=15,AU(a,this._extensionManager);case 15:if(u=e.sent,!this._interruptCameraCapture){e.next=21;break}throw this._interruptCameraCapture=!1,this._removeLocalTrackEvents(u),u.close(),new lA(uA.INTERRUPT,"interrupt by stopVideoCapture");case 21:if(this._initLocalTrackEvents(u),this._localVideoTrack=u,null===(c=this._videoPlayer)||void 0===c||c.playVideo(u),(d=null==u?void 0:u.getTrack())&&(s=d.getSettings(),l={width:s.width,height:s.height},this._localVideoTrack.resolution=l,setTimeout((function(){return p.safeEmit(Xd.onLocalVideoSizeChanged,{streamIndex:yd.STREAM_INDEX_MAIN,info:l})}))),this._room){e.next=28;break}return e.abrupt("return",s);case 28:return e.prev=28,this._cameraCapturing=!1,e.finish(28);case 31:return h=this._room._roomConfig.isAutoPublish,(null!==(r=this._room)&&void 0!==r&&null!==(n=r.localStream)&&void 0!==n&&n.pubVideo||h)&&(this._visibility?this._updatePublish():this.safeEmit(Xd.onAutoPublishResult,{isScreen:!1,state:fd.PUBLISH_FAIL})),null===(i=this._room.localStream)||void 0===i||null===(o=i.observer)||void 0===o||o.setEnableVideo(!0),e.abrupt("return",s);case 35:case"end":return e.stop()}}),e,this,[[11,,28,31]])}))),function(e){return ie.apply(this,arguments)})},{key:"stopVideoCapture",value:(ne=km(Em().mark((function e(){var t,r,n,i,o,a,s,c;return Em().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(IX.print("stopVideoCapture()"),!this._cameraCapturing){e.next=5;break}return this._interruptCameraCapture=!0,IX.print("stopVideoCapture()","capturing"),e.abrupt("return");case 5:if(this._trackSourceType.video!==dd.VIDEO_SOURCE_TYPE_EXTERNAL){e.next=7;break}throw new lA(uA.STREAM_TYPE_NOT_MATCH,"setVideoSourceType as internal first");case 7:if(null===(t=this._videoPlayer)||void 0===t||t.stop(),this._localVideoTrack&&(this._localVideoTrack.dummy||((s=this._extensionManager.getPluginByName(nU.PRE_PROCESSING,"RTCBeautyExtension"))&&s.emit("stop"),this._removeLocalTrackEvents(this._localVideoTrack),this._localVideoTrack.close(),this._localImgVideoTrack?(null===(c=this._localVideoTrack)||void 0===c||c.setTrack(this._localImgVideoTrack,this._extensionManager),this._localVideoTrack.dummy=!0):this._localVideoTrack=void 0)),this._room){e.next=11;break}return e.abrupt("return");case 11:if(null===(r=this._room)||void 0===r||null===(n=r.localStream)||void 0===n||!n.pubVideo){e.next=14;break}return e.next=14,this._updatePublish();case 14:null===(i=this._room)||void 0===i||null===(o=i.localStream)||void 0===o||null===(a=o.observer)||void 0===a||a.setEnableVideo(!1);case 15:case"end":return e.stop()}}),e,this)}))),function(){return ne.apply(this,arguments)})},{key:"startAudioCapture",value:(re=km(Em().mark((function e(t){var r,n,i,o,a,s;return Em().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(IX.print("startAudioCapture()","deviceId: $o",t),oD(t)||ZP(t,"deviceId"),t=t||this._localAudioDeviceId,this._localAudioDeviceId=t,this._trackSourceType.audio!==ld.AUDIO_SOURCE_TYPE_EXTERNAL){e.next=6;break}throw new lA(uA.STREAM_TYPE_NOT_MATCH,"setAudioSourceType as internal first");case 6:if(!this._micCapturing&&!this._localAudioTrack){e.next=8;break}throw new lA(uA.REPEAT_CAPTURE,"Has already capture");case 8:return t&&this._ctx.audioProfileManager.updateConstraints({deviceId:{exact:t}}),e.prev=9,this._micCapturing=!0,e.next=13,wU(this._ctx.audioProfileManager.getConstraints(),this._extensionManager);case 13:if(a=e.sent,!this._interruptMicCapture){e.next=19;break}throw this._interruptMicCapture=!1,this._removeLocalTrackEvents(a),a.close(),new lA(uA.INTERRUPT,"interrupt by stopAudioCapture");case 19:if(this._initLocalTrackEvents(a),this._localAudioTrack=a,this._localAudioTrack.setVolume(this._localAudioVolume),this._tempMixingAudioTrack&&(this._localAudioTrack.mixType=this._tempMixingAudioTrack.type,this._localAudioTrack.mixedAudioTrack=this._tempMixingAudioTrack.track,delete this._tempMixingAudioTrack),this._room){e.next=25;break}return e.abrupt("return");case 25:return e.prev=25,this._micCapturing=!1,e.finish(25);case 28:s=this._room._roomConfig.isAutoPublish,(null!==(r=this._room)&&void 0!==r&&null!==(n=r.localStream)&&void 0!==n&&n.pubAudio||s)&&(this._visibility?this._updatePublish():this.safeEmit(Xd.onAutoPublishResult,{isScreen:!1,state:fd.PUBLISH_FAIL})),null===(i=this._room.localStream)||void 0===i||null===(o=i.observer)||void 0===o||o.setEnableAudio(!0);case 31:case"end":return e.stop()}}),e,this,[[9,,25,28]])}))),function(e){return re.apply(this,arguments)})},{key:"stopAudioCapture",value:(te=km(Em().mark((function e(){var t,r,n,i;return Em().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(IX.print("stopAudioCapture()"),!this._micCapturing){e.next=5;break}return this._interruptMicCapture=!0,IX.print("stopAudioCapture()","capturing"),e.abrupt("return");case 5:if(this._trackSourceType.audio!==ld.AUDIO_SOURCE_TYPE_EXTERNAL){e.next=7;break}throw new lA(uA.STREAM_TYPE_NOT_MATCH,"setAudioSourceType as internal first");case 7:if(this._localAudioTrack&&(this._removeLocalTrackEvents(this._localAudioTrack),this._localAudioTrack.close()),this._localAudioTrack=void 0,this._audioMixingManager.stopAll(),this._room){e.next=12;break}return e.abrupt("return");case 12:if(null===(t=this._room)||void 0===t||null===(r=t.localStream)||void 0===r||!r.pubAudio){e.next=15;break}return e.next=15,this._updatePublish();case 15:null===(n=this._room.localStream)||void 0===n||null===(i=n.observer)||void 0===i||i.setEnableAudio(!1);case 16:case"end":return e.stop()}}),e,this)}))),function(){return te.apply(this,arguments)})},{key:"getAudioMixingManager",value:function(){return IX.print("getAudioMixingManager()","invoke"),this._audioMixingManager}},{key:"startScreenCapture",value:(ee=km(Em().mark((function e(){var t,r,n,i,o,a,s,c,u,d,l,h,p,_,v,f,m=this,g=arguments;return Em().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(c=g.length>0&&void 0!==g[0]?g[0]:{},IX.print("startScreenCapture()","config: %o",c),u=c.enableAudio,d=void 0!==u&&u,this._trackSourceType.screenVideo!==dd.VIDEO_SOURCE_TYPE_EXTERNAL){e.next=5;break}throw new lA(uA.STREAM_TYPE_NOT_MATCH,"setVideoSourceType as internal first");case 5:if(this._trackSourceType.screenAudio!==ld.AUDIO_SOURCE_TYPE_EXTERNAL){e.next=7;break}throw new lA(uA.STREAM_TYPE_NOT_MATCH,"setAudioSourceType as internal first");case 7:return e.next=9,OU(d,this._extensionManager,this._screenStreamEncodeConfig[0]);case 9:if(l=e.sent,h=Qk(l,2),p=h[0],null==(_=h[1])||_.setVolume(this._localScreenAudioVolume),this._localScreenVideoTrack&&!this._localScreenVideoTrack.dummy&&(this._removeLocalTrackEvents(this._localScreenVideoTrack),this._localScreenVideoTrack.close()),null===(t=this._localScreenAudioTrack)||void 0===t||t.close(),delete this._localScreenAudioTrack,this._localScreenVideoTrack=p,null!==(r=this._screenStreamEncodeConfig[0])&&void 0!==r&&r.contentHint&&p.setContentHint(null===(v=this._screenStreamEncodeConfig[0])||void 0===v?void 0:v.contentHint),(f=null==p?void 0:p.getTrack())&&setTimeout((function(){var e=f.getSettings(),t={width:e.width,height:e.height};p.resolution=t,m.safeEmit(Xd.onLocalVideoSizeChanged,{streamIndex:yd.STREAM_INDEX_SCREEN,info:{width:e.width,height:e.height}})}),500),_&&(this._localScreenAudioTrack=_,this._initLocalTrackEvents(_)),null===(n=this._screenPlayer)||void 0===n||n.playVideo(this._localScreenVideoTrack),this._initLocalTrackEvents(this._localScreenVideoTrack,!0),!(null!==(i=this._room)&&void 0!==i&&null!==(o=i.localScreenStream)&&void 0!==o&&o.pubAudio||null!==(a=this._room)&&void 0!==a&&null!==(s=a.localScreenStream)&&void 0!==s&&s.pubVideo)){e.next=27;break}return e.next=27,this._updateScreenPublish();case 27:case"end":return e.stop()}}),e,this)}))),function(){return ee.apply(this,arguments)})},{key:"stopScreenCapture",value:($=km(Em().mark((function e(){var t,r,n,i,o,a;return Em().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(IX.print("stopScreenCapture()"),null===(t=this._screenPlayer)||void 0===t||t.stop(),this._localScreenVideoTrack&&(this._localScreenVideoTrack.dummy||(this._removeLocalTrackEvents(this._localScreenVideoTrack),this._localScreenVideoTrack.close(),this._localImgScreenTrack&&(null===(a=this._localScreenVideoTrack)||void 0===a||a.setTrack(this._localImgScreenTrack,this._extensionManager),this._localScreenVideoTrack.dummy=!0))),this._localScreenAudioTrack&&(this._removeLocalTrackEvents(this._localScreenAudioTrack),this._localScreenAudioTrack.close()),this._localScreenAudioTrack=void 0,!(null!==(r=this._room)&&void 0!==r&&null!==(n=r.localScreenStream)&&void 0!==n&&n.pubAudio||null!==(i=this._room)&&void 0!==i&&null!==(o=i.localScreenStream)&&void 0!==o&&o.pubVideo)){e.next=8;break}return e.next=8,this._updateScreenPublish();case 8:case"end":return e.stop()}}),e,this)}))),function(){return $.apply(this,arguments)})},{key:"setLocalVideoPlayer",value:function(e,t){if(IX.print("setLocalVideoPlayer()","streamIndex: %o, videoPlayerOption: %o",e,t),$P(e,"streamIndex",[yd.STREAM_INDEX_MAIN,yd.STREAM_INDEX_SCREEN]),t&&t.renderDom){var r,n,i,o,a=ud(ud({userId:this._getUserId()},t),{},{isLocal:!0});if(lD(a),e===yd.STREAM_INDEX_MAIN&&!this._videoPlayer)return this._videoPlayer=new xG(this.id,a),this._initPlayerEvents(this._videoPlayer,!1,e),this._videoPlayer.mirror(!!this._mirrorType),this._localVideoTrack&&!this._localVideoTrack.dummy&&(null===(r=this._config)||void 0===r?void 0:r.autoPlayPolicy)!==Md.PLAY_MANUALLY&&this._videoPlayer.playVideo(this._localVideoTrack),(null===(n=this._room)||void 0===n?void 0:n.localStream)&&(this._room.localStream.videoDom=this._videoPlayer.domElement),this._videoPlayer.domElement;if(e===yd.STREAM_INDEX_SCREEN&&!this._screenPlayer)return this._screenPlayer=new xG(this.id,ud(ud({},a),{},{isScreen:!0,isLocal:!0})),this._initPlayerEvents(this._screenPlayer,!1,e),this._localScreenVideoTrack&&!this._localScreenVideoTrack.dummy&&(null===(i=this._config)||void 0===i?void 0:i.autoPlayPolicy)!==Md.PLAY_MANUALLY&&this._screenPlayer.playVideo(this._localScreenVideoTrack),(null===(o=this._room)||void 0===o?void 0:o.localScreenStream)&&(this._room.localScreenStream.videoDom=this._screenPlayer.domElement),this._screenPlayer.domElement;if(t&&void 0!==t.renderMode){var s=e===yd.STREAM_INDEX_MAIN?this._videoPlayer:this._screenPlayer;null==s||s.setRenderMode(t.renderMode)}}else{var c,u;e===yd.STREAM_INDEX_MAIN?(null===(c=this._videoPlayer)||void 0===c||c.destroy(!0),delete this._videoPlayer):(null===(u=this._screenPlayer)||void 0===u||u.destroy(),delete this._screenPlayer)}}},{key:"startLiveTranscoding",value:(Z=km(Em().mark((function e(t){var r,n,i;return Em().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(IX.print("startLiveTranscoding()","transcode: %o",t),bX.checkStartParams(t),this._liveTranscodeConfig=t,!((n=null===(r=this._room)||void 0===r?void 0:r.roomInfo)&&n.roomId.length+n.userInfo.userId.length>126)){e.next=6;break}throw new lA(uA.INVALID_PARAMS,"The roomId+userId must be within 126 bytes");case 6:if(e.prev=6,this.safeEmit(Xd.onStreamMixingEvent,{event:LV.START,error:0,message:""}),!this._room||this._room.connectionState!==Yj.CONNECTED){e.next=11;break}return e.next=11,null===(i=this._room)||void 0===i?void 0:i.liveControlMessage(bX.getStartParams(this._liveTranscodeConfig));case 11:e.next=20;break;case 13:if(e.prev=13,e.t0=e.catch(6),!(e.t0 instanceof lA)){e.next=19;break}throw e.t0;case 19:throw new lA(uA.UNEXPECTED_ERROR,"unexpected error",e.t0);case 20:case"end":return e.stop()}}),e,this,[[6,13]])}))),function(e){return Z.apply(this,arguments)})},{key:"updateLiveTranscoding",value:(Q=km(Em().mark((function e(t){var r,n,i,o;return Em().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(IX.print("updateLiveTranscoding()","transcode: %o",t),this._liveTranscodeConfig){e.next=3;break}return e.abrupt("return");case 3:return delete(i=LB({},t)).audio,null===(r=i.video)||void 0===r||delete r.codec,null===(n=i.video)||void 0===n||delete n.gop,bX.checckUpdateParams(i),this._liveTranscodeConfig=LB(this._liveTranscodeConfig,i),e.prev=9,this.safeEmit(Xd.onStreamMixingEvent,{event:LV.UPDATE,error:0,message:""}),e.next=13,null===(o=this._room)||void 0===o?void 0:o.liveControlMessage(bX.getUpdateParams(this._liveTranscodeConfig));case 13:e.next=22;break;case 15:if(e.prev=15,e.t0=e.catch(9),!(e.t0 instanceof lA)){e.next=21;break}throw e.t0;case 21:throw new lA(uA.UNEXPECTED_ERROR,"unexpected error",e.t0);case 22:case"end":return e.stop()}}),e,this,[[9,15]])}))),function(e){return Q.apply(this,arguments)})},{key:"stopLiveTranscoding",value:(J=km(Em().mark((function e(){var t;return Em().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(IX.print("stopLiveTranscoding()"),this._liveTranscodeConfig){e.next=3;break}return e.abrupt("return");case 3:return delete this._liveTranscodeConfig,e.prev=4,this.safeEmit(Xd.onStreamMixingEvent,{event:LV.STOP,error:0,message:""}),e.next=8,null===(t=this._room)||void 0===t?void 0:t.liveControlMessage({action:"stopped",type:"transcode"});case 8:e.next=17;break;case 10:if(e.prev=10,e.t0=e.catch(4),!(e.t0 instanceof lA)){e.next=16;break}throw e.t0;case 16:throw new lA(uA.UNEXPECTED_ERROR,"unexpected error",e.t0);case 17:case"end":return e.stop()}}),e,this,[[4,10]])}))),function(){return J.apply(this,arguments)})},{key:"startSubtitle",value:(Y=km(Em().mark((function e(t){var r;return Em().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return IX.print("startSubtitle()","config: %o",t),this._assertNotInRoom(),e.next=4,null===(r=this._room)||void 0===r?void 0:r.startSubtitle(t);case 4:case"end":return e.stop()}}),e,this)}))),function(e){return Y.apply(this,arguments)})},{key:"stopSubtitle",value:function(){var e;IX.print("stopSubtitle()","invoke"),null===(e=this._room)||void 0===e||e.stopSubtitle()}},{key:"setBusinessId",value:function(e){return IX.print("setBusinessId()","businessId: %s",e),!function(e){return"string"!=typeof e}(e)&&!this._room&&(this.monitor.set({rtc_business_id:e}),this._businessId=e,!0)}},{key:"setUserVisibility",value:(q=km(Em().mark((function e(t){var r,n;return Em().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(IX.print("setUserVisibility()","enable: %o",t),t=!!t,this._visibility!==t){e.next=4;break}return e.abrupt("return");case 4:if(this._room){e.next=7;break}return this._visibility=t,e.abrupt("return");case 7:if(this._assertNotInRoom(),this._room.localStream&&(null===(n=this._room.localStream.observer)||void 0===n||n.setPublisher(t)),e.t0=!t,!e.t0){e.next=13;break}return e.next=13,this._room.unpublish();case 13:return e.next=15,this._room.updateUserAttributes({role:t?oX.NORMAL_USER:oX.SILENT_USER});case 15:this._visibility=t,t&&null!==(r=this._roomConfig)&&void 0!==r&&r.isAutoPublish&&this._updatePublish({mediaType:Sd.AUDIO_AND_VIDEO});case 17:case"end":return e.stop()}}),e,this)}))),function(e){return q.apply(this,arguments)})},{key:"_initPlayerEvents",value:function(e){var t=this,r=arguments.length>1&&void 0!==arguments[1]&&arguments[1],n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:yd.STREAM_INDEX_MAIN,i=n===yd.STREAM_INDEX_SCREEN;e.on("playback_event",(function(n){switch(n.eventName){case"timeupdate":return;case"loadeddata":if("audio"===n.type){var o,a,s=e.userId.replace("_screen",""),c=null===(o=t._room)||void 0===o||null===(a=o.remoteStreams.get(s))||void 0===a?void 0:sE(a).call(a,(function(e){return e.isScreen===i})),u=function(){r?t.safeEmit(Xd.onFirstPublicStreamAudioFrameDecoded,{publicStreamId:s}):(t.safeEmit(Xd.onAudioFirstFrameDecoded,{userId:s,isScreen:i}),t.safeEmit(Xd.onRemoteAudioFirstFrame,{userId:s,isScreen:i})),t.monitor.report("first_remote_audio_render",{stream_id:"",stream_user_id:s||""},{isScreen:i})};c&&c.observer&&!c.observer.audioFirstFrameReceived?c.observer.once("recvAudioFirstFrame",u):u()}else{var d,l,h={userId:e.userId,height:(null===(d=e.domElement)||void 0===d?void 0:d.videoHeight)||0,width:(null===(l=e.domElement)||void 0===l?void 0:l.videoWidth)||0,isScreen:i};r?(h.publicStreamId=h.userId,delete h.userId,delete h.isScreen,t.safeEmit(Xd.onFirstPublicStreamVideoFrameRendered,h),t.safeEmit(Xd.onFirstPublicStreamVideoFrameDecoded,h)):e.isLocal||(t.safeEmit(Xd.onVideoFirstFrameRendered,h),t.safeEmit(Xd.onVideoFirstFrameDecoded,h),t.safeEmit(Xd.onRemoteVideoFirstFrame,h)),t.monitor.report("first_remote_video_render",{stream_id:"",stream_user_id:n.userId||""},{isScreen:i})}break;case"autoplay-error":return r&&(n.publicStreamId=n.userId),IO(t.id,"autoplay-error",e instanceof xG?"video":"audio",0,n.userId||""),void t.safeEmit(Xd.onAutoplayFailed,{userId:n.userId,kind:e instanceof xG?"video":"audio",mediaType:e instanceof xG?Sd.VIDEO:Sd.AUDIO,streamIndex:e.isScreen?yd.STREAM_INDEX_SCREEN:yd.STREAM_INDEX_MAIN})}t.safeEmit(Xd.onPlayerEvent,n)}))}},{key:"_initLocalTrackEvents",value:function(e){var t=this,r=arguments.length>1&&void 0!==arguments[1]&&arguments[1];["track-ended","track-mute","track-unmute"].forEach((function(r){e.on(r,function(){var e=km(Em().mark((function e(n){var i,o,a;return Em().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t.monitor.report("rtc_error",{message:wm(i="track-".concat(r," mediaType: ")).call(i,n.getTrack().kind),error_code:GV.TRACK_ERROR}),o=!1,n!==t._localScreenAudioTrack&&n!==t._localScreenVideoTrack||(o=!0),a=n.getTrack().kind,t.safeEmit({"track-ended":Xd.onTrackEnded,"track-mute":Xd.onTrackMute,"track-unmute":Xd.onTrackUnmute}[r],{kind:a,isScreen:o}),!gP&&!_P){e.next=13;break}if("track-mute"!==r){e.next=12;break}if(ZL.emit(JL.ON_IOS_LOCAL_TRACK_MUTE,a),"audio"!==a){e.next=12;break}return e.next=11,t.stopAudioCapture();case 11:t.startAudioCapture();case 12:"track-unmute"===r&&ZL.emit(JL.ON_IOS_LOCAL_TRACK_UNMUTE,a);case 13:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}())})),e.on("resolution-change",(function(e){t._extensionManager.getPluginsByType(nU.PRE_PROCESSING).forEach((function(t){var r;null==t||null===(r=t.applyConstraints)||void 0===r||r.call(t,e)})),t.safeEmit(Xd.onLocalVideoSizeChanged,{streamIndex:r?yd.STREAM_INDEX_SCREEN:yd.STREAM_INDEX_MAIN,info:e})}))}},{key:"_removeLocalTrackEvents",value:function(e){e.removeAllListeners("track-ended"),e.removeAllListeners("track-mute"),e.removeAllListeners("track-unmute"),e.removeAllListeners("resolution-change")}},{key:"setRemoteVideoPlayer",value:function(e,t){IX.print("setRemoteVideoPlayer()","streamIndex: %o, videoPlayerOption: %o",e,t),$P(e,"streamIndex",[yd.STREAM_INDEX_MAIN,yd.STREAM_INDEX_SCREEN]),lD(t);var r,n,i,o=t.userId;if(e===yd.STREAM_INDEX_MAIN){var a,s,c;if(null===(a=this._remoteVideoPlayer.get(o))||void 0===a||a.destroy(),!t.renderDom)return;var u=new xG(this.id,t);this._initPlayerEvents(u,!1,e),this._remoteVideoPlayer.set(o,u);var d=null===(s=this._room)||void 0===s||null===(c=s.remoteStreams.get(o))||void 0===c?void 0:sE(c).call(c,(function(e){return!e.isScreen}));return d&&(this._updateVideoPlayerState(d),d.videoDom=u.domElement),u.domElement}if(null===(r=this._remoteScreenPlayer.get(o))||void 0===r||r.destroy(),t.renderDom){var l=new xG(this.id,ud(ud({},t),{},{isScreen:!0}));this._remoteScreenPlayer.set(o,l),this._initPlayerEvents(l,!1,e);var h=null===(n=this._room)||void 0===n||null===(i=n.remoteStreams.get(o))||void 0===i?void 0:sE(i).call(i,(function(e){return e.isScreen}));return h&&(this._updateVideoPlayerState(h),h.videoDom=l.domElement),l.domElement}}},{key:"setLocalVideoMirrorType",value:function(e){IX.print("setLocalVideoMirrorType()","mirrorType: %o",e),$P(e,"mirrorType",[Td.MIRROR_TYPE_NONE,Td.MIRROR_TYPE_RENDER]),this._mirrorType=e,this._videoPlayer&&this._videoPlayer.mirror(!!e)}},{key:"setAudioPlaybackDevice",value:(W=km(Em().mark((function e(t){var r;return Em().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return IX.print("setAudioPlaybackDevice()","deviceId: %s",t),ZP(t,"deviceId"),e.next=4,this._audioDeviceManager.setSinkId(t);case 4:r=e.sent,this._remoteAudioPlayer.forEach((function(e){e.setPlaybackDevice(t)})),this._remoteScreenAudioPlayer.forEach((function(e){e.setPlaybackDevice(t)})),this.safeEmit(Xd.onAudioPlaybackDeviceChanged,r),this.monitor.report("rtc_audio_device",{audio_event:"playout_device_switch",message:eT(r),error_code:0});case 9:case"end":return e.stop()}}),e,this)}))),function(e){return W.apply(this,arguments)})},{key:"play",value:(X=km(Em().mark((function e(t){var r,n,i,o,a,s,c,u,d,l,h,p,_,v,f,m,g=arguments;return Em().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return o=g.length>1&&void 0!==g[1]?g[1]:Sd.AUDIO_AND_VIDEO,a=g.length>2?g[2]:void 0,IX.print("play()","userId: %s, mediaType: %s, streamIndex: %s",t,o,a),s=!t||t===this._getUserId()||"local_user"===t,c=void 0===a||a===yd.STREAM_INDEX_MAIN,u=void 0===a||a===yd.STREAM_INDEX_SCREEN,d=o!==Sd.VIDEO,l=o!==Sd.AUDIO,h=[],s&&l&&(c&&this._localVideoTrack&&(null===(p=this._videoPlayer)||void 0===p||p.mirror(!!this._mirrorType),h.push(null===(_=this._videoPlayer)||void 0===_?void 0:_.playVideo(this._localVideoTrack))),u&&this._localScreenVideoTrack&&h.push(null===(v=this._screenPlayer)||void 0===v?void 0:v.playVideo(this._localScreenVideoTrack))),t===(null===(r=this._audioMixingManager)||void 0===r?void 0:r.id)&&h.push(this._audioMixingManager.resumeLocalPlay()),f=null===(n=this._room)||void 0===n?void 0:n.remoteStreams,l&&c&&h.push(PG(this._remoteVideoPlayer,t,!1,f)),l&&u&&h.push(PG(this._remoteScreenPlayer,t,!0,f)),d&&c&&h.push(PG(this._remoteAudioPlayer,t,!1,f)),l&&u&&h.push(PG(this._remoteScreenAudioPlayer,t,!0,f)),m=null===(i=this._publicStreamManager)||void 0===i?void 0:i.remoteStreams,d&&h.push(PG(this._publicStreamVideoPlayer,t,!1,m)),l&&h.push(PG(this._publicStreamAudioPlayer,t,!1,m)),e.abrupt("return",Wf.all(h).then((function(){})));case 20:case"end":return e.stop()}}),e,this)}))),function(e){return X.apply(this,arguments)})},{key:"pauseAllSubscribedStream",value:(K=km(Em().mark((function e(t){var r,n,i,o,a,s=this;return Em().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(IX.print("pauseAllSubscribedStream()","mediaType: %o",t),this._checkMediaType(t),qO(t)&&(s._pauseAllSubscribeState.audio=!0),YO(t)&&(s._pauseAllSubscribeState.video=!0),this._room){e.next=6;break}return e.abrupt("return",Wf.resolve());case 6:n=[],i=Jk(tR(r=this._room.remoteStreams).call(r));try{for(i.s();!(o=i.n()).done;)a=o.value,Array.isArray(a)&&a.forEach((function(e){if(e.hasSubscribed){s._pauseAllSubscribeState.resumeStreamIds[e.streamId]=e.streamId;var r=s._unsubscribe(e.isScreen,e.userId,t,!0);r&&n.push(r)}}))}catch(c){i.e(c)}finally{i.f()}return e.abrupt("return",Wf.all(n).then((function(){})));case 10:case"end":return e.stop()}}),e,this)}))),function(e){return K.apply(this,arguments)})},{key:"resumeAllSubscribedStream",value:(z=km(Em().mark((function e(t){var r,n,i,o,a,s=this;return Em().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(IX.print("resumeAllSubscribedStream()","mediaType: %o",t),this._checkMediaType(t),qO(t)&&(s._pauseAllSubscribeState.audio=!1),YO(t)&&(s._pauseAllSubscribeState.video=!1),this._room){e.next=6;break}return e.abrupt("return",Wf.resolve());case 6:n=[],i=Jk(tR(r=this._room.remoteStreams).call(r));try{for(i.s();!(o=i.n()).done;)a=o.value,Array.isArray(a)&&a.forEach((function(e){if(s._pauseAllSubscribeState.resumeStreamIds[e.streamId]){delete s._pauseAllSubscribeState.resumeStreamIds[e.streamId];var r=s._subscribe(e.isScreen,e.userId,t);r&&n.push(r)}}))}catch(c){i.e(c)}finally{i.f()}return e.abrupt("return",Wf.all(n).then((function(){var e,t;null===(e=s._room)||void 0===e||null===(t=e.remoteStreams)||void 0===t||t.forEach((function(e){Array.isArray(e)&&e.forEach((function(e){s._updateAudioPlayerState(e),s._updateVideoPlayerState(e)}))}))})));case 10:case"end":return e.stop()}}),e,this)}))),function(e){return z.apply(this,arguments)})},{key:"sendUserMessage",value:(H=km(Em().mark((function e(t,r){var n,i,o,a=this;return Em().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return sD(t),hD(r),this._assertNotInRoom(),o=Date.now(),e.abrupt("return",null===(n=this._room)||void 0===n||null===(i=n.sendUserMessage(t,r))||void 0===i?void 0:i.then((function(e){return a._messageStatisticsObserver.countP2PMessage(!0,t,!1,o,e),e.id})).catch((function(e){throw a._messageStatisticsObserver.countP2PMessage(!1,t,!1,o,e),e})));case 5:case"end":return e.stop()}}),e,this)}))),function(e,t){return H.apply(this,arguments)})},{key:"sendUserBinaryMessage",value:(G=km(Em().mark((function e(t,r){var n,i,o,a=this;return Em().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return sD(t),rD(r,"message"),hD(r),this._assertNotInRoom(),o=Date.now(),e.abrupt("return",null===(n=this._room)||void 0===n||null===(i=n.sendUserMessage(t,r))||void 0===i?void 0:i.then((function(e){return a._messageStatisticsObserver.countP2PMessage(!0,t,!0,o,e),e.id})).catch((function(e){throw a._messageStatisticsObserver.countP2PMessage(!1,t,!0,o,e),e})));case 6:case"end":return e.stop()}}),e,this)}))),function(e,t){return G.apply(this,arguments)})},{key:"sendRoomMessage",value:(j=km(Em().mark((function e(t){var r,n,i,o=this;return Em().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return hD(t),this._assertNotInRoom(),i=Date.now(),e.abrupt("return",null===(r=this._room)||void 0===r||null===(n=r.sendRoomMessage(t))||void 0===n?void 0:n.then((function(e){var t,r;return o._messageStatisticsObserver.countRoomMessage(!0,null===(t=o._room)||void 0===t||null===(r=t.roomInfo)||void 0===r?void 0:r.roomId,!1,i),e})).catch((function(e){var t,r;throw o._messageStatisticsObserver.countRoomMessage(!1,null===(t=o._room)||void 0===t||null===(r=t.roomInfo)||void 0===r?void 0:r.roomId,!1,i),e})));case 4:case"end":return e.stop()}}),e,this)}))),function(e){return j.apply(this,arguments)})},{key:"sendRoomBinaryMessage",value:(B=km(Em().mark((function e(t){var r,n,i,o=this;return Em().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return hD(t),this._assertNotInRoom(),i=Date.now(),e.abrupt("return",null===(r=this._room)||void 0===r||null===(n=r.sendRoomMessage(t,!0))||void 0===n?void 0:n.then((function(e){var t,r;return o._messageStatisticsObserver.countRoomMessage(!0,null===(t=o._room)||void 0===t||null===(r=t.roomInfo)||void 0===r?void 0:r.roomId,!0,i),e})).catch((function(e){var t,r;throw o._messageStatisticsObserver.countRoomMessage(!1,null===(t=o._room)||void 0===t||null===(r=t.roomInfo)||void 0===r?void 0:r.roomId,!0,i),e})));case 4:case"end":return e.stop()}}),e,this)}))),function(e){return B.apply(this,arguments)})},{key:"setAudioCaptureConfig",value:(F=km(Em().mark((function e(){var t,r=arguments;return Em().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:t=r.length>0&&void 0!==r[0]?r[0]:{},IX.print("setAudioCaptureConfig()","config: %o",t),delete t.deviceId,nD(t),this._shouldUpdateAudioConf("setAudioCaptureConfig")&&this._ctx.audioProfileManager.updateConstraints(t);case 5:case"end":return e.stop()}}),e,this)}))),function(){return F.apply(this,arguments)})},{key:"setVideoCaptureConfig",value:(V=km(Em().mark((function e(){var t,r=arguments;return Em().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=r.length>0&&void 0!==r[0]?r[0]:{},IX.print("setVideoCaptureConfig()","config: %o",t),e.abrupt("return",this._setVideoCaptureConfig(t));case 3:case"end":return e.stop()}}),e,this)}))),function(){return V.apply(this,arguments)})},{key:"_setVideoCaptureConfig",value:(U=km(Em().mark((function e(){var t,r,n,i=arguments;return Em().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(delete(r=i.length>0&&void 0!==i[0]?i[0]:{}).deviceId,nD(r),n=ud(ud({},r),{},{deviceId:this._videoStreamConstraints.deviceId}),!this._localVideoTrack){e.next=7;break}return e.next=7,this._localVideoTrack.updateVideoCaptureConfig(n);case 7:return this._videoStreamConstraints=n,e.abrupt("return",(null===(t=this._localVideoTrack)||void 0===t?void 0:t.getTrack().getSettings())||{});case 9:case"end":return e.stop()}}),e,this)}))),function(){return U.apply(this,arguments)})},{key:"enableSimulcastMode",value:function(e){var t;return IX.print("enableSimulcastMode()","enabled: %o",e),this._enableSimulcast=e,14!==(null==RP?void 0:RP[0])&&(null!==(t=this._room)&&void 0!==t&&t.hasPublished&&tP("You must call this API before publishing the video streams"),!0)}},{key:"setVideoEncoderConfig",value:(L=km(Em().mark((function e(t){var r,n,i;return Em().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:for(IX.print("setVideoEncoderConfig()"," descriptions: %o",t),Array.isArray(t)||(t=[t]),fD(t=Gs(t).call(t,(function(e){return!!e}))),t.length>3&&(tP("setVideoEncoderConfig: You can set parameters for up to 3 streams"),t=bm(t).call(t,0,3)),n=1;n<t.length;n++)i=rP(t[0].width)/rP(t[n].width)||1,Math.floor(i)!==i&&tP("setVideoEncoderConfig: The resolution setting needs to be an integer multiple");VR(t).call(t,(function(e,t){return t.maxKbps-e.maxKbps})),this._setVideoCaptureConfig(ud({},t[0])),this._videoStreamEncodeConfig=t,this._updateDummyCaptureImage(yd.STREAM_INDEX_MAIN),null!==(r=this._room)&&void 0!==r&&r.hasPublished&&this._updatePublish();case 11:case"end":return e.stop()}}),e,this)}))),function(e){return L.apply(this,arguments)})},{key:"setScreenEncoderConfig",value:(N=km(Em().mark((function e(t){var r;return Em().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:IX.print("setScreenEncoderConfig()","description: %o",t),this._screenStreamEncodeConfig=[t],this._localScreenVideoTrack&&(this._localScreenVideoTrack.updateVideoCaptureConfig(t),t.contentHint&&this._localScreenVideoTrack.setContentHint(t.contentHint)),this._updateDummyCaptureImage(yd.STREAM_INDEX_SCREEN),null!==(r=this._room)&&void 0!==r&&r.hasScreenPublished&&this._updateScreenPublish();case 5:case"end":return e.stop()}}),e,this)}))),function(e){return N.apply(this,arguments)})},{key:"sendSEIMessage",value:function(e,t,r){if(IX.print("sendSEIMessage()","streamIdex: %o, message: %o, repeatCount: %o",e,t,r),!kN())throw new lA(uA.NOT_SUPPORTED,"Browser does not support sending SEI");$P(e,"streamIndex",[yd.STREAM_INDEX_MAIN,yd.STREAM_INDEX_SCREEN]),QP(r,"repeatCount",0,30);var n="string"==typeof t?new Uint8Array(DO.str2ab(t)):t;if(t.length){var i;if(e===yd.STREAM_INDEX_MAIN){var o,a,s;if(null===(o=this._room)||void 0===o||null===(a=o.localStream)||void 0===a||!a.hasPublished)return;i=null===(s=this._room)||void 0===s?void 0:s.localStream}else{var c,u,d;if(null===(c=this._room)||void 0===c||null===(u=c.localScreenStream)||void 0===u||!u.hasPublished)return;i=null===(d=this._room)||void 0===d?void 0:d.localScreenStream}if(n.byteLength>4096)IX.print("sei size must not bigger than 4KB");else{var l=xO();i.seiList.push({content:n,uuid:l,repeatCount:r}),setTimeout((function(){var e;if(i){var t,r=WR(e=i.seiList).call(e,(function(e){return e.uuid===l}));if(r)zE(t=i.seiList).call(t,r,1)}}),2e3)}}else IX.print("sei message must not be empty")}},{key:"setAudioVolumeIndicationInterval",value:function(e){var t=this;IX.print("setAudioVolumeIndicationInterval()","interval %o: ",e),("number"!=typeof e||e<200)&&(e=200);var r=[];this._audioVolumeIndicationTimer&&clearInterval(this._audioVolumeIndicationTimer),this._audioVolumeIndicationTimer=setInterval((function(){var e,n;r=[],null===(e=t._room)||void 0===e||e.remoteStreams.forEach((function(e,t){var n;if(0!==e.length){var i=sE(e).call(e,(function(e){return!1===e.isScreen})),o=null==i||null===(n=i.audioTrack)||void 0===n?void 0:n.getAudioLevel();r.push({userId:t,volume:o||0})}}));var i=null===(n=t._localAudioTrack)||void 0===n?void 0:n.getAudioLevel();r.push({userId:t._getUserId(),volume:i||0}),t.safeEmit(Xd.onAudioVolumeIndication,{speakers:r})}),e)}},{key:"_sendActiveSpeaker",value:function(e,t){if(this._room&&this._room.remoteUsers.size>=1){var r,n=e[0],i=tb(t).call(t,(function(e,t){return e&&e.audioPropertiesInfo.nonlinearVolume>t.audioPropertiesInfo.nonlinearVolume?e:t}),void 0);if((r=n?i?n.audioPropertiesInfo.nonlinearVolume>i.audioPropertiesInfo.nonlinearVolume?n:i:n:i)&&r.audioPropertiesInfo.nonlinearVolume>-35){var o,a;if(r.streamKey)o=this._room.remoteUsers.get(r.streamKey.userId);else o=null===(a=this._room._roomInfo)||void 0===a?void 0:a.userInfo;o&&this.safeEmit(Xd.onActiveSpeaker,{userId:o.userId,extraInfo:o.extraInfo})}}}},{key:"enableAudioPropertiesReport",value:function(){var e=this,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};IX.print("enableAudioPropertiesReport()","config %o: ",t);var r=t.enableInBackground,n=void 0===r||r,i=t.interval,o=void 0===i?100:i;this._stopAudioPropertiesReport(),o<=0||(o=Math.max(100,o),this._audioPropertiesReportTimer=self.setInterval((function(){if(n||"hidden"!==document.visibilityState){var t=[],r=e._audioDeviceManager.getRecordTrack()||e._localAudioTrack;if(r){var i=r.getAudioLevel();t.push({streamIndex:yd.STREAM_INDEX_MAIN,audioPropertiesInfo:{linearVolume:i,nonlinearVolume:WO(i)}})}if(e._localScreenAudioTrack){var o=e._localScreenAudioTrack.getAudioLevel();t.push({streamIndex:yd.STREAM_INDEX_SCREEN,audioPropertiesInfo:{linearVolume:o,nonlinearVolume:WO(o)}})}if(e.safeEmit(Xd.onLocalAudioPropertiesReport,t),e._room){var a,s=[];if(null!==(a=e._room)&&void 0!==a&&a.multiChatMode)e._room.getActiveSpeakerInMultiChatMode().forEach((function(t){var r,n,i=255*t.audioLevel;s.push({streamKey:{userId:t.userId,streamIndex:yd.STREAM_INDEX_MAIN,roomId:null===(r=e._room)||void 0===r||null===(n=r._roomInfo)||void 0===n?void 0:n.roomId},audioPropertiesInfo:{linearVolume:i,nonlinearVolume:WO(i)}})}));else e._room.remoteStreams.forEach((function(t,r){t.forEach((function(t){if(t.audioTrack){var n,i,o=t.audioTrack.getAudioLevel();s.push({streamKey:{userId:r,streamIndex:t.isScreen?yd.STREAM_INDEX_SCREEN:yd.STREAM_INDEX_MAIN,roomId:null===(n=e._room)||void 0===n||null===(i=n.roomInfo)||void 0===i?void 0:i.roomId},audioPropertiesInfo:{linearVolume:o,nonlinearVolume:WO(o)}})}}))}));e.safeEmit(Xd.onRemoteAudioPropertiesReport,s),e._sendActiveSpeaker(t,Gs(s).call(s,(function(e){return e.streamKey.streamIndex!==yd.STREAM_INDEX_SCREEN})))}}}),o))}},{key:"setVideoSourceType",value:(M=km(Em().mark((function e(t,r){var n,i,o,a,s,c,u,d,l,h,p,_,v,f,m,g,y,S,b,E,T,k,I,R,A;return Em().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(IX.print("setVideoSourceType()","index: %o, videoSourceType: %o",t,r),$P(t,"streamIndex",[yd.STREAM_INDEX_MAIN,yd.STREAM_INDEX_SCREEN]),$P(r,"VideoSourceType",[dd.VIDEO_SOURCE_TYPE_EXTERNAL,dd.VIDEO_SOURCE_TYPE_INTERNAL]),n=t===yd.STREAM_INDEX_MAIN?"video":"screenVideo",this._trackSourceType[n]===r){e.next=26;break}if(this._trackSourceType[n]=r,IX.print("setVideoSourceType",wm(i="set ".concat(n," source type to ")).call(i,r)),!this._localVideoTrack||t!==yd.STREAM_INDEX_MAIN){e.next=17;break}if(u=!1,r===dd.VIDEO_SOURCE_TYPE_EXTERNAL&&(u=!0,(d=this._extensionManager.getPluginByName(nU.PRE_PROCESSING,"RTCBeautyExtension"))&&d.emit("stop"),this._removeLocalTrackEvents(this._localVideoTrack),this._localVideoTrack.close()),null===(o=this._videoPlayer)||void 0===o||o.stop(),this._localVideoTrack=void 0,l=null===(a=this._room)||void 0===a?void 0:a._roomConfig.isAutoPublish,u?null===(h=this._room)||void 0===h||null===(p=h.localStream)||void 0===p||null===(_=p.observer)||void 0===_||_.setEnableVideo(!1):null===(v=this._room)||void 0===v||null===(f=v.localStream)||void 0===f||null===(m=f.observer)||void 0===m||m.setPushVideo(!1),!(null!==(s=this._room)&&void 0!==s&&null!==(c=s.localStream)&&void 0!==c&&c.pubVideo||l)){e.next=17;break}return e.next=17,this._updatePublish();case 17:if(!this._localScreenVideoTrack||t!==yd.STREAM_INDEX_SCREEN){e.next=26;break}if(b=!1,r===dd.VIDEO_SOURCE_TYPE_EXTERNAL&&(b=!0,this._removeLocalTrackEvents(this._localScreenVideoTrack),this._localScreenVideoTrack.close()),null===(g=this._screenPlayer)||void 0===g||g.stop(),this._localScreenVideoTrack=void 0,b?null===(E=this._room)||void 0===E||null===(T=E.localScreenStream)||void 0===T||null===(k=T.observer)||void 0===k||k.setEnableVideo(!1):null===(I=this._room)||void 0===I||null===(R=I.localScreenStream)||void 0===R||null===(A=R.observer)||void 0===A||A.setPushVideo(!1),null===(y=this._room)||void 0===y||null===(S=y.localScreenStream)||void 0===S||!S.pubVideo){e.next=26;break}return e.next=26,this._updateScreenPublish();case 26:case"end":return e.stop()}}),e,this)}))),function(e,t){return M.apply(this,arguments)})},{key:"setExternalVideoTrack",value:(D=km(Em().mark((function e(t,r){var n,i,o,a,s,c,u,d,l,h,p;return Em().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(IX.print("setExternalVideoTrack()","index: %o, track: %o",t,r),$P(t,"streamIndex",[yd.STREAM_INDEX_MAIN,yd.STREAM_INDEX_SCREEN]),eD(r),t!==yd.STREAM_INDEX_MAIN){e.next=15;break}if(this._trackSourceType.video===dd.VIDEO_SOURCE_TYPE_EXTERNAL){e.next=6;break}throw new lA(uA.STREAM_TYPE_NOT_MATCH,"setVideoSourceType as external first");case 6:return e.next=8,MU(r,this._extensionManager);case 8:if(this._localVideoTrack=e.sent,this._initLocalTrackEvents(this._localVideoTrack),null===(n=this._videoPlayer)||void 0===n||n.playVideo(this._localVideoTrack),s=null===(i=this._room)||void 0===i?void 0:i._roomConfig.isAutoPublish,!(null!==(o=this._room)&&void 0!==o&&null!==(a=o.localStream)&&void 0!==a&&a.pubVideo||s)){e.next=15;break}return e.next=15,this._updatePublish();case 15:if(t!==yd.STREAM_INDEX_SCREEN){e.next=27;break}if(this._trackSourceType.screenVideo===dd.VIDEO_SOURCE_TYPE_EXTERNAL){e.next=18;break}throw new lA(uA.STREAM_TYPE_NOT_MATCH,"setVideoSourceType as external first");case 18:return e.next=20,VU(r,this._extensionManager);case 20:if(this._localScreenVideoTrack=e.sent,this._initLocalTrackEvents(this._localScreenVideoTrack,!0),null===(c=this._screenPlayer)||void 0===c||c.playVideo(this._localScreenVideoTrack),null===(u=this._room)||void 0===u||null===(d=u.localScreenStream)||void 0===d||null===(l=d.observer)||void 0===l||l.setPushVideo(!0),null===(h=this._room)||void 0===h||null===(p=h.localScreenStream)||void 0===p||!p.pubVideo){e.next=27;break}return e.next=27,this._updateScreenPublish();case 27:case"end":return e.stop()}}),e,this)}))),function(e,t){return D.apply(this,arguments)})},{key:"setAudioSourceType",value:(P=km(Em().mark((function e(t,r){var n,i,o,a,s,c,u,d,l,h,p,_,v,f,m,g,y,S,b,E,T,k;return Em().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(IX.print("setAudioSourceType()","index: %o, audioSourceType: %o",t,r),$P(t,"streamIndex",[yd.STREAM_INDEX_MAIN,yd.STREAM_INDEX_SCREEN]),$P(r,"audioSourceType",[ld.AUDIO_SOURCE_TYPE_EXTERNAL,ld.AUDIO_SOURCE_TYPE_INTERNAL]),n=t===yd.STREAM_INDEX_MAIN?"audio":"screenAudio",this._trackSourceType[n]===r){e.next=24;break}if(this._trackSourceType[n]=r,IX.print("setVideoSourceType",wm(i="set ".concat(n," source type to ")).call(i,r)),!this._localAudioTrack||t!==yd.STREAM_INDEX_MAIN){e.next=16;break}if(c=!1,this._trackSourceType.audio===ld.AUDIO_SOURCE_TYPE_EXTERNAL&&(c=!0,this._removeLocalTrackEvents(this._localAudioTrack),this._localAudioTrack.close()),this._localAudioTrack=void 0,u=null===(o=this._room)||void 0===o?void 0:o._roomConfig.isAutoPublish,c?null===(d=this._room)||void 0===d||null===(l=d.localStream)||void 0===l||null===(h=l.observer)||void 0===h||h.setEnableAudio(!1):null===(p=this._room)||void 0===p||null===(_=p.localStream)||void 0===_||null===(v=_.observer)||void 0===v||v.setPushAudio(!1),!(null!==(a=this._room)&&void 0!==a&&null!==(s=a.localStream)&&void 0!==s&&s.pubAudio||u)){e.next=16;break}return e.next=16,this._updatePublish();case 16:if(!this._localScreenAudioTrack||t!==yd.STREAM_INDEX_SCREEN){e.next=24;break}if(g=!1,this._trackSourceType.audio===ld.AUDIO_SOURCE_TYPE_EXTERNAL&&(g=!0,this._removeLocalTrackEvents(this._localScreenAudioTrack),this._localScreenAudioTrack.close()),this._localScreenAudioTrack=void 0,g?null===(y=this._room)||void 0===y||null===(S=y.localScreenStream)||void 0===S||null===(b=S.observer)||void 0===b||b.setEnableAudio(!1):null===(E=this._room)||void 0===E||null===(T=E.localScreenStream)||void 0===T||null===(k=T.observer)||void 0===k||k.setPushAudio(!1),null===(f=this._room)||void 0===f||null===(m=f.localScreenStream)||void 0===m||!m.pubAudio){e.next=24;break}return e.next=24,this._updateScreenPublish();case 24:case"end":return e.stop()}}),e,this)}))),function(e,t){return P.apply(this,arguments)})},{key:"setExternalAudioTrack",value:(O=km(Em().mark((function e(t,r){var n,i,o,a,s,c,u,d,l,h,p,_;return Em().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(IX.print("setExternalAudioTrack()","index: %o, track: %o",t,r),$P(t,"streamIndex",[yd.STREAM_INDEX_MAIN,yd.STREAM_INDEX_SCREEN]),eD(r),t!==yd.STREAM_INDEX_MAIN){e.next=16;break}if(this._trackSourceType.audio===ld.AUDIO_SOURCE_TYPE_EXTERNAL){e.next=6;break}throw new lA(uA.STREAM_TYPE_NOT_MATCH,"setAudioSourceType as external first");case 6:return e.next=8,LU(r,this._extensionManager);case 8:if(this._localAudioTrack=e.sent,this._localAudioTrack.setVolume(this._localAudioVolume),this._initLocalTrackEvents(this._localAudioTrack),u=null===(n=this._room)||void 0===n?void 0:n._roomConfig.isAutoPublish,null===(i=this._room)||void 0===i||null===(o=i.localStream)||void 0===o||null===(a=o.observer)||void 0===a||a.setPushAudio(!0),!(null!==(s=this._room)&&void 0!==s&&null!==(c=s.localStream)&&void 0!==c&&c.pubAudio||u)){e.next=16;break}return e.next=16,this._updatePublish();case 16:if(t!==yd.STREAM_INDEX_SCREEN){e.next=28;break}if(this._trackSourceType.screenAudio===ld.AUDIO_SOURCE_TYPE_EXTERNAL){e.next=19;break}throw new lA(uA.STREAM_TYPE_NOT_MATCH,"setAudioSourceType as external first");case 19:return e.next=21,BU(r,this._extensionManager);case 21:if(this._localScreenAudioTrack=e.sent,this._localScreenAudioTrack.setVolume(this._localScreenAudioVolume),this._initLocalTrackEvents(this._localScreenAudioTrack),null===(d=this._room)||void 0===d||null===(l=d.localScreenStream)||void 0===l||null===(h=l.observer)||void 0===h||h.setPushAudio(!0),null===(p=this._room)||void 0===p||null===(_=p.localScreenStream)||void 0===_||!_.pubAudio){e.next=28;break}return e.next=28,this._updateScreenPublish();case 28:case"end":return e.stop()}}),e,this)}))),function(e,t){return O.apply(this,arguments)})},{key:"login",value:(x=km(Em().mark((function e(t,r){return Em().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return IX.print("login()","token: %o, userInfo: %o",t,r),oD(t)||ZP(t,"token"),sD(r),e.abrupt("return",this._rtmClient.login(t,r));case 4:case"end":return e.stop()}}),e,this)}))),function(e,t){return x.apply(this,arguments)})},{key:"logout",value:(w=km(Em().mark((function e(){return Em().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return IX.print("logout()"),e.abrupt("return",this._rtmClient.logout());case 2:case"end":return e.stop()}}),e,this)}))),function(){return w.apply(this,arguments)})},{key:"updateLoginToken",value:(C=km(Em().mark((function e(t){return Em().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return IX.print("updateLoginToken()","token: %o",t),oD(t)||ZP(t,"token"),e.abrupt("return",this._rtmClient.updateLoginToken(t));case 3:case"end":return e.stop()}}),e,this)}))),function(e){return C.apply(this,arguments)})},{key:"getPeerOnlineStatus",value:(A=km(Em().mark((function e(t){return Em().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return IX.print("getPeerOnlineStatus()","userId: %o",t),sD(t),e.abrupt("return",this._rtmClient.getPeerOnlineStatus(t));case 3:case"end":return e.stop()}}),e,this)}))),function(e){return A.apply(this,arguments)})},{key:"sendUserMessageOutsideRoom",value:(R=km(Em().mark((function e(t,r){var n,i=this;return Em().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return sD(t),hD(r),n=Date.now(),e.abrupt("return",this._rtmClient.sendUserMessageOutsideRoom(t,r).then((function(e){return i._messageStatisticsObserver.countUserMessageOutsideRoom(!0,t,!1,n,e),e.id})).catch((function(e){throw i._messageStatisticsObserver.countUserMessageOutsideRoom(!1,t,!1,n,e),e})));case 4:case"end":return e.stop()}}),e,this)}))),function(e,t){return R.apply(this,arguments)})},{key:"sendUserBinaryMessageOutsideRoom",value:(I=km(Em().mark((function e(t,r){var n,i=this;return Em().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return sD(t),rD(r,"message"),hD(r),n=Date.now(),e.abrupt("return",this._rtmClient.sendUserMessageOutsideRoom(t,r).then((function(e){return i._messageStatisticsObserver.countUserMessageOutsideRoom(!0,t,!0,n,e),e.id})).catch((function(e){throw i._messageStatisticsObserver.countUserMessageOutsideRoom(!1,t,!0,n,e),e})));case 5:case"end":return e.stop()}}),e,this)}))),function(e,t){return I.apply(this,arguments)})},{key:"setServerParams",value:(k=km(Em().mark((function e(t,r){return Em().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return IX.print("setServerParams()","signature: %o, url: %0",t,r),e.abrupt("return",this._rtmClient.setServerParams(t,r));case 2:case"end":return e.stop()}}),e,this)}))),function(e,t){return k.apply(this,arguments)})},{key:"sendServerMessage",value:(T=km(Em().mark((function e(t){var r,n=this;return Em().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return ZP(t,"message"),hD(t),r=Date.now(),e.abrupt("return",this._rtmClient.sendServerMessage(t).then((function(e){n._messageStatisticsObserver.countServerMessage(!0,!1,r,e)})).catch((function(e){throw n._messageStatisticsObserver.countServerMessage(!1,!1,r,e),e})));case 4:case"end":return e.stop()}}),e,this)}))),function(e){return T.apply(this,arguments)})},{key:"sendServerBinaryMessage",value:(E=km(Em().mark((function e(t){var r,n=this;return Em().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return rD(t,"message"),hD(t),r=Date.now(),e.abrupt("return",this._rtmClient.sendServerMessage(t).then((function(e){n._messageStatisticsObserver.countServerMessage(!0,!0,r,e)})).catch((function(e){throw n._messageStatisticsObserver.countServerMessage(!1,!0,r,e),e})));case 4:case"end":return e.stop()}}),e,this)}))),function(e){return E.apply(this,arguments)})},{key:"startCloudProxy",value:function(e){if(this._room)throw new lA(uA.START_CLOUD_PROXY_AFTER_JOIN,"[startCloudProxy] should be invoke before join room ");IX.print("startCloudProxy()",e),ZP(e.logProxy,"logProxy"),ZP(e.accessProxy,"accessProxy"),ZP(e.configProxy,"configProxy"),this._originIceConfigRequestUrls=XP("ICE_CONFIG_REQUEST_URLS"),this._originLogServerUrl=XP("LOG_SERVER_URL"),this._originConfigServerUrls=XP("CONFIG_REQUEST_DOMAINS"),KP("ICE_CONFIG_REQUEST_URLS",e.accessProxy),KP("LOG_SERVER_URL",function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"";return/^https?:\/\/.+/.test(e)||(e="https://"+e),"".concat(e,"/video/v1/webrtc_log/")}(e.logProxy)),KP("CONFIG_REQUEST_DOMAINS",[e.configProxy]),UP.clearAccessNode(this._appId),UP.clearAccessUrls(),this._ctx.useCloudProxy=!0}},{key:"stopCloudProxy",value:function(){var e;if(this._room)throw new lA(uA.STOP_CLOUD_PROXY_BEFORE_LEAVE,"[stopCloudProxy] should be invoke after leave room ");IX.print("stopCloudProxy()"),KP("ICE_CONFIG_REQUEST_URLS",null===(e=this._originIceConfigRequestUrls)||void 0===e?void 0:JE(e).call(e,(function(e){return e.replace("https://","").replace("/dispatch/v1/AccessInfo?Action=GetAccessInfo","")}))),KP("LOG_SERVER_URL",this._originLogServerUrl),KP("CONFIG_REQUEST_DOMAINS",this._originConfigServerUrls),UP.clearAccessNode(this._appId),UP.clearAccessUrls(),this._ctx.useCloudProxy=!1,this._startCloudProxyTimestamp=void 0}},{key:"startPushPublicStream",value:(b=km(Em().mark((function e(t,r){var n,i,o,a=this;return Em().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(IX.print("startPushPublicStream()","publicStreamId: %o, publicStreamParam: %o",t,r),cD(t),this._assertNotInRoom(),!this._publicStreamIds.get(t)){e.next=5;break}throw new lA(uA.REPEAT_PUSH,"repeat push public media stream");case 5:return o=WP(t,"started",r),e.abrupt("return",null===(n=this._room)||void 0===n||null===(i=n.publicStreamControlMessage(o))||void 0===i?void 0:i.then((function(){a._publicStreamIds.set(t,t)})));case 7:case"end":return e.stop()}}),e,this)}))),function(e,t){return b.apply(this,arguments)})},{key:"updatePublicStreamParam",value:(S=km(Em().mark((function e(t,r){var n,i;return Em().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return IX.print("startPushPublicStream()","publicStreamId: %o, publicStreamParam: %o",t,r),cD(t),this._assertNotInRoom(),i=WP(t,"layoutChanged",r),e.abrupt("return",null===(n=this._room)||void 0===n?void 0:n.publicStreamControlMessage(i));case 5:case"end":return e.stop()}}),e,this)}))),function(e,t){return S.apply(this,arguments)})},{key:"stopPushPublicStream",value:(y=km(Em().mark((function e(t){var r,n=this;return Em().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return IX.print("startPushPublicStream()","publicStreamId: %o",t),cD(t),this._assertNotInRoom(),e.abrupt("return",null===(r=this._room)||void 0===r?void 0:r.publicStreamControlMessage({type:"publicstream",action:"stopped",publicStreamID:t}).then((function(){n._publicStreamIds.delete(t)})));case 4:case"end":return e.stop()}}),e,this)}))),function(e){return y.apply(this,arguments)})},{key:"startPlayPublicStream",value:(g=km(Em().mark((function e(t){var r,n,i,o,a,s,c=this;return Em().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(cD(t),this._publicStreamManager){e.next=8;break}return this._publicStreamManager=new uX(this.id,this._appId,{businessId:this._businessId}),this._publicStreamManager.on(NV.RESUBSCRIBE,(function(e){var t=e.stream;if(t){var r,n=c._publicStreamAudioPlayer.get(t.streamId);n&&t.audioTrack&&(n.stop(),n.playAudio(null===(r=e.stream)||void 0===r?void 0:r.audioTrack));var i,o=c._publicStreamVideoPlayer.get(t.streamId);o&&t.videoTrack&&o.playVideo(null===(i=e.stream)||void 0===i?void 0:i.videoTrack)}})),null===(r=this._publicStreamManager)||void 0===r||r.on("onRemoteStreamStats",(function(e){e.publicStreamId=e.userId,delete e.userId,delete e.isScreen,c.safeEmit(Xd.onPublicStreamStats,e)})),null===(n=this._publicStreamManager)||void 0===n||n.on(NV.ON_SEI_MESSAGED_RECEIVED,(function(e){c.safeEmit(Xd.onPublicStreamSEIMessageReceived,e)})),e.next=8,this._publicStreamManager.connect();case 8:return e.next=10,this._publicStreamManager.startPlayPublicStream(t);case 10:i=e.sent,(o=this._publicStreamVideoPlayer.get(t))&&null!=i&&i.videoTrack&&o.playVideo(i.videoTrack,i),!(a=this._publicStreamAudioPlayer.get(t))&&null!=i&&i.audioTrack&&(a=new OG(this.id,t,{muted:(null===(s=this._config)||void 0===s?void 0:s.autoPlayPolicy)===Md.VIDEO_ONLY,isScreen:!1}),this._initPlayerEvents(a,!0),a.playAudio(i.audioTrack),this._publicStreamAudioPlayer.set(t,a));case 15:case"end":return e.stop()}}),e,this)}))),function(e){return g.apply(this,arguments)})},{key:"stopPlayPublicStream",value:(m=km(Em().mark((function e(t){var r;return Em().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this._publicStreamManager){e.next=2;break}return e.abrupt("return");case 2:this._publicStreamManager.stopPlayPublicStream(t),(r=this._publicStreamAudioPlayer.get(t))&&(r.destroy(),this._publicStreamAudioPlayer.delete(t));case 5:case"end":return e.stop()}}),e,this)}))),function(e){return m.apply(this,arguments)})},{key:"setAudioProfile",value:(f=km(Em().mark((function e(t){return Em().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:IX.print("setAudioProfile()","profile: %o",t),this._shouldUpdateAudioConf("setAudioProfile")&&this._ctx.audioProfileManager.setAudioProfile(t);case 2:case"end":return e.stop()}}),e,this)}))),function(e){return f.apply(this,arguments)})},{key:"setPublicStreamVideoPlayer",value:function(e,t){var r,n,i,o;IX.print("setPublicStreamVideoPlayer()","publicStreamId: %o, videoPlayerOption: %o",e,t);var a=this._publicStreamVideoPlayer.get(e);if(null===(r=a)||void 0===r||r.destroy(),null!=t&&t.renderDom){a=new xG(this.id,ud(ud({},t),{},{userId:e})),this._initPlayerEvents(a,!0),this._publicStreamVideoPlayer.set(e,a);var s=null===(n=this._publicStreamManager)||void 0===n||null===(i=n.remoteStreams)||void 0===i?void 0:i.get(e);null!=s&&s.videoTrack&&(null===(o=this._config)||void 0===o?void 0:o.autoPlayPolicy)!==Md.PLAY_MANUALLY&&a.playVideo(s.videoTrack,s)}else this._publicStreamVideoPlayer.delete(e)}},{key:"setDummyCaptureImagePath",value:(v=km(Em().mark((function e(t,r){var n=this;return Em().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",new Wf((function(e,i){ZP(r,"filePath");var o=new Image;o.crossOrigin="anonymous",o.src=r,o.onload=function(){t===yd.STREAM_INDEX_MAIN?n._dummyMainImage=o:n._dummyScreenImage=o;try{n._updateDummyCaptureImage(t),e()}catch(r){i(new lA(uA.UNEXPECTED_ERROR,r.message))}},o.onerror=function(){i(new lA(uA.UNEXPECTED_ERROR,"Load image error"))}})));case 1:case"end":return e.stop()}}),e)}))),function(e,t){return v.apply(this,arguments)})},{key:"_updateDummyCaptureImage",value:function(e){var t,r;if(e===yd.STREAM_INDEX_MAIN?(t=this._dummyMainImage,r=this._videoStreamEncodeConfig[0]):(t=this._dummyScreenImage,r=this._screenStreamEncodeConfig[0]),t){var n,i,o=document.createElement("canvas"),a=o.getContext("2d"),s=rP(r.width),c=rP(r.height);if(!a)throw new lA(uA.UNEXPECTED_ERROR,"Not support canvas");!s||!c||t.width<=s&&t.height<=c?(n=t.width,i=t.height):(n=Math.min(s,t.width*c/t.height),i=Math.min(c,t.height*s/t.width)),o.width=n,o.height=i,a.drawImage(t,0,0,t.width,t.height,0,0,n,i);var u=window.setInterval((function(){t&&a.drawImage(t,0,0,t.width,t.height,0,0,n,i)}),200);e===yd.STREAM_INDEX_MAIN?(clearInterval(this._dummyMainTimer),this._dummyMainTimer=u):(clearInterval(this._dummyScreenTimer),this._dummyScreenTimer=u);var d,l,h,p,_=o.captureStream(5).getVideoTracks()[0];if(e===yd.STREAM_INDEX_MAIN){if(this._localImgVideoTrack=_,null!==(d=this._localVideoTrack)&&void 0!==d&&d.dummy)null===(l=this._localVideoTrack)||void 0===l||l.setTrack(this._localImgVideoTrack,this._extensionManager)}else if(this._localImgScreenTrack=_,null!==(h=this._localScreenVideoTrack)&&void 0!==h&&h.dummy)null===(p=this._localScreenVideoTrack)||void 0===p||p.setTrack(this._localImgScreenTrack,this._extensionManager)}}},{key:"_addListenExtensionEvent",value:function(e){var t=this;e.on("re-capture-audio",(function(){t._localAudioTrack&&t.stopAudioCapture().then((function(){t.startAudioCapture()}))})),e.on("re-capture-video",(function(){t._localVideoTrack&&!t._localVideoTrack.dummy&&t.stopVideoCapture().then((function(){t.startVideoCapture()}))})),e.on("reset-video-effect",function(){var e=km(Em().mark((function e(r,n){var i,o,a;return Em().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!t._localVideoTrack||t._localVideoTrack.dummy){e.next=17;break}return t._localVideoTrack&&t._removeLocalTrackEvents(t._localVideoTrack),e.prev=2,e.next=5,t._localVideoTrack.generatePreProcessingTrack(t._extensionManager);case 5:e.next=10;break;case 7:e.prev=7,e.t0=e.catch(2),n(e.t0);case 10:if(t._initLocalTrackEvents(t._localVideoTrack),null!==(i=t._videoPlayer)&&void 0!==i&&i.played&&(t._videoPlayer.stop(),t._videoPlayer.playVideo(t._localVideoTrack),t._videoPlayer.mirror(!!t._mirrorType)),t.safeEmit(Xd.onLocalStreamTrackChangedByExtension,{streamIndex:yd.STREAM_INDEX_MAIN,type:"video"}),r(),null===(o=t._room)||void 0===o||null===(a=o.localStream)||void 0===a||!a.pubVideo){e.next=17;break}return e.next=17,t._updatePublish();case 17:r();case 18:case"end":return e.stop()}}),e,null,[[2,7]])})));return function(t,r){return e.apply(this,arguments)}}())}},{key:"registerExtension",value:(_=km(Em().mark((function e(t){return Em().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t.monitor=this.monitor,e.prev=1,e.next=4,t.isSupported();case 4:if(e.sent){e.next=7;break}throw new Error("This extension is not supported.");case 7:e.next=12;break;case 9:throw e.prev=9,e.t0=e.catch(1),new Error("This extension is not supported.");case 12:return e.next=14,t.init({videoCaptureConfig:this._videoStreamConstraints});case 14:this._extensionManager.register(t),this._addListenExtensionEvent(t);case 16:case"end":return e.stop()}}),e,this,[[1,9]])}))),function(e){return _.apply(this,arguments)})},{key:"defaultTranscoding",value:function(){return JSON.parse(eT(bX.getDefaultValue()))}},{key:"_updatePublish",value:(p=km(Em().mark((function e(){var t,r,n,i=arguments;return Em().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t=i.length>0&&void 0!==i[0]?i[0]:{},IX.print("_updatePublish()","config: %o",t),r={mediaType:void 0,invokeByJoinRoom:!1,pubState:UV.PUB},t=ud(ud({},r),t),this._visibility){e.next=6;break}throw new lA(uA.NO_PUBLISH_PERMISSION,"no publish permission");case 6:return e.next=8,this._pubLock.lock();case 8:if(n=e.sent,this._room&&this._room.connectionState===Yj.CONNECTED){e.next=12;break}return n(),e.abrupt("return");case 12:return e.prev=12,e.next=15,this._room.publish(this._videoStreamEncodeConfig,this._enableSimulcast,this._localVideoTrack,this._localAudioTrack,t.mediaType,t.pubState,t.invokeByJoinRoom);case 15:this._videoPlayer&&this._room.localStream&&(this._room.localStream.videoDom=this._videoPlayer.domElement),e.next=25;break;case 18:if(e.prev=18,e.t0=e.catch(12),!(e.t0 instanceof lA)){e.next=24;break}throw e.t0;case 24:throw new lA(uA.UNEXPECTED_ERROR,"unexpected error",e.t0);case 25:return e.prev=25,n(),e.finish(25);case 28:case"end":return e.stop()}}),e,this,[[12,18,25,28]])}))),function(){return p.apply(this,arguments)})},{key:"startAudioPlaybackDeviceTest",value:(h=km(Em().mark((function e(t,r){return Em().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return IX.print("startAudioPlaybackDeviceTest()","filePath: %o, indicationInterval: %o",t,r),ZP(t,"filePath"),QP(r,"indicationInterval"),e.next=5,this._audioDeviceManager.startAudioPlaybackDeviceTest(t,r);case 5:return e.abrupt("return",e.sent);case 6:case"end":return e.stop()}}),e,this)}))),function(e,t){return h.apply(this,arguments)})},{key:"stopAudioPlaybackDeviceTest",value:function(){IX.print("stopAudioPlaybackDeviceTest()"),this._audioDeviceManager.stopAudioPlaybackDeviceTest()}},{key:"startAudioDeviceRecordTest",value:(l=km(Em().mark((function e(t,r){return Em().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return IX.print("startAudioDeviceRecordTest()","indicationInterval: %o",t),QP(t,"indicationInterval"),e.next=4,this._audioDeviceManager.startAudioDeviceRecordTest(t,r,this._localAudioVolume);case 4:case"end":return e.stop()}}),e,this)}))),function(e,t){return l.apply(this,arguments)})},{key:"stopAudioDeviceRecordAndPlayTest",value:function(){IX.print("stopAudioDeviceRecordAndPlayTest()"),this._audioDeviceManager.stopAudioDeviceRecordAndPlayTest()}},{key:"stopAudioDevicePlayTest",value:function(){IX.print("stopAudioDevicePlayTest()"),this._audioDeviceManager.stopAudioDevicePlayTest()}},{key:"setRemoteUserPriority",value:function(e,t){var r;IX.print("setRemoteUserPriority()","userId: %o, priority: %o",e,t);try{sD(e),$P(t,"priority",[wd.HIGH,wd.MEDIUM,wd.LOW])}catch(n){return console.warn(n),!1}return this._ctx.userPriority.set(e,t),null===(r=this._room)||void 0===r||r.updateRemoteUserPriority(e),!0}},{key:"takeLocalSnapshot",value:(d=km(Em().mark((function e(t){var r,n;return Em().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(IX.print("takeLocalSnapshot()","streamIndex: %o",t),$P(t,"streamIndex",[yd.STREAM_INDEX_MAIN,yd.STREAM_INDEX_SCREEN]),r=t===yd.STREAM_INDEX_MAIN?this.localVideoTrack:this.localScreenVideoTrack){e.next=5;break}throw new lA(uA.INVOKED_BEFORE_CAPTURE,"capture first");case 5:return n=t===yd.STREAM_INDEX_MAIN?this._videoPlayer:this._screenPlayer,e.abrupt("return",_X(r.getTrack("preprocessing"),(null==n?void 0:n.mirrorType)===Td.MIRROR_TYPE_RENDER,n));case 7:case"end":return e.stop()}}),e,this)}))),function(e){return d.apply(this,arguments)})},{key:"takeRemoteSnapshot",value:(u=km(Em().mark((function e(t,r){var n,i,o,a,s,c;return Em().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(IX.print("takeRemoteSnapshot()","id: %o, streamIndex: %o",t,r),ZP(t,"id"),$P(r,"streamIndex",[yd.STREAM_INDEX_MAIN,yd.STREAM_INDEX_SCREEN]),c=(null===(n=this._room)||void 0===n||null===(i=n.remoteStreams.get(t))||void 0===i||null===(o=sE(i).call(i,(function(e){return e.isScreen===(r===yd.STREAM_INDEX_SCREEN)})))||void 0===o?void 0:o.videoTrack)||(null===(a=this._publicStreamManager)||void 0===a||null===(s=a.remoteStreams.get(t))||void 0===s?void 0:s.videoTrack)){e.next=6;break}throw new lA(uA.STREAM_NOT_EXIST,"stream not exist");case 6:return e.abrupt("return",_X(c.getTrack(),!1,r===yd.STREAM_INDEX_MAIN?this._remoteVideoPlayer.get(t):this._remoteScreenPlayer.get(t)));case 7:case"end":return e.stop()}}),e,this)}))),function(e,t){return u.apply(this,arguments)})},{key:"setSubscribeFallbackOption",value:function(e){IX.print("setSubscribeFallbackOption()","option: %o",e);try{$P(e,"option",[Cd.DISABLE,Cd.VIDEO_STREAM_LOW,Cd.AUDIO_ONLY])}catch(t){return console.warn(t),!1}return!this._room&&(this._ctx.subscribeFallbackOption=e,!0)}},{key:"getLocalStreamTrack",value:function(e,t){var r,n,i,o=this;if(e===yd.STREAM_INDEX_MAIN?(n="video"===t?this.localVideoTrack:this.localAudioTrack,i=function(){var e;return null===(e=o._room)||void 0===e?void 0:e.localStream}):(n="video"===t?this.localScreenVideoTrack:this.localScreenAudioTrack,i=function(){var e;return null===(e=o._room)||void 0===e?void 0:e.localScreenStream}),n){var a=n instanceof GU&&n.mixedAudioTrack?n.mixedAudioTrack:n.getTrack("preprocessing");if(a){var s=i();return this._reportMsTrackEvent(a,(null==s||null===(r=s.stream)||void 0===r?void 0:r.id)||"local"),a}}}},{key:"getRemoteStreamTrack",value:function(e,t,r){var n,i,o=(null===(n=this._room)||void 0===n?void 0:n.remoteStreams.get(e))||[];if(o&&o.length){var a,s,c,u,d;if(t===yd.STREAM_INDEX_MAIN)a=sE(o).call(o,(function(e){return!e.isScreen})),i="video"===r?null===(s=a)||void 0===s?void 0:s.videoTrack:null===(c=a)||void 0===c?void 0:c.audioTrack;else a=sE(o).call(o,(function(e){return e.isScreen})),i="video"===r?null===(u=a)||void 0===u?void 0:u.videoTrack:null===(d=a)||void 0===d?void 0:d.audioTrack;if(i){var l=i.getTrack();if(l&&a){var h=a.streamId;return this._reportMsTrackEvent(l,h),l}}}}},{key:"getPublicStreamTrack",value:function(e,t){if(this._publicStreamManager&&this._publicStreamManager.remoteStreams){var r=this._publicStreamManager.remoteStreams.get(e);if(r){var n="video"===t?r.videoTrack:r.audioTrack;if(n){var i=n.getTrack();if(i){var o=r.streamId;return this._reportMsTrackEvent(i,o),i}}}}}},{key:"setRemoteStreamRenderSync",value:function(e){return!this._room&&(this._ctx.avSync=!!e,!0)}},{key:"setCaptureVolume",value:function(e,t){var r,n,i;($P(e,"streamIndex",[yd.STREAM_INDEX_MAIN,yd.STREAM_INDEX_SCREEN]),t=mD(t,"volume",0,400),e===yd.STREAM_INDEX_SCREEN)?(null===(r=this._localScreenAudioTrack)||void 0===r||r.setVolume(t),this._localScreenAudioVolume=t):(null===(n=this._localAudioTrack)||void 0===n||n.setVolume(t),null===(i=this._audioDeviceManager.audioTrack)||void 0===i||i.setVolume(t),this._localAudioVolume=t)}},{key:"setPlaybackVolume",value:function(e,t,r){var n,i,o;if(sD(e),$P(t,"streamIndex",[yd.STREAM_INDEX_MAIN,yd.STREAM_INDEX_SCREEN]),r=mD(r,"volume",0,400),null!==(n=this._room)&&void 0!==n&&n.multiChatMode)tP("setPlaybackVolume is not supported in Conference mode");else{var a=t===yd.STREAM_INDEX_SCREEN;a?this._remoteScreenAudioVolume.set(e,r):this._remoteAudioVolume.set(e,r),null===(i=this._room)||void 0===i||null===(o=i.remoteStreams.get(e))||void 0===o||o.forEach((function(e){var t;e.isScreen===a&&(null===(t=e.audioTrack)||void 0===t||t.setVolume(r))}))}}},{key:"setPublicStreamVolume",value:function(e,t){var r,n,i;ZP(e,"publicStreamId"),t=mD(t,"volume",0,400),this._publicAudioVolume.set(e,t),null===(r=this._publicStreamManager)||void 0===r||null===(n=r.remoteStreams.get(e))||void 0===n||null===(i=n.audioTrack)||void 0===i||i.setVolume(t)}},{key:"startForwardStreamToRooms",value:(c=km(Em().mark((function e(t){var r;return Em().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t.forEach((function(e){aD(e.roomId)})),this._assertNotInRoom(),e.next=4,this._room.startForwardStream2Rooms(t);case 4:return r=e.sent,e.abrupt("return",r);case 6:case"end":return e.stop()}}),e,this)}))),function(e){return c.apply(this,arguments)})},{key:"updateForwardStreamToRooms",value:(s=km(Em().mark((function e(t){var r;return Em().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t.forEach((function(e){aD(e.roomId)})),this._assertNotInRoom(),e.next=4,this._room.updateForwardStream2Rooms(t);case 4:return r=e.sent,e.abrupt("return",r);case 6:case"end":return e.stop()}}),e,this)}))),function(e){return s.apply(this,arguments)})},{key:"stopForwardStreamToRooms",value:(a=km(Em().mark((function e(){var t;return Em().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return this._assertNotInRoom(),e.next=3,this._room.stopForwardStream2Rooms();case 3:return t=e.sent,e.abrupt("return",t);case 5:case"end":return e.stop()}}),e,this)}))),function(){return a.apply(this,arguments)})},{key:"pauseForwardStreamToAllRooms",value:(o=km(Em().mark((function e(){var t;return Em().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return this._assertNotInRoom(),e.next=3,this._room.pauseForwardStream2AllRooms();case 3:return t=e.sent,e.abrupt("return",t);case 5:case"end":return e.stop()}}),e,this)}))),function(){return o.apply(this,arguments)})},{key:"resumeForwardStreamToAllRooms",value:(i=km(Em().mark((function e(){var t;return Em().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return this._assertNotInRoom(),e.next=3,this._room.resumeForwardStream2AllRooms();case 3:return t=e.sent,e.abrupt("return",t);case 5:case"end":return e.stop()}}),e,this)}))),function(){return i.apply(this,arguments)})},{key:"_reportMsTrackEvent",value:function(e,t){var r=this;if(!e.hookStop){e.hookStop=!0;var n=e.stop;e.stop=function(){IO(r.id,"stop",t,0,t),n.call(e)}}}},{key:"_updateScreenPublish",value:(n=km(Em().mark((function e(){var t,r,n,i=arguments;return Em().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=i.length>0&&void 0!==i[0]?i[0]:{},IX.print("_updateScreenPublish()"),r={mediaType:void 0,pubState:UV.PUB},t=ud(ud({},r),t),e.next=6,this._pubLock.lock();case 6:if(n=e.sent,this._room&&this._room.connectionState===Yj.CONNECTED){e.next=10;break}return n(),e.abrupt("return");case 10:return e.prev=10,e.next=13,this._room.publishScreen(this._screenStreamEncodeConfig,this._localScreenVideoTrack,this._localScreenAudioTrack,t.mediaType,t.pubState);case 13:this._screenPlayer&&this._room.localScreenStream&&(this._room.localScreenStream.videoDom=this._screenPlayer.domElement),e.next=23;break;case 16:if(e.prev=16,e.t0=e.catch(10),!(e.t0 instanceof lA)){e.next=22;break}throw e.t0;case 22:throw new lA(uA.UNEXPECTED_ERROR,"unexpected error",e.t0);case 23:return e.prev=23,n(),e.finish(23);case 26:case"end":return e.stop()}}),e,this,[[10,16,23,26]])}))),function(){return n.apply(this,arguments)})},{key:"_updateAudioPlayerState",value:function(e){IX.print("_updateAudioPlayerState()");var t,r=e.userId,n=e.isScreen,i=n?this._remoteScreenAudioPlayer:this._remoteAudioPlayer,o=i.get(r);if(e.audioTrack&&e.attributes.audiostream&&e.subAudio){var a,s,c,u=n?null!==(a=this._remoteScreenAudioVolume.get(r))&&void 0!==a?a:100:null!==(s=this._remoteAudioVolume.get(r))&&void 0!==s?s:100;if(e.audioTrack.setVolume(u),!o){var d;o=new OG(this.id,r,{muted:(null===(d=this._config)||void 0===d?void 0:d.autoPlayPolicy)===Md.VIDEO_ONLY,isScreen:n}),this._initPlayerEvents(o,!1,n?yd.STREAM_INDEX_SCREEN:yd.STREAM_INDEX_MAIN),i.set(r,o);var l=this._audioDeviceManager.getSinkId();l&&o.setPlaybackDevice(l)}(null===(c=this._config)||void 0===c?void 0:c.autoPlayPolicy)!==Md.PLAY_MANUALLY&&o.playAudio(e.audioTrack),sP&&_P&&(t=this._remoteAudioPlayer,SX&&clearTimeout(SX),SX=setTimeout((function(){var e,r=Jk(t);try{for(r.s();!(e=r.n()).done;){var n=Qk(e.value,2),i=n[0],o=n[1];null!=i&&cA(i).call(i,"mux")&&o.pause()}}catch(l){r.e(l)}finally{r.f()}var a,s=Jk(t);try{for(s.s();!(a=s.n()).done;){var c=Qk(a.value,2),u=c[0],d=c[1];null!=u&&cA(u).call(u,"mux")&&d.manuallyPlay()}}catch(l){s.e(l)}finally{s.f()}}),2e3))}else{var h;null===(h=o)||void 0===h||h.stop()}}},{key:"_updateVideoPlayerState",value:function(e){var t;IX.print("_updateVideoPlayerState()");var r,n,i=e.userId;if(r=e.isScreen?this._remoteScreenPlayer.get(i):this._remoteVideoPlayer.get(i),e.videoTrack)r&&(null===(n=this._config)||void 0===n?void 0:n.autoPlayPolicy)!==Md.PLAY_MANUALLY&&r.playVideo(e.videoTrack,e);else if(null!==(t=r)&&void 0!==t&&t.played){var o;null===(o=r)||void 0===o||o.stop()}}},{key:"_onAddStream",value:(r=km(Em().mark((function e(t){var r,n,i,o,a,s,c,u,d;return Em().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if((n=t.stream).videoDom=null===(r=this._remoteVideoPlayer.get(n.userId))||void 0===r?void 0:r.domElement,i=null==n?void 0:n.attributes,o=i.localaudio,a=i.audiostream,s=i.localvideo,c=i.videostream,u=zU.NONE,a&&(u|=Sd.AUDIO),c&&(u|=Sd.VIDEO),!u){e.next=12;break}return e.next=9,new Wf((function(e){return setTimeout(e)}));case 9:null!=n&&n.isScreen?this.safeEmit(Xd.onUserPublishScreen,{userId:n.userId,mediaType:u}):(this.safeEmit(Xd.onUserPublishStream,{userId:n.userId,mediaType:u,videoStreamDescriptions:null==n||null===(d=n.attributes)||void 0===d?void 0:d.videoDescriptions}),this._handleAutoSubscribe(n,!0)),this.safeEmit("onAddStream",{userId:n.userId,mediaType:u,isScreen:!(null==n||!n.isScreen)}),null!=n&&n.isScreen||(o&&this.safeEmit(Xd.onUserStartAudioCapture,{userId:n.userId}),s&&this.safeEmit(Xd.onUserStartVideoCapture,{userId:n.userId}));case 12:case"end":return e.stop()}}),e,this)}))),function(e){return r.apply(this,arguments)})},{key:"_handleAutoSubscribe",value:function(e,t){var r,n,i=zU.NONE;if(null!==(r=this._roomConfig)&&void 0!==r&&r.isAutoSubscribeAudio&&(i|=Sd.AUDIO),null!==(n=this._roomConfig)&&void 0!==n&&n.isAutoSubscribeVideo&&(i|=Sd.VIDEO),i){var o,a;if(t&&qO(i))null===(o=e.observer)||void 0===o||o.setAutoSubscribeAudio(!0);if(t&&YO(i))null===(a=e.observer)||void 0===a||a.setAutoSubscribeVideo(!0);this._subscribe(!1,e.userId,i)}}},{key:"_onRemoveStream",value:function(e){var t,r=this,n=e.stream,i=null!==(t=CX[e.reason])&&void 0!==t?t:bd.STREAM_REMOVE_REASON_OTHER,o=n.isScreen?Xd.onUserUnpublishScreen:Xd.onUserUnpublishStream,a=zU.NONE;n.attributes.audiostream&&(a|=Sd.AUDIO),n.attributes.videostream&&(a|=Sd.VIDEO),a!==zU.NONE&&(this.safeEmit(o,{userId:n.userId,mediaType:a,reason:i}),this.safeEmit("onRemoveStream",{userId:n.userId,isScreen:n.isScreen})),this._getRemotePlayer(n.userId,n.isScreen).forEach((function(e){var t=n.isScreen?"".concat(n.userId,"_screen"):n.userId;r._remoteAudioPlayer.delete(t),n.isScreen?r._remoteScreenPlayer.delete(n.userId):r._remoteVideoPlayer.delete(n.userId),null==e||e.destroy()}))}},{key:"_onUserConnection",value:function(e){var t=this;setTimeout((function(){return t.safeEmit(Xd.onUserJoined,e)}))}},{key:"_onUserLeave",value:function(e){var t=this,r=e.userInfo;this._getRemotePlayer(r.userId,!0).forEach((function(e){var n="".concat(r.userId,"_screen");t._remoteAudioPlayer.delete(n),t._remoteScreenPlayer.delete(r.userId),null==e||e.destroy()})),this._getRemotePlayer(r.userId,!1).forEach((function(e){var n=r.userId;t._remoteAudioPlayer.delete(n),t._remoteVideoPlayer.delete(r.userId),null==e||e.destroy()})),this.safeEmit(Xd.onUserLeave,e)}},{key:"_onRoomError",value:function(e){var t;this.safeEmit(Xd.onError,e),null===(t=this._room)||void 0===t||t.destroy(),this._room=void 0}},{key:"_onNetworkQuality",value:function(){for(var e,t=arguments.length,r=new Array(t),n=0;n<t;n++)r[n]=arguments[n];this.safeEmit.apply(this,wm(e=[Xd.onNetworkQuality]).call(e,r))}},{key:"_onConnectionStateChange",value:function(e){if(void 0!==this._startCloudProxyTimestamp&&this._ctx.useCloudProxy&&e.state===Ed.CONNECTION_STATE_CONNECTED&&this.safeEmit(Xd.onCloudProxyConnected,{interval:Date.now()-this._startCloudProxyTimestamp}),this.safeEmit(Xd.onConnectionStateChanged,e),e.state===Ed.CONNECTION_STATE_RECONNECTING){var t,r=Jk(this._remoteAudioPlayer);try{for(r.s();!(t=r.n()).done;){var n=Qk(t.value,2),i=n[0],o=n[1];null!=i&&cA(i).call(i,"mux")&&o.stop()}}catch(a){r.e(a)}finally{r.f()}}}},{key:"_getRemotePlayer",value:function(e,t){var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:Sd.AUDIO_AND_VIDEO,n=(t?this._remoteScreenAudioPlayer:this._remoteAudioPlayer).get(e),i=(t?this._remoteScreenPlayer:this._remoteVideoPlayer).get(e),o=[];return r&Sd.AUDIO&&o.push(n),r&Sd.VIDEO&&o.push(i),o}},{key:"_stopAudioPropertiesReport",value:function(){null!==this._audioPropertiesReportTimer&&(clearInterval(this._audioPropertiesReportTimer),this._audioPropertiesReportTimer=null)}},{key:"_onResubscribe",value:function(e){e.stream&&(this._getRemotePlayer(e.stream.userId,e.stream.isScreen).forEach((function(e){return null==e?void 0:e.stop()})),this._updateAudioPlayerState(e.stream),this._updateVideoPlayerState(e.stream))}},{key:"_onSubscribePushTrack",value:function(e){e.stream&&this._updateAudioPlayerState(e.stream)}},{key:"_onRemovePushTrack",value:function(e){var t=this;if(e.stream){this._updateAudioPlayerState(e.stream);var r=e.stream;this._getRemotePlayer(r.userId,r.isScreen,e.mediaType).forEach((function(n){var i=r.isScreen?"".concat(r.userId,"_screen"):r.userId;e.mediaType&Sd.AUDIO&&t._remoteAudioPlayer.delete(i),r.isScreen?e.mediaType&Sd.VIDEO&&t._remoteScreenPlayer.delete(r.userId):e.mediaType&Sd.VIDEO&&t._remoteVideoPlayer.delete(r.userId),null==n||n.destroy()}))}}},{key:"_onVideoDeviceStateChange",value:function(e){this.safeEmit(Xd.onVideoDeviceStateChanged,e)}},{key:"_onAudioDeviceStateChange",value:function(e){this.safeEmit(Xd.onAudioDeviceStateChanged,e)}},{key:"_onUserPublishStateChange",value:function(e){var t,r=e.userId,n=e.isScreen,i=e.mediaType,o=e.pubState,a=e.remoteStream,s={userId:r,mediaType:i};n?o===UV.PUB?this.safeEmit(Xd.onUserPublishScreen,s):this.safeEmit(Xd.onUserUnpublishScreen,ud(ud({},s),{},{reason:bd.STREAM_REMOVE_REASON_UNPUBLISH})):o===UV.PUB?(s.videoStreamDescriptions=null==a||null===(t=a.attributes)||void 0===t?void 0:t.videoDescriptions,this.safeEmit(Xd.onUserPublishStream,s),this._handleAutoSubscribe(a,!0)):this.safeEmit(Xd.onUserUnpublishStream,ud(ud({},s),{},{reason:bd.STREAM_REMOVE_REASON_UNPUBLISH}))}},{key:"_onCustomMessage",value:function(e){var t=e.message;e.binary?this.safeEmit(Xd.onRoomBinaryMessageReceived,{userId:e.clientId,message:t}):this.safeEmit(Xd.onRoomMessageReceived,{userId:e.clientId,message:t})}},{key:"_onUserMessageReceived",value:function(e){this._messageStatisticsObserver.recvP2PMessage(e.userId),this.safeEmit(Xd.onUserMessageReceived,e)}},{key:"_onUserBinaryMessageReceived",value:function(e){this._messageStatisticsObserver.recvP2PMessage(e.userId),this.safeEmit(Xd.onUserBinaryMessageReceived,e)}},{key:"_onLiveTranscodingResult",value:function(e){this.safeEmit(Xd.onLiveTranscodingResult,e)}},{key:"_onStreamMixingEvent",value:function(e){this.safeEmit(Xd.onStreamMixingEvent,e)}},{key:"_onUserTokenWillExpire",value:function(){this.safeEmit(Xd.onTokenWillExpire)}},{key:"_onPushPublicStreamResult",value:function(e){this.safeEmit(Xd.onPushPublicStreamResult,e)}},{key:"_handleRTMClient",value:function(e){var t=this;e.on("onUserMessageReceivedOutsideRoom",(function(e){t._messageStatisticsObserver.recvP2POutRoomMessage(e.userId),t.safeEmit(Xd.onUserMessageReceivedOutsideRoom,e)})),e.on("onUserBinaryMessageReceivedOutsideRoom",(function(e){t._messageStatisticsObserver.recvP2POutRoomMessage(e.userId),t.safeEmit(Xd.onUserBinaryMessageReceivedOutsideRoom,e)})),e.on("onUserDisconnection",(function(){t.safeEmit(Xd.onError,{errorCode:uA.RTM_DUPLICATE_LOGIN})})),e.on("onRTMTokenError",(function(){t.safeEmit(Xd.onError,{errorCode:uA.RTM_TOKEN_ERROR})})),e.on("onServerParamsSetResult",(function(e){t.safeEmit(Xd.onServerParamsSetResult,null==e?void 0:e.code)}))}},{key:"waitForNewToken",get:function(){return!!this._tempRoomInfo}},{key:"localAudioTrack",get:function(){return this._localAudioTrack}},{key:"localVideoTrack",get:function(){return this._localVideoTrack}},{key:"localScreenAudioTrack",get:function(){return this._localScreenAudioTrack}},{key:"localScreenVideoTrack",get:function(){return this._localScreenVideoTrack}},{key:"remoteStreams",get:function(){var e,t,r=[];null!==(e=this._room)&&void 0!==e&&e.remoteStreams&&(null===(t=this._room)||void 0===t||t.remoteStreams.forEach((function(e){Array.isArray(e)&&e.forEach((function(e){r.push({userId:e.userId,isScreen:e.isScreen,hasVideo:e.hasVideo,hasAudio:e.hasAudio,videoStreamDescriptions:e.attributes.videoDescriptions})}))})));return r}},{key:"iceState",get:function(){var e,t,r,n;return null===(e=this._room)||void 0===e||null===(t=e._mediaServerClient)||void 0===t||null===(r=t.handler)||void 0===r||null===(n=r._peerConnection)||void 0===n?void 0:n.iceConnectionState}},{key:"remoteUsers",get:function(){var e,t,r=[];null!==(e=this._room)&&void 0!==e&&e.remoteUsers&&(null===(t=this._room)||void 0===t||t.remoteUsers.forEach((function(e){r.push({userId:e.userId})})));return r}},{key:"multiChatMode",get:function(){var e,t;return!(null===(e=this._room)||void 0===e||null===(t=e._mediaServerClient)||void 0===t||!t.roomAttributes.multiChatMode)}},{key:"_handleAudioDeviceManager",value:function(){var e=this;this._audioDeviceManager.on("onAudioPlaybackDeviceTestVolume",(function(t){e.safeEmit(Xd.onAudioPlaybackDeviceTestVolume,t)}))}},{key:"_assertNotInRoom",value:function(){if(!this._room||this._room.connectionState!==Yj.CONNECTED)throw new lA(uA.NOT_CONNECTED_YET,"server not connected")}},{key:"_checkMediaType",value:function(e){$P(e,"mediaType",[Sd.AUDIO,Sd.VIDEO,Sd.AUDIO_AND_VIDEO])}},{key:"_getUserId",value:function(){var e,t;return(null===(e=this._room)||void 0===e||null===(t=e.roomInfo)||void 0===t?void 0:t.userInfo.userId)||"local_user"}},{key:"_switchTrack",value:(t=km(Em().mark((function e(t){var r,n,i;return Em().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this._initLocalTrackEvents(t),this._localVideoTrack=t,null!==(r=this._videoPlayer)&&void 0!==r&&r.played&&(this._videoPlayer.stop(),this._videoPlayer.playVideo(t),this._videoPlayer.mirror(!!this._mirrorType)),null===(n=this._room)||void 0===n||null===(i=n.localStream)||void 0===i||!i.pubVideo){e.next=6;break}return e.next=6,this._updatePublish();case 6:case"end":return e.stop()}}),e,this)}))),function(e){return t.apply(this,arguments)})},{key:"_shouldUpdateAudioConf",value:function(e){var t,r,n,i=(null===(t=this._room)||void 0===t?void 0:t.hasPublished)||(null===(r=this._room)||void 0===r||null===(n=r.localStream)||void 0===n?void 0:n.pubAudio)||this._localAudioTrack&&this._localAudioTrack.sourceType===oU.INTERNAL;if(i){var o="engine.".concat(e," should be called before publishing or capturing.");console.warn("[RTC WebSDK]: "+o),IO(this.id,e,o)}return!i}},{key:"_getServerConfig",value:function(){var e=this;AO({engineId:this.id,appId:this.appId,sdkVersion:XP("VERSION"),requestDomains:XP("CONFIG_REQUEST_DOMAINS"),keys:["rts_report","web_join_room"]}).then((function(t){t.rts_report&&_O.setConfig(t.rts_report),e._ctx.joinRoomConfig.setServerConfig(t.web_join_room)}))}}]),Ee}(bD);kX([TO()],RX.prototype,"updateToken",1),kX([TO()],RX.prototype,"setVideoCaptureDevice",1),kX([TO()],RX.prototype,"setAudioCaptureDevice",1),kX([function(e,t,r){if("function"==typeof r.value){var n=r.value;r.value=function(){for(var e,t=EO(this.id),r=arguments.length,i=new Array(r),o=0;o<r;o++)i[o]=arguments[o];return null==t||t.set({room_id:i[1],user_id:null===(e=i[2])||void 0===e?void 0:e.userId}),n.apply(this,i)}}},TO()],RX.prototype,"connect",1),kX([TO()],RX.prototype,"joinRoom",1),kX([TO()],RX.prototype,"leaveRoom",1),kX([TO()],RX.prototype,"destroy",1),kX([TO()],RX.prototype,"publishStream",1),kX([TO()],RX.prototype,"unpublishStream",1),kX([TO()],RX.prototype,"publishScreen",1),kX([TO()],RX.prototype,"unpublishScreen",1),kX([TO()],RX.prototype,"subscribeStream",1),kX([TO()],RX.prototype,"unsubscribeStream",1),kX([TO()],RX.prototype,"subscribeScreen",1),kX([TO()],RX.prototype,"unsubscribeScreen",1),kX([TO()],RX.prototype,"setRemoteVideoConfig",1),kX([TO()],RX.prototype,"startVideoCapture",1),kX([TO()],RX.prototype,"stopVideoCapture",1),kX([TO()],RX.prototype,"startAudioCapture",1),kX([TO()],RX.prototype,"stopAudioCapture",1),kX([TO()],RX.prototype,"getAudioMixingManager",1),kX([TO()],RX.prototype,"startScreenCapture",1),kX([TO()],RX.prototype,"stopScreenCapture",1),kX([TO()],RX.prototype,"setLocalVideoPlayer",1),kX([TO()],RX.prototype,"startLiveTranscoding",1),kX([TO()],RX.prototype,"updateLiveTranscoding",1),kX([TO()],RX.prototype,"stopLiveTranscoding",1),kX([TO()],RX.prototype,"startSubtitle",1),kX([TO()],RX.prototype,"stopSubtitle",1),kX([TO()],RX.prototype,"setBusinessId",1),kX([TO()],RX.prototype,"setUserVisibility",1),kX([TO()],RX.prototype,"setRemoteVideoPlayer",1),kX([TO()],RX.prototype,"setLocalVideoMirrorType",1),kX([TO()],RX.prototype,"setAudioPlaybackDevice",1),kX([TO()],RX.prototype,"play",1),kX([TO()],RX.prototype,"pauseAllSubscribedStream",1),kX([TO()],RX.prototype,"resumeAllSubscribedStream",1),kX([TO()],RX.prototype,"sendUserMessage",1),kX([TO()],RX.prototype,"sendUserBinaryMessage",1),kX([TO()],RX.prototype,"sendRoomMessage",1),kX([TO()],RX.prototype,"sendRoomBinaryMessage",1),kX([TO()],RX.prototype,"setAudioCaptureConfig",1),kX([eP("4.51"),TO()],RX.prototype,"setVideoCaptureConfig",1),kX([TO()],RX.prototype,"enableSimulcastMode",1),kX([TO()],RX.prototype,"setVideoEncoderConfig",1),kX([TO()],RX.prototype,"setScreenEncoderConfig",1),kX([TO()],RX.prototype,"sendSEIMessage",1),kX([eP("4.42"),TO()],RX.prototype,"setAudioVolumeIndicationInterval",1),kX([TO()],RX.prototype,"enableAudioPropertiesReport",1),kX([TO()],RX.prototype,"setVideoSourceType",1),kX([TO()],RX.prototype,"setExternalVideoTrack",1),kX([TO()],RX.prototype,"setAudioSourceType",1),kX([TO()],RX.prototype,"setExternalAudioTrack",1),kX([TO()],RX.prototype,"login",1),kX([TO()],RX.prototype,"logout",1),kX([TO()],RX.prototype,"updateLoginToken",1),kX([TO()],RX.prototype,"getPeerOnlineStatus",1),kX([TO()],RX.prototype,"sendUserMessageOutsideRoom",1),kX([TO()],RX.prototype,"sendUserBinaryMessageOutsideRoom",1),kX([TO()],RX.prototype,"setServerParams",1),kX([TO()],RX.prototype,"sendServerMessage",1),kX([TO()],RX.prototype,"sendServerBinaryMessage",1),kX([TO()],RX.prototype,"startCloudProxy",1),kX([TO()],RX.prototype,"stopCloudProxy",1),kX([TO()],RX.prototype,"startPushPublicStream",1),kX([TO()],RX.prototype,"updatePublicStreamParam",1),kX([TO()],RX.prototype,"stopPushPublicStream",1),kX([TO("streamId")],RX.prototype,"startPlayPublicStream",1),kX([TO("streamId")],RX.prototype,"stopPlayPublicStream",1),kX([TO()],RX.prototype,"setAudioProfile",1),kX([TO()],RX.prototype,"setPublicStreamVideoPlayer",1),kX([TO()],RX.prototype,"setDummyCaptureImagePath",1),kX([TO()],RX.prototype,"registerExtension",1),kX([TO()],RX.prototype,"startAudioPlaybackDeviceTest",1),kX([TO()],RX.prototype,"stopAudioPlaybackDeviceTest",1),kX([TO()],RX.prototype,"startAudioDeviceRecordTest",1),kX([TO()],RX.prototype,"stopAudioDeviceRecordAndPlayTest",1),kX([TO()],RX.prototype,"stopAudioDevicePlayTest",1),kX([TO()],RX.prototype,"setRemoteUserPriority",1),kX([TO()],RX.prototype,"takeLocalSnapshot",1),kX([TO()],RX.prototype,"takeRemoteSnapshot",1),kX([TO()],RX.prototype,"setSubscribeFallbackOption",1),kX([TO()],RX.prototype,"getLocalStreamTrack",1),kX([TO()],RX.prototype,"getRemoteStreamTrack",1),kX([TO()],RX.prototype,"getPublicStreamTrack",1),kX([TO()],RX.prototype,"setRemoteStreamRenderSync",1),kX([TO()],RX.prototype,"startForwardStreamToRooms",1),kX([TO()],RX.prototype,"updateForwardStreamToRooms",1),kX([TO()],RX.prototype,"stopForwardStreamToRooms",1),kX([TO()],RX.prototype,"pauseForwardStreamToAllRooms",1),kX([TO()],RX.prototype,"resumeForwardStreamToAllRooms",1);var AX,CX={"client unpublished":bd.STREAM_REMOVE_REASON_UNPUBLISH,"publish failed":bd.STREAM_REMOVE_REASON_PUBLISH_FAILED,"stream removed":bd.STREAM_REMOVE_REASON_KEEP_LIVE_FAILED,"client disconnected":bd.STREAM_REMOVE_REASON_CLIENT_DISCONNECTED,"client republish":bd.STREAM_REMOVE_REASON_REPUBLISH},wX=new uO("VERTC",0);oO.storeKey=wm(AX="".concat(Date.now(),"-")).call(AX,UP.getDeviceId()),fO({rtc_sdk_version:zP.VERSION,device_id:UP.getDeviceId(),log_cache_key:oO.storeKey}),mO(zP.LOG_SERVER_URL);var xX=1,OX=function(e,t){wX.print("createEngine","Invoke VERTC.createEngine"),ZP(e,"appId");var r=(xX++).toString();return function(e,t){var r=new Bx(e);r.set(ud(ud({},t),{},{engine_session_id:rC()})),r.report("sdk_init_engine",{start:Date.now(),type:"begin"}),bO.set(e,r)}(r,{rtc_app_id:e,auto_play_policy:null==t?void 0:t.autoPlayPolicy}),new RX(e,r,t)},PX=function(e){if(wX.print("destroyEngine","Invoke VERTC.destroyEngine"),!(e instanceof RX))throw new lA(uA.INVALID_ENGINE,"Invalid engine object");var t;e.destroy(),(t=e.monitor).report("sdk_init_engine",{start:Date.now(),type:"end"}),bO.delete(t.id)},DX=function(){var e=km(Em().mark((function e(){return Em().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",qL.enumerateDevices());case 1:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}(),MX=function(){var e=km(Em().mark((function e(){var t,r,n,i,o,a,s=arguments;return Em().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t=s.length>0&&void 0!==s[0]?s[0]:{video:!0,audio:!0},r=t.video,n=t.audio,i={video:!1,audio:!1},!r){e.next=13;break}return e.prev=4,e.next=7,qL.getPermissions({video:!0,force:!0});case 7:o=e.sent,i.video=o.video,e.next=13;break;case 11:e.prev=11,e.t0=e.catch(4);case 13:if(!n){e.next=23;break}return e.prev=14,e.next=17,qL.getPermissions({audio:!0,force:!0});case 17:a=e.sent,i.audio=a.audio,e.next=23;break;case 21:e.prev=21,e.t1=e.catch(14);case 23:return e.abrupt("return",i);case 24:case"end":return e.stop()}}),e,null,[[4,11],[14,21]])})));return function(){return e.apply(this,arguments)}}(),NX=function(){var e=km(Em().mark((function e(){return Em().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",qL.enumerateAudioCaptureDevices());case 1:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}(),LX=function(){var e=km(Em().mark((function e(){return Em().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",qL.enumerateVideoCaptureDevices());case 1:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}(),UX=function(){var e=km(Em().mark((function e(){return Em().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",qL.enumerateAudioPlaybackDevices());case 1:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}(),VX=function(){return zP.VERSION},FX=function(){return yO("isSupported",0,""),hN()},BX=function(){return yO("getSupportedCodecs",0,""),_N()},jX=function(e){var t=e.logLevel,r=e.LogfileSize;t&&(oO.logLevel=t),r&&(oO.LogfileSize=r)},GX=function(e){oO.download(e)};return ud(ud(ud(ud({},new(qd((function e(){Yd(this,e),sd(this,"getSdkVersion",VX),sd(this,"createEngine",OX),sd(this,"destroyEngine",PX),sd(this,"enumerateDevices",DX),sd(this,"enableDevices",MX),sd(this,"enumerateAudioCaptureDevices",NX),sd(this,"enumerateVideoCaptureDevices",LX),sd(this,"enumerateAudioPlaybackDevices",UX),sd(this,"getParameter",XP),sd(this,"setParameter",KP),sd(this,"isSupported",FX),sd(this,"getSupportedCodecs",BX),sd(this,"events",Xd),sd(this,"ErrorCode",uA),sd(this,"platform","VolcEngine"),sd(this,"commitInfo","release_454<d2c50df>"),sd(this,"downloadLog",GX),sd(this,"setLogConfig",jX)})))),jd),Kd),{},{events:Xd})}));
